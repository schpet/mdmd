{"id":"bd-16x","title":"Document new serve semantics and index/404 policies","description":"Document behavior and operational expectations for the new serving model. Ensure maintainers and users understand root/index behavior, pathful startup URLs, and omission rules.\n\nImplementation details:\n- Update the mdmd serve help text in src/main.rs to reflect implemented semantics:\n  - startup output includes primary pathful URL (for example http://127.0.0.1:3333/playground/README.md) and root index URL (http://127.0.0.1:3333/).\n  - GET / renders root directory index, not entry document.\n  - directory index policies: dotfiles excluded, out-of-root symlinks omitted.\n  - broken links render rich recovery 404 with nearest-parent links/listing.\n- Add maintainer-facing doc at docs/serve-semantics.md (preferred over AGENTS edits) summarizing:\n  - CWD-based serve_root model,\n  - routing order and branch outcomes,\n  - listing/404 policies,\n  - canonical test and e2e commands.\n- Add a short release-verification runbook section that references the exact integration/e2e commands and expected log markers.\n\nFiles to update:\n- src/main.rs help/after_help text.\n- docs/serve-semantics.md (new or updated) as the canonical behavior contract.\n\nDependency links:\n- Depends on completed implementation/testing tasks.\n- Closes once docs align exactly with tested behavior/output labels.\n\n## Verification Steps\n- Run docs-linked commands (unit, integration, and tests/e2e_serve_navigation.sh under RUST_LOG=debug).\n- Verify help text and docs output labels match implementation exactly (pathful entry URL line, root index URL line, branch-log keys).\n- Confirm docs/serve-semantics.md is the canonical reference and command snippets execute as written.","acceptance_criteria":"1) CLI/help/docs describe final serve semantics accurately: pathful startup entry URL + root index URL, GET / as root index, and rich 404 recovery behavior. 2) Documentation explicitly records directory-index omission policies (dotfiles excluded, out-of-root symlinks omitted) and CWD-based serve_root behavior. 3) docs/serve-semantics.md is the canonical maintainer reference; AGENTS.md is not required for this feature documentation. 4) Docs link to canonical automated checks: unit tests, integration tests, and tests/e2e_serve_navigation.sh under RUST_LOG=debug. 5) Command snippets and expected log/output labels match implementation exactly (including both startup URL lines and branch-log keys). 6) Verification pass confirms docs-linked commands execute and produce sectioned, detailed logs.","status":"closed","priority":2,"issue_type":"docs","created_at":"2026-02-24T22:57:03.486909206Z","created_by":"exedev","updated_at":"2026-02-25T00:21:34.015345725Z","closed_at":"2026-02-25T00:21:34.015294153Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-16x","depends_on_id":"bd-2uj","type":"blocks","created_at":"2026-02-24T22:57:18.413014953Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-16x","depends_on_id":"bd-3ci","type":"blocks","created_at":"2026-02-24T22:57:19.017097786Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-16x","depends_on_id":"bd-3h2","type":"blocks","created_at":"2026-02-24T22:57:19.620213543Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-16x","depends_on_id":"bd-3u5","type":"blocks","created_at":"2026-02-24T22:57:19.318709773Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-16x","depends_on_id":"bd-uso","type":"blocks","created_at":"2026-02-24T22:57:18.716838114Z","created_by":"exedev","metadata":"{}","thread_id":""}],"comments":[{"id":8,"issue_id":"bd-16x","author":"Peter Schilling","text":"Documentation should be treated as behavioral contract: root index semantics, startup URLs, and listing policies must match tests and runtime output exactly.","created_at":"2026-02-24T22:57:36Z"}]}
{"id":"bd-17g","title":"Wire backlinks index into AppState and request lookup path","description":"Objective and scope:\n- Thread startup-built backlinks index into shared server state and request handling pipeline.\n- Scope includes AppState extension, lookup key derivation for current page, and fallback behavior for non-markdown/error pages.\n\nImplementation details:\n- Add field to AppState in serve.rs:\n  pub backlinks: HashMap<String, Vec<BacklinkRef>>,\n  (import: use crate::backlinks::BacklinkRef; use std::collections::HashMap;)\n  NOTE: AppState is already stored in Arc<AppState>. Do NOT add an inner Arc<HashMap> — the outer Arc is sufficient.\n- In run_serve, BEFORE constructing AppState (around line 1246), call:\n  let backlinks = crate::backlinks::build_backlinks_index(&canonical_root);\n  where canonical_root is the variable already computed at that point (NOT a field of state, which does not exist yet). Then pass backlinks into the AppState constructor.\n- In serve_handler, at the markdown render path (serve.rs:1099-1101 area):\n  let key = crate::backlinks::url_key_from_rel_path(&norm_display);\n  let backlinks_slice = state.backlinks.get(&key).map(Vec::as_slice).unwrap_or(&[]);\n  Pass backlinks_slice into PageShellContext.\n- For non-markdown responses (static assets, raw mode, directory index, 404): pass &[] via PageShellContext.\n- Keep all existing normalization logic unchanged.\n\nDependency links:\n- Depends on index-build (bd-1hd) and key-contract (bd-r8y).\n- Blocks HTML rendering (bd-1fc) and file-change detection (bd-38z).\n\nAcceptance criteria:\n- build_backlinks_index is called with the canonical_root variable (before AppState exists).\n- Runtime lookup returns expected backlinks for indexed pages.\n- No regressions for non-markdown responses.\n- No inner Arc; outer Arc<AppState> provides O(1) clone.\n\nTest requirements:\n- Unit: verify url_key_from_rel_path(norm_display) produces correct key. Test populated map lookup and empty-slice fallback.\n- E2E: GET doc with inbound links → page HTML has backlink entries. GET doc with no links → 'No backlinks yet.' text.\n- Logging: optional debug!('[backlinks] key={} found={}', key, count) for diagnosis.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-25T01:14:39.640876144Z","created_by":"exedev","updated_at":"2026-02-25T05:01:18.604710896Z","closed_at":"2026-02-25T05:01:18.604672008Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-17g","depends_on_id":"bd-1hd","type":"blocks","created_at":"2026-02-25T01:14:52.756603580Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-17g","depends_on_id":"bd-r8y","type":"blocks","created_at":"2026-02-25T01:14:52.423099978Z","created_by":"exedev","metadata":"{}","thread_id":""}],"comments":[{"id":30,"issue_id":"bd-17g","author":"Peter Schilling","text":"Design note: AppState wiring should avoid per-request filesystem rescans. All request-time work should be key derivation + map lookup only, to keep latency predictable on large doc trees.","created_at":"2026-02-25T01:15:11Z"}]}
{"id":"bd-18i","title":"serve2 slice 3: SSR markdown pipeline","description":"## Covered Sections\n- executable-decomposition\n- slice-3-ssr-markdown-pipeline-gfm-link-rewrite-mermaid-mode\n- validation-strategy\n- cross-slice-dependencies\n- gate-a-approval-checklist\n\n## Acceptance Criteria\n- GFM fixtures render correctly.\n- Mermaid fences render as diagrams (`client`) or code (`off`).\n- Nested relative links resolve to correct rendered pages from configured root.\n- Markdown conversion occurs server-side; client JS is limited to Mermaid execution and TOC active-state behavior.\n\n## Verification Steps\n- Run fixture-based render tests for tables/task-lists/strikethrough and syntax highlighting output markers.\n- Run Mermaid mode integration tests asserting rendered diagram container in `client` mode and preserved code fence in `off` mode.\n- Run link-rewrite tests from nested directories asserting resolved served URLs and no root-escape rewrites.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-23T06:57:33.996857597Z","created_by":"exedev","updated_at":"2026-02-24T00:11:18.158404927Z","closed_at":"2026-02-24T00:11:18.158385471Z","close_reason":"Cleaning up for fresh start","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-18i","depends_on_id":"bd-kcr","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-19b","title":"Heading navigation: n/p to jump between headings","description":"Implement heading-to-heading navigation using n (next heading) and p (previous heading). When pressed, the viewport should jump so the target heading appears at the top of the screen (or near the top with a small margin). The status bar should indicate the current heading context. This directly mirrors delta's navigate feature but built into the TUI.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-21T00:28:51.683391877Z","created_by":"exedev","updated_at":"2026-02-21T00:59:21.446601573Z","closed_at":"2026-02-21T00:59:21.446560142Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-19b","depends_on_id":"bd-1by","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-19b","depends_on_id":"bd-1sf","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-1by","title":"Viewport scrolling: j/k/arrows/page-up/page-down/gg/G navigation","description":"Implement vertical scrolling through the rendered markdown content. The viewport should track a scroll offset and render only the visible portion. Support: j/Down (scroll down one line), k/Up (scroll up one line), Ctrl-d/Page-Down (half page down), Ctrl-u/Page-Up (half page up), g/Home (top of document), G/End (bottom of document). Show a scroll position indicator in the status bar.","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-02-21T00:28:51.402568381Z","created_by":"exedev","updated_at":"2026-02-21T00:55:38.501072239Z","closed_at":"2026-02-21T00:55:38.501024827Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1by","depends_on_id":"bd-p4x","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-1dt","title":"Support entry paths outside cwd with explicit startup safety warning/confirm","description":"Objective and scope:\n- Allow mdmd serve entry paths outside cwd while warning users about network exposure risk and confirming in interactive mode.\n- Scope includes serve_root derivation logic change, cwd containment detection, warning text, TTY prompt policy, non-interactive auto-continue behavior, and decline exit behavior.\n\nImplementation details:\n- Current behavior (in src/serve.rs run_serve): serve_root = CWD always; entry paths outside CWD are REJECTED at lines 1217-1225 with an error.\n- New behavior:\n  1. Canonicalize entry path as before.\n  2. Check if canonical_entry starts_with canonical_root (CWD):\n     - YES (entry is inside CWD): preserve existing behavior, serve_root = CWD. No warning.\n     - NO (entry is outside CWD): derive serve_root from entry:\n       - If canonical_entry is a directory: serve_root = canonical_entry\n       - If canonical_entry is a file: serve_root = canonical_entry.parent().unwrap_or(&canonical_entry)\n       Then emit warning and prompt (see below).\n  3. Replace the current rejection block (lines 1217-1225) with the above logic.\n  4. After new serve_root is chosen for out-of-cwd case, recompute canonical_root = fs::canonicalize(&serve_root).unwrap_or(serve_root.clone()), then update the serve_root variable too.\n- Warning text (print to stderr):\n  'WARNING: Serving files from outside your current working directory.'\n  'serve_root: {serve_root_display}'\n  'Any file under this directory may be accessible to others on your network.'\n  'Proceed? [y/N] '\n  (flush stderr before blocking on stdin)\n- TTY detection: use std::io::IsTerminal — this trait was stabilized in Rust 1.70. Since axum 0.8 requires Rust 1.75+, this project can rely on IsTerminal without the atty crate. Do NOT add the atty crate as a dependency. Call std::io::stdin().is_terminal().\n- Interactive TTY branch (is_terminal() == true):\n  - Read one line from stdin via std::io::BufRead::lines() or read_line().\n  - Accept 'y' or 'yes' (case-insensitive trim); anything else → eprintln!('Aborted.') and std::process::exit(1).\n- Non-interactive branch (is_terminal() == false):\n  - Print '[info] Non-interactive stdin; proceeding without confirmation.' to stderr.\n  - Continue startup without reading from stdin.\n- Order of operations in run_serve:\n  1. Compute and canonicalize entry path.\n  2. Detect out-of-cwd; optionally prompt (before any banner output that implies success).\n  3. Build backlinks index using final canonical_root.\n  4. Construct AppState with final serve_root + canonical_root.\n  5. Bind and print startup banner.\n- In-cwd entry path behavior is UNCHANGED: serve_root = CWD, canonical_root = canonicalize(CWD).\n\nDependency links:\n- Independent of backlinks indexing but required by same release scope.\n- Blocks integration tests for out-of-cwd and cross-directory serving flows (bd-26u.3).\n- Blocks cross-directory resolution task (bd-2ag).\n\nAcceptance criteria:\n- In-cwd serve starts without prompt and serve_root = CWD (no behavioral regression).\n- Out-of-cwd interactive flow prompts, obeys confirm (y/yes/Y/YES) with server start, obeys anything else with exit code 1.\n- Non-interactive mode (stdin not a tty) warns then proceeds without blocking.\n- Backlinks index and AppState are built against the correct serve_root in all cases.\n- No atty crate added; uses std::io::IsTerminal exclusively.\n\nTest requirements (unit and e2e, with logging expectations):\n- Unit: test cwd containment detection logic as a pure function with in-cwd and out-of-cwd PathBuf fixtures. Test prompt parsing as a pure function: accepts 'y', 'yes', 'Y', 'YES'; rejects '', 'n', 'N', 'no', 'yes please'.\n- E2E: subprocess-based tests using the pattern in tests/serve_integration.rs (Command + Stdio::piped):\n  (1) In-cwd: start server with CWD-relative entry via ServerHandle; assert stderr does NOT contain 'WARNING'.\n  (2) Out-of-cwd non-interactive: spawn with Stdio::null() as stdin (simulates non-tty); assert 'WARNING' in stderr + server starts successfully.\n  (3) Out-of-cwd interactive decline: write 'n\\n' to stdin pipe; assert process exits with code 1 and stderr contains 'Aborted'.\n  (4) Out-of-cwd interactive confirm: write 'y\\n' to stdin pipe; assert server starts.\n- Logging: warning text must include 'WARNING' and serve_root path. Decline path must print 'Aborted.' (exact) and exit non-zero.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-25T01:14:40.600434088Z","created_by":"exedev","updated_at":"2026-02-25T01:52:44.258798675Z","closed_at":"2026-02-25T01:52:44.258769940Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":33,"issue_id":"bd-1dt","author":"Peter Schilling","text":"Security messaging constraint: warning text must clearly describe exposure risk in plain language. Interactive confirm is a deliberate friction point; non-interactive auto-continue is required by planner assumption for automation contexts.","created_at":"2026-02-25T01:15:12Z"}]}
{"id":"bd-1fc","title":"Render backlinks panel under top chrome and remove stale 'back to' assumptions","description":"Objective and scope:\n- Add server-rendered backlinks UI below top chrome, including populated and empty states, and remove stale 'back to' assumptions.\n- Scope includes introducing a PageShellContext struct, HTML template wiring, CSS styling, fragment hint display, anchor scroll-offset behavior, and the build_page_shell signature change.\n- NOTE: The same signature change also accommodates mtime from bd-38z; coordinate so both parameters are added together in a single context struct.\n\nImplementation details:\n- INTRODUCE PageShellContext struct (in src/html.rs) to avoid multiple sequential signature changes:\n  pub struct PageShellContext<'a> {\n    pub backlinks: &'a [BacklinkRef],\n    pub file_mtime_secs: Option<u64>,   // from bd-38z; None = no freshness polling\n    pub page_url_path: Option<&'a str>, // from bd-38z; root-relative path for meta tag\n  }\n  (Additional fields may be added as needed without further signature churn.)\n- Change build_page_shell signature to:\n  pub fn build_page_shell(body_html: &str, headings: &[HeadingEntry], file_path: &Path, serve_root: &Path, ctx: &PageShellContext) -> String\n- IMPORTANT: there are 7+ call sites in html.rs tests (lines 711, 728, 738, 750, 760, 776, etc.) and one in serve.rs (line 1101) — ALL must be updated. Test sites pass PageShellContext { backlinks: &[], file_mtime_secs: None, page_url_path: None }. Serve site passes real values from state and request handler.\n- HTML structure: insert between </header> and <div class='layout'>:\n  ORDER (top to bottom):\n  1. File update notice div (always emitted, hidden by default; JS from bd-38z controls visibility):\n     <div id='mdmd-change-notice' class='change-notice' hidden>\n       This file has changed on disk.\n       <button class='change-notice-reload' onclick='location.reload()'>Load latest</button>\n     </div>\n  2. Backlinks panel section:\n     Non-empty: <section class='backlinks-panel' aria-label='Backlinks'>\n                  <h2 class='backlinks-header'>Backlinks ({N})</h2>\n                  <ul class='backlinks-list'>\n                    <li class='backlinks-item'>\n                      <a class='backlinks-source' href='{source_url_path}#{fragment}'>{source_display}</a>\n                      [<span class='backlinks-fragment'> § {fragment}</span> when fragment present]\n                      <p class='backlinks-snippet'>{html-escaped snippet}</p>\n                    </li>\n                  </ul>\n                </section>\n     Empty: <section class='backlinks-panel backlinks-panel--empty' aria-label='Backlinks'>\n              <p class='backlinks-empty-text'>No backlinks yet.</p>\n            </section>\n  3. <div class='layout'> (existing)\n- The file update notice is always server-emitted (hidden attribute); JS removes the hidden attribute when change detected. This avoids JS DOM insertion complexity and is accessible.\n- When ctx.file_mtime_secs is None, emit the notice element with hidden; JS will skip polling when meta tags are absent.\n- CSS additions in src/web_assets.rs:\n  .change-notice { display: none; background: #fff3cd; border: 1px solid #ffc107; padding: 0.5rem 1rem; margin: 0; font-size: 0.9rem; align-items: center; gap: 0.75rem; }\n  .change-notice:not([hidden]) { display: flex; }\n  .change-notice-reload { background: #ffc107; border: none; padding: 0.25rem 0.75rem; cursor: pointer; border-radius: 3px; font-weight: 600; }\n  .backlinks-panel { padding: 0.75rem 1.5rem; border-bottom: 1px solid var(--border-color, #e0e0e0); }\n  .backlinks-header { font-size: 0.9rem; font-weight: 600; color: #666; margin: 0 0 0.5rem; }\n  .backlinks-list { list-style: none; margin: 0; padding: 0; }\n  .backlinks-item { margin: 0.4rem 0; }\n  .backlinks-source { font-weight: 500; }\n  .backlinks-snippet { font-size: 0.85rem; color: #555; margin: 0.1rem 0 0; font-style: italic; }\n  .backlinks-empty-text { color: #888; font-size: 0.85rem; margin: 0; }\n  Heading anchor scroll offset: add 'scroll-margin-top: 4rem;' to heading anchor targets (h1,h2,h3,h4,h5,h6 within .content { scroll-margin-top: 4rem; } or as a targeted selector [id] within .content).\n- 'Back to' audit: grep serve.rs and html.rs for 'back to' / 'back-to' UI strings and HTML patterns. Per plan scope, none expected; if found, remove. Document audit result with a code comment in html.rs test module.\n- HTML escaping: use existing html_escape() from html.rs for source_display and snippet (both are user-controlled content).\n\nDependency links:\n- Depends on AppState lookup wiring (bd-17g) and freshness work (bd-38z) for PageShellContext fields.\n- Blocks integration/e2e UI verification (bd-26u.1).\n\nAcceptance criteria:\n- File update notice div is present in every markdown page HTML output (hidden by default).\n- Backlinks panel appears directly below the notice div, above layout div.\n- Populated state shows correct count and source link + snippet entries.\n- Empty state shows 'No backlinks yet.' text.\n- Heading fragment jumps remain visible below sticky chrome.\n- All existing html.rs tests still pass after signature update.\n- No stale 'back to' expectation or UI remains.\n\nTest requirements (unit and e2e, with logging expectations):\n- Unit: test 'backlinks_panel_populated': build page shell with 2 BacklinkRefs; assert HTML contains 'Backlinks (2)', source link hrefs, html-escaped snippet text, and section element. Test 'backlinks_panel_empty': assert 'No backlinks yet.' and no 'Backlinks (' string. Test 'change_notice_present_and_hidden': assert HTML contains id='mdmd-change-notice' and 'hidden' attribute. Test 'scroll_margin_top_in_css': assert CSS string contains 'scroll-margin-top'.\n- E2E: serve fixture doc with known inbound refs; GET URL; assert response body contains 'Backlinks (' substring and expected source path.\n- Logging: no new WARN/ERROR in normal render path.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-25T01:14:39.961928328Z","created_by":"exedev","updated_at":"2026-02-25T05:06:40.610059882Z","closed_at":"2026-02-25T05:06:40.609992640Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1fc","depends_on_id":"bd-17g","type":"blocks","created_at":"2026-02-25T01:14:53.100028801Z","created_by":"exedev","metadata":"{}","thread_id":""}],"comments":[{"id":31,"issue_id":"bd-1fc","author":"Peter Schilling","text":"UX intent: backlinks panel belongs directly under top chrome to mimic graph-note tools while keeping doc-first reading flow. 'Back to' cleanup here is an audit gate; remove only concrete code/test artifacts, not imagined behavior.","created_at":"2026-02-25T01:15:11Z"}]}
{"id":"bd-1hd","title":"Build startup backlinks index traversal with scope filters and observability","description":"Objective and scope:\n- Traverse serve_root at startup, collect outbound edges from markdown-like files, and invert into backlinks index.\n- Scope includes traversal filters, index materialization in memory, scan summary output, and user-facing restart reminder.\n\nImplementation details:\n- Create src/backlinks.rs as the home for types, extractor, and traversal. Add 'mod backlinks;' to src/main.rs following the existing pattern (mod html; mod serve; etc.).\n- Traverse serve_root synchronously before server bind using std::fs::read_dir recursively (no walkdir in Cargo.toml; implement a simple iterative walk with a VecDeque<PathBuf> stack, or add walkdir to [dependencies] if preferred for cleaner code).\n- Scan .md and .markdown extensions; skip files with other extensions.\n- Skip directories named '.git', 'node_modules', and '.jj' entirely (check dir name before recursing).\n- For each eligible file: read contents with fs::read_to_string(). On Err, emit:\n  eprintln!(\"[backlinks] skipping path='{}' reason='read-error: {}'\", path.display(), e);\n  continue to next file (do not panic or abort traversal).\n- Run extractor from bd-f8j on the UTF-8 source; collect DocExtractResult { title, outbound_refs }.\n- Invert edges: for each OutboundRef { target_url_path, target_fragment, snippet } from a source file, construct BacklinkRef { source_url_path, source_display, snippet, target_fragment } and push into backlinks_index[target_url_path].\n  - source_url_path = url_key_from_rel_path(source_rel_path) (using canonical helper from bd-r8y).\n  - source_display = doc title from DocExtractResult.title if Some(_), else source root-relative path without leading slash.\n- Filter self-backlinks during inversion: skip edge when source_url_path == target_url_path.\n- After full traversal, emit these two messages:\n  eprintln!(\"[backlinks] indexed files={} edges={}\", file_count, edge_count);\n  println!(\"backlinks: startup-indexed; restart server after file edits to pick up changes\");\n  The eprintln! matches existing [serve] operational log style (goes to stderr).\n  The println! is user-facing and appears in the stdout startup banner (captured by test_serve_startup_stdout_format and backlinks e2e tests checking stdout).\n- Return completed HashMap<String, Vec<BacklinkRef>>.\n\nConcurrency: run synchronously before tokio runtime or before server bind within the runtime. No parallelism needed in first pass.\n\nDependency links:\n- Depends on extractor task (bd-f8j) and model/key contract (bd-r8y).\n- Blocks AppState wiring (bd-17g) and integration tests.\n\nAcceptance criteria:\n- Startup index build is deterministic and bounded to selected serve_root.\n- Files outside serve_root do not enter index.\n- eprintln! scan count and println! restart reminder both appear reliably (not gated on RUST_LOG).\n- Skipped directories (.git, node_modules, .jj) are not traversed.\n- Read errors skip the file with one eprintln! line; traversal continues.\n- mod backlinks; is added to src/main.rs.\n\nTest requirements (unit and e2e, with logging expectations):\n- Unit: create TempDir fixture trees with known link graphs; assert inversion produces correct BacklinkRef entries per target. Assert .git and node_modules directories are excluded. Assert self-backlinks do not appear in output. Assert source_display is H1 title when present, path when absent.\n- E2E: start server on fixture workspace; call shutdown_with_sigint(); check output.stdout for 'backlinks: startup-indexed' line; check output.stderr for '[backlinks] indexed files=' line with non-zero counts.\n- Logging: assert restart reminder on stdout; assert scan summary on stderr. Both are eprintln!/println! (not info! macro) so they appear regardless of RUST_LOG.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-25T01:14:39.322870515Z","created_by":"exedev","updated_at":"2026-02-25T04:55:41.879612044Z","closed_at":"2026-02-25T04:55:41.879586999Z","close_reason":"Implemented build_backlinks_index in src/backlinks.rs with recursive traversal, scope filters (.git/.jj/node_modules exclusion), edge inversion, self-link filtering, and observability output. Called from run_serve in src/serve.rs before server bind. Unit tests added.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1hd","depends_on_id":"bd-f8j","type":"blocks","created_at":"2026-02-25T01:14:52.088878913Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1hd","depends_on_id":"bd-r8y","type":"blocks","created_at":"2026-02-25T01:14:51.761946240Z","created_by":"exedev","metadata":"{}","thread_id":""}],"comments":[{"id":29,"issue_id":"bd-1hd","author":"Peter Schilling","text":"Operational intent: startup indexing is eventually-stale by design for first pass. The required startup log reminder about restart-after-edits is part of product behavior, not just debugging noise.","created_at":"2026-02-25T01:15:11Z"}]}
{"id":"bd-1mv","title":"[Subtask] Add verbose/no-open/open-attempt integration coverage","description":"Flag interactions across verbose/no-open/headed conditions are easy to regress without targeted behavioral tests. Since an actual browser open is unreliable in CI, open-attempt logic must expose a deterministic, testable seam.\n\nObjective and scope:\n- Add integration coverage for verbose diagnostics and no-open/auto-open interactions.\n- Verify open-attempt logic using deterministic hooks/env overrides, not host-dependent side effects.\n\nImplementation details:\nTest 1: verbose mode emits diagnostics\n- Spawn server with --verbose and capture stdout/stderr.\n- Assert URL lines remain on stdout.\n- Assert startup diagnostics ([serve], [bind], and relevant [tailscale] behavior) appear on stderr.\n\nTest 2: --no-open suppresses open regardless of headed env\n- Spawn server with --no-open and headed-like env (DISPLAY=:99 on Linux where applicable).\n- Assert server starts and URL appears on stdout.\n- Assert no browser-attempt diagnostic line is produced even with --verbose.\n\nTest 3: headless environment suppresses auto-open\n- Spawn server without --no-open but with CI=1 and DISPLAY/WAYLAND unset.\n- Assert server starts and URL appears.\n- Assert no browser-attempt diagnostic line.\n\nDeterministic verification requirement:\n- Add a test hook (env var or injectable opener command) so tests can verify whether open would be attempted without requiring a real browser binary.\n- Recommended: force opener command to a known failing stub and assert verbose logging behavior around that failure.\n\nDependency links:\n- Parent: bd-3bl.\n- Depends on bd-i8p (open logic), bd-1o6 (verbose gating), and bd-34s (URL-only stdout baseline).\n\nAcceptance criteria:\n- --verbose produces startup diagnostics on stderr while keeping URL-only stdout.\n- --no-open prevents open attempts in all tested environments.\n- Headless CI env (CI=1, no DISPLAY/WAYLAND) suppresses open attempts.\n- Integration assertions are deterministic across developer machines and CI.\n\nTest requirements:\nUnit:\n- Decision seam tests for open-attempt logic matrix.\n- Env override parsing tests for any introduced test hook.\n\nE2E/integration:\n- All scenarios above run in CI without requiring an actual browser.\n- Detailed logs (scenario name, env overrides, stdout/stderr excerpts) are emitted by the e2e script/harness.\n- Logging expectation: [browser] diagnostics appear only in verbose mode and only when an open attempt is actually made.","notes":"Verification Steps:\n1. Implement the scoped changes and keep behavior aligned with this bead's objective/acceptance criteria.\n2. Run the unit and integration/e2e tests listed under Test requirements for this bead.\n3. Verify stdout/stderr logging expectations in the executed scenarios (default vs verbose, and any no-open/headless paths if applicable).\n4. Record the exact validation commands and outcomes in the implementation notes/PR summary for reproducibility.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-25T16:25:14.605538642Z","created_by":"exedev","updated_at":"2026-02-25T17:44:53.947392005Z","closed_at":"2026-02-25T17:44:53.947316258Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1mv","depends_on_id":"bd-34s","type":"blocks","created_at":"2026-02-25T16:25:31.131382500Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1mv","depends_on_id":"bd-kpe","type":"blocks","created_at":"2026-02-25T16:25:32.825416725Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1mv","depends_on_id":"bd-o5a","type":"blocks","created_at":"2026-02-25T16:25:33.191357475Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1mv","depends_on_id":"bd-u9i","type":"blocks","created_at":"2026-02-25T16:25:33.596134930Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-1mz","title":"Serve5-02: Server bootstrap, bounded port retry, graceful shutdown","description":"## Objective\nImplement axum/tokio server startup, default port 3333, bounded retry (100 attempts on EADDRINUSE only), and Ctrl+C shutdown.\n\n## Implementation Details\n- Bind loop: on EADDRINUSE errors, increment port by 1 and retry up to 100 times; exit with clear error when max attempts exhausted.\n- R8 mitigation: distinguish EADDRINUSE from other OS errors. For any non-EADDRINUSE bind error (e.g. EACCES, ENODEV), fail immediately with the specific OS error message — do NOT retry.\n- Default bind address: 127.0.0.1 loopback. The `--bind` flag is defined in bd-p7i's CLI serve subcommand and its value is passed to the server bootstrap here.\n- `tokio::signal::ctrl_c()` shutdown path; all listener tasks exit cleanly on SIGINT.\n- Log each bind attempt (port tried, outcome), the final bound port, and shutdown completion.\n- App state shared via `Arc<AppState>` containing `serve_root`, `entry_file`, and config.\n\n## Acceptance Criteria\n- Server binds on 3333 when free; retries on EADDRINUSE up to 100 times.\n- Non-EADDRINUSE errors cause immediate failure with OS error detail (not retry).\n- Clean shutdown on SIGINT without panic; exit code 0.\n\n## Verification Steps\n- Unit: `bind_with_retry` returns correct port after N EADDRINUSE failures.\n- Unit: non-EADDRINUSE error produces immediate `Err`, never retries.\n- Unit: attempt counter stops at 100 and returns descriptive error.\n- Integration: occupy port 3333, assert server binds on 3334.\n- Integration: occupy ports 3333–3432 (all 100 candidate ports), assert server fails with clear error message — must not panic.\n- Log lines: `[bind] trying port=3333`, `[bind] EADDRINUSE, trying 3334`, `[bind] success port=3334`, `[shutdown] complete`.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-24T04:48:24.259145678Z","created_by":"exedev","updated_at":"2026-02-24T06:34:30.168802641Z","closed_at":"2026-02-24T06:34:30.168776783Z","close_reason":"Implemented server bootstrap with bounded port retry and graceful shutdown","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1mz","depends_on_id":"bd-2f2","type":"parent-child","created_at":"2026-02-24T06:24:51.280417520Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1mz","depends_on_id":"bd-p7i","type":"blocks","created_at":"2026-02-24T04:48:27.856845905Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-1o1","title":"Vim-like search: / to search with highlighted matches and n/N navigation","description":"Implement vim-style search. Pressing '/' enters search mode with a search bar at the bottom. As the user types, matches are highlighted in the document (incremental search). Press Enter to confirm the search. Then use Ctrl-n/Ctrl-p (since n/p are taken by heading nav) to jump between matches. Press Escape to cancel search. The match count and current match index should be shown in the status bar.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-21T00:28:52.266944042Z","created_by":"exedev","updated_at":"2026-02-21T01:27:30.674300091Z","closed_at":"2026-02-21T01:27:30.674242613Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1o1","depends_on_id":"bd-1by","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-1o6","title":"Gate serve diagnostics behind verbose and keep default stderr quiet","description":"Background and rationale:\nCurrent diagnostics are emitted from scattered eprintln call sites. Without centralized gating, default startup cannot be quiet and predictable.\n\nObjective and scope:\n- Introduce a shared verbose gate for all serve-path diagnostics.\n- Ensure non-error startup is silent on stderr by default.\n- Preserve diagnostic richness when verbose is enabled.\n\nImplementation details:\n- Add a common helper/macro/function for serve diagnostics conditioned on verbose.\n- Thread verbose through request context/handler state used by serve helpers.\n- Gate tailscale detection skip/miss diagnostics and startup informational diagnostics currently emitted with eprintln!.\n- Do not add or migrate to a new logging framework in this change.\n\nDependency links:\n- Depends on CLI/options plumbing task.\n- Blocks stdout contract finalization and integration test updates.\n\nAcceptance criteria:\n- Default serve startup emits no informational diagnostics to stderr in normal non-error flow.\n- Verbose mode emits existing diagnostics (or equivalent content) for troubleshooting.\n- Error handling remains visible and unaffected by verbose gating where appropriate.\n\nTest requirements:\nUnit:\n- Tests for diagnostic helper behavior (verbose false suppresses, verbose true emits).\n- Any helper-level tests for tailscale detection logging branches.\n\nE2E/integration:\n- Non-verbose startup confirms quiet stderr in non-error conditions.\n- Verbose startup confirms diagnostics appear.\n- Logging expectation: diagnostic strings are absent by default and present only with verbose.\n- Persist test logs for startup stderr in artifacts or local e2e logs to simplify regression triage.","notes":"Verification Steps:\n1. Implement the scoped changes and keep behavior aligned with this bead's objective/acceptance criteria.\n2. Run the unit and integration/e2e tests listed under Test requirements for this bead.\n3. Verify stdout/stderr logging expectations in the executed scenarios (default vs verbose, and any no-open/headless paths if applicable).\n4. Record the exact validation commands and outcomes in the implementation notes/PR summary for reproducibility.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-25T16:24:11.766461216Z","created_by":"exedev","updated_at":"2026-02-25T17:22:08.625319154Z","closed_at":"2026-02-25T17:22:08.625279541Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1o6","depends_on_id":"bd-1zw","type":"blocks","created_at":"2026-02-25T16:25:24.996335598Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1o6","depends_on_id":"bd-h6g","type":"blocks","created_at":"2026-02-25T16:24:18.757567453Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1o6","depends_on_id":"bd-u9i","type":"blocks","created_at":"2026-02-25T16:25:25.396107119Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-1p6","title":"Serve5-07: Local markdown link rewriting for web navigation","description":"## Objective\nRewrite local markdown links in the AST before HTML rendering for correct web navigation; preserve external URLs.\n\n## Implementation Details\n- Perform link rewriting via comrak AST traversal (NOT post-render string replacement) to avoid spurious matches in code blocks, inline HTML, and titles.\n- This traversal is integrated into the same `render_markdown` pass as heading extraction (see bd-mzl render signature: `fn render_markdown(input: &str, file_path: &Path, serve_root: &Path) -> (String, Vec<HeadingEntry>)`).\n- Rewrite targets that are relative paths ending in `.md` or extensionless local paths:\n  - `.md` suffix: leave as-is (serve resolver handles `.md` paths directly).\n  - Extensionless relative path: leave as-is (resolver will try `.md` fallback).\n  - Absolute and external URLs (`http://`, `https://`, `//`, `mailto:`, `#`): never rewritten.\n- Convert relative paths to root-relative (absolute from `serve_root`) so links work regardless of which page is being served. For example, `other.md` from `docs/subdir/page.md` → `/docs/subdir/other.md` as a root-relative href.\n- Preserve query strings (`?`) and fragments (`#`) — append after rewritten base path.\n- Directory-relative links: resolve from current file's directory within `serve_root`. If a relative path would resolve to a location above `serve_root` (e.g. `../../outside.md` from a nested file), the resulting href must not escape `serve_root` — either clamp to root or pass as-is for the path resolver to reject with 404 at request time.\n- Log: count of links rewritten vs. skipped per document at `debug` level.\n\n## Acceptance Criteria\n- Internal doc links navigate correctly across nested file hierarchies.\n- External links are unchanged.\n- No unsafe escaping via rewritten links.\n- Fragments and query strings are preserved.\n- Links in fenced code blocks are NOT rewritten.\n- Relative traversal links that would escape `serve_root` do not produce URLs pointing outside the root.\n\n## Verification Steps\n- Unit: `[t](other.md)` from root-level file → root-relative href `/other.md`.\n- Unit: `[t](subdir/page.md)` from root-level file → root-relative href `/subdir/page.md` (validates subdirectory path construction).\n- Unit: `[t](../parent.md)` from `docs/subdir/page.md` → root-relative href `/docs/parent.md` (resolves relative to current file directory, stays within `serve_root`).\n- Unit: `[t](subdir/doc)` extensionless from root-level file → root-relative path `/subdir/doc` passed through (resolver will add `.md`).\n- Unit: `[t](https://example.com/page.md)` → href unchanged.\n- Unit: `[t](#section)` → href unchanged.\n- Unit: `[t](doc.md#section?query=1)` → fragment and query preserved in rewritten href.\n- Unit: `[t](../../outside.md)` from `docs/subdir/page.md` → resulting href does not reference content above `serve_root`; either clamped to root or passes as-is for 404 handling by the resolver.\n- Unit: link inside a fenced code block → NOT rewritten.\n- Integration: navigate `index.md` → `subdir/page.md` via link → page renders (200).\n- Log: `[rewrite] file=<path> rewritten=<N> skipped=<M>` at debug level.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-24T04:49:57.542029263Z","created_by":"exedev","updated_at":"2026-02-24T07:11:49.295005423Z","closed_at":"2026-02-24T07:11:49.294959706Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1p6","depends_on_id":"bd-2f2","type":"parent-child","created_at":"2026-02-24T06:24:48.712151688Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1p6","depends_on_id":"bd-ezg","type":"blocks","created_at":"2026-02-24T04:50:01.074991413Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1p6","depends_on_id":"bd-mzl","type":"blocks","created_at":"2026-02-24T04:50:00.822466106Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-1sf","title":"Markdown parsing: AST extraction with heading tree and link collection","description":"Implement markdown file parsing using pulldown-cmark. Parse the file into a structured representation that includes: (1) a flat list of content blocks (paragraphs, code blocks, lists, etc.) with their line ranges, (2) a heading tree with heading level, text, and line position, (3) a collection of all links with their text, URL, and position. This module is pure logic with no TUI dependency, making it easily unit-testable.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-21T00:28:50.821214527Z","created_by":"exedev","updated_at":"2026-02-21T00:43:41.340688781Z","closed_at":"2026-02-21T00:41:01.258983258Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1sf","depends_on_id":"bd-2rl","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-1zl","title":"Indentation hierarchy toggle in serve viewer","description":"Background: Implement a viewer-only indentation hierarchy mode that mirrors dark-mode ergonomics (toggle button, persistence, immediate application).\\n\\nRationale: Users need a structural reading mode that visually nests section content under headings while preserving heading semantics and anchor behavior.\\n\\nConstraints:\\n- Scope limited to serve viewer behavior and assets.\\n- Use DOM-based sectioning from rendered HTML (no markdown source transform).\\n- Keep heading elements/IDs intact for TOC and deep links.\\n- Toggle must be idempotent and reversible without page reload.\\n\\nIntent for maintainers: This epic decomposes implementation and verification into independent, dependency-linked tasks so future contributors can reason about correctness and regression risk without referring back to planning docs.\n\n## Covered Sections\n- overview-primary-requirements\n- workflow-diagram-toggle-state-flow\n- implementation-notes-1-toggle-wiring-and-persistence (covered by bd-1zl.1, bd-1zl.2)\n- implementation-notes-2-dom-section-building-algorithm (covered by bd-1zl.3, bd-1zl.4)\n- implementation-notes-3-toc-observer-compatibility (covered by bd-1zl.5)\n- implementation-notes-4-css-indentation-behavior-and-reduced-motion (covered by bd-1zl.6)\n- implementation-notes-5-idempotency-and-reversal (covered by bd-1zl.4, bd-1zl.7)\n- verification-logic-checks (covered by bd-1zl.7)\n- verification-chrome-mcp-required (covered by bd-1zl.8)","acceptance_criteria":"Criteria:\\n- All child tasks are independently actionable and dependency-linked with no cycles.\\n- Every child issue includes objective/scope, implementation details, acceptance criteria, and explicit unit/e2e test expectations with logging requirements.\\n- Epic closure requires verified implementation in serve viewer and completed Chrome MCP verification task.","notes":"## Verification Steps\n1. Implement only the scoped behavior for this bead and keep dependency contracts unchanged.\n2. Run the bead-specific unit and integration/e2e checks referenced by this bead and capture exact commands executed.\n3. Verify observable UX/output/logging expectations for this bead in both nominal and edge paths.\n4. Record results (pass/fail + key evidence) in implementation notes so follow-on beads can rely on reproducible validation.","status":"open","priority":1,"issue_type":"epic","created_at":"2026-02-25T20:49:16.469427582Z","created_by":"exedev","updated_at":"2026-02-25T21:03:53.536667859Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-1zl.1","title":"Define toggle state contract and initialization flow","description":"Objective and scope:\\n- Define the single source of truth for indentation mode state and load/apply sequence during viewer startup.\\n- Include no-heading pages in scope so toggle still renders and persists.\\n\\nImplementation details:\\n- Add state key contract: mdmd-indent-hierarchy with values on|off.\\n- Choose root state marker class (e.g. on html/body) to coordinate CSS/JS.\\n- Refactor startup flow so TOC early-return paths do not skip toggle setup.\\n- Document order of operations: read storage -> render controls -> apply mode -> bind observers.\\n\\nDependency links:\\n- Parent: epic indentation hierarchy toggle.\\n- Blocks downstream tasks that wire UI, DOM transforms, and CSS behavior.","acceptance_criteria":"Criteria:\\n- Startup path always initializes indentation toggle regardless of heading count.\\n- Storage key/value contract is documented in code and used consistently.\\n- Initial page render reflects persisted state without requiring a second user action.","notes":"## Verification Steps\n1. Implement only the scoped behavior for this bead and keep dependency contracts unchanged.\n2. Run the bead-specific unit and integration/e2e checks referenced by this bead and capture exact commands executed.\n3. Verify observable UX/output/logging expectations for this bead in both nominal and edge paths.\n4. Record results (pass/fail + key evidence) in implementation notes so follow-on beads can rely on reproducible validation.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-25T20:51:48.139329172Z","created_by":"exedev","updated_at":"2026-02-25T21:18:39.473261972Z","closed_at":"2026-02-25T21:18:39.473217985Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1zl.1","depends_on_id":"bd-1zl","type":"parent-child","created_at":"2026-02-25T20:51:48.139329172Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-1zl.1.1","title":"Codify indentation state constants and storage contract","description":"Objective and scope:\\n- Define constants for indentation mode key/value/class contract used across viewer JS/CSS.\\n- Add FOUC-prevention inline script so saved indent state is applied before first paint.\\n\\nImplementation details:\\n- Storage key: mdmd-indent-hierarchy; legal values: on | off; unknown/missing values normalize to off.\\n- Root state class: indent-hierarchy-on on <html>.\\n- Add inline pre-paint script in html.rs (parallel to THEME_INIT_SCRIPT) before stylesheet link:\\n    (function(){\\n      try {\\n        var s = localStorage.getItem('mdmd-indent-hierarchy');\\n        if (s === 'on') document.documentElement.classList.add('indent-hierarchy-on');\\n      } catch (_) {}\\n    }());\\n- Use named JS constants for key and values in mdmd.js (no repeated magic strings).\\n- Ensure malformed storage values never throw and never default to ON.\\n\\nDependency links:\\n- Parent: bd-1zl.1.","acceptance_criteria":"Criteria:\\n- Storage key/value/class constants are centralized and referenced from all indentation-mode call sites.\\n- Unknown or corrupt storage values resolve safely to off without exceptions.","notes":"## Verification Steps\n1. Implement only the scoped behavior for this bead and keep dependency contracts unchanged.\n2. Run the bead-specific unit and integration/e2e checks referenced by this bead and capture exact commands executed.\n3. Verify observable UX/output/logging expectations for this bead in both nominal and edge paths.\n4. Record results (pass/fail + key evidence) in implementation notes so follow-on beads can rely on reproducible validation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-25T20:53:06.541522600Z","created_by":"exedev","updated_at":"2026-02-25T21:54:51.504520487Z","closed_at":"2026-02-25T21:54:51.504482847Z","close_reason":"All requirements implemented: INDENT_INIT_SCRIPT added to html.rs before stylesheet link (parallel to THEME_INIT_SCRIPT); try-catch wraps localStorage access; malformed/missing values normalize to off; named constants INDENT_KEY/INDENT_ON/INDENT_OFF/INDENT_CLASS defined in mdmd.js with no repeated magic strings.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1zl.1.1","depends_on_id":"bd-1zl.1","type":"parent-child","created_at":"2026-02-25T20:53:06.541522600Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-1zl.1.2","title":"Refactor startup sequence to always initialize toggles","description":"Objective and scope:\\n- Ensure initialization path does not skip indentation toggle on no-heading documents.\\n\\nImplementation details:\\n- The current mdmd.js has an early return at line 28: 'if (headingEls.length === 0) { return; }'. This early return is inside the TOC IIFE and would prevent any indentation toggle setup if it ran first.\\n- Refactor approach: split mdmd.js into three clearly separated IIFEs (all within one file):\\n    1. IIFE 1 (existing, refactored): TOC observer setup only. Keep the 'headingEls.length === 0' early return — it correctly skips TOC setup on no-heading pages.\\n    2. IIFE 2 (existing): Theme toggle (unchanged, already separate IIFE starting at line 76).\\n    3. IIFE 3 (new): Indentation hierarchy toggle. This IIFE runs unconditionally regardless of heading count. Contains all indent-toggle logic: init from storage, button bind, ON/OFF transform, observer rebind call.\\n- Guarantee order of operations: read persistence -> apply class to <html> -> bind button click -> (on button click: transform DOM -> rebind observer).\\n- Dark-mode startup behavior is unchanged (Theme toggle IIFE is independent).\\n- The FOUC-prevention inline script (bd-1zl.1.1) runs before stylesheet and before this IIFE, applying the class before first paint.\\n\\nDependency links:\\n- Depends on bd-1zl.1.1 constants contract.\\n- Parent: bd-1zl.1.","acceptance_criteria":"Criteria:\\n- Toggle initialization runs on every viewer page, including no-headings documents.\\n- Existing dark-mode initialization remains functionally unchanged.","notes":"## Verification Steps\n1. Implement only the scoped behavior for this bead and keep dependency contracts unchanged.\n2. Run the bead-specific unit and integration/e2e checks referenced by this bead and capture exact commands executed.\n3. Verify observable UX/output/logging expectations for this bead in both nominal and edge paths.\n4. Record results (pass/fail + key evidence) in implementation notes so follow-on beads can rely on reproducible validation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-25T20:53:07.436640921Z","created_by":"exedev","updated_at":"2026-02-25T21:58:03.703166993Z","closed_at":"2026-02-25T21:58:03.703129750Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1zl.1.2","depends_on_id":"bd-1zl.1","type":"parent-child","created_at":"2026-02-25T20:53:07.436640921Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1zl.1.2","depends_on_id":"bd-1zl.1.1","type":"blocks","created_at":"2026-02-25T20:53:20.506735423Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-1zl.2","title":"Add indentation toggle control beside theme toggle","description":"Objective and scope:\\n- Add a fixed viewer control to enable/disable indentation hierarchy with parity to theme-toggle UX.\\n\\nImplementation details:\\n- Create/insert button with stable selector/id (indent-toggle).\\n- Position to avoid overlap with theme control and preserve mobile usability.\\n- Wire click handler to apply/remove indentation mode, persist state, and update button affordance state (label/icon/aria-pressed).\\n- Ensure repeat clicks are no-op when state unchanged.\\n\\nDependency links:\\n- Depends on state-contract task for key names and startup ordering.\\n- Parent: epic indentation hierarchy toggle.","acceptance_criteria":"Criteria:\\n- Indentation toggle button appears in viewer and does not overlap theme toggle at supported viewport sizes.\\n- Control exposes accessible pressed state and toggles mode exactly once per click.\\n- Persistence updates immediately on toggle.","notes":"## Verification Steps\n1. Implement only the scoped behavior for this bead and keep dependency contracts unchanged.\n2. Run the bead-specific unit and integration/e2e checks referenced by this bead and capture exact commands executed.\n3. Verify observable UX/output/logging expectations for this bead in both nominal and edge paths.\n4. Record results (pass/fail + key evidence) in implementation notes so follow-on beads can rely on reproducible validation.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-25T20:51:48.565999317Z","created_by":"exedev","updated_at":"2026-02-25T22:24:41.149153682Z","closed_at":"2026-02-25T22:24:41.149115974Z","close_reason":"Button rendered and positioned (bd-1zl.2.1 closed); click handling and persistence wired via centralized setIndentMode (bd-1zl.2.2 closed)","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1zl.2","depends_on_id":"bd-1zl","type":"parent-child","created_at":"2026-02-25T20:51:48.565999317Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1zl.2","depends_on_id":"bd-1zl.1","type":"blocks","created_at":"2026-02-25T20:51:55.169825942Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-1zl.2.1","title":"Render and position indentation toggle control","description":"Objective and scope:\\n- Add button markup/class hooks and non-overlapping layout near theme toggle.\\n\\nImplementation details:\\n- In html.rs, inject the indent-toggle button immediately after the theme-toggle button (line ~502). Example markup:\\n    <button id=\"indent-toggle\" class=\"indent-toggle\" aria-label=\"Toggle indentation hierarchy\" aria-pressed=\"false\">[ICON_INDENT]</button>\\n- Use a simple grid/list SVG icon (e.g., three horizontal lines of descending indent levels, 16x16 SVG). A minimal inline SVG that visually communicates nested hierarchy is acceptable; accessibility label carries semantic weight.\\n- Position: fixed, top: 0.75rem, right: calc(0.75rem + 36px + 0.5rem) so it sits directly left of the theme toggle with 0.5rem gap. No overlap possible at any viewport width.\\n- Match theme-toggle visual style: same width (36px), height (36px), background (var(--color-surface)), border, border-radius (6px), cursor, z-index (100), padding (0), color, and hover transition from the .theme-toggle rule.\\n- On narrow viewports (<=768px) where the TOC is hidden, the button should remain visible (fixed positioned elements are not hidden by the media query that hides .toc-sidebar).\\n- Set aria-pressed dynamically via JS to reflect current state (on = true, off = false).\\n\\nDependency links:\\n- Depends on bd-1zl.1.\\n- Parent: bd-1zl.2.","acceptance_criteria":"Criteria:\\n- Button is visible and discoverable on desktop/mobile without overlapping existing controls.\\n- Accessibility metadata reflects state semantics.","notes":"## Verification Steps\n1. Implement only the scoped behavior for this bead and keep dependency contracts unchanged.\n2. Run the bead-specific unit and integration/e2e checks referenced by this bead and capture exact commands executed.\n3. Verify observable UX/output/logging expectations for this bead in both nominal and edge paths.\n4. Record results (pass/fail + key evidence) in implementation notes so follow-on beads can rely on reproducible validation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-25T20:53:08.320784295Z","created_by":"exedev","updated_at":"2026-02-25T22:16:14.195921194Z","closed_at":"2026-02-25T22:16:14.195877385Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1zl.2.1","depends_on_id":"bd-1zl.2","type":"parent-child","created_at":"2026-02-25T20:53:08.320784295Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-1zl.2.2","title":"Wire toggle click handling and persistence updates","description":"Objective and scope:\\n- Connect the indentation toggle control to mode transitions, storage persistence, ARIA state, and TOC rebind.\\n\\nImplementation details:\\n- Centralize behavior in setIndentMode(nextOn, reason) so all call sites use identical sequencing.\\n- Click handler:\\n  1. Read current state from documentElement class.\\n  2. If state changes: run ON/OFF transform path, update root class, then rebind TOC observer.\\n  3. Persist final state in localStorage with try/catch.\\n  4. Set button aria-pressed to 'true'/'false' string.\\n- Idempotency rule: repeated requests for existing state must not mutate DOM or add wrappers.\\n- Persistence/ARIA are synchronized to final resolved state (including no-op calls from init), so UI and storage cannot drift.\\n- Capture btn reference during init; do not rely on event.target.\\n\\nDependency links:\\n- Depends on bd-1zl.2.1 and bd-1zl.1.1.\\n- Parent: bd-1zl.2.","acceptance_criteria":"Criteria:\\n- Each click produces exactly one state transition and one persistence write.\\n- Button affordance reflects resolved mode after transition.","notes":"## Verification Steps\n1. Implement only the scoped behavior for this bead and keep dependency contracts unchanged.\n2. Run the bead-specific unit and integration/e2e checks referenced by this bead and capture exact commands executed.\n3. Verify observable UX/output/logging expectations for this bead in both nominal and edge paths.\n4. Record results (pass/fail + key evidence) in implementation notes so follow-on beads can rely on reproducible validation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-25T20:53:09.211903986Z","created_by":"exedev","updated_at":"2026-02-25T22:24:34.466920573Z","closed_at":"2026-02-25T22:24:34.466888589Z","close_reason":"Implemented setIndentMode(nextOn) centralizing all mode transitions; click handler reads state from documentElement class; persistence and ARIA always synchronized to resolved state; idempotency maintained via classList.add no-op and data-indent-active guard","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1zl.2.2","depends_on_id":"bd-1zl.1.1","type":"blocks","created_at":"2026-02-25T20:53:21.474445514Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1zl.2.2","depends_on_id":"bd-1zl.2","type":"parent-child","created_at":"2026-02-25T20:53:09.211903986Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1zl.2.2","depends_on_id":"bd-1zl.2.1","type":"blocks","created_at":"2026-02-25T20:53:20.985086292Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-1zl.3","title":"Implement DOM outline section builder for heading hierarchy","description":"Objective and scope:\\n- Build generated section wrappers in main.content based on heading outline semantics.\\n\\nImplementation details:\\n- Iterate document-order direct children under main.content.\\n- Treat each heading (h1..h6) as section start; section extends to next heading of same or higher level.\\n- Use level stack to nest wrapper containers (section.indent-section + data-depth).\\n- Keep pre-heading content at depth 0 and unindented baseline behavior.\\n- Preserve original heading nodes and IDs; only move nodes into generated wrappers.\\n- Handle no-heading pages as safe no-op transform.\\n\\nDependency links:\\n- Depends on state-contract task for activation rules.\\n- Parent: epic indentation hierarchy toggle.","acceptance_criteria":"Criteria:\\n- Generated wrappers reflect document-outline hierarchy for mixed heading levels.\\n- Pre-heading content remains unwrapped at depth 0.\\n- Heading nodes and IDs remain unchanged and reachable by existing anchors.","notes":"## Verification Steps\n1. Implement only the scoped behavior for this bead and keep dependency contracts unchanged.\n2. Run the bead-specific unit and integration/e2e checks referenced by this bead and capture exact commands executed.\n3. Verify observable UX/output/logging expectations for this bead in both nominal and edge paths.\n4. Record results (pass/fail + key evidence) in implementation notes so follow-on beads can rely on reproducible validation.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-25T20:51:49.007195355Z","created_by":"exedev","updated_at":"2026-02-25T21:22:45.331715959Z","closed_at":"2026-02-25T21:22:45.331678171Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1zl.3","depends_on_id":"bd-1zl","type":"parent-child","created_at":"2026-02-25T20:51:49.007195355Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1zl.3","depends_on_id":"bd-1zl.1","type":"blocks","created_at":"2026-02-25T20:51:55.606699224Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-1zl.3.1","title":"Implement heading-stack traversal for outline sections","description":"Objective and scope:\\n- Compute nested section boundaries according to heading levels in document order.\\n- Critical context: comrak renders flat HTML siblings under main.content, not nested — the algorithm must work with a flat NodeList.\\n\\nImplementation details:\\n- Collect direct children of main.content into an ordered array: Array.from(mainEl.children).\\n- Scan the array linearly. When a child is a heading element (H1..H6), it starts a new section group at its heading level depth.\\n- Use a level stack (array of {level, sectionEl} entries) to track currently open sections:\\n    1. Pop stack entries while stack.top.level >= current heading level (those sections are closed).\\n    2. The remaining stack top is the parent for the new section (or main.content if stack is empty).\\n    3. Push new entry {level: headingLevel, sectionEl: newWrapper}.\\n- depth = stack.length at the point the section is opened (depth 1 = top-level section inside main).\\n- Non-heading children before the first heading: depth 0 — leave in main.content at original position without wrapping.\\n- Non-heading children after a heading: collect into the current topmost section's wrapper.\\n- Produce a flat description of (sectionEl, depth, [children]) tuples sufficient for bd-1zl.3.2 to materialize.\\n- Guard: if headingEls.length === 0, return empty plan (no-op, bd-1zl.3.2 skips wrapping).\\n\\nDependency links:\\n- Depends on bd-1zl.1.\\n- Parent: bd-1zl.3.","acceptance_criteria":"Criteria:\\n- Boundary detection is correct for mixed and skipped heading levels.\\n- Computed depth stack is deterministic for repeated runs.","notes":"## Verification Steps\n1. Implement only the scoped behavior for this bead and keep dependency contracts unchanged.\n2. Run the bead-specific unit and integration/e2e checks referenced by this bead and capture exact commands executed.\n3. Verify observable UX/output/logging expectations for this bead in both nominal and edge paths.\n4. Record results (pass/fail + key evidence) in implementation notes so follow-on beads can rely on reproducible validation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-25T20:53:10.082373807Z","created_by":"exedev","updated_at":"2026-02-25T21:30:28.217873884Z","closed_at":"2026-02-25T21:30:28.217827785Z","close_reason":"Refactored buildOutlineSections into separate planOutlineSections (traversal, returns plan array) and materializeOutlineSections (DOM writes). planOutlineSections returns [] on no headings, otherwise [{sectionEl, depth, parent, children}] tuples in document order.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1zl.3.1","depends_on_id":"bd-1zl.3","type":"parent-child","created_at":"2026-02-25T20:53:10.082373807Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-1zl.3.2","title":"Generate/move wrapper sections while preserving heading nodes","description":"Objective and scope:\\n- Materialize section wrappers and move nodes into them without altering heading identities or attributes.\\n\\nImplementation details:\\n- Consume traversal plan from bd-1zl.3.1 and generate wrappers in DOM order.\\n- Wrapper contract (required by OFF and verification tasks):\\n    <section class='indent-section' data-indent-generated='1' data-depth='N'>\\n- Insert each wrapper at the heading's current position and move planned nodes (heading + belonging content) into that wrapper; do not clone nodes.\\n- Pre-heading nodes remain untouched in main.content (depth 0, unwrapped).\\n- Never mutate heading id/class/data attributes; only relocate nodes.\\n- Avoid innerHTML-based transforms; use direct node movement only.\\n- Set mainEl.dataset.indentActive = '1' after successful ON transform.\\n\\nDependency links:\\n- Depends on bd-1zl.3.1 traversal output.\\n- Parent: bd-1zl.3.","acceptance_criteria":"Criteria:\\n- Wrappers are generated with correct depth metadata.\\n- Heading IDs remain stable and TOC anchors still resolve.","notes":"## Verification Steps\n1. Implement only the scoped behavior for this bead and keep dependency contracts unchanged.\n2. Run the bead-specific unit and integration/e2e checks referenced by this bead and capture exact commands executed.\n3. Verify observable UX/output/logging expectations for this bead in both nominal and edge paths.\n4. Record results (pass/fail + key evidence) in implementation notes so follow-on beads can rely on reproducible validation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-25T20:53:11.031447406Z","created_by":"exedev","updated_at":"2026-02-25T21:37:03.226652949Z","closed_at":"2026-02-25T21:37:03.226542588Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1zl.3.2","depends_on_id":"bd-1zl.3","type":"parent-child","created_at":"2026-02-25T20:53:11.031447406Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1zl.3.2","depends_on_id":"bd-1zl.3.1","type":"blocks","created_at":"2026-02-25T20:53:21.964629103Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-1zl.4","title":"Make indentation transform reversible and idempotent","description":"Objective and scope:\\n- Guarantee stable repeated ON/OFF cycles without wrapper accumulation or semantic drift.\\n\\nImplementation details:\\n- Implement restore strategy (tracked snapshot or deterministic unwrap) that fully returns baseline DOM shape.\\n- Add guards so ON when already ON does not rewrap; OFF when already OFF is no-op.\\n- Ensure generated markers are namespaced to avoid collisions with authored content.\\n- Validate heading order/IDs unchanged after multiple cycles.\\n\\nDependency links:\\n- Depends on DOM outline section builder task.\\n- Parent: epic indentation hierarchy toggle.","acceptance_criteria":"Criteria:\\n- Repeated ON operations do not create duplicate wrappers.\\n- OFF fully restores baseline DOM shape (or equivalent canonical form) without residual generated markers.\\n- Multiple ON/OFF cycles preserve heading order and IDs.","notes":"## Verification Steps\n1. Implement only the scoped behavior for this bead and keep dependency contracts unchanged.\n2. Run the bead-specific unit and integration/e2e checks referenced by this bead and capture exact commands executed.\n3. Verify observable UX/output/logging expectations for this bead in both nominal and edge paths.\n4. Record results (pass/fail + key evidence) in implementation notes so follow-on beads can rely on reproducible validation.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-25T20:51:49.449744927Z","created_by":"exedev","updated_at":"2026-02-25T21:25:52.328381965Z","closed_at":"2026-02-25T21:25:52.328327483Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1zl.4","depends_on_id":"bd-1zl","type":"parent-child","created_at":"2026-02-25T20:51:49.449744927Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1zl.4","depends_on_id":"bd-1zl.3","type":"blocks","created_at":"2026-02-25T20:51:56.061544676Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-1zl.4.1","title":"Implement canonical unwrap or snapshot restore path","description":"Objective and scope:\\n- Provide deterministic OFF behavior that restores the original DOM shape without destroying/recreating content nodes unnecessarily.\\n\\nImplementation details:\\n- Use canonical unwrap (not innerHTML snapshot). OFF path must remove only generated wrappers and move their children back into main.content in original document order.\\n- Wrapper contract for safe unwrapping:\\n  - Generated nodes are <section class='indent-section' data-indent-generated='1' data-depth='N'>.\\n  - OFF targets only wrappers with data-indent-generated='1' to avoid touching authored <section> nodes.\\n- Unwrap algorithm:\\n  1. Select wrappers in reverse document order under main.content.\\n  2. For each wrapper, move all child nodes before the wrapper (preserves order).\\n  3. Remove empty wrapper.\\n  4. Clear mainEl.dataset.indentActive.\\n- Transition-aware OFF behavior:\\n  - Remove root class first so padding animates to baseline.\\n  - After transition end (or immediate when reduced motion is enabled), run unwrap.\\n  - Include a timeout fallback so OFF cannot hang if transition events are missed.\\n- This strategy preserves heading element identities/ids and avoids replacing nodes via HTML reparse.\\n- After unwrap, call heading observer rebind (bd-1zl.5.1) to refresh references defensively.\\n\\nDependency links:\\n- Depends on bd-1zl.3.2 wrapper generation details.\\n- Parent: bd-1zl.4.","acceptance_criteria":"Criteria:\\n- OFF path removes generated wrappers and returns canonical baseline structure.\\n- Post-restore headings and anchors behave as pre-toggle.","notes":"## Verification Steps\n1. Implement only the scoped behavior for this bead and keep dependency contracts unchanged.\n2. Run the bead-specific unit and integration/e2e checks referenced by this bead and capture exact commands executed.\n3. Verify observable UX/output/logging expectations for this bead in both nominal and edge paths.\n4. Record results (pass/fail + key evidence) in implementation notes so follow-on beads can rely on reproducible validation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-25T20:53:11.976996902Z","created_by":"exedev","updated_at":"2026-02-25T21:41:41.129582317Z","closed_at":"2026-02-25T21:41:41.129544192Z","close_reason":"Canonical unwrap path implemented: unwrapOutlineSections selects generated wrappers in reverse document order, moves children before each wrapper, removes empty wrapper, clears indentActive flag. applyIndentOff provides transition-aware sequencing (class removal first, reduced-motion fast path, transitionend listener with 350ms timeout fallback). Defensive rebindHeadingObserver hook call added post-unwrap via window.mdmd namespace (no-op until bd-1zl.5.1 implements it). Namespace initialized at module level.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1zl.4.1","depends_on_id":"bd-1zl.3.2","type":"blocks","created_at":"2026-02-25T20:53:22.455354604Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1zl.4.1","depends_on_id":"bd-1zl.4","type":"parent-child","created_at":"2026-02-25T20:53:11.976996902Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-1zl.4.2","title":"Add idempotency guards for repeated toggle cycles","description":"Objective and scope:\\n- Prevent duplicate wrapping and state drift across repeated ON/OFF requests.\\n\\nImplementation details:\\n- ON guard: if mainEl.dataset.indentActive === '1', skip transform and return current state.\\n- OFF guard: if marker absent, skip unwrap and return current state.\\n- ON success sets marker to '1'; OFF success clears marker.\\n- Guards must be compatible with transition-aware OFF sequencing from bd-1zl.4.1 (class removal may happen before unwrap; marker is cleared after unwrap completes).\\n- No-op requests must not create/remove wrappers or reorder content.\\n- Caller-level state sync (aria/localStorage) uses returned final state so UI remains consistent even when transform is a no-op.\\n\\nDependency links:\\n- Depends on bd-1zl.4.1 restore path.\\n- Parent: bd-1zl.4.","acceptance_criteria":"Criteria:\\n- Repeated toggles do not increase wrapper count or alter heading identity/order.\\n- No-op transitions produce no DOM mutation.","notes":"## Verification Steps\n1. Implement only the scoped behavior for this bead and keep dependency contracts unchanged.\n2. Run the bead-specific unit and integration/e2e checks referenced by this bead and capture exact commands executed.\n3. Verify observable UX/output/logging expectations for this bead in both nominal and edge paths.\n4. Record results (pass/fail + key evidence) in implementation notes so follow-on beads can rely on reproducible validation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-25T20:53:12.949155322Z","created_by":"exedev","updated_at":"2026-02-25T21:48:09.540932167Z","closed_at":"2026-02-25T21:48:09.540902076Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1zl.4.2","depends_on_id":"bd-1zl.4","type":"parent-child","created_at":"2026-02-25T20:53:12.949155322Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1zl.4.2","depends_on_id":"bd-1zl.4.1","type":"blocks","created_at":"2026-02-25T20:53:22.951288587Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-1zl.5","title":"Rebind TOC heading observation after DOM restructuring","description":"Objective and scope:\\n- Keep TOC navigation and active-section highlighting correct after wrapper insertion/removal.\\n\\nImplementation details:\\n- Recompute heading NodeList after each mode transition.\\n- Recreate/rebind IntersectionObserver lifecycle cleanly (disconnect old observers first).\\n- Confirm existing TOC links (href=#id) continue to scroll to preserved heading IDs.\\n- Ensure pages with zero headings do not throw and still initialize controls.\\n\\nDependency links:\\n- Depends on DOM outline section builder and reversible/idempotent tasks.\\n- Parent: epic indentation hierarchy toggle.","acceptance_criteria":"Criteria:\\n- TOC links continue to navigate to correct headings after toggling ON and OFF.\\n- Active heading highlight updates correctly during scroll in both modes.\\n- No observer leaks or duplicate callbacks across repeated toggles.","notes":"## Verification Steps\n1. Implement only the scoped behavior for this bead and keep dependency contracts unchanged.\n2. Run the bead-specific unit and integration/e2e checks referenced by this bead and capture exact commands executed.\n3. Verify observable UX/output/logging expectations for this bead in both nominal and edge paths.\n4. Record results (pass/fail + key evidence) in implementation notes so follow-on beads can rely on reproducible validation.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-25T20:51:49.890828620Z","created_by":"exedev","updated_at":"2026-02-25T22:01:11.332715335Z","closed_at":"2026-02-25T22:01:11.332694490Z","close_reason":"rebindHeadingObserver is now called after buildOutlineSections on both the page-load ON path and the click-handler ON branch, mirroring the existing OFF-path call in unwrapOutlineSections.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1zl.5","depends_on_id":"bd-1zl","type":"parent-child","created_at":"2026-02-25T20:51:49.890828620Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1zl.5","depends_on_id":"bd-1zl.3","type":"blocks","created_at":"2026-02-25T20:51:56.521864196Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1zl.5","depends_on_id":"bd-1zl.4","type":"blocks","created_at":"2026-02-25T20:51:56.988212708Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-1zl.5.1","title":"Rebuild heading observer lifecycle on mode transitions","description":"Objective and scope:\\n- Ensure observer bindings are recreated correctly after DOM restructuring on each ON/OFF transition.\\n\\nImplementation details:\\n- Extract the observer setup logic from the current TOC IIFE into a standalone rebindHeadingObserver() function that:\\n    1. Disconnects the existing observer instance (if any): if (observer) { observer.disconnect(); }\\n    2. Clears visibleIds: visibleIds.clear();\\n    3. Re-queries headings: headingEls = Array.from(document.querySelectorAll('main.content h1, main.content h2, main.content h3, main.content h4, main.content h5, main.content h6'));\\n    4. Re-observes each heading element: headingEls.forEach(function(el) { observer.observe(el); });\\n    5. Calls updateActive() immediately to clear any stale active state.\\n- The observer and visibleIds variables must be in a shared scope accessible to both the init path and the toggle handler (module-level or shared closure scope).\\n- After innerHTML restore (OFF path in bd-1zl.4.1), headingEl references in old headingEls array are stale (replaced by newly parsed nodes). rebindHeadingObserver() re-queries fresh node references so this is always safe.\\n- On no-heading documents, re-query returns empty array; observer.disconnect() is still called safely, and updateActive() is a no-op.\\n\\nDependency links:\\n- Depends on bd-1zl.4 and bd-1zl.3.\\n- Parent: bd-1zl.5.","acceptance_criteria":"Criteria:\\n- No duplicate observers or orphaned listeners after repeated transitions.\\n- Active heading updates continue during scroll.","notes":"## Verification Steps\n1. Implement only the scoped behavior for this bead and keep dependency contracts unchanged.\n2. Run the bead-specific unit and integration/e2e checks referenced by this bead and capture exact commands executed.\n3. Verify observable UX/output/logging expectations for this bead in both nominal and edge paths.\n4. Record results (pass/fail + key evidence) in implementation notes so follow-on beads can rely on reproducible validation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-25T20:53:13.941959299Z","created_by":"exedev","updated_at":"2026-02-25T21:52:15.382757968Z","closed_at":"2026-02-25T21:52:15.382715339Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1zl.5.1","depends_on_id":"bd-1zl.4.2","type":"blocks","created_at":"2026-02-25T20:53:23.423750757Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1zl.5.1","depends_on_id":"bd-1zl.5","type":"parent-child","created_at":"2026-02-25T20:53:13.941959299Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-1zl.5.2","title":"Validate TOC anchors and active-state mapping post-rebind","description":"Objective and scope:\\n- Ensure TOC anchor targets and active-item mapping remain correct after DOM rewrap/unwarp cycles.\\n\\nImplementation details:\\n- Verify href to heading-id mapping is unchanged after toggles.\\n- Confirm active-state mapping uses refreshed heading references only.\\n- Add guardrails for no-heading pages to skip mapping logic safely.\\n\\nDependency links:\\n- Depends on bd-1zl.5.1 observer lifecycle rebuild.\\n- Parent: bd-1zl.5.","acceptance_criteria":"Criteria:\\n- TOC links continue to resolve to correct headings in both indentation states.\\n- Active-item mapping uses current heading set and avoids stale references.","notes":"## Verification Steps\n1. Implement only the scoped behavior for this bead and keep dependency contracts unchanged.\n2. Run the bead-specific unit and integration/e2e checks referenced by this bead and capture exact commands executed.\n3. Verify observable UX/output/logging expectations for this bead in both nominal and edge paths.\n4. Record results (pass/fail + key evidence) in implementation notes so follow-on beads can rely on reproducible validation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-25T20:53:34.976889827Z","created_by":"exedev","updated_at":"2026-02-25T22:01:07.070533723Z","closed_at":"2026-02-25T22:01:07.070502795Z","close_reason":"TOC anchor IDs are preserved (same DOM nodes moved via appendChild, not cloned/replaced). Active-state mapping uses fresh references after rebindHeadingObserver. No-heading guardrails in place via typeof check and TOC IIFE early-return.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1zl.5.2","depends_on_id":"bd-1zl.5","type":"parent-child","created_at":"2026-02-25T20:53:34.976889827Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1zl.5.2","depends_on_id":"bd-1zl.5.1","type":"blocks","created_at":"2026-02-25T20:53:36.009787176Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-1zl.6","title":"Style depth-based indentation with reduced-motion support","description":"Objective and scope:\\n- Provide clear visual hierarchy via depth-based indentation and smooth, lightweight transitions.\\n\\nImplementation details:\\n- Add depth rules for .indent-section[data-depth=...] using logical spacing properties.\\n- Apply transition for indentation properties with short duration/ease; avoid expensive animation patterns.\\n- Add prefers-reduced-motion fallback to disable/minimize motion.\\n- Verify readability for lists, blockquotes, tables, and pre/code content (no double-indent artifacts).\\n\\nDependency links:\\n- Depends on toggle state contract and DOM wrapper class/attribute contract.\\n- Parent: epic indentation hierarchy toggle.","acceptance_criteria":"Criteria:\\n- Depth styling visibly increases indentation by nesting depth.\\n- Transition behavior is smooth under normal motion settings and suppressed/minimized under reduced-motion preference.\\n- Code blocks/tables/lists remain readable with no double-indentation artifacts.","notes":"## Verification Steps\n1. Implement only the scoped behavior for this bead and keep dependency contracts unchanged.\n2. Run the bead-specific unit and integration/e2e checks referenced by this bead and capture exact commands executed.\n3. Verify observable UX/output/logging expectations for this bead in both nominal and edge paths.\n4. Record results (pass/fail + key evidence) in implementation notes so follow-on beads can rely on reproducible validation.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-25T20:51:50.339932426Z","created_by":"exedev","updated_at":"2026-02-25T22:02:40.268490405Z","closed_at":"2026-02-25T22:02:40.268441643Z","close_reason":"Implemented: depth-based CSS spacing rules (data-depth='1'..'6'), 180ms ease-out transition, and prefers-reduced-motion fallback are all present in mdmd.css. Sub-tasks bd-1zl.6.1 and bd-1zl.6.2 were already closed.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1zl.6","depends_on_id":"bd-1zl","type":"parent-child","created_at":"2026-02-25T20:51:50.339932426Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1zl.6","depends_on_id":"bd-1zl.1","type":"blocks","created_at":"2026-02-25T20:51:57.435741438Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1zl.6","depends_on_id":"bd-1zl.3","type":"blocks","created_at":"2026-02-25T20:51:57.853951939Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-1zl.6.1","title":"Implement depth-based spacing rules for generated sections","description":"Objective and scope:\\n- Define visual indentation mapping from wrapper depth to spacing while preserving readability for complex blocks.\\n\\nImplementation details:\\n- Introduce CSS variable for step size (example: --indent-step: 1.25rem) for easy tuning.\\n- Apply indentation to generated wrappers only via logical property:\\n    :root.indent-hierarchy-on .indent-section[data-depth='1'] { padding-inline-start: calc(var(--indent-step) * 1); }\\n    ... up to data-depth='6'.\\n- Base/off state keeps wrapper padding at 0 so class toggling can animate between 0 and depth spacing.\\n- Keep wrapper display simple (block) and avoid width hacks that can distort pre/table layout.\\n- Readability checks required for nested lists, blockquotes, tables, and pre/code:\\n  - No clipping/overflow regressions introduced by indentation rules.\\n  - Existing overflow handling for pre/table remains authoritative.\\n\\nDependency links:\\n- Depends on bd-1zl.3.2 depth attribute contract.\\n- Parent: bd-1zl.6.","acceptance_criteria":"Criteria:\\n- Increased depth yields visibly increased indentation with consistent increments.\\n- Baseline depth does not regress layout when mode is off.","notes":"## Verification Steps\n1. Implement only the scoped behavior for this bead and keep dependency contracts unchanged.\n2. Run the bead-specific unit and integration/e2e checks referenced by this bead and capture exact commands executed.\n3. Verify observable UX/output/logging expectations for this bead in both nominal and edge paths.\n4. Record results (pass/fail + key evidence) in implementation notes so follow-on beads can rely on reproducible validation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-25T20:53:14.812378477Z","created_by":"exedev","updated_at":"2026-02-25T21:44:00.473721079Z","closed_at":"2026-02-25T21:44:00.473685710Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1zl.6.1","depends_on_id":"bd-1zl.3.2","type":"blocks","created_at":"2026-02-25T21:01:21.820487812Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1zl.6.1","depends_on_id":"bd-1zl.6","type":"parent-child","created_at":"2026-02-25T20:53:14.812378477Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-1zl.6.2","title":"Add transition behavior with reduced-motion fallback","description":"Objective and scope:\\n- Provide smooth indentation transitions while respecting reduced-motion preferences.\\n\\nImplementation details:\\n- Transition must be observable on each ON/OFF toggle, not just initial render.\\n- Use class-conditional spacing so wrappers can animate between states:\\n  - Base .indent-section padding-inline-start: 0.\\n  - :root.indent-hierarchy-on rules apply depth padding values.\\n- Apply lightweight transition on wrapper indentation properties (e.g., padding-inline-start 160-220ms ease-out).\\n- Reduced motion:\\n    @media (prefers-reduced-motion: reduce) { .indent-section { transition: none; } }\\n- OFF sequencing with bd-1zl.4.1: remove root class (animate to baseline), then unwrap generated wrappers after transition completion or timeout fallback.\\n- Avoid animating expensive properties beyond spacing.\\n\\nDependency links:\\n- Depends on bd-1zl.6.1 depth spacing rules and bd-1zl.4.1 OFF sequencing contract.\\n- Parent: bd-1zl.6.","acceptance_criteria":"Criteria:\\n- ON/OFF transitions are smooth under normal settings and minimized under reduced-motion.\\n- Content readability is preserved for code blocks, lists, blockquotes, and tables.","notes":"## Verification Steps\n1. Implement only the scoped behavior for this bead and keep dependency contracts unchanged.\n2. Run the bead-specific unit and integration/e2e checks referenced by this bead and capture exact commands executed.\n3. Verify observable UX/output/logging expectations for this bead in both nominal and edge paths.\n4. Record results (pass/fail + key evidence) in implementation notes so follow-on beads can rely on reproducible validation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-25T20:53:15.719203487Z","created_by":"exedev","updated_at":"2026-02-25T21:45:06.018385844Z","closed_at":"2026-02-25T21:45:06.018351286Z","close_reason":"Implemented CSS transition (padding-inline-start 180ms ease-out) on .indent-section with @media (prefers-reduced-motion: reduce) fallback. JS transition-aware OFF sequencing was already in place from bd-1zl.4.1.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1zl.6.2","depends_on_id":"bd-1zl.4.1","type":"blocks","created_at":"2026-02-25T21:01:22.329213633Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1zl.6.2","depends_on_id":"bd-1zl.6","type":"parent-child","created_at":"2026-02-25T20:53:15.719203487Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1zl.6.2","depends_on_id":"bd-1zl.6.1","type":"blocks","created_at":"2026-02-25T20:53:23.908268614Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-1zl.7","title":"Add unit tests for outline transform and toggle idempotency","description":"Objective and scope:\\n- Add deterministic tests for structural transform correctness and edge cases.\\n\\nImplementation details:\\n- Cover mixed heading levels, skipped heading levels, and pre-heading content.\\n- Cover no-heading documents and malformed but tolerated heading sequences.\\n- Assert ON/OFF/ON cycles do not accumulate wrappers and preserve heading IDs/order.\\n- Include tests for state persistence read/write contract and control initialization path.\\n\\nDependency links:\\n- Depends on implementation tasks for state, wrapper build, restore, and TOC rebind.\\n- Parent: epic indentation hierarchy toggle.","acceptance_criteria":"Criteria:\\n- Unit suite covers outline parsing, wrapper generation, restore/idempotency, and initialization persistence pathways.\\n- Tests are deterministic and fail with actionable diagnostics.\\n- Coverage includes no-heading and pre-heading-content edge cases.","notes":"## Verification Steps\n1. Implement only the scoped behavior for this bead and keep dependency contracts unchanged.\n2. Run the bead-specific unit and integration/e2e checks referenced by this bead and capture exact commands executed.\n3. Verify observable UX/output/logging expectations for this bead in both nominal and edge paths.\n4. Record results (pass/fail + key evidence) in implementation notes so follow-on beads can rely on reproducible validation.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-25T20:51:50.792413831Z","created_by":"exedev","updated_at":"2026-02-25T22:21:02.440574254Z","closed_at":"2026-02-25T22:21:02.440553635Z","close_reason":"All unit test coverage complete: bd-1zl.7.1 (fixture-based outline) and bd-1zl.7.2 (cycle/idempotency) both implemented in tests/js/indent_transform.test.mjs","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1zl.7","depends_on_id":"bd-1zl","type":"parent-child","created_at":"2026-02-25T20:51:50.792413831Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1zl.7","depends_on_id":"bd-1zl.1","type":"blocks","created_at":"2026-02-25T20:51:58.273627987Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1zl.7","depends_on_id":"bd-1zl.3","type":"blocks","created_at":"2026-02-25T20:51:58.736515759Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1zl.7","depends_on_id":"bd-1zl.4","type":"blocks","created_at":"2026-02-25T20:51:59.208053819Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1zl.7","depends_on_id":"bd-1zl.5","type":"blocks","created_at":"2026-02-25T20:51:59.675872318Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1zl.7","depends_on_id":"bd-1zl.6","type":"blocks","created_at":"2026-02-25T20:52:00.134064664Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-1zl.7.1","title":"Add fixture-based outline algorithm unit tests","description":"Objective and scope:\\n- Build deterministic fixture coverage for outline section construction semantics.\\n\\nImplementation details:\\n- Test file: tests/js/indent_transform.test.mjs using Node's built-in test runner (`node --test`) and jsdom.\\n- Extract or export pure helpers from mdmd.js so tests can call algorithm code without browser globals.\\n- Fixture matrix (minimum):\\n  1. Single heading + paragraph => one depth-1 wrapper.\\n  2. Mixed levels h1/h2/h3 => nested wrappers depth 1/2/3.\\n  3. Skipped level h1->h3 => h3 nested beneath active ancestor section (no semantic break).\\n  4. Pre-heading content => remains unwrapped in main.content.\\n  5. No headings => transform returns no-op and zero wrappers.\\n  6. Same-level sequence => sibling sections, no accidental nesting.\\n- For each assertion failure, log fixture name, expected topology, observed topology, and serialized heading order.\\n- Keep tests hermetic (no network, no external browser).\\n\\nDependency links:\\n- Depends on bd-1zl.3.2 behavior contract.\\n- Parent: bd-1zl.7.","acceptance_criteria":"Criteria:\\n- Fixture suite validates expected topology for all planned heading patterns.\\n- Failure output is specific enough to diagnose depth/boundary mismatches.","notes":"## Verification Steps\n1. Implement only the scoped behavior for this bead and keep dependency contracts unchanged.\n2. Run the bead-specific unit and integration/e2e checks referenced by this bead and capture exact commands executed.\n3. Verify observable UX/output/logging expectations for this bead in both nominal and edge paths.\n4. Record results (pass/fail + key evidence) in implementation notes so follow-on beads can rely on reproducible validation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-25T20:53:16.708024886Z","created_by":"exedev","updated_at":"2026-02-25T22:21:01.927116558Z","closed_at":"2026-02-25T22:21:01.927075854Z","close_reason":"Fixture-based outline algorithm unit tests added to tests/js/indent_transform.test.mjs covering all 6 required fixtures (F1-F6)","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1zl.7.1","depends_on_id":"bd-1zl.3.2","type":"blocks","created_at":"2026-02-25T20:53:24.383612973Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1zl.7.1","depends_on_id":"bd-1zl.7","type":"parent-child","created_at":"2026-02-25T20:53:16.708024886Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-1zl.7.2","title":"Add cycle/idempotency and init-path unit coverage","description":"Objective and scope:\\n- Verify idempotency cycles and startup persistence logic remain stable.\\n\\nImplementation details:\\n- Add test section in tests/js/indent_transform.test.mjs for lifecycle/state behavior:\\n  1. ON->OFF->ON wrapper count invariant.\\n  2. ON->ON no additional wrappers.\\n  3. OFF->OFF no throw and no active marker.\\n  4. OFF clears generated markers and wrapper nodes.\\n  5. Stored 'on' applies root class at init.\\n  6. Stored 'off'/missing/invalid values normalize to OFF.\\n  7. localStorage access failure (throws) does not break init.\\n  8. No-heading document still initializes button and aria state.\\n- Assertion diagnostics must include: test case name, initial storage value, transition sequence, wrapper counts before/after, and final class/marker values.\\n- Add a shell wrapper (tests/e2e/run_js_unit_indent.sh) that runs the JS unit suite and writes timestamped logs under target/e2e-logs/indent-hierarchy/unit/.\\n\\nDependency links:\\n- Depends on bd-1zl.4.2 and bd-1zl.1.2.\\n- Parent: bd-1zl.7.","acceptance_criteria":"Criteria:\\n- Cycle tests prove no wrapper accumulation or heading drift.\\n- Init-path tests confirm consistent state recovery behavior.","notes":"## Verification Steps\n1. Implement only the scoped behavior for this bead and keep dependency contracts unchanged.\n2. Run the bead-specific unit and integration/e2e checks referenced by this bead and capture exact commands executed.\n3. Verify observable UX/output/logging expectations for this bead in both nominal and edge paths.\n4. Record results (pass/fail + key evidence) in implementation notes so follow-on beads can rely on reproducible validation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-25T20:53:17.657846528Z","created_by":"exedev","updated_at":"2026-02-25T22:13:00.598558889Z","closed_at":"2026-02-25T22:13:00.598520803Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1zl.7.2","depends_on_id":"bd-1zl.1.2","type":"blocks","created_at":"2026-02-25T20:53:25.318949419Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1zl.7.2","depends_on_id":"bd-1zl.4.2","type":"blocks","created_at":"2026-02-25T20:53:24.850613558Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1zl.7.2","depends_on_id":"bd-1zl.7","type":"parent-child","created_at":"2026-02-25T20:53:17.657846528Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-1zl.8","title":"Execute e2e and Chrome MCP verification for indentation mode","description":"Objective and scope:\\n- Validate real browser behavior and regression boundaries in serve mode.\\n\\nImplementation details:\\n- Run serve-mode e2e flow with indentation OFF baseline, ON transition, OFF restore.\\n- Verify dark-mode toggle still functions independently.\\n- Verify TOC click navigation and active-highlight updates while scrolling in both modes.\\n- Verify visual correctness for code blocks, lists, and tables.\\n- Use Chrome MCP to inspect generated wrappers and depth attributes in DOM.\\n\\nDependency links:\\n- Depends on all implementation and automated test tasks.\\n- Parent: epic indentation hierarchy toggle.","acceptance_criteria":"Criteria:\\n- Chrome MCP session confirms wrapper generation/removal and depth attributes when toggling.\\n- Dark mode continues functioning independently of indentation mode.\\n- TOC navigation/highlighting and content readability checks pass in both modes.\\n- Verification evidence is captured in task notes/checklist.","notes":"## Verification Steps\n1. Implement only the scoped behavior for this bead and keep dependency contracts unchanged.\n2. Run the bead-specific unit and integration/e2e checks referenced by this bead and capture exact commands executed.\n3. Verify observable UX/output/logging expectations for this bead in both nominal and edge paths.\n4. Record results (pass/fail + key evidence) in implementation notes so follow-on beads can rely on reproducible validation.","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-25T20:51:51.233205337Z","created_by":"exedev","updated_at":"2026-02-25T21:03:52.009039061Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1zl.8","depends_on_id":"bd-1zl","type":"parent-child","created_at":"2026-02-25T20:51:51.233205337Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1zl.8","depends_on_id":"bd-1zl.2","type":"blocks","created_at":"2026-02-25T20:52:00.581297368Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1zl.8","depends_on_id":"bd-1zl.3","type":"blocks","created_at":"2026-02-25T20:52:01.039469325Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1zl.8","depends_on_id":"bd-1zl.4","type":"blocks","created_at":"2026-02-25T20:52:01.507079491Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1zl.8","depends_on_id":"bd-1zl.5","type":"blocks","created_at":"2026-02-25T20:52:01.971538182Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1zl.8","depends_on_id":"bd-1zl.6","type":"blocks","created_at":"2026-02-25T20:52:02.439482526Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1zl.8","depends_on_id":"bd-1zl.7","type":"blocks","created_at":"2026-02-25T20:52:02.879195853Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-1zl.8.1","title":"Automate serve-mode e2e flow for indentation toggle","description":"Objective and scope:\\n- Provide an executable end-to-end script that validates indentation toggle behavior in real serve-mode browser runtime with detailed diagnostics.\\n\\nImplementation details:\\n- Primary script: tests/e2e/indent_hierarchy_matrix.sh.\\n- Script responsibilities:\\n  - Build or use BINARY override.\\n  - Launch mdmd serve on ephemeral port with fixture content.\\n  - Create timestamped artifact dir: target/e2e-logs/indent-hierarchy/<timestamp>/.\\n  - Write per-scenario stdout/stderr plus structured summary (pass/fail + evidence).\\n- Runtime verification must include browser-executed JS checks (not curl-only static HTML checks).\\n- Add a small browser driver (Playwright or equivalent headless Chromium script invoked by the shell harness) to execute:\\n  1. Baseline load: indent wrappers absent, indent/theme buttons present.\\n  2. Toggle ON via click: wrappers appear, depths present, localStorage='on'.\\n  3. Toggle OFF via click: wrappers removed after transition window, localStorage='off'.\\n  4. No-heading fixture: no crash, toggle remains interactive, state persists.\\n  5. TOC link click + scroll: heading navigation and active class still update after mode changes.\\n- Keep detailed logging per assertion: scenario, selector/check, expected, observed, and captured failure context (DOM snippet/screenshot if available).\\n- Exit non-zero if any assertion fails.\\n\\nDependency links:\\n- Depends on bd-1zl.7.2, bd-1zl.6.2, bd-1zl.5.1.\\n- Parent: bd-1zl.8.","acceptance_criteria":"Criteria:\\n- E2E flow passes with stable selectors and deterministic assertions.\\n- Dark-mode behavior remains unaffected by indentation toggle interactions.","notes":"## Verification Steps\n1. Implement only the scoped behavior for this bead and keep dependency contracts unchanged.\n2. Run the bead-specific unit and integration/e2e checks referenced by this bead and capture exact commands executed.\n3. Verify observable UX/output/logging expectations for this bead in both nominal and edge paths.\n4. Record results (pass/fail + key evidence) in implementation notes so follow-on beads can rely on reproducible validation.","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-25T20:53:18.616887446Z","created_by":"exedev","updated_at":"2026-02-25T21:03:52.516867705Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1zl.8.1","depends_on_id":"bd-1zl.5.1","type":"blocks","created_at":"2026-02-25T20:53:26.306589882Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1zl.8.1","depends_on_id":"bd-1zl.6.2","type":"blocks","created_at":"2026-02-25T20:53:26.817402880Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1zl.8.1","depends_on_id":"bd-1zl.7.2","type":"blocks","created_at":"2026-02-25T20:53:25.809729517Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1zl.8.1","depends_on_id":"bd-1zl.8","type":"parent-child","created_at":"2026-02-25T20:53:18.616887446Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-1zl.8.2","title":"Run Chrome MCP manual verification and capture checklist evidence","description":"Objective and scope:\\n- Perform manual Chrome MCP validation and capture reproducible evidence for each acceptance check.\\n\\nImplementation details:\\n- Use Chrome MCP tools (snapshot + evaluate_script) against live mdmd serve page.\\n- Required checklist (record PASS/FAIL + observed values):\\n  1. indent-toggle exists and aria-pressed matches stored/default state.\\n  2. indent-toggle and theme-toggle are visible and non-overlapping.\\n  3. Toggle ON creates .indent-section[data-indent-generated='1'] nodes.\\n  4. data-depth values reflect heading nesting for fixture outline.\\n  5. Heading ids unchanged before/after ON/OFF.\\n  6. TOC click navigates to heading after ON and after OFF.\\n  7. Active TOC highlight updates while scrolling after ON/OFF cycles.\\n  8. Toggle OFF returns to baseline structure (no generated wrappers).\\n  9. Code block, list, and table readability remains acceptable.\\n  10. Theme toggle still works independently of indentation mode.\\n  11. prefers-reduced-motion disables indentation transitions.\\n  12. localStorage key/value transitions on->off correctly per toggle.\\n- Evidence output:\\n  - Store run notes and evaluated values in target/e2e-logs/indent-hierarchy/chrome-mcp/<timestamp>/checklist.md.\\n  - Include relevant DOM counts/attributes and screenshot references when a check fails.\\n\\nDependency links:\\n- Depends on bd-1zl.8.1 automated matrix and parent bd-1zl.8.\\n- Parent: bd-1zl.8.","acceptance_criteria":"Criteria:\\n- Checklist evidence confirms DOM structure, behavior, and regressions are covered.\\n- Any deviations are documented with reproduction notes.","notes":"## Verification Steps\n1. Implement only the scoped behavior for this bead and keep dependency contracts unchanged.\n2. Run the bead-specific unit and integration/e2e checks referenced by this bead and capture exact commands executed.\n3. Verify observable UX/output/logging expectations for this bead in both nominal and edge paths.\n4. Record results (pass/fail + key evidence) in implementation notes so follow-on beads can rely on reproducible validation.","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-25T20:53:19.589930115Z","created_by":"exedev","updated_at":"2026-02-25T21:03:53.031442594Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1zl.8.2","depends_on_id":"bd-1zl.8","type":"parent-child","created_at":"2026-02-25T20:53:19.589930115Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1zl.8.2","depends_on_id":"bd-1zl.8.1","type":"blocks","created_at":"2026-02-25T20:53:27.308298315Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-1zw","title":"[Subtask] Introduce shared verbose-gated diagnostic helper","description":"Scattered diagnostic output needs a single control point to guarantee quiet default startup. The verbose flag lives in two contexts: run_serve startup code (local variable) and axum request handlers (AppState.verbose).\n\nObjective and scope:\n- Introduce a consistent pattern for verbose-gated diagnostics usable in both startup code and handlers.\n- Standardize all informational eprintln! calls in serve paths behind this gate.\n\nImplementation details:\n- Define a macro (or small helper function) in serve.rs:\n    macro_rules! vlog {\n        ($verbose:expr, $($args:tt)*) => {\n            if $verbose { eprintln!($($args)*); }\n        };\n    }\n- In startup/init code: use vlog!(verbose, ...) with the local verbose variable.\n- In request handlers: use vlog!(state.verbose, ...) via AppState.verbose (requires bd-3fh).\n- Replace informational eprintln! calls in serve.rs with vlog! invocations.\n- Keep true error-path diagnostics unconditional.\n\nScope of calls to gate (informational only):\n- [tailscale], [bind], [serve], [shutdown]\n- [request], [cache], [resolve], [freshness], [compression], [dir-index], [backlinks]\n\nDependency links:\n- Parent: bd-1o6.\n- Depends on option propagation (bd-3fh) for AppState.verbose.\n\nAcceptance criteria:\n- Informational serve diagnostics are consistently gated by verbose.\n- Default startup emits zero informational stderr output.\n- Error diagnostics remain unconditional.\n\nTest requirements:\nUnit:\n- Tests verify helper-gated decision behavior (false suppresses, true allows).\n- Tests verify representative error diagnostics are not accidentally gated.\n- Prefer testing extracted decision/helper logic rather than brittle stderr capture in macro-only tests.\n\nE2E/integration:\n- Default startup: no informational stderr output.\n- --verbose startup: expected startup diagnostics appear.\n- Logging expectation: '[serve]'/'[bind]' categories absent without --verbose.","notes":"Verification Steps:\n1. Implement the scoped changes and keep behavior aligned with this bead's objective/acceptance criteria.\n2. Run the unit and integration/e2e tests listed under Test requirements for this bead.\n3. Verify stdout/stderr logging expectations in the executed scenarios (default vs verbose, and any no-open/headless paths if applicable).\n4. Record the exact validation commands and outcomes in the implementation notes/PR summary for reproducibility.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-25T16:25:11.861284118Z","created_by":"exedev","updated_at":"2026-02-25T17:12:35.144661497Z","closed_at":"2026-02-25T17:12:35.144621755Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1zw","depends_on_id":"bd-3fh","type":"blocks","created_at":"2026-02-25T16:25:26.201568390Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-22o","title":"Serve5-09: Cache validators and compression middleware","description":"## Objective\nAdd `ETag`/`Last-Modified` response headers and response compression to improve serve performance; handle conditional requests with 304 responses.\n\n## Implementation Details\n- **ETag**: compute as hex-encoded FNV-1a (fast; sufficient for cache validation — not a cryptographic use) of response body bytes; set as strong ETag `\"<hash>\"`. Document the chosen algorithm in a code comment so it can be changed consistently. SHA-256 is acceptable if FNV-1a is unavailable, but prefer the faster hash.\n- **Last-Modified**: derive from file `mtime` (`std::fs::metadata().modified()`); format as HTTP date string per RFC 7231.\n- **Conditional request handling**:\n  - `If-None-Match`: compare request ETag against response ETag; return `304 Not Modified` with no body when equal. Return `200` with full body when ETag does not match.\n  - `If-Modified-Since`: compare request date against `Last-Modified`; return `304 Not Modified` when file has not been modified since that date. Return `200` with full body when the file was modified after the request date.\n- **Compression**: use `tower-http` `CompressionLayer` with gzip and brotli enabled; apply to all text responses (HTML, CSS, JS, plain text).\n- **Static assets** (`/assets/mdmd.css`, `/assets/mdmd.js`): also include `ETag`/`Last-Modified` based on embedded content hash and build time.\n- Log: `[cache] path=<p> etag=<hash> status=<200|304>` and `[compression] encoding=<gzip|br|none>` per request.\n\n## Acceptance Criteria\n- All responses include `ETag` and `Last-Modified` headers.\n- `If-None-Match` with matching ETag returns 304; with non-matching ETag returns 200 with full body.\n- `If-Modified-Since` with date newer than file mtime returns 304; with date older than file mtime returns 200 with full body.\n- Gzip compression applied when `Accept-Encoding: gzip` is negotiated (`Content-Encoding: gzip` in response).\n- Brotli compression applied when `Accept-Encoding: br` is negotiated (`Content-Encoding: br` in response).\n\n## Verification Steps\n- Unit: same content bytes produce identical ETag; different bytes produce different ETag.\n- Unit: `Last-Modified` format string parses as a valid RFC 7231 HTTP date.\n- Integration: GET page → response includes `ETag` and `Last-Modified`.\n- Integration: GET with `If-None-Match: <etag>` → 304, empty body.\n- Integration: GET with `If-None-Match: <different-etag>` → 200, full response body (non-matching ETag must not return 304).\n- Integration: GET with `If-Modified-Since: <date newer than file mtime>` → 304, empty body (file not modified since that date).\n- Integration: GET with `If-Modified-Since: <date older than file mtime>` → 200, full response body (file was modified after the request date).\n- Integration: GET with `Accept-Encoding: gzip` → `Content-Encoding: gzip`.\n- Integration: GET with `Accept-Encoding: br` → `Content-Encoding: br`.\n- Log: `[cache] path=/ etag=abc123 status=304` when conditional match.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-24T04:50:31.778809519Z","created_by":"exedev","updated_at":"2026-02-24T07:17:42.923018330Z","closed_at":"2026-02-24T07:17:42.922971235Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-22o","depends_on_id":"bd-1mz","type":"blocks","created_at":"2026-02-24T04:50:36.049121287Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-22o","depends_on_id":"bd-2f2","type":"parent-child","created_at":"2026-02-24T06:24:52.879701056Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-22o","depends_on_id":"bd-ezg","type":"blocks","created_at":"2026-02-24T04:50:36.302756074Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-22o","depends_on_id":"bd-mzl","type":"blocks","created_at":"2026-02-24T04:50:36.563266115Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-24s","title":"CLI interface: clap argument handling, --help, error messages","description":"Wire up proper CLI argument handling using clap. The binary should accept a positional markdown file path argument, support --help, and provide graceful error messages for common issues (file not found, not a markdown file, permission denied). Add a --version flag. If no file is given, show usage information.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-21T00:28:53.467357871Z","created_by":"exedev","updated_at":"2026-02-21T01:29:33.081621419Z","closed_at":"2026-02-21T01:29:33.081576672Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-24s","depends_on_id":"bd-2rl","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-267","title":"Outline modal: hierarchical heading view with live document preview","description":"Implement an outline overlay (triggered by 'o') that displays all headings in a hierarchical list, similar to Zed's Cmd-Shift-O. Headings are indented by level and prefixed with '#' symbols to denote hierarchy. The current heading (based on scroll position) should be pre-selected when the modal opens. As the user moves up/down in the outline list, the document behind the modal should scroll to show that heading's section. Pressing Enter selects and closes the modal at that position. Pressing Escape closes without changing position.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-21T00:28:51.962901586Z","created_by":"exedev","updated_at":"2026-02-21T01:18:15.824741236Z","closed_at":"2026-02-21T01:18:15.824667721Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-267","depends_on_id":"bd-19b","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-26u","title":"Integration/e2e matrix for backlinks UI, freshness notice, and out-of-cwd safety","description":"Objective and scope:\n- Validate end-to-end behavior across rendering, startup safety messaging, and changed-on-disk update flow.\n- Scope includes backlinks panel populated/empty states, heading-fragment visibility, no stale back-to assumptions, out-of-cwd startup modes, and cross-directory resolution boundaries.\n\nImplementation details:\n- E2E test file: add tests to tests/serve_integration.rs OR create tests/backlinks_integration.rs. Reference the EXISTING helpers:\n  ServerHandle, Fixture/FixtureOptions, ResponseSnapshot, fetch(), fetch_with_headers(), free_port(), wait_for_server_ready(), bin_path(), client() — all defined in tests/serve_integration.rs.\n- Extend Fixture/FixtureOptions for backlinks scenarios (e.g., add a backlinks_fixture() fn that creates the 6-file graph: a.md, b.md, empty.md, c.md, d.md, target.md).\n- For subprocess-based out-of-cwd tests, use std::process::Command directly (NOT ServerHandle) to control current_dir separately from the entry path.\n- The existing test test_serve_startup_stdout_format in serve_integration.rs checks stdout lines. New backlinks tests that add println! startup lines must NOT break this test. Since the test uses position() (prefix search, not fixed line index), adding new lines is safe.\n- Add a 'test_backlinks_startup_stdout' test that calls shutdown_with_sigint() and checks:\n  let stdout = String::from_utf8_lossy(&output.stdout);\n  assert!(stdout.contains('backlinks: startup-indexed'), 'restart reminder missing from stdout');\n  let stderr = String::from_utf8_lossy(&output.stderr);\n  assert!(stderr.contains('[backlinks] indexed files='), 'scan count missing from stderr');\n- Timing: all tests involving mtime detection use std::thread::sleep(Duration::from_secs(1)) after file mutation.\n- Subtasks own specific scenario implementations.\n\nDependency links:\n- Depends on UI render (bd-1fc), metadata freshness (bd-38z), out-of-cwd policy (bd-1dt), cross-directory resolution (bd-2ag).\n\nAcceptance criteria:\n- Tests use existing Fixture/ServerHandle infrastructure, not custom helpers.\n- Startup stdout/stderr assertions added for backlinks log lines.\n- No tracing-test dependency.\n- All tests pass with cargo test --test serve_integration (or backlinks_integration).\n\nTest requirements:\n- Unit: not primary.\n- E2E: primary. Tests must be deterministic; no fixed-sleep except explicit 1s mtime wait.\n- Logging: stdout checked for 'backlinks: startup-indexed'; stderr checked for '[backlinks] indexed files=N'.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-25T01:14:41.595481867Z","created_by":"exedev","updated_at":"2026-02-25T05:43:12.113973447Z","closed_at":"2026-02-25T05:43:12.113942382Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-26u","depends_on_id":"bd-1dt","type":"blocks","created_at":"2026-02-25T01:14:56.151200523Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-26u","depends_on_id":"bd-1fc","type":"blocks","created_at":"2026-02-25T01:14:55.488626944Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-26u","depends_on_id":"bd-2ag","type":"blocks","created_at":"2026-02-25T01:14:56.455286391Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-26u","depends_on_id":"bd-38z","type":"blocks","created_at":"2026-02-25T01:14:55.823256198Z","created_by":"exedev","metadata":"{}","thread_id":""}],"comments":[{"id":36,"issue_id":"bd-26u","author":"Peter Schilling","text":"End-to-end coverage expectation: prioritize assertions on visible behavior and startup warnings/log summaries rather than internal function calls. These tests are the guardrail for future UX and safety changes.","created_at":"2026-02-25T01:15:13Z"}]}
{"id":"bd-26u.1","title":"E2E subtask: backlinks panel rendering, empty state, and fragment visibility","description":"Objective and scope:\n- Validate user-visible backlinks presentation and navigation behavior in served pages.\n- Scope includes populated panel with title-based source_display, empty state text, count header, change notice div presence, and sticky-header scroll-margin CSS.\n\nImplementation details:\n- All tests use ServerHandle + fetch() from tests/serve_integration.rs. Extend FixtureOptions or write a standalone fn setup_backlinks_fixture() → (TempDir, PathBuf) that creates the specific graph:\n  root/\n    a.md  ('# Page A\\n\\nSee also [Page B](./b.md#section-1).')\n    b.md  ('# Page B\\n\\n## Section 1\\n\\nContent here.')\n    empty.md  ('# Empty\\n\\nNo links here.')\n    c.md  ('# Page C\\n\\n[Target](./target.md)')\n    d.md  ('# Page D\\n\\n[Target](./target.md)')\n    target.md  ('# Target\\n\\nTarget content.')\n- Test 'backlinks_panel_populated':\n  1. Start server on root/ (serves all .md files).\n  2. GET /b.md; assert 200.\n  3. assert body.contains('Backlinks (1)') with message 'backlinks count header missing'.\n  4. assert body.contains('href=\"/a.md\"') or 'href=\"/a.md#section-1\"' (source link present).\n  5. assert body.contains('Page A') as the visible link text (title from H1, not path).\n  6. assert body.contains('section-1') (fragment hint present somewhere near the link).\n  7. assert body.contains('See also') or snippet text from a.md content.\n- Test 'backlinks_panel_empty':\n  1. GET /empty.md; assert 200.\n  2. assert body.contains('No backlinks yet.').\n  3. assert !body.contains('Backlinks (') with message 'populated header shown for empty state'.\n- Test 'backlinks_count_accuracy':\n  1. GET /target.md; assert 200.\n  2. assert body.contains('Backlinks (2)') with message 'expected 2 backlinks from c.md and d.md'.\n  3. assert body.contains('Page C') AND body.contains('Page D') (both source titles present).\n- Test 'change_notice_div_present_and_hidden':\n  1. GET any markdown page (e.g., /b.md).\n  2. let body = resp.body_text();\n  3. let notice_pos = body.find('id=\"mdmd-change-notice\"'); assert notice_pos.is_some().\n  4. let context = &body[notice_pos.unwrap()..notice_pos.unwrap()+100]; assert context.contains('hidden').\n- Test 'scroll_margin_top_in_css':\n  1. GET /assets/mdmd.css; assert 200.\n  2. assert body.contains('scroll-margin-top') with message 'heading anchor scroll-margin missing from CSS'.\n- Test 'no_back_to_links':\n  1. GET /b.md; body = resp.body_text().to_lowercase().\n  2. Find all <a ...> elements; assert none have inner text containing 'back to'.\n\nDependency links:\n- Subtask of bd-26u; depends on bd-1fc (backlinks UI rendering).\n\nAcceptance criteria:\n- All 6 tests pass with descriptive assertion messages.\n- Source display shows H1 title, not raw path.\n- Tests extend existing fixture infrastructure rather than rewriting helpers.\n\nTest requirements:\n- E2E: primary deliverable. Located in tests/serve_integration.rs or tests/backlinks_integration.rs.\n- Logging: no WARN/ERROR in captured stderr during happy-path GET requests.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-25T01:16:07.598561286Z","created_by":"exedev","updated_at":"2026-02-25T05:43:11.980790416Z","closed_at":"2026-02-25T05:43:11.980750927Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-26u.1","depends_on_id":"bd-1fc","type":"blocks","created_at":"2026-02-25T01:16:20.485406937Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-26u.1","depends_on_id":"bd-26u","type":"parent-child","created_at":"2026-02-25T01:16:07.598561286Z","created_by":"exedev","metadata":"{}","thread_id":""}],"comments":[{"id":39,"issue_id":"bd-26u.1","author":"Peter Schilling","text":"UX validation note: this test should prove panel placement below top chrome, not just presence of backlink text.","created_at":"2026-02-25T01:16:26Z"}]}
{"id":"bd-26u.2","title":"E2E subtask: file-change notice reload flow","description":"Objective and scope:\n- Verify changed-on-disk detection and reload action in realistic serve flow.\n- Scope includes metadata polling detection timing and the freshness endpoint response after file mutation.\n\nImplementation details:\n- All tests use the ServerHandle + fetch() pattern from tests/serve_integration.rs.\n- Freshness endpoint path format: pass WITHOUT leading slash (e.g., ?path=fixture.md, not ?path=/fixture.md). This matches what JS sends since page_url_path meta tag stores norm_display without leading slash. The freshness_handler normalizes both forms, but tests should use the canonical form.\n- Test 'freshness_endpoint_returns_mtime':\n  1. Create fixture file at tempdir root (e.g., fixture.md with '# Test\\n\\nContent.').\n  2. Start server via ServerHandle with fixture entry = fixture.md.\n  3. GET /_mdmd/freshness?path=fixture.md; parse JSON response.\n  4. Assert HTTP 200, Content-Type contains 'application/json'.\n  5. Assert JSON has key 'mtime' with u64 value > 0.\n- Test 'freshness_detects_file_change':\n  1. Start server on fixture.md; GET /_mdmd/freshness?path=fixture.md → record mtime_before.\n  2. Overwrite file with new content (fs::write).\n  3. std::thread::sleep(Duration::from_secs(1)) to advance filesystem mtime clock.\n  4. GET /_mdmd/freshness?path=fixture.md again; parse mtime_after.\n  5. Assert mtime_after > mtime_before with descriptive message including both values.\n- Test 'freshness_unchanged_file':\n  1. GET /_mdmd/freshness?path=fixture.md twice without modification.\n  2. Assert same mtime both calls.\n- Test 'freshness_endpoint_path_traversal_blocked':\n  1. GET /_mdmd/freshness?path=../../etc/passwd; assert HTTP 404 response.\n- Test 'page_has_mtime_meta_tag':\n  1. GET /fixture.md as rendered HTML page.\n  2. Assert body_text() contains 'name=\"mdmd-mtime\"'.\n  3. Assert body_text() contains 'name=\"mdmd-path\"'.\n  4. Assert body_text() contains 'content=\"fixture.md\"' (the norm_display value without leading slash).\n- Test 'page_has_change_notice_div':\n  1. GET /fixture.md; assert body_text() contains 'id=\"mdmd-change-notice\"'.\n  2. Assert body_text() contains 'hidden' within 50 chars of 'mdmd-change-notice'.\n\nDependency links:\n- Subtask of bd-26u; depends on bd-38z (metadata polling implementation).\n\nAcceptance criteria:\n- Server-side freshness endpoint is thoroughly tested including path traversal protection.\n- Meta tag embedding and notice div presence are verified.\n- File mutation test deterministically produces changed mtime with the explicit 1s sleep.\n\nTest requirements:\n- E2E: primary deliverable. Located in tests/serve_integration.rs or tests/backlinks_integration.rs.\n- Logging: assert no WARN/ERROR in stderr for normal freshness flow by inspecting captured output.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-25T01:16:07.925568743Z","created_by":"exedev","updated_at":"2026-02-25T05:43:12.101954136Z","closed_at":"2026-02-25T05:43:12.101924833Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-26u.2","depends_on_id":"bd-26u","type":"parent-child","created_at":"2026-02-25T01:16:07.925568743Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-26u.2","depends_on_id":"bd-38z","type":"blocks","created_at":"2026-02-25T01:16:20.822958316Z","created_by":"exedev","metadata":"{}","thread_id":""}],"comments":[{"id":40,"issue_id":"bd-26u.2","author":"Peter Schilling","text":"Stability note: use deterministic file timestamp mutation to avoid flaky polling-window assertions.","created_at":"2026-02-25T01:16:27Z"}]}
{"id":"bd-26u.3","title":"E2E subtask: out-of-cwd warning modes and cross-directory allow/block matrix","description":"Objective and scope:\n- Validate startup safety warning/confirmation modes and root-bounded cross-directory link behavior.\n- Scope includes interactive yes/no behavior, non-interactive auto-continue, warning text content, and serve_root-based allow/block outcomes.\n\nImplementation details:\n- All subprocess-based tests use std::process::Command directly (NOT ServerHandle, which hardcodes current_dir = fixture.root). Set current_dir to something OUTSIDE the tempdir (e.g., '/') to ensure the entry path is reliably out-of-cwd.\n- BROAD vs NARROW ROOT distinction:\n  - Broad root: pass the PARENT DIRECTORY as serve entry (directory → serve_root = entry itself). Both sibling subdirs are inside serve_root.\n  - Narrow root: pass a FILE inside a subdirectory (file → serve_root = entry.parent()). Cross-dir target is outside serve_root → blocked.\n- Fixture layout for cross-dir tests:\n  tmp_base/\n    docs/\n      a.md  ('# Page A\\n\\n[Page B](../other/b.md)')\n    other/\n      b.md  ('# Page B\\n\\nContent.')\n- Test 'out_of_cwd_non_interactive_proceeds':\n  1. Create fixture.md in std::env::temp_dir() subdirectory.\n  2. Spawn with stdin(Stdio::null()) — null stdin makes is_terminal() return false → non-interactive branch, auto-proceeds.\n  3. Wait for server via retry loop polling the port (wait_for_server_ready pattern).\n  4. Assert process still running.\n  5. Kill; capture output.stderr; assert contains 'WARNING' and the serve_root path.\n- Test 'out_of_cwd_interactive_confirm_proceeds':\n  1. Same fixture; spawn with stdin(Stdio::piped()).\n  2. Write 'y\\n' to child.stdin; drop stdin handle.\n  3. Wait for server start via port poll.\n  4. Kill; assert process had started successfully.\n- Test 'out_of_cwd_interactive_decline_exits':\n  1. Same fixture; spawn with stdin(Stdio::piped()).\n  2. Write 'n\\n' to stdin; drop handle.\n  3. Poll for child exit with timeout (retry try_wait, do not use fixed sleep).\n  4. Assert exit_status.success() == false.\n  5. Assert stderr contains 'Aborted'.\n- Test 'in_cwd_no_warning':\n  1. Create fixture inside CWD (tempfile::Builder::new().tempdir_in(std::env::current_dir()?)).\n  2. Spawn via ServerHandle (current_dir = fixture.root, which is inside CWD → no warning).\n  3. Shut down; assert output.stderr does NOT contain 'WARNING'.\n- Test 'cross_dir_allow_broad_root':\n  1. Create tmp_base/docs/a.md and tmp_base/other/b.md as above.\n  2. Spawn: mdmd serve tmp_base/ with current_dir('/') and stdin(Stdio::null()) to auto-proceed past warning.\n  3. Wait for server start via port poll.\n  4. GET /other/b.md; assert HTTP 200.\n  5. Kill server.\n- Test 'cross_dir_block_narrow_root':\n  1. Same fixture; spawn: mdmd serve tmp_base/docs/a.md with current_dir('/') and stdin(Stdio::null()).\n  2. Wait for server start.\n  3. GET /other/b.md; assert HTTP 404 (outside serve_root = tmp_base/docs).\n  4. Kill; assert stderr contains 'outside-root' or 'denied'.\n\nNOTE: Both cross-dir tests are out-of-cwd (tmp_base is under /tmp, not under CWD). Use Stdio::null() for stdin to simulate non-interactive mode and auto-proceed past the warning prompt. This is the correct simulator for CI/headless scenarios.\n\nDependency links:\n- Subtask of bd-26u; depends on bd-1dt and bd-2ag.\n\nAcceptance criteria:\n- All 6 tests pass deterministically.\n- Cross-dir tests explicitly use Stdio::null() to handle the out-of-cwd warning without blocking.\n- Warning text assertions are string-contains (not full-match).\n- Broad/narrow root difference is achieved via entry type (directory vs file), not configuration.\n\nTest requirements:\n- E2E: primary deliverable. Located in tests/serve_integration.rs or tests/backlinks_integration.rs.\n- Logging: WARNING text and blocked-path context lines asserted via captured output.stderr bytes.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-25T01:16:08.273107528Z","created_by":"exedev","updated_at":"2026-02-25T05:43:12.109405547Z","closed_at":"2026-02-25T05:43:12.109307650Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-26u.3","depends_on_id":"bd-1dt","type":"blocks","created_at":"2026-02-25T01:16:21.177359476Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-26u.3","depends_on_id":"bd-26u","type":"parent-child","created_at":"2026-02-25T01:16:08.273107528Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-26u.3","depends_on_id":"bd-2ag","type":"blocks","created_at":"2026-02-25T01:16:21.525304017Z","created_by":"exedev","metadata":"{}","thread_id":""}],"comments":[{"id":41,"issue_id":"bd-26u.3","author":"Peter Schilling","text":"Security regression note: warning prompt coverage is as important as link resolution assertions; both protect intended risk boundary.","created_at":"2026-02-25T01:16:27Z"}]}
{"id":"bd-28j","title":"[Subtask] Add serve parser support for no-open and verbose flags","description":"Serve UX changes require stable CLI parsing semantics before behavior changes can be implemented safely.\n\nObjective and scope:\n- Add --no-open and --verbose (short alias -v) flags to the serve subcommand in main.rs.\n- Define defaults: verbose defaults false (quiet); no-open defaults false (auto-open enabled).\n- Provide clear user-facing help text for both flags.\n\nImplementation details:\n- In src/main.rs, add two fields to the Serve struct (~line 74):\n    #[arg(long)]\n    no_open: bool,\n    #[arg(long, short = 'v')]\n    verbose: bool,\n- Propagate these values through DispatchMode::Serve variant and the dispatch match arm (~line 318) that calls serve::run_serve.\n- Validate that no-open and verbose can coexist without parse errors.\n\nDependency links:\n- Parent: bd-h6g.\n- This subtask unblocks option propagation (bd-3fh) and downstream behavior tasks.","acceptance_criteria":"Acceptance criteria:\n- `mdmd serve` accepts `--no-open` and `--verbose`/`-v` without parse regressions.\n- Default values are `no_open=false` and `verbose=false` when flags are omitted.\n- `--no-open` and `--verbose` can be provided together and parse correctly.\n- Parsed values are propagated through dispatch wiring to `serve::run_serve` inputs.","notes":"Verification Steps:\n1. Run CLI parse/help checks to confirm `serve --help` exposes `--no-open` and `--verbose, -v`.\n2. Run parser-focused tests for default/individual/combined flag cases.\n3. Execute a serve smoke invocation for default, `--verbose`, `--no-open`, and combined flags to confirm argument acceptance.\n4. Verify dispatch passes parsed booleans into `run_serve` by test assertion or targeted instrumentation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-25T16:25:11.048768309Z","created_by":"exedev","updated_at":"2026-02-25T16:46:49.811823291Z","closed_at":"2026-02-25T16:46:49.811767942Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-28p","title":"serve2 slice 1: CLI + bootstrap","description":"## Covered Sections\n- mdmd-serve2-replay-plan-2026-02-23-revision-2\n- overview\n- workflow-diagram\n- dependencies-and-implementation-notes\n- executable-decomposition\n- slice-1-cli-surface-and-server-bootstrap\n- risks-and-mitigations\n- validation-strategy\n- test-infrastructure-bootstrap\n- per-slice-validation-commands\n- manual-smoke-checklist-before-gate-a-sign-off\n- regression-guard-for-tui-backward-compatibility\n- operational-checks\n- startup\n- runtime-error-handling\n- large-file-and-resource-limits\n- graceful-shutdown\n- open-questions-resolved\n- cross-slice-dependencies\n- revision-pass-round-1-incorporated\n- gate-a-approval-checklist\n\n## Acceptance Criteria\n- CLI flags parse and route to runtime config correctly: `--port`, `--host`, `--root`, `--open`, `--no-tailscale`, `--mermaid-mode <client|off>`.\n- First free port at or above requested/default is selected within retry cap; cap exhaustion exits with actionable error.\n- Non-`AddrInUse` bind failures exit immediately with actionable error text.\n- Ctrl-C/SIGTERM performs graceful shutdown without panic.\n- `mdmd <file>` and `mdmd view <file>` still launch TUI path unchanged.\n\n## Verification Steps\n- Run unit tests covering CLI argument parsing and dispatch (`serve` vs TUI commands).\n- Run integration test that binds an occupied port and confirms auto-increment behavior and retry-cap failure path.\n- Run integration test that starts server and sends SIGINT/SIGTERM, asserting clean shutdown exit.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-23T06:57:33.814115841Z","created_by":"exedev","updated_at":"2026-02-24T00:11:17.437942082Z","closed_at":"2026-02-24T00:11:17.437913041Z","close_reason":"Cleaning up for fresh start","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-2ag","title":"Ensure cross-directory link resolution works within selected serve_root only","description":"Objective and scope:\n- Guarantee that links across sibling directories resolve when both are inside selected serve_root, while preserving traversal blocks outside root.\n- Scope includes resolution behavior validation for examples like /tmp docs and ../other-project/docs rooted serving.\n\nImplementation details:\n- No code changes to containment logic are expected; this task is primarily a validation and test-authoring task.\n- Verify that existing resolve_candidate() + rewrite_local_links() + containment checks correctly handle cross-directory links when serve_root is set to a broader directory.\n- Scenarios to validate:\n  1. serve_root = /tmp; entry = /tmp/docs/a.md; link in a.md: '../other/b.md'; target = /tmp/other/b.md → ALLOWED (inside serve_root).\n  2. serve_root = /tmp/docs; entry = /tmp/docs/a.md; link in a.md: '../other/b.md'; target = /tmp/other/b.md → BLOCKED (outside serve_root).\n  3. serve_root = CWD; entry = docs/README.md; link: '../sibling/page.md'; target = sibling/page.md → ALLOWED if sibling/ is inside CWD.\n- For backlinks index: verify that edges from files in /tmp/docs to /tmp/other are correctly recorded when serve_root = /tmp (both under root), and not recorded when serve_root = /tmp/docs (target outside root).\n- Rewrite path: rewrite_local_links() in html.rs already uses strip_prefix(serve_root); verify this correctly rejects escaping links for the above cases.\n- No changes to security model; existing containment check at serve.rs:1031 is sufficient.\n\nDependency links:\n- Depends on out-of-cwd support task (bd-1dt) for serve_root to be dynamically derived.\n- Feeds integration test task (bd-26u.3) with scenario matrix.\n\nAcceptance criteria:\n- Cross-directory links resolve only when targets remain in serve_root.\n- Traversal outside serve_root is blocked consistently in both backlinks index and request resolution.\n\nTest requirements (unit and e2e, with logging expectations):\n- Unit: use TempDir to create /tmp-style fixture trees with sibling directories. Assert rewrite_local_links() output for cross-sibling link under broad and narrow serve_root. Assert backlinks extractor correctly filters by serve_root containment.\n- E2E: use fixture dirs created in system temp space (tempfile::tempdir()). Start server with broad root (parent dir); GET cross-directory linked doc; assert 200 response. Start server with narrow root; GET same target; assert 404 response. Assert blocked-path log context line appears for narrow-root case.\n- Logging: blocked traversal attempts should emit [resolve] path=... branch=denied reason=outside-root at info/debug level (already implemented in serve.rs; just assert it in tests).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-25T01:14:40.908574796Z","created_by":"exedev","updated_at":"2026-02-25T05:19:25.632899920Z","closed_at":"2026-02-25T05:19:25.632863147Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2ag","depends_on_id":"bd-1dt","type":"blocks","created_at":"2026-02-25T01:14:53.770931258Z","created_by":"exedev","metadata":"{}","thread_id":""}],"comments":[{"id":34,"issue_id":"bd-2ag","author":"Peter Schilling","text":"Boundary intent: enabling out-of-cwd entry paths is not permission broadening beyond chosen serve_root. This issue exists to prevent accidental traversal relaxations while still supporting /tmp and sibling-directory workflows.","created_at":"2026-02-25T01:15:12Z"}]}
{"id":"bd-2f2","title":"Serve5: Implement mdmd serve phase-1 web server","description":"Top-level epic for mdmd serve phase 1. Adds axum/tokio web server to mdmd that serves Markdown as HTML with GFM rendering via comrak, sticky TOC, secure serve_root path resolution, Mermaid client hydration, cache validators, compression, and Tailscale-aware startup URLs. Preserves existing TUI (mdmd <file>) behavior. See docs/plans/serve5/plan.md for full spec.\n\n## Success Criteria\n- `mdmd <file>` continues to launch existing TUI behavior (no regression).\n- `mdmd serve README.md` starts server, prints localhost URL, and serves HTML.\n- Port 3333 occupied: server retries with incrementing ports; stops after 100 attempts with clear error.\n- Non-EADDRINUSE bind errors cause immediate failure with OS error detail (not retry).\n- Startup output always includes localhost URL; includes Tailscale URL when available.\n- Rendered HTML includes phase-1 feature matrix (tables, task lists, strikethrough, Mermaid placeholders, etc.).\n- TOC is persistently visible; active heading updates while scrolling.\n- Local Markdown links resolve only within serve_root; traversal attempts are denied (R1, R2).\n- URL-encoded traversal (%2e%2e) attempts are denied.\n- Symlink-based escape from serve_root is denied via post-canonicalize re-check.\n- Static asset requests resolve only within serve_root; traversal attempts are denied.\n- Files exceeding 16 MB return 413.\n- All responses include X-Content-Type-Options: nosniff and correct Content-Type (including 404/413).\n- HTTP responses support ETag/Last-Modified cache validation and gzip/brotli compression.\n- Server shuts down cleanly on Ctrl+C; exit code 0.\n- `cargo test`, `cargo clippy -- -D warnings`, and `cargo fmt --check` all pass.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-02-24T04:47:50.131042943Z","created_by":"exedev","updated_at":"2026-02-24T22:19:39.155285100Z","closed_at":"2026-02-24T22:19:39.155216156Z","close_reason":"All children completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-2fs","title":"Link following: Enter to open linked markdown documents with back navigation","description":"When a link is focused (via Tab navigation from bd-3o8), pressing Enter on a link to a local .md file should open that file in mdmd, replacing the current document. Implement a navigation stack so the user can press Backspace or a back key to return to the previous document at the same scroll position. External URLs should be opened in the system browser.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-02-21T00:28:52.871364150Z","created_by":"exedev","updated_at":"2026-02-21T01:35:57.258977503Z","closed_at":"2026-02-21T01:35:57.258928168Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2fs","depends_on_id":"bd-3o8","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-2l9","title":"Serve5-10: Unit test coverage for serve internals","description":"## Objective\nProvide comprehensive deterministic unit test coverage for all serve internals, covering all R1–R10 risk mitigations.\n\n## Implementation Details\nTests live in `#[cfg(test)]` modules within each source file (`src/serve.rs`, `src/html.rs`, `src/web_assets.rs`).\nEach test must include a descriptive name explaining the exact scenario under test.\nAll tests must log scenario-specific failure context (via `println!` in test body or assertion messages).\n\n## Cargo.toml dependency audit (R10)\nBefore implementing any bead, verify Cargo.toml includes (with pinned versions):\n- `axum` (server framework, bd-1mz)\n- `tokio` with `full` features (async runtime, bd-1mz)\n- `comrak` with only needed features: `\"default\"` is fine; do NOT enable experimental extensions (bd-mzl)\n- `tower-http` with `compression-gzip`, `compression-br` (bd-22o)\n- `serde_json` (tailscale parsing, bd-3kq)\n- Dev-only: `reqwest` blocking client (bd-39z integration tests)\n- Optional: `fnv` crate for FNV-1a ETag, or use inline implementation (bd-22o)\nVerify binary size delta after comrak: `cargo build --release` before and after; delta must be ≤500 KB.\n\n## Port retry tests (R8)\n- `test_bind_retry_eaddrinuse_success`: N ports occupied, next free → success.\n- `test_bind_retry_max_failure`: 100 ports all EADDRINUSE → descriptive error.\n- `test_bind_no_retry_eacces`: EACCES error → immediate failure, attempt count = 1.\n\n## Tailscale parsing tests (R7)\n- `test_tailscale_valid_dns_name`: `\"hostname.ts.net.\"` → trimmed URL.\n- `test_tailscale_trailing_dot_only`: `\".\"` → no tailscale URL.\n- `test_tailscale_empty_dns_name`: `\"\"` → no tailscale URL.\n- `test_tailscale_missing_self_key`: JSON `{}` → no tailscale URL.\n- `test_tailscale_malformed_json`: `\"not json\"` → no tailscale URL, no panic.\n- `test_tailscale_subprocess_error`: command not found → no tailscale URL, no panic.\n\n## Path safety tests (R1, R2)\n- `test_path_traversal_dotdot`: `/../etc/passwd` → denied.\n- `test_path_traversal_url_encoded_dotdot`: `/%2e%2e/etc/passwd` → denied.\n- `test_path_traversal_slash_encoded`: `/%2e%2e%2fetc%2fpasswd` → denied (slash also URL-encoded).\n- `test_path_traversal_double_encoded`: `/%252e%252e/` → denied.\n- `test_path_traversal_mixed_case_encoding`: `/%2E%2E/` → denied.\n- `test_path_symlink_escape`: in-tree symlink → `/tmp/` → denied (canonicalize re-check).\n- `test_path_in_root_exact`: valid in-root path → resolved.\n\n## Path fallback tests\n- `test_path_extensionless_md_fallback`: `GET /guide` → resolves `guide.md`.\n- `test_path_directory_readme`: `GET /docs/` → resolves `docs/README.md`.\n- `test_path_directory_index`: `GET /docs/` (no README.md) → resolves `docs/index.md`.\n\n## File size limit tests (R5)\n- `test_file_size_limit_exceeded`: file > 16 MB → 413 result.\n- `test_file_size_limit_at_boundary`: file = 16 MB exactly → allowed.\n\n## MIME type tests (R6)\n- `test_mime_png`, `test_mime_svg`, `test_mime_jpg`, `test_mime_gif`, `test_mime_ico`.\n- `test_mime_css`, `test_mime_js`, `test_mime_woff2`, `test_mime_pdf`.\n- `test_mime_unknown_extension`: `.xyz` → `application/octet-stream`.\n\n## Security header tests (R6 - nosniff on all response types)\n- `test_nosniff_on_200`: successful response includes `X-Content-Type-Options: nosniff`.\n- `test_nosniff_on_404`: path-not-found response includes `X-Content-Type-Options: nosniff`.\n- `test_nosniff_on_413`: oversized-file response includes `X-Content-Type-Options: nosniff`.\n\n## HTML injection tests (R3)\n- `test_script_tag_stripped`: `<script>` in Markdown → not in HTML output.\n- `test_style_tag_stripped`: `<style>` in Markdown → not in HTML output.\n\n## Renderer feature tests (phase-1 feature matrix)\n- `test_render_paragraph`: plain text paragraph → output contains `<p>`.\n- `test_render_emphasis`: `*text*` → output contains `<em>`.\n- `test_render_strong`: `**text**` → output contains `<strong>`.\n- `test_render_inline_code`: `` `code` `` → output contains `<code>`.\n- `test_render_normal_link`: `[text](https://example.com)` → output contains `<a href=\"https://example.com\">`.\n- `test_render_fenced_code_language_class`: fenced block with info string `rust` → output contains `class=\"language-rust\"` (or equivalent); validates language hint preserved.\n- `test_render_autolinks`: bare URL `https://example.com` in Markdown body → output contains `<a href=\"https://example.com\">` (GFM autolink extension active).\n- `test_render_blockquote`: `> quoted text` → output contains `<blockquote>`.\n- `test_render_ordered_list`: `1. Item` → output contains `<ol>` and `<li>`.\n- `test_render_unordered_list`: `- Item` → output contains `<ul>` and `<li>`.\n\n## Anchor deduplication tests (R4)\n- `test_anchor_dedup_same_level`: three `## Foo` → `foo`, `foo-1`, `foo-2`.\n- `test_anchor_dedup_mixed_levels`: `## Foo` then `### Foo` → `foo`, `foo-1` (no collision sharing).\n- `test_anchor_no_collision_different_text`: `## Foo` then `## Bar` → `foo`, `bar`.\n\n## Link rewriting tests\n- `test_link_rewrite_relative_md`: `[t](other.md)` → href becomes root-relative `/other.md`.\n- `test_link_rewrite_subdirectory_md`: `[t](subdir/page.md)` from root-level file → root-relative href `/subdir/page.md` (validates subdirectory path construction).\n- `test_link_rewrite_nested_relative`: `[t](../doc.md)` → resolved correctly relative to current file directory; result is root-relative within serve_root.\n- `test_link_rewrite_external_unchanged`: `https://example.com/page.md` → unchanged.\n- `test_link_rewrite_fragment_only`: `#section` → unchanged.\n- `test_link_rewrite_fragment_preserved`: `doc.md#section` → fragment preserved.\n- `test_link_in_code_block_not_rewritten`: link in fenced code block → unchanged.\n- `test_link_rewrite_above_root_does_not_escape`: `[t](../../outside.md)` from `docs/subdir/page.md` → resulting href does not reference content above serve_root.\n\n## ETag tests (bd-22o)\n- `test_etag_deterministic`: same bytes → same ETag.\n- `test_etag_differs_on_change`: different bytes → different ETag.\n\n## Acceptance Criteria\n- All unit tests pass in CI (`cargo test`).\n- No test passes vacuously; each has meaningful assertions.\n- All scenario names are descriptive enough to diagnose failure without reading the test body.\n- Cargo.toml dependency audit completed; binary size delta ≤500 KB.\n\n## Verification Steps\n- Run `cargo test`; all listed test functions must exist and pass.\n- `cargo test 2>&1 | grep -E 'test .* ok|FAILED'` must show all listed tests passing.\n- Verify `cargo build --release` binary size delta ≤500 KB vs. pre-comrak baseline (R10).","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-24T04:51:17.855359180Z","created_by":"exedev","updated_at":"2026-02-24T22:11:47.814296452Z","closed_at":"2026-02-24T22:11:47.814247486Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2l9","depends_on_id":"bd-1mz","type":"blocks","created_at":"2026-02-24T04:51:23.276769482Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-2l9","depends_on_id":"bd-1p6","type":"blocks","created_at":"2026-02-24T04:51:24.286440326Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-2l9","depends_on_id":"bd-22o","type":"blocks","created_at":"2026-02-24T05:41:12.832675975Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-2l9","depends_on_id":"bd-2f2","type":"parent-child","created_at":"2026-02-24T06:24:48.204860877Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-2l9","depends_on_id":"bd-3kq","type":"blocks","created_at":"2026-02-24T04:51:23.544556465Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-2l9","depends_on_id":"bd-ezg","type":"blocks","created_at":"2026-02-24T04:51:24.035401190Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-2l9","depends_on_id":"bd-mzl","type":"blocks","created_at":"2026-02-24T04:51:23.786420830Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-2n4","title":"Serve5-05: HTML shell, sticky TOC UI, assets, and raw mode","description":"## Objective\nBuild page shell with persistent sticky TOC, active heading highlight via IntersectionObserver, embedded static assets, and ?raw=1 raw mode.\n\n## Implementation Details\n- HTML shell template in src/html.rs: full <!DOCTYPE html> with <head> (charset, viewport, CSS link) and <body> (header, TOC sidebar, content area).\n- Header displays: mdmd serve branding and current file path relative to serve_root.\n- TOC sidebar: sticky, left-aligned, generated from Vec<HeadingEntry>; links use #anchor-id fragments.\n- Active heading: mdmd.js uses IntersectionObserver with rootMargin: '0px 0px -80% 0px' to detect topmost visible heading; applies .active CSS class to corresponding TOC link.\n- Mermaid init entrypoint in mdmd.js: call mermaid.initialize({ startOnLoad: true }) after DOM ready. Note: the Mermaid CDN script tag is added by bd-2se; this bead only creates the JS init call stub.\n- Serve /assets/mdmd.css and /assets/mdmd.js from include_str! embedded constants in src/web_assets.rs.\n- ?raw=1 query param: return Markdown source as text/plain; charset=utf-8, bypassing HTML rendering.\n- CSS: responsive two-column layout (TOC + content), GitHub-inspired code/table styles, sticky TOC via position:sticky.\n- Request log includes mode=rendered or mode=raw per request.\n\n## Acceptance Criteria\n- TOC visible; active section updates while scrolling (IntersectionObserver).\n- ?raw=1 returns Markdown source with Content-Type: text/plain.\n- /assets/mdmd.css and /assets/mdmd.js serve with correct MIME types.\n- Header includes current file path context.\n- Rendered HTML shell contains a <script> tag that loads /assets/mdmd.js.\n\n## Verification Steps\n- Integration: GET / returns HTML with <nav> containing TOC links.\n- Integration: GET /?raw=1 returns Content-Type: text/plain and Markdown source.\n- Integration: GET /assets/mdmd.css returns Content-Type: text/css.\n- Integration: GET /assets/mdmd.js returns Content-Type: text/javascript and non-empty body.\n- Integration: rendered HTML page contains a <script> tag referencing /assets/mdmd.js (asset link must be present; Mermaid CDN <script> presence is verified in bd-2se, not here).\n- Log: [request] path=/ mode=rendered and [request] path=/ mode=raw per request type.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-24T04:49:17.745129387Z","created_by":"exedev","updated_at":"2026-02-24T06:59:58.790675533Z","closed_at":"2026-02-24T06:59:58.790653986Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2n4","depends_on_id":"bd-2f2","type":"parent-child","created_at":"2026-02-24T06:24:49.768696785Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-2n4","depends_on_id":"bd-mzl","type":"blocks","created_at":"2026-02-24T04:49:20.920224293Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-2rl","title":"Project scaffolding: Cargo project with ratatui/crossterm TUI skeleton","description":"Initialize the Rust project with Cargo.toml including dependencies: ratatui, crossterm, pulldown-cmark, clap. Create a minimal main.rs that initializes the terminal with crossterm, enters raw mode, sets up the ratatui event loop, renders an empty screen, and exits cleanly on 'q'. This is the foundation all other features build on.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-21T00:28:50.541913395Z","created_by":"exedev","updated_at":"2026-02-21T00:34:03.113219904Z","closed_at":"2026-02-21T00:34:03.113164879Z","close_reason":"Scaffolded Cargo project with ratatui/crossterm TUI skeleton","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-2rv","title":"Serve startup output simplification + auto-open behavior","description":"Background:\nThe current mdmd serve startup experience prints multiple labels and diagnostics that are noisy for normal use. Product direction is to reduce default startup output to entry URL lines only, while preserving troubleshooting via --verbose.\n\nObjective and scope:\n- Deliver a cohesive startup UX for mdmd serve on macOS/Linux.\n- Keep default startup output to one or two entry URL lines.\n- Add browser auto-open by default in headed sessions with --no-open opt-out.\n- Keep existing diagnostics available behind --verbose.\n\nConstraints and rationale:\n- No new logging framework in this slice; gate existing eprintln diagnostics instead.\n- Browser launch failures must never block serving.\n- Tailscale URL remains optional and only appears when detected.\n- Behavior must be defined against the effective bound port (do not hardcode 3333/3334 in assertions).\n- Implementation and tests must be self-contained enough that maintainers do not need to consult external plan docs.\n\nImplementation detail expectations:\n- Subtasks must cover CLI plumbing, logging gate propagation, startup stdout contract, browser launching plus headed detection, and test updates.\n- Dependencies must enforce order: interface and logging primitives first, then behavior, then tests/polish.\n\nDependency links:\n- Parent epic depends on: bd-h6g, bd-1o6, bd-guc, bd-i8p, bd-3bl.\n- Core chain: bd-h6g -> bd-1o6 -> (bd-guc and bd-i8p) -> bd-3bl.\n\nAcceptance criteria:\n- Child tasks closed with all required behavior validated.\n- Resulting mdmd serve defaults to URL-only stdout output and quiet stderr unless verbose/errors.\n- Auto-open behaves correctly on macOS/Linux and can be disabled with --no-open.\n\nTest requirements (unit + e2e, including logging expectations):\n- Unit tests for headed-environment and open-attempt decisions exist.\n- Integration/e2e tests enforce stdout URL contract and default stderr quietness.\n- Verbose mode tests verify diagnostics are emitted only when requested.\n- An executable e2e script captures per-scenario stdout/stderr logs with clear pass/fail markers.","acceptance_criteria":"1) Default `mdmd serve` startup writes URL lines only to stdout and keeps stderr quiet unless `--verbose` or real errors occur.\n2) Browser auto-open is attempted by default only in headed sessions, is non-blocking, and failures never prevent serving.\n3) `--no-open` reliably disables browser-launch attempts across environments.\n4) Verbose mode restores diagnostic visibility for bind/tailscale/browser decision paths without changing default contracts.\n5) Child tasks and their validations are complete and reproducible without external planning docs.","notes":"Verification Steps:\n1. Implement the scoped changes and keep behavior aligned with this bead's objective/acceptance criteria.\n2. Run the unit and integration/e2e tests listed under Test requirements for this bead.\n3. Verify stdout/stderr logging expectations in the executed scenarios (default vs verbose, and any no-open/headless paths if applicable).\n4. Record the exact validation commands and outcomes in the implementation notes/PR summary for reproducibility.","status":"open","priority":1,"issue_type":"epic","created_at":"2026-02-25T16:23:30.620093778Z","created_by":"exedev","updated_at":"2026-02-25T21:03:39.633437754Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2rv","depends_on_id":"bd-1o6","type":"blocks","created_at":"2026-02-25T16:24:22.235174071Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-2rv","depends_on_id":"bd-3bl","type":"blocks","created_at":"2026-02-25T16:24:23.408314682Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-2rv","depends_on_id":"bd-guc","type":"blocks","created_at":"2026-02-25T16:24:22.648329716Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-2rv","depends_on_id":"bd-h6g","type":"blocks","created_at":"2026-02-25T16:24:21.850124803Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-2rv","depends_on_id":"bd-i8p","type":"blocks","created_at":"2026-02-25T16:24:23.016889851Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-2se","title":"Serve5-08: Mermaid placeholder SSR and client hydration","description":"## Objective\nSupport Mermaid in phase 1 with SSR placeholders and client hydration only; no Node/headless-browser dependency.\n\n## Implementation Details\n- During comrak AST traversal, detect fenced code blocks with language='mermaid' (case-insensitive).\n- Replace mermaid fences with <pre class=\"mermaid\">...</pre> where content is HTML-escaped diagram source (do not inject raw Mermaid source without escaping).\n- Non-mermaid fenced code blocks are rendered via standard comrak code block output (unchanged).\n- In mdmd.js, initialize Mermaid client-side: load Mermaid from CDN (specific pinned version, e.g., https://cdn.jsdelivr.net/npm/mermaid@10.x.y/dist/mermaid.min.js) and call mermaid.initialize({ startOnLoad: true, theme: 'default' }).\n- Mermaid CDN script tag included in HTML shell unconditionally (small overhead, avoids conditional complexity).\n- Document the pinned CDN version in a code comment in web_assets.rs or html.rs, including the rationale for the chosen version.\n\n## Acceptance Criteria\n- Mermaid fences render <pre class=\"mermaid\"> placeholder with escaped diagram source.\n- Non-Mermaid fences unchanged by the Mermaid detection pass.\n- Client-side hydration initializes without console errors on a page with a Mermaid diagram.\n- Mermaid CDN <script> tag uses a specific pinned version (must NOT use @latest or an unresolvable range); the pinned version is documented in a code comment.\n\n## Verification Steps\n- Unit: fenced block language 'mermaid' → output contains <pre class=\"mermaid\">.\n- Unit: diagram source containing <> → HTML-escaped (&lt;&gt;) in output.\n- Unit: fenced block language 'rust' → code block, NOT mermaid placeholder.\n- Unit: fenced block language 'MERMAID' (uppercase) → also detected as mermaid.\n- Integration: GET page with mermaid diagram → HTML response contains class=\"mermaid\".\n- Integration: Mermaid CDN <script> tag present in HTML shell and URL contains a pinned semver (e.g., matches regex `mermaid@\\d+\\.\\d+`).\n- Browser e2e (optional manual): mermaid renders as SVG, no console errors.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-24T04:50:13.746249600Z","created_by":"exedev","updated_at":"2026-02-24T22:09:43.434335629Z","closed_at":"2026-02-24T22:09:43.434310034Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2se","depends_on_id":"bd-2f2","type":"parent-child","created_at":"2026-02-24T06:24:53.407176980Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-2se","depends_on_id":"bd-2n4","type":"blocks","created_at":"2026-02-24T04:50:17.431484725Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-2se","depends_on_id":"bd-mzl","type":"blocks","created_at":"2026-02-24T04:50:17.191235932Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-2uj","title":"Compute and expose entry_url_path; print pathful startup URLs","description":"Objective and scope:\n- Add `entry_url_path` to server state and compute it once at startup from resolved entry file.\n- Update startup output so the primary URL includes the document path and also prints a root index URL.\n\nImplementation details:\n- Extend `AppState` with `entry_url_path: String`.\n- After resolving the entry file under canonical root, derive URL path by:\n  1) stripping canonical root prefix,\n  2) converting separators to `/`,\n  3) percent-encoding each path segment,\n  4) prepending `/`.\n- Preserve startup rejection for entry paths outside `serve_root`.\n- If user passed a directory, keep existing directory-to-entry fallback, then compute URL from resolved file.\n- Startup output should clearly print both:\n  - primary entry URL (pathful)\n  - root index URL (`/`)\n\nDependency links:\n- Depends on epic only.\n- Blocks routing and docs tasks that consume startup URL semantics.\n\nAcceptance criteria:\n- `AppState` exposes stable `entry_url_path` for handlers/templates.\n- Startup log/output always includes both URLs with correct host/port and percent-encoding.\n- Paths with spaces/unicode produce valid encoded URLs.\n\nTest requirements (unit and e2e, with logging expectations):\n- Unit: test entry URL path derivation, including nested paths, spaces, unicode, and directory-entry resolution.\n- E2E: run `mdmd serve playground/README.md`; verify startup text includes both URLs and primary URL contains `/playground/README.md`.\n- Logging: verify startup output includes deterministic labels for both URLs and no warning/error logs during successful startup.\n\n## Verification Steps\n- Run unit tests for entry URL derivation including nested paths, spaces, unicode, and directory-entry resolution.\n- Run mdmd serve playground/README.md and verify startup output prints both primary pathful URL and root index URL with deterministic labels.\n- Run startup path under RUST_LOG=debug and confirm successful startup emits no unexpected WARN/ERROR.","acceptance_criteria":"1) AppState exposes stable entry_url_path for handlers/templates. 2) Startup log/output always includes both primary pathful entry URL and root index URL with correct host/port and percent-encoding. 3) Paths with spaces/unicode produce valid encoded URLs and entry-outside-root remains rejected at startup.","notes":"percent_encode_segment helper spec: encode each byte that is not an unreserved URI character (ALPHA/DIGIT/-._~) as %XX uppercase hex. Test vectors: 'hello' -> 'hello', 'my file' -> 'my%20file', 'path/seg' should NOT be called on full paths (only per-segment). entry_url_path for 'playground/README.md' with CWD='/workspace' -> '/playground/README.md'. entry_url_path for 'docs/my notes/guide.md' -> '/docs/my%20notes/guide.md'. Entry outside CWD: fail at startup with clear error message including both paths.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-24T22:57:01.706609912Z","created_by":"exedev","updated_at":"2026-02-24T23:26:26.225472419Z","closed_at":"2026-02-24T23:08:22.906959042Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":2,"issue_id":"bd-2uj","author":"Peter Schilling","text":"Intent: make startup navigation deterministic by computing a canonical, encoded path once and reusing it. Constraint: do not loosen outside-root rejection; directory input should still resolve using existing fallback rules before URL derivation.","created_at":"2026-02-24T22:57:34Z"},{"id":13,"issue_id":"bd-2uj","author":"Peter Schilling","text":"CRITICAL implementation gap: serve_root must change from entry_file.parent() to std::env::current_dir(). In run_serve(), the current code computes serve_root = entry_file.parent() (line 721-724 of serve.rs). The plan requires serve_root = canonical CWD so that navigation to sibling/parent directories from a nested entry file works correctly. Concretely: change run_serve() to: (1) let serve_root = std::env::current_dir().unwrap_or_else(|_| PathBuf::from(\".\"));  (2) let canonical_root = std::fs::canonicalize(&serve_root).unwrap_or_else(|_| serve_root.clone()); (3) validate that canonical entry_file starts_with canonical_root, else fail with a clear error. Without this change, serving playground/README.md would make serve_root=playground/ and requests for /playground/ would escape the root. Also add a percent_encode_segment(s: &str) -> String helper that percent-encodes a single URL path segment (spaces, unicode, reserved chars) for building entry_url_path and directory index hrefs. Unit tests must cover: entry_url_path derivation for nested paths, paths with spaces/unicode, directory-entry resolution before URL derivation, and the case where entry is outside CWD (must fail at startup with clear error).","created_at":"2026-02-24T23:00:25Z"},{"id":23,"issue_id":"bd-2uj","author":"Peter Schilling","text":"IMPLEMENTATION STATUS: as of the current working copy, bd-2uj is fully implemented. The following changes are present in src/serve.rs: (1) AppState.entry_url_path: String field added; (2) pub fn percent_encode_segment(s: &str) -> String implemented with unit tests (encode_unreserved_chars_pass_through, encode_space_as_percent20, encode_multibyte_unicode, encode_reserved_url_chars); (3) pub fn derive_entry_url_path(entry_file, canonical_root) -> Result<String, String> implemented with unit tests (url_path_simple_nested, url_path_top_level_file, url_path_entry_equals_root, url_path_deeply_nested, url_path_with_spaces, url_path_with_unicode_segment, url_path_outside_root_is_err); (4) run_serve() uses std::env::current_dir() as serve_root; (5) startup prints 'url:   http://127.0.0.1:{port}{entry_url_path}' and 'index: http://127.0.0.1:{port}/'. All unit tests pass. The test_serve_startup_stdout_format integration test still looks for 'url:   http://' which still matches — but bd-uso/bd-3h2 must also add an assertion for the 'index:' line.","created_at":"2026-02-24T23:11:13Z"}]}
{"id":"bd-30z","title":"Serve5-12: Startup and page-context UX polish","description":"## Objective\nFinalize startup/page context details: print serve_root, entry file, and URL(s) in stable format; display current file path in page header.\n\n## Implementation Details\n- Startup output (written to stdout, stable format):\n    mdmd serve\n    root:  /absolute/path/to/serve_root\n    entry: /absolute/path/to/entry.md\n    url:   http://127.0.0.1:3333\n    url:   http://hostname.ts.net:3333   (only when tailscale available)\n- Each line uses consistent 'key:   value' format with aligned colons.\n- Page header HTML: <header><span class=\"serve-root\">{serve_root}</span> / <span class=\"current-file\">{relative_file_path}</span></header>\n- relative_file_path is current request's resolved file path relative to serve_root.\n- All startup output must be assertable by integration tests via stdout line matching.\n\n## Acceptance Criteria\n- Startup stdout begins with 'mdmd serve' as the literal first line.\n- Startup stdout contains root:, entry:, and at least one url: line in stable format.\n- Page header shows current file relative path.\n- Output consistent regardless of Tailscale availability (localhost URL always present).\n\n## Verification Steps\n- Integration: assert startup stdout first line is exactly 'mdmd serve'.\n- Integration: capture startup stdout, assert lines match expected format with regex.\n- Integration: assert 'root:  /abs/path' line present.\n- Integration: assert 'entry: /abs/path' line present.\n- Integration: assert 'url:   http://127.0.0.1:<port>' line present.\n- Integration: render page, assert <header> contains relative file path.\n- Log: startup diagnostics remain structured for bind/path troubleshooting.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-24T04:50:50.850092495Z","created_by":"exedev","updated_at":"2026-02-24T22:09:17.716946509Z","closed_at":"2026-02-24T22:09:17.716905563Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-30z","depends_on_id":"bd-1mz","type":"blocks","created_at":"2026-02-24T04:50:54.791684786Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-30z","depends_on_id":"bd-2f2","type":"parent-child","created_at":"2026-02-24T06:24:52.338536034Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-30z","depends_on_id":"bd-2n4","type":"blocks","created_at":"2026-02-24T04:50:55.055540943Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-30z","depends_on_id":"bd-3kq","type":"blocks","created_at":"2026-02-24T05:48:00.099260830Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-324","title":"serve2 slice 5: cache + revalidation + compression","description":"## Covered Sections\n- executable-decomposition\n- slice-5-cache-revalidation-and-compression\n- validation-strategy\n- cross-slice-dependencies\n\n## Acceptance Criteria\n- Unchanged requests avoid unnecessary rerender.\n- Revalidation headers are present and `304` works correctly.\n- Compression is applied when client supports it.\n- Concurrent requests do not race or corrupt cache state.\n\n## Verification Steps\n- Run cache unit tests asserting key invalidation on file identity changes and reuse when unchanged.\n- Run HTTP integration tests for `ETag`/`Last-Modified` and conditional `If-None-Match`/`If-Modified-Since` returning `304`.\n- Run compression negotiation tests with `Accept-Encoding: gzip` asserting compressed text responses.\n- Run concurrency stress test with parallel requests to same document asserting deterministic responses.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T06:57:34.192977685Z","created_by":"exedev","updated_at":"2026-02-24T00:11:18.383144730Z","closed_at":"2026-02-24T00:11:18.383125757Z","close_reason":"Cleaning up for fresh start","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-324","depends_on_id":"bd-18i","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-34s","title":"[Subtask] Update integration tests for URL-only stdout and quiet stderr","description":"The startup output contract is a user-facing behavior that needs explicit integration assertions to prevent regressions. The existing test_serve_startup_stdout_format currently asserts the old labeled format and must be fully replaced.\n\nObjective and scope:\n- Replace the old test_serve_startup_stdout_format assertions in tests/serve_integration.rs (~line 788).\n- Assert URL-only stdout and default quiet stderr.\n- Ensure assertions align with dynamic bound ports (do not assume a fixed port value).\n\nImplementation details:\nNew assertions for test_serve_startup_stdout_format:\n1. stdout has at least one line and at most two lines.\n2. Line 0 matches regex: ^http://127\\.0\\.0\\.1:\\d+/.* (bare local URL, no label prefix).\n3. If a second line exists, it must match ^http://[a-zA-Z0-9._-]+:\\d+/.* (tailscale URL, bare).\n4. No line starts with any of: 'mdmd serve', 'root:', 'entry:', 'url:', 'index:', 'backlinks:'.\n5. stderr contains no informational startup diagnostics in default mode.\n\nHelper for stderr capture:\n- ServerHandle::shutdown_with_sigint() should return both stdout and stderr.\n- If only stdout is currently captured, extend helper/process spawn paths to capture both.\n\nDefault mode test (no flags):\n- parse stdout/stderr separately\n- assert URL-only stdout contract\n- assert no informational stderr categories ([serve], [bind], [tailscale], [browser])\n\nDependency links:\n- Parent: bd-3bl.\n- Depends on bd-guc output contract and bd-1o6 gating behavior.\n\nAcceptance criteria:\n- Test fails with old labeled stdout format.\n- Test passes with new URL-only stdout format.\n- Stderr assertion catches regressions in verbose gating.\n\nTest requirements:\nUnit:\n- Add helper-level tests only if needed for deterministic integration assertions.\n\nE2E/integration:\n- Default mode startup: URL-only stdout, quiet stderr (no [serve]/[bind]/[tailscale]/[browser] lines).\n- Logging expectation: diagnostic strings absent without --verbose.\n- Emit concise assertion failure messages that include offending stdout/stderr excerpts.","notes":"Verification Steps:\n1. Implement the scoped changes and keep behavior aligned with this bead's objective/acceptance criteria.\n2. Run the unit and integration/e2e tests listed under Test requirements for this bead.\n3. Verify stdout/stderr logging expectations in the executed scenarios (default vs verbose, and any no-open/headless paths if applicable).\n4. Record the exact validation commands and outcomes in the implementation notes/PR summary for reproducibility.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-25T16:25:14.224720359Z","created_by":"exedev","updated_at":"2026-02-25T17:32:11.900123332Z","closed_at":"2026-02-25T17:32:11.900082545Z","close_reason":"Updated integration tests: improved second-line URL validation to check host:port/path format, extended stderr checks to cover all four diagnostic categories ([serve], [bind], [tailscale], [browser]), and fixed test_backlinks_startup_stdout to assert URL-only stdout instead of nonexistent 'backlinks: startup-indexed' string","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-34s","depends_on_id":"bd-3k4","type":"blocks","created_at":"2026-02-25T16:25:31.576222033Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-34s","depends_on_id":"bd-8z2","type":"blocks","created_at":"2026-02-25T16:25:32.028482173Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-34s","depends_on_id":"bd-u9i","type":"blocks","created_at":"2026-02-25T16:25:32.436346917Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-38z","title":"Add file-change detection metadata check and 'Load latest' notice flow","description":"Objective and scope:\n- Detect when the currently viewed markdown file changes on disk and surface a reload notice in-page.\n- Scope includes metadata token embedding in rendered HTML (via PageShellContext from bd-1fc), a dedicated freshness check axum route, lightweight JS polling, and wiring the hidden notice div (emitted by bd-1fc) to become visible.\n\nImplementation details:\n- PageShellContext integration (coordinate with bd-1fc which owns the struct):\n  - Populate file_mtime_secs: mtime.and_then(|t| t.duration_since(UNIX_EPOCH).ok()).map(|d| d.as_secs()) in serve_handler before calling build_page_shell.\n  - Populate page_url_path: Some(norm_display) so JS can construct the freshness query param without URL parsing. norm_display is WITHOUT leading slash (e.g., 'docs/readme.md').\n  - build_page_shell (owned by bd-1fc) emits these meta tags in <head> when values are Some:\n    <meta name='mdmd-mtime' content='{mtime_secs}'>\n    <meta name='mdmd-path' content='{norm_display_no_slash}'>\n  - build_page_shell also emits <div id='mdmd-change-notice' hidden> (see bd-1fc); JS unhides it on change.\n- Freshness axum route (add to run_serve router in serve.rs):\n  Router::new()\n    .route('/_mdmd/freshness', axum::routing::get(freshness_handler))\n    .fallback(serve_handler)\n  The route MUST be added before .fallback() so it is not consumed by the catch-all.\n- freshness_handler implementation:\n  - Signature: async fn freshness_handler(State(state): State<Arc<AppState>>, req: Request) -> Response\n  - Extract ?path query param from URI query string (parse manually or use axum::extract::Query<HashMap<String,String>>).\n  - Input path can arrive WITH or WITHOUT leading slash (JS sends without, but defensive handling costs nothing).\n  - Validate: percent_decode() then normalize_path(); if result is None → 404 JSON.\n  - Resolve: state.canonical_root.join(&normalized). Canonicalize; check starts_with(&state.canonical_root). If outside root → 404 JSON.\n  - Stat: tokio::fs::metadata(resolved).await. On error → 404 JSON.\n  - Extract mtime: metadata.modified().ok().and_then(|t| t.duration_since(UNIX_EPOCH).ok()).map(|d| d.as_secs()).unwrap_or(0).\n  - JSON response: use serde_json::json!({ 'mtime': mtime_secs }) — serde_json is already in Cargo.toml, no new dependency needed. Do NOT add a new struct with serde Derive just for this endpoint.\n  - Return 200 with Content-Type: application/json and body = json.to_string().\n  - Log: debug!('[freshness] path={} mtime={}', display_path, mtime_secs).\n- Client polling JS (add to src/web_assets.rs embedded JS, not inlined in HTML):\n  (function() {\n    var meta_mtime = document.querySelector('meta[name=\"mdmd-mtime\"]');\n    var meta_path = document.querySelector('meta[name=\"mdmd-path\"]');\n    if (!meta_mtime || !meta_path) return;\n    var initial_mtime = parseInt(meta_mtime.content, 10);\n    var page_path = meta_path.content; // norm_display WITHOUT leading slash\n    var failures = 0;\n    var MAX_FAILURES = 3;\n    var interval = setInterval(function() {\n      fetch('/_mdmd/freshness?path=' + encodeURIComponent(page_path))\n        .then(function(r) { return r.ok ? r.json() : Promise.reject('non-200'); })\n        .then(function(data) {\n          failures = 0;\n          if (data.mtime !== initial_mtime) {\n            clearInterval(interval);\n            var notice = document.getElementById('mdmd-change-notice');\n            if (notice) notice.removeAttribute('hidden');\n          }\n        })\n        .catch(function() {\n          failures++;\n          if (failures >= MAX_FAILURES) clearInterval(interval);\n        });\n    }, 4000);\n  })();\n- The notice div is server-emitted by bd-1fc with hidden attribute; JS calls removeAttribute('hidden') to reveal it. No JS DOM insertion required.\n- The freshness endpoint applies existing containment checks via state.canonical_root (same as serve_handler).\n\nDependency links:\n- Depends on AppState/rendering wiring (bd-17g) and on bd-1fc for PageShellContext and the change-notice div.\n- Blocks integration/e2e verification for freshness flow (bd-26u.2).\n\nAcceptance criteria:\n- Changed file triggers notice within one polling interval; Load latest reloads.\n- Unchanged file never shows notice.\n- Polling errors fail silently; consecutive failures stop polling after 3.\n- Freshness endpoint rejects path traversal and outside-root paths with 404 JSON.\n- Axum route registered before .fallback() so it takes precedence.\n- serde_json::json!() used for response; no new derive struct added.\n\nTest requirements (unit and e2e, with logging expectations):\n- Unit: test freshness_handler with known TempDir fixture file: verify JSON response has 'mtime' key with u64 value > 0 and Content-Type application/json. Test path traversal rejected (path='../../etc/passwd' → 404). Test outside-root path → 404. Test meta tags in page shell HTML (assert mdmd-mtime and mdmd-path content attributes present when mtime is Some).\n- E2E (in bd-26u.2): start server on fixture file using existing ServerHandle pattern from tests/serve_integration.rs; GET /_mdmd/freshness?path=fixture.md (no leading slash, matches JS behavior); confirm mtime; mutate file; wait 1s; GET again; assert mtime changed. Verify page HTML includes mdmd-change-notice with hidden attribute.\n- Logging: each freshness request logs at debug level; no WARN/ERROR for normal flow.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-25T01:14:40.291882988Z","created_by":"exedev","updated_at":"2026-02-25T05:10:19.827881366Z","closed_at":"2026-02-25T05:10:19.827841248Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-38z","depends_on_id":"bd-17g","type":"blocks","created_at":"2026-02-25T01:14:53.432924767Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-38z","depends_on_id":"bd-1fc","type":"blocks","created_at":"2026-02-25T01:30:35.692129710Z","created_by":"exedev","metadata":"{}","thread_id":""}],"comments":[{"id":32,"issue_id":"bd-38z","author":"Peter Schilling","text":"Risk note: polling must be conservative and fail-quietly. The user should only notice this feature when content actually changed; transient metadata check errors must not spam UI or logs.","created_at":"2026-02-25T01:15:12Z"}]}
{"id":"bd-39a","title":"serve2 slice 6: tailscale + bind host policy","description":"## Covered Sections\n- executable-decomposition\n- slice-6-tailscale-discovery-bind-host-policy-and-startup-url-selection\n- dependencies-and-implementation-notes\n- validation-strategy\n- cross-slice-dependencies\n- gate-a-approval-checklist\n\n## Acceptance Criteria\n- Bind host follows the 3-case policy in the plan.\n- Tailscale DNS URL is primary when available.\n- Localhost URL is always printed.\n- Missing/broken/hanging tailscale command never blocks startup.\n\n## Verification Steps\n- Run unit tests for host-selection decision table (explicit host, tailscale present, tailscale absent).\n- Run subprocess timeout/error-path tests with mocked `tailscale status --json` outputs (valid, invalid, timeout).\n- Run startup output tests asserting deterministic URL ordering and localhost inclusion.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T06:57:34.298549250Z","created_by":"exedev","updated_at":"2026-02-24T00:11:17.660230894Z","closed_at":"2026-02-24T00:11:17.660205768Z","close_reason":"Cleaning up for fresh start","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-39a","depends_on_id":"bd-28p","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-39h","title":"Terminal resize handling and responsive layout","description":"Ensure the application handles terminal resize events gracefully. When the terminal is resized, the content should reflow, scroll position should be maintained (or adjusted to stay reasonable), and all modals should re-center. Also handle very small terminal sizes gracefully (show a 'terminal too small' message if below minimum size).","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-21T00:28:54.074687071Z","created_by":"exedev","updated_at":"2026-02-21T01:42:43.778412177Z","closed_at":"2026-02-21T01:42:43.778367121Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-39h","depends_on_id":"bd-1by","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-39h","depends_on_id":"bd-267","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-39z","title":"Serve5-11: Integration and e2e test suite for mdmd serve","description":"## Objective\nComprehensive end-to-end coverage for serve behavior, security, rendering, navigation, cache semantics, MIME correctness, and legacy CLI compatibility.\n\n## Implementation Details\n- Tests live in tests/serve_integration.rs using reqwest (blocking) as HTTP client and std::process::Command to spawn mdmd binary.\n- Each test spawns server on random available port, performs HTTP requests, asserts on status/headers/body.\n- Fixtures: temp dir with test Markdown files (table, task list, mermaid block, relative links, oversized stub, symlink pointing outside root) created before each test; cleaned up after.\n- Detailed logging: each test prints `[TEST] scenario=<name> port=<port>` before requests. Failed assertions include full response body and headers.\n- Port selection: use `TcpListener::bind(\"127.0.0.1:0\")` to get free port before spawning binary with `--port <free_port>` and `--bind 127.0.0.1` to restrict to loopback.\n- Use `std::thread::sleep` with a reasonable startup wait (or retry loop with timeout) before making requests.\n\n## Coverage map (each is a separate #[test])\n- `test_serve_basic_html`: GET / → 200, HTML, Content-Type: text/html.\n- `test_serve_toc_present`: HTML response contains `<nav>` with TOC links.\n- `test_serve_raw_mode`: GET `/?raw=1` → Content-Type: text/plain, Markdown source.\n- `test_serve_table_rendered`: HTML contains `<table>` for GFM table fixture.\n- `test_serve_task_list_rendered`: HTML contains `<input type=\"checkbox\">`.\n- `test_serve_mermaid_placeholder`: HTML contains `class=\"mermaid\"` for mermaid fixture.\n- `test_serve_mermaid_cdn_script`: HTML contains Mermaid CDN `<script>` tag with pinned semver URL.\n- `test_serve_local_md_link_resolves`: GET link target → 200.\n- `test_serve_traversal_denied`: GET `/../etc/passwd` → 404.\n- `test_serve_url_encoded_traversal_denied`: GET `/%2e%2e/etc/passwd` → 404.\n- `test_serve_symlink_escape_denied`: symlink in root → outside path → 404.\n- `test_serve_extensionless_resolves`: GET `/guide` → 200 (resolves guide.md).\n- `test_serve_directory_readme_resolves`: GET `/subdir/` → 200 (resolves subdir/README.md).\n- `test_serve_directory_index_resolves`: GET `/subdir/` when README.md absent but index.md present → 200 (resolves subdir/index.md).\n- `test_serve_static_asset_image`: GET `/image.png` → 200, Content-Type: image/png.\n- `test_serve_nosniff_header`: X-Content-Type-Options: nosniff present on 200, 404, AND 413 responses (all three must be checked in this test or split into sub-assertions).\n- `test_serve_etag_present`: response includes `ETag` header.\n- `test_serve_304_on_etag_match`: GET with `If-None-Match: <etag>` → 304, empty body.\n- `test_serve_200_on_etag_mismatch`: GET with `If-None-Match: <wrong-etag>` → 200, full response body (non-matching ETag must NOT suppress full response).\n- `test_serve_304_on_modified_since`: GET with `If-Modified-Since: <date newer than file mtime>` → 304, empty body.\n- `test_serve_200_on_modified_since_older`: GET with `If-Modified-Since: <date older than file mtime>` → 200, full response body (file was modified after the request date, so must not return 304).\n- `test_serve_compression_gzip`: GET with `Accept-Encoding: gzip` → `Content-Encoding: gzip`.\n- `test_serve_compression_br`: GET with `Accept-Encoding: br` → `Content-Encoding: br`.\n- `test_serve_file_too_large`: oversized file (> 16 MB) → 413.\n- `test_serve_script_stripped`: page with `<script>` in Markdown → not in HTML response body.\n- `test_serve_startup_stdout_format`: capture stdout, assert: first line is 'mdmd serve', then 'root:', 'entry:', and 'url:' lines present in that order.\n- `test_serve_assets_css`: GET `/assets/mdmd.css` → 200, Content-Type: text/css.\n- `test_serve_assets_js`: GET `/assets/mdmd.js` → 200, Content-Type: text/javascript.\n- `test_legacy_cli_tui_path`: spawn `mdmd <file>` (no subcommand) → TUI mode dispatched, not serve. May require a non-interactive assertion (check process behavior, not terminal output).\n- `test_serve_graceful_shutdown`: send SIGINT to server process → exits with code 0.\n\n## Acceptance Criteria\n- All integration/e2e test functions pass with `cargo test --test serve_integration`.\n- Traversal and symlink denial tests confirm no file content leaked outside root.\n- Legacy CLI test confirms TUI path not regressed.\n- Pre-Merge Operational Checklist items covered by corresponding test functions.\n- Both conditional request cases tested: matching (304) and non-matching (200).\n- Both compression encodings tested independently: gzip and brotli.\n- nosniff header verified on 200, 404, and 413 response types.\n\n## Verification Steps\n- `cargo test --test serve_integration 2>&1`; all listed test names appear as ok.\n- Failed tests print `[TEST] scenario=<name>` plus full response context for diagnosis.\n- Run checklist: `cargo build --release`, `cargo clippy -- -D warnings`, `cargo fmt --check`, `cargo test`.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-24T04:51:47.387327453Z","created_by":"exedev","updated_at":"2026-02-24T22:19:38.359421935Z","closed_at":"2026-02-24T22:19:38.359387757Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-39z","depends_on_id":"bd-1mz","type":"blocks","created_at":"2026-02-24T04:51:53.763333091Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-39z","depends_on_id":"bd-1p6","type":"blocks","created_at":"2026-02-24T04:51:54.863487637Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-39z","depends_on_id":"bd-22o","type":"blocks","created_at":"2026-02-24T04:51:55.428642701Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-39z","depends_on_id":"bd-2f2","type":"parent-child","created_at":"2026-02-24T06:24:47.672297126Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-39z","depends_on_id":"bd-2n4","type":"blocks","created_at":"2026-02-24T04:51:54.326229413Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-39z","depends_on_id":"bd-2se","type":"blocks","created_at":"2026-02-24T04:51:55.140164297Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-39z","depends_on_id":"bd-30z","type":"blocks","created_at":"2026-02-24T04:51:55.721524335Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-39z","depends_on_id":"bd-3kq","type":"blocks","created_at":"2026-02-24T04:51:54.054948577Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-39z","depends_on_id":"bd-ezg","type":"blocks","created_at":"2026-02-24T04:51:54.585946730Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-3bl","title":"Lock behavior with integration coverage for output/logging/open flags","description":"Background and rationale:\nThe behavior change is user-facing and must be locked with integration coverage so future refactors cannot silently reintroduce noisy startup output.\n\nObjective and scope:\n- Update/add integration tests to enforce startup output, logging, and flag behavior end to end.\n- Ensure tests are deterministic across environments that may or may not have tailscale.\n- Add an executable e2e script that runs scenario matrix checks and emits structured logs.\n\nImplementation details:\n- Update serve integration test for startup stdout format to URL-only contract.\n- Add coverage for verbose diagnostics vs default quiet stderr.\n- Add coverage for no-open behavior and open-attempt suppression cases.\n- Design assertions for optional tailscale URL without flakiness (accept absent/present based on detection).\n- Add `tests/e2e/serve_startup_matrix.sh` (or equivalent) that runs key scenarios and writes per-scenario logs under `target/e2e-logs/serve-startup/`.\n\nDependency links:\n- Depends on diagnostic gating, output contract, and auto-open tasks.\n- Blocks epic closure.\n\nAcceptance criteria:\n- Integration suite captures new contract and passes in CI.\n- Tests clearly document expected stdout/stderr behavior under default and verbose modes.\n- no-open behavior is enforced by automated tests.\n- E2E matrix script provides clear, timestamped scenario logs for debugging regressions.\n\nTest requirements:\nUnit:\n- Add any missing helper-level tests needed to support deterministic integration assertions.\n\nE2E/integration:\n- Default serve startup: URL-only stdout, quiet stderr.\n- Verbose serve startup: URL stdout retained plus diagnostics on stderr.\n- no-open and headed/headless variants validated where feasible.\n- Logging expectation: default mode emits no informational startup logs.\n- Scripted matrix should print scenario headers, command lines, environment overrides, and captured stdout/stderr summaries.","notes":"Verification Steps:\n1. Implement the scoped changes and keep behavior aligned with this bead's objective/acceptance criteria.\n2. Run the unit and integration/e2e tests listed under Test requirements for this bead.\n3. Verify stdout/stderr logging expectations in the executed scenarios (default vs verbose, and any no-open/headless paths if applicable).\n4. Record the exact validation commands and outcomes in the implementation notes/PR summary for reproducibility.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-25T16:24:12.920088335Z","created_by":"exedev","updated_at":"2026-02-25T17:58:37.026777191Z","closed_at":"2026-02-25T17:58:37.026734621Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3bl","depends_on_id":"bd-1mv","type":"blocks","created_at":"2026-02-25T16:25:30.686407224Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3bl","depends_on_id":"bd-1o6","type":"blocks","created_at":"2026-02-25T16:24:20.739915647Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3bl","depends_on_id":"bd-34s","type":"blocks","created_at":"2026-02-25T16:25:30.253585406Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3bl","depends_on_id":"bd-guc","type":"blocks","created_at":"2026-02-25T16:24:21.128341292Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3bl","depends_on_id":"bd-i8p","type":"blocks","created_at":"2026-02-25T16:24:21.493143453Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-3bl.1","title":"[Subtask] Add serve startup e2e matrix script with detailed logs","description":"Create a scriptable e2e harness for serve startup UX coverage with detailed logging.\n\nObjective and scope:\n- Add a reproducible e2e script that exercises startup scenarios outside Rust integration tests.\n- Capture stdout/stderr logs per scenario for fast diagnosis in CI and local runs.\n\nImplementation details:\n- Add script: tests/e2e/serve_startup_matrix.sh\n- Scenarios at minimum:\n  1) default startup (non-verbose)\n  2) --verbose startup\n  3) --no-open startup\n  4) headless env startup (CI=1, DISPLAY/WAYLAND unset)\n- For each scenario:\n  - print scenario name + command + environment overrides\n  - capture process stdout and stderr separately\n  - emit pass/fail summary with relevant regex checks\n- Persist logs under target/e2e-logs/serve-startup/<timestamp>/<scenario>_{stdout,stderr}.log\n- Exit non-zero on first failed assertion.\n\nAcceptance criteria:\n- Script is executable and callable from CI (`bash tests/e2e/serve_startup_matrix.sh`).\n- Script validates URL-only stdout contract and verbose-gated stderr behavior.\n- Logs are detailed enough to triage failures without re-running interactively.\n\nTest requirements:\nUnit:\n- N/A (script-focused task).\n\nE2E:\n- Script itself is run in CI/local and enforces startup output/logging contract.\n- Include clear logging lines that annotate assertion failures with scenario context.","notes":"Verification Steps:\n1. Implement the scoped changes and keep behavior aligned with this bead's objective/acceptance criteria.\n2. Run the unit and integration/e2e tests listed under Test requirements for this bead.\n3. Verify stdout/stderr logging expectations in the executed scenarios (default vs verbose, and any no-open/headless paths if applicable).\n4. Record the exact validation commands and outcomes in the implementation notes/PR summary for reproducibility.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-25T16:33:53.019955062Z","created_by":"exedev","updated_at":"2026-02-25T18:02:46.810022318Z","closed_at":"2026-02-25T18:02:46.809975965Z","close_reason":"Script implemented at tests/e2e/serve_startup_matrix.sh with all four scenarios (default, verbose, no-open, headless), per-scenario log files, and fail-fast exit on first assertion failure.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3bl.1","depends_on_id":"bd-1mv","type":"blocks","created_at":"2026-02-25T16:34:00.123861270Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3bl.1","depends_on_id":"bd-34s","type":"blocks","created_at":"2026-02-25T16:33:59.713321198Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3bl.1","depends_on_id":"bd-3bl","type":"parent-child","created_at":"2026-02-25T16:33:53.019955062Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-3ci","title":"Implement directory index renderer policy (sort/filter/symlink/breadcrumbs)","description":"Implement directory index rendering for navigable folder requests that have no markdown fallback, plus the special GET / root early-exit.\n\nObjective and scope:\n- Add fn render_directory_index_response(state: &Arc<AppState>, dir_path: &Path, url_prefix: &str) -> Response that renders an HTML directory listing.\n- This function is used in TWO places in the handler:\n  (A) GET / early-exit (before resolve_candidate): always render directory index for serve_root.\n  (B) After resolve_candidate returns None: if metadata shows candidate is_dir, render directory index.\n\nImplementation details:\n- Handler structure (see also bd-uso for the GET / early-exit):\n    // (A) Root early-exit — always show directory index for serve_root.\n    if normalized == PathBuf::new() {\n        return render_directory_index_response(&state, &state.canonical_root, \"/\").await;\n    }\n    // (B) General pipeline.\n    let candidate = state.serve_root.join(&normalized);\n    match resolve_candidate(&candidate).await {\n        Some(resolved) => { /* serve file as before */ }\n        None => {\n            if let Ok(meta) = tokio::fs::metadata(&candidate).await {\n                if meta.is_dir() {\n                    return render_directory_index_response(&state, &candidate, &norm_display).await;\n                }\n            }\n            return rich_not_found_response(&state, &norm_display).await;\n        }\n    }\n- Sorting policy: directories first, then files; each group case-insensitive alphabetical.\n- Hidden entries policy: exclude entries whose name begins with '.'.\n- Symlink policy: include only if tokio::fs::canonicalize(entry) starts_with canonical_root; omit otherwise.\n- Breadcrumbs: build from url_prefix split by '/', each segment links back to its path. Root segment links to /.\n- Href encoding: encode each path segment with percent_encode_segment() individually, not the full path.\n- For directory paths that DO have README.md or index.md, resolve_candidate returns that file — directory index is NOT rendered for those paths (this is for path (B); path (A) always renders root index regardless).\n- Reuse the listing logic as a shared helper so bd-3u5 can call the same sort/filter/encode code.\n\nDependency links:\n- Depends on bd-uso (handler restructuring) and bd-2uj (percent_encode_segment).\n- Blocks bd-3u5, bd-3h2, bd-16x.\n\n## Acceptance Criteria\n- Shared directory-listing renderer is used for both root index and directory-path index responses, with deterministic ordering and per-segment URL encoding.\n- Listing policy is enforced: directories-first alpha sort, files alpha sort, dotfiles omitted, out-of-root symlinks omitted.\n- Breadcrumb links are correct for nested paths and root breadcrumb always points to `/`.\n- Unit tests cover listing-sort/filter/symlink decisions plus href segment encoding edge cases (spaces/unicode/reserved chars).\n- E2E scriptable checks validate root and nested directory index behavior with debug logging: `RUST_LOG=debug cargo test --test serve_integration test_serve_directory_index_policies -- --nocapture`.\n- Logs include index-render branch context (`path`, `entries`) and emit no unexpected `WARN`/`ERROR` on valid requests.\n\n## Verification Steps\n- Run unit tests covering sort/filter/symlink/breadcrumb/encoding policy helpers.\n- Run: RUST_LOG=debug cargo test --test serve_integration test_serve_directory_index_policies -- --nocapture.\n- Confirm rendered HTML shows deterministic ordering and logs include directory-index path + entry-count context without unexpected WARN/ERROR.","acceptance_criteria":"1) A shared directory-listing renderer is used by both GET / root early-exit and non-root directory index responses after unresolved candidate checks. 2) Listing policy is deterministic: directories first, then files; case-insensitive alpha sort within each group; dotfiles omitted; out-of-root symlinks omitted; in-root symlinks retained. 3) Breadcrumbs are correct for nested paths and root always links to /. 4) Hrefs are built by per-segment percent encoding (not whole-path encoding), including spaces, unicode, and reserved-character segments. 5) Unit tests comprehensively cover sort/filter/symlink/breadcrumb/encoding behaviors, including edge cases. 6) Integration tests validate root and nested index pages and confirm policy markers in rendered HTML. 7) E2E script coverage is added/extended in tests/e2e_serve_navigation.sh with directory-index scenarios and detailed step/log output. 8) Logs include directory-index branch context (requested path and entry count) and no unexpected WARN/ERROR on valid index requests.","notes":"Directory listing HTML structure: breadcrumb nav showing path segments as links (root -> dir1 -> dir2); entries list with icons or text markers for dirs vs files; each entry href is /path/to/dir/entry-name (percent-encoded); trailing slash on directory hrefs for clean navigation. Reuse the listing function in bd-3u5 (nearest-parent listing) to avoid duplicate sort/filter logic. Rust readdir: use tokio::fs::read_dir() and collect entries before sorting. Handle read_dir error gracefully by returning 500 or falling through to 404 rather than panicking.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-24T22:57:02.282636927Z","created_by":"exedev","updated_at":"2026-02-24T23:49:59.075456031Z","closed_at":"2026-02-24T23:49:59.075415112Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3ci","depends_on_id":"bd-2uj","type":"blocks","created_at":"2026-02-24T23:04:10.079782228Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3ci","depends_on_id":"bd-uso","type":"blocks","created_at":"2026-02-24T22:57:15.122871685Z","created_by":"exedev","metadata":"{}","thread_id":""}],"comments":[{"id":4,"issue_id":"bd-3ci","author":"Peter Schilling","text":"Policy note: directory listings are a product surface, not just debugging output. Enforce stable ordering/filtering to keep tests deterministic and UX predictable; omit out-of-root symlink targets to maintain boundary guarantees.","created_at":"2026-02-24T22:57:35Z"},{"id":22,"issue_id":"bd-3ci","author":"Peter Schilling","text":"Handler pipeline correction for GET /: the plan's workflow diagram shows GET / as a SEPARATE early branch that always renders the root directory index, distinct from the general GET /<path> pipeline. This means the implementation MUST NOT let GET / fall through to resolve_candidate (which would find serve_root/README.md and serve it instead of the index). The handler structure must be:\n\n  // Early-exit for root: always show root directory index.\n  if normalized == PathBuf::new() {\n      return render_directory_index_response(&state, &state.canonical_root, \"/\").await;\n  }\n  // General pipeline for all other paths:\n  let candidate = state.serve_root.join(&normalized);\n  match resolve_candidate(&candidate).await {\n      Some(resolved) => { /* serve file */ }\n      None => {\n          // Check if candidate is a directory → render index.\n          if let Ok(meta) = tokio::fs::metadata(&candidate).await {\n              if meta.is_dir() {\n                  return render_directory_index_response(&state, &candidate, &norm_display).await;\n              }\n          }\n          // Not a directory → rich 404.\n          return rich_not_found_response(&state, &norm_display).await;\n      }\n  }\n\nThe render_directory_index_response() function is shared by both the root-early-exit and the general is_dir branch.","created_at":"2026-02-24T23:10:34Z"}]}
{"id":"bd-3fa","title":"Add focused logging instrumentation for serve resolution branches","description":"Objective and scope:\n- Add explicit logging/observability expectations around path resolution and navigation outcomes to support debugging.\n- Keep instrumentation minimal, structured, and local-tool oriented.\n\nImplementation details:\n- Emit startup log with canonical serve root + pathful entry URL in one structured line, for example: [serve] serve_root=<...> entry_url_path=<...>.\n- Emit one structured request-outcome line per successful/expected branch:\n  - markdown served,\n  - static asset served,\n  - directory index rendered (include entries=<count>),\n  - rich 404 rendered (include nearest_parent=<...>).\n- Preserve existing resolver branch logging ([resolve] ...) and avoid duplicate noisy lines.\n- Keep expected-miss behavior non-error: rich 404 is INFO/DEBUG, not ERROR.\n- Keep traversal/invalid-input denials terse and log only minimal diagnostic context.\n\nDependency links:\n- Depends on routing/index/404 implementation tasks.\n- Supports integration and e2e logging assertions.\n\nTest requirements (unit and e2e, with logging expectations):\n- Unit: validate any helper that builds normalized/encoded fields used in structured logs.\n- Integration: capture stderr in tests/serve_integration.rs and assert required structured log keys per branch.\n- E2E scripts: extend tests/e2e_serve_navigation.sh with a dedicated logging-signatures section that runs targeted requests under RUST_LOG=debug, writes logs to an artifact file, and asserts required signatures with rg.\n\n## Verification Steps\n- Run targeted integration tests while capturing stderr and assert startup and branch-outcome log signatures exist.\n- Run tests/e2e_serve_navigation.sh logging-signatures section to validate required keys with rg.\n- Confirm expected 404 paths log at INFO/DEBUG and genuine failures are the only WARN/ERROR events.","acceptance_criteria":"1) Startup logs include serve_root and entry_url_path in a stable, parseable structured format. 2) Request-resolution logs emit one final branch-outcome line for markdown/static/directory-index/rich-404 with normalized path context. 3) Directory-index logs include entry-count metadata and rich-404 logs include nearest-parent metadata. 4) Expected 404 handling logs at INFO/DEBUG (not ERROR); WARN/ERROR are reserved for genuine failures. 5) Unit tests cover helper logic used to build structured log metadata where such helpers exist. 6) Integration tests assert presence of required branch log signatures by capturing server stderr. 7) tests/e2e_serve_navigation.sh contains a logging-signatures step that validates required log lines via rg and prints artifact locations for debugging.","status":"closed","priority":2,"issue_type":"chore","created_at":"2026-02-24T22:57:03.777721989Z","created_by":"exedev","updated_at":"2026-02-25T00:01:20.093506497Z","closed_at":"2026-02-25T00:01:20.093454975Z","close_reason":"Added all four structured log lines per spec","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3fa","depends_on_id":"bd-2uj","type":"blocks","created_at":"2026-02-24T23:04:10.369332895Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3fa","depends_on_id":"bd-3ci","type":"blocks","created_at":"2026-02-24T22:57:16.582041835Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3fa","depends_on_id":"bd-3u5","type":"blocks","created_at":"2026-02-24T22:57:16.883548631Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3fa","depends_on_id":"bd-uso","type":"blocks","created_at":"2026-02-24T22:57:16.275767501Z","created_by":"exedev","metadata":"{}","thread_id":""}],"comments":[{"id":9,"issue_id":"bd-3fa","author":"Peter Schilling","text":"Logging is for diagnosis of path resolution decisions. Capture branch outcome and relevant normalized path context at info/debug levels; expected 404 flows are not errors.","created_at":"2026-02-24T22:57:36Z"},{"id":18,"issue_id":"bd-3fa","author":"Peter Schilling","text":"Logging integration notes: with the new handler pipeline (markdown -> static asset -> directory index -> rich 404), add structured log lines for each branch outcome. Recommended format for new branches: '[request] path={norm_display} mode=directory_index entries={count}' and '[request] path={norm_display} mode=rich_404 nearest_parent={parent_path}'. Startup logs should emit: '[serve] serve_root={canonical_root} entry_url_path={entry_url_path}' so operators can confirm CWD-based root is correct. The existing '[resolve] path=... branch=...' format is preserved for existing branches. Integration tests in bd-3h2 should capture stderr and assert these log lines are present on successful and 404 paths.","created_at":"2026-02-24T23:01:37Z"}]}
{"id":"bd-3fh","title":"[Subtask] Propagate serve options through run_serve and runtime state","description":"Flags are only useful if runtime serve logic receives them consistently, including inside axum request handlers that run asynchronously after startup.\n\nObjective and scope:\n- Update run_serve signature to include no_open and verbose parameters.\n- Add verbose: bool to AppState so all axum handlers can gate their eprintln! calls via state.verbose.\n- Propagate no_open to the browser-open decision point at startup.\n\nImplementation details:\n- Update pub async fn run_serve signature in serve.rs (~line 1313):\n    pub async fn run_serve(file: String, bind_addr: String, start_port: u16, no_open: bool, verbose: bool) -> io::Result<()>\n- Update all call sites in main.rs to pass the new parameters.\n- Add verbose: bool field to AppState struct (~line 85 in serve.rs) so request handlers (serve_handler, freshness_handler, etc.) receive it through State<Arc<AppState>>.\n- Assign AppState { verbose, ... } when building the app state before axum::serve.\n- Keep no_open as a local variable in run_serve (only used at startup, not needed in handlers).\n\nDependency links:\n- Parent: bd-h6g.\n- Depends on parser subtask (bd-28j) for the source values.\n\nAcceptance criteria:\n- run_serve signature updated, all call sites compile.\n- AppState.verbose is accessible in serve_handler and freshness_handler.\n- No compile/runtime regressions from signature changes.\n\nTest requirements:\nUnit:\n- Option propagation tests for AppState construction with verbose=true/false.\n\nE2E/integration:\n- Invoke serve with --verbose flag and verify handler-level diagnostics are emitted.\n- Invoke serve without --verbose and verify handler-level diagnostics are absent.\n- Logging expectation: propagation itself does not emit diagnostics.","notes":"Verification Steps:\n1. Implement the scoped changes and keep behavior aligned with this bead's objective/acceptance criteria.\n2. Run the unit and integration/e2e tests listed under Test requirements for this bead.\n3. Verify stdout/stderr logging expectations in the executed scenarios (default vs verbose, and any no-open/headless paths if applicable).\n4. Record the exact validation commands and outcomes in the implementation notes/PR summary for reproducibility.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-25T16:25:11.459136918Z","created_by":"exedev","updated_at":"2026-02-25T16:49:33.937483561Z","closed_at":"2026-02-25T16:49:33.937441936Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3fh","depends_on_id":"bd-28j","type":"blocks","created_at":"2026-02-25T16:25:24.590189871Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-3h2","title":"Expand integration test matrix for serve navigation flows","description":"Build a comprehensive integration/e2e test matrix for the new serve UX behavior. This bead is the cross-feature acceptance gate from root navigation through broken-link recovery.\n\nImplementation details:\n- Keep the existing real-binary subprocess pattern in `tests/serve_integration.rs` (`Command::new(bin_path())` + reqwest client). Do not switch to `axum` TestClient/`tower::ServiceExt`.\n- Server subprocesses must run with `.current_dir(&fixture.root)` so CWD-root semantics are exercised against temp fixtures.\n- Extend integration tests to cover:\n  - `GET /` returns root directory index HTML (not entry markdown).\n  - Root index links to the entry document; following link returns rendered markdown HTML (`200`, `text/html`).\n  - Relative markdown links resolve to root-relative hrefs and remain reachable.\n  - Directory index policies: breadcrumbs, dirs-before-files ordering, dotfiles excluded, out-of-root symlinks omitted.\n  - Rich 404 page: `404`, HTML content type, requested path shown, nearest-parent recovery link, entry link, root link.\n  - Embedded assets `/assets/mdmd.css` and `/assets/mdmd.js` remain routable/content-typed correctly.\n- Continue using tempdir `Fixture`/`FixtureOptions`; add options for dotfiles/symlinks/nested structures instead of introducing alternate fixture systems.\n- Keep all integration coverage in `tests/serve_integration.rs`.\n\nDependency links:\n- Depends on bd-uso, bd-3u5, bd-3ci, bd-3fa, bd-t6w.\n- Blocks docs/polish closeout.\n\n## Acceptance Criteria\n- Integration suite validates full navigation flow: startup URL lines, root index at `/`, entry navigation, rewritten relative links, directory index policy behaviors, embedded assets, and rich 404 recovery.\n- Fixture strategy stays tempdir-based using `Fixture`/`FixtureOptions` and includes explicit options for dotfiles, symlinks, nested dirs, and link cases.\n- A maintained e2e script exists at `tests/e2e_serve_navigation.sh` with explicit sections: `root-index-flow`, `directory-index-policy`, `link-rewrite-flow`, `rich-404-recovery`, `logging-signatures`.\n- E2E script runs targeted integration tests under `RUST_LOG=debug` with `--nocapture`, writes deterministic log artifacts, and exits non-zero on any assertion failure.\n- Script output includes per-request assertions that report URL, expected status/content marker, and observed result for fast diagnosis.\n- Happy-path scenarios emit no unexpected `WARN`/`ERROR`; expected 404 scenarios include structured recovery context in logs.\n\n## Verification Steps\n- Run: RUST_LOG=debug cargo test --test serve_integration -- --nocapture and verify the expanded matrix passes.\n- Run: bash tests/e2e_serve_navigation.sh and verify required sections (root-index-flow, directory-index-policy, link-rewrite-flow, rich-404-recovery, logging-signatures).\n- Confirm script artifacts are deterministic and include per-step URL/status/content-marker assertions.","acceptance_criteria":"1) Integration suite in tests/serve_integration.rs validates full navigation flow: startup URL lines, root index at /, entry navigation, rewritten relative links, directory index policy behaviors, embedded assets, and rich 404 recovery. 2) Fixture strategy stays tempdir-based using Fixture/FixtureOptions and includes dedicated options for dotfiles, symlinks, nested dirs, and link scenarios. 3) E2E coverage is script-driven and maintained in tests/e2e_serve_navigation.sh with at least these sections: root-index-flow, directory-index-policy, link-rewrite-flow, rich-404-recovery, and logging-signatures. 4) Script runs targeted integration tests under RUST_LOG=debug with --nocapture, exits non-zero on any failed assertion, and writes logs to deterministic artifact paths. 5) Script output includes clear section markers plus per-step request/response assertions that identify failing URL, expected status/content markers, and observed result. 6) Integration + e2e coverage together exercises both happy-path and broken-link-path behavior end-to-end, including recovery links. 7) Happy-path scenarios emit no unexpected WARN/ERROR; expected 404 scenarios include structured recovery context in logs.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-24T22:57:03.184262094Z","created_by":"exedev","updated_at":"2026-02-25T00:17:00.631720388Z","closed_at":"2026-02-25T00:17:00.631641895Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3h2","depends_on_id":"bd-3ci","type":"blocks","created_at":"2026-02-24T22:57:17.184494920Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3h2","depends_on_id":"bd-3fa","type":"blocks","created_at":"2026-02-24T22:57:18.105352783Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3h2","depends_on_id":"bd-3u5","type":"blocks","created_at":"2026-02-24T22:57:17.488760988Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3h2","depends_on_id":"bd-t6w","type":"blocks","created_at":"2026-02-24T22:57:17.793528298Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3h2","depends_on_id":"bd-uso","type":"blocks","created_at":"2026-02-24T23:23:33.179248447Z","created_by":"exedev","metadata":"{}","thread_id":""}],"comments":[{"id":7,"issue_id":"bd-3h2","author":"Peter Schilling","text":"Integration matrix is the release-quality gate for this feature set. Prefer fixture-driven tests that model real navigation hops rather than isolated response checks.","created_at":"2026-02-24T22:57:36Z"},{"id":17,"issue_id":"bd-3h2","author":"Peter Schilling","text":"Fixture inventory: playground/ already contains stable test fixtures. Use these for integration tests: playground/README.md (entry doc with relative links to other files), playground/links.md (link-rich file), playground/subdir/nested.md (nested markdown with relative links back to parent), playground/subdir/sibling.md. Test scenario matrix for integration suite: (1) GET / returns HTML listing containing 'playground' dir entry; (2) GET /playground/README.md returns rendered HTML; (3) GET /playground/ returns dir index listing links.md, README.md, subdir/, etc.; (4) GET /playground/subdir/ returns dir index with nested.md, sibling.md; (5) GET /playground/subdir/nested.md returns rendered HTML; (6) GET /playground/.hidden (if it exists) returns 404 or is excluded from index; (7) GET /nonexistent/path/file.md returns 404 rich page with /playground/ as nearest parent (or /); (8) /assets/mdmd.css and /assets/mdmd.js return expected content-type. All tests use the actual binary or axum TestClient for real HTTP semantics.","created_at":"2026-02-24T23:01:30Z"},{"id":25,"issue_id":"bd-3h2","author":"Peter Schilling","text":"CLARIFICATION on fixture strategy: the comment above mentioning 'playground/ already contains stable test fixtures — use these for integration tests' is INCORRECT for the integration test suite. Integration tests in tests/serve_integration.rs use temp-dir Fixture instances (via tempfile::tempdir()), NOT the playground/ directory. playground/ files are for manual local testing only (e.g. cargo run serve playground/README.md). The integration tests must create their own controlled fixtures via Fixture::new(opts) and extend FixtureOptions as needed. The playground/ fixture inventory comment describes manual scenarios only, not automated test scenarios. The automated test scenarios are described in the implementation details section of this bead.","created_at":"2026-02-24T23:15:23Z"}]}
{"id":"bd-3jp","title":"serve2 slice 4: heading-first navigation","description":"## Covered Sections\n- executable-decomposition\n- slice-4-heading-first-navigation-ux\n- validation-strategy\n- cross-slice-dependencies\n\n## Acceptance Criteria\n- TOC links map 1:1 to heading IDs.\n- Active section is visually highlighted while scrolling.\n- Duplicate heading text yields stable unique IDs.\n\n## Verification Steps\n- Run slug-generation unit tests for duplicate and punctuation-heavy headings.\n- Run DOM-level tests (or snapshot assertions) verifying TOC anchor/heading ID parity.\n- Run browser integration check asserting active-state class changes while scrolling fixture content.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T06:57:34.095403578Z","created_by":"exedev","updated_at":"2026-02-24T00:11:18.605946485Z","closed_at":"2026-02-24T00:11:18.605921729Z","close_reason":"Cleaning up for fresh start","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3jp","depends_on_id":"bd-18i","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-3k4","title":"[Subtask] Refactor startup stdout to URL-only lines","description":"Users primarily need actionable URLs; labeled startup blocks reduce signal-to-noise. The current startup stdout at ~lines 1463-1481 in serve.rs emits seven labeled lines; the new contract is bare URL(s) only.\n\nObjective and scope:\n- Replace the entire old startup println! block in run_serve with URL-only output.\n- Remove all prefix labels from stdout.\n\nImplementation details:\nCurrent code to replace (~lines 1463-1481 in serve.rs):\n    println!(\"mdmd serve\");\n    println!(\"root:  {}\", state.canonical_root.display());\n    println!(\"entry: {}\", state.entry_file.display());\n    println!(\"url:   http://127.0.0.1:{bound_port}{}\", state.entry_url_path);\n    println!(\"index: http://127.0.0.1:{bound_port}/\");\n    println!(\"backlinks: startup-indexed; restart server after file edits to pick up changes\");\n    // ... tailscale block also removes 'url:' and 'index:' prefixed lines\n\nNew code (stdout only, no labels):\n    println!(\"http://127.0.0.1:{bound_port}{}\", state.entry_url_path);\n    // tailscale handled in bd-8z2\n\nChanges:\n- Remove the 'mdmd serve' banner line entirely from stdout.\n- Remove root:, entry:, backlinks: lines entirely from stdout (backlinks hint can be added to verbose stderr if desired, as vlog!(verbose, ...)).\n- Remove the index: http://127.0.0.1:{port}/ line (root index URL not shown in default mode).\n- Change url:   http://... prefix to bare http://... with no prefix.\n- Move the tailscale URL changes to bd-8z2 but note the same pattern: no 'url:' or 'index:' prefix, just the bare entry URL.\n\nDependency links:\n- Parent: bd-guc.\n- Depends on verbose gating task completion (bd-u9i) to avoid stdout/stderr overlap.\n\nAcceptance criteria:\n- Default stdout contains no label text (no 'mdmd serve', 'root:', 'entry:', 'url:', 'index:', 'backlinks:').\n- Local entry URL is printed as bare URL on first stdout line.\n\nTest requirements:\nUnit:\n- If URL formatting is extracted to a helper, test the helper returns a bare URL string.\n\nE2E/integration:\n- Startup stdout format test asserts first line matches ^http://127\\.0\\.0\\.1:\\d+/.\n- Asserts no lines start with 'mdmd serve', 'root:', 'entry:', 'url:', 'index:', 'backlinks:'.\n- Logging expectation: stderr remains quiet in default mode.","notes":"Verification Steps:\n1. Implement the scoped changes and keep behavior aligned with this bead's objective/acceptance criteria.\n2. Run the unit and integration/e2e tests listed under Test requirements for this bead.\n3. Verify stdout/stderr logging expectations in the executed scenarios (default vs verbose, and any no-open/headless paths if applicable).\n4. Record the exact validation commands and outcomes in the implementation notes/PR summary for reproducibility.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-25T16:25:12.643568689Z","created_by":"exedev","updated_at":"2026-02-25T16:46:52.424466474Z","closed_at":"2026-02-25T16:46:52.424446075Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-3kq","title":"Serve5-03: Tailscale-aware startup URL output","description":"## Objective\nAlways print localhost URL on startup; conditionally print Tailscale URL from `.Self.DNSName`.\n\n## Implementation Details\n- Spawn `tailscale status --json` as subprocess; capture stdout.\n- R7 mitigation: parse JSON via `serde_json` using `?`/`Result` propagation only — zero `unwrap()`/`expect()` on tailscale parsing paths. Any parse failure, empty output, or subprocess error is silently treated as 'no Tailscale available'; log at `debug` level with skip reason.\n- Trim trailing `.` from DNSName before printing.\n- Only print Tailscale URL when DNSName is non-empty after trimming.\n- Startup output always includes: `url:   http://127.0.0.1:{port}`\n- When Tailscale available: also print: `url:   http://{tailscale_dns}:{port}`\n\n## Acceptance Criteria\n- Startup never panics or fails due to tailscale errors.\n- URL output policy is deterministic: always localhost, optionally tailscale.\n- All tailscale parse paths use `?`/`Result`; no `unwrap`.\n\n## Verification Steps\n- Unit: valid JSON with DNSName `\"hostname.ts.net.\"` → trimmed URL `http://hostname.ts.net:{port}`.\n- Unit: trailing dot only `\".\"` → treated as empty, no tailscale URL.\n- Unit: empty JSON `{}` or missing `Self` → no tailscale URL, no panic.\n- Unit: malformed JSON → no tailscale URL, no panic.\n- Unit: subprocess failure (command not found) → no tailscale URL, no panic.\n- Integration: start server with environment stub returning valid Tailscale JSON; assert tailscale URL appears in startup output.\n- Integration: start server with environment stub returning invalid JSON; assert only localhost URL appears (no tailscale URL, no crash).\n- Log: `[tailscale] skipped reason=<detail>` at debug level when unavailable.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-24T04:48:41.578140572Z","created_by":"exedev","updated_at":"2026-02-24T07:04:57.643176128Z","closed_at":"2026-02-24T07:04:57.643138391Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3kq","depends_on_id":"bd-1mz","type":"blocks","created_at":"2026-02-24T04:48:44.924382127Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3kq","depends_on_id":"bd-2f2","type":"parent-child","created_at":"2026-02-24T06:24:50.770923572Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-3mx","title":"Relative-link serve UX overhaul","description":"Objective and scope:\n- Deliver the relative-link serving UX overhaul for `mdmd serve <path>` so local doc browsing behaves like filesystem navigation.\n- Scope includes startup URL behavior, path-aware routing, directory index rendering, rich broken-link pages, and full validation coverage.\n- Out of scope: adding a `--root` flag or changing the broader containment/security model beyond current local-tool checks.\n\nImplementation details:\n- Use `serve_root = cwd` and keep containment checks as the base trust boundary.\n- Ensure `entry_url_path` is computed once at startup from canonical entry path relative to canonical root.\n- Keep existing `resolve_candidate()` and `rewrite_local_links()` implementations; focus on integrating behavior with routing and UX.\n- Coordinate child tasks for routing order, index policy, 404 experience, tests, and docs.\n\nDependency links:\n- Parent epic; children are blocked by this issue for structure/traceability.\n\nAcceptance criteria:\n- All child tasks are completed and dependency graph is acyclic.\n- End-to-end flow works: startup prints pathful entry URL + root URL, `/` shows root index, relative links resolve, broken links show rich recovery page.\n- Final behavior matches plan intent without needing to consult `docs/plans/relative-links/plan.md`.\n\nTest requirements (unit and e2e, with logging expectations):\n- Unit: child tasks must include focused unit tests for helper/path logic.\n- E2E/integration: child tasks must include route-level behavior validation from startup URL through navigation.\n- Logging: successful-path tests should observe no `WARN/ERROR`; broken-link scenarios should emit structured request context at `INFO` or `DEBUG` with requested path.\n\n## Success Criteria\n- Child tasks close with no dependency cycles and collectively deliver the planned UX behavior: pathful startup URL, root index at `/`, working relative navigation, directory index policies, and rich 404 recovery.\n- Unit-test coverage exists for path derivation/listing/nearest-parent logic and guards against regressions in fallback or encoding behavior.\n- E2E coverage includes reproducible script-based execution with detailed debug logging for happy path and broken-link path.\n- Release verification runbook includes explicit commands (`cargo test`, targeted integration tests, and e2e script invocations) and expected log signatures.\n\n## Verification Steps\n- Verify all child beads are closed and dependency graph remains acyclic (br dep cycles).\n- Run full verification suite (cargo test, targeted serve integration tests, and tests/e2e_serve_navigation.sh) and confirm expected behavior signatures.\n- Validate release runbook commands and log markers are complete enough for reproducible maintainer validation.","acceptance_criteria":"1) All child tasks complete with an acyclic dependency graph and no scope loss versus the approved relative-link serve UX plan. 2) Delivered behavior is end-to-end consistent: pathful startup entry URL + root index URL, GET / root index, correct relative-link navigation, directory index policy enforcement, and rich 404 recovery UX. 3) Comprehensive automated coverage exists across unit tests, integration tests, and at least one maintained e2e script (tests/e2e_serve_navigation.sh) with detailed logging. 4) Logging expectations are validated: branch-level resolution context is present; happy-path runs avoid unexpected WARN/ERROR; expected 404 flows log structured recovery context at INFO/DEBUG. 5) Release verification runbook includes explicit commands and expected log signatures so maintainers can reproduce behavior without consulting plan docs.","status":"open","priority":1,"issue_type":"epic","created_at":"2026-02-24T22:57:01.431220176Z","created_by":"exedev","updated_at":"2026-02-24T23:25:44.967388119Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3mx","depends_on_id":"bd-16x","type":"blocks","created_at":"2026-02-24T22:57:21.690694419Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3mx","depends_on_id":"bd-2uj","type":"blocks","created_at":"2026-02-24T22:57:19.918097507Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3mx","depends_on_id":"bd-3ci","type":"blocks","created_at":"2026-02-24T22:57:20.520529966Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3mx","depends_on_id":"bd-3fa","type":"blocks","created_at":"2026-02-24T22:57:21.998189257Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3mx","depends_on_id":"bd-3h2","type":"blocks","created_at":"2026-02-24T22:57:21.401707339Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3mx","depends_on_id":"bd-3u5","type":"blocks","created_at":"2026-02-24T22:57:20.816603430Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3mx","depends_on_id":"bd-t6w","type":"blocks","created_at":"2026-02-24T22:57:21.106867297Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3mx","depends_on_id":"bd-uso","type":"blocks","created_at":"2026-02-24T22:57:20.217151538Z","created_by":"exedev","metadata":"{}","thread_id":""}],"comments":[{"id":1,"issue_id":"bd-3mx","author":"Peter Schilling","text":"Maintainer context: this epic is intentionally integration-focused and preserves existing resolver/rewrite internals. The key behavior shift is UX routing ( as root index) and startup URL presentation. Keep scope constrained to local-tool use and existing containment checks.","created_at":"2026-02-24T22:57:34Z"},{"id":10,"issue_id":"bd-3mx","author":"Peter Schilling","text":"Dependency authority: the explicit graph (via br dep) is canonical. Epic depends on all child tasks so work can start with ready leaf tasks and epic closes last.","created_at":"2026-02-24T22:57:49Z"}]}
{"id":"bd-3o8","title":"Link detection, highlighting, and Tab navigation between links","description":"Visually highlight markdown links in the rendered document with a distinct style (underline + color). Implement Tab/Shift-Tab to cycle between links. When a link is focused, show the URL in the status bar. This creates the accessibility-inspired link navigation described in the spec.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-02-21T00:28:52.559065613Z","created_by":"exedev","updated_at":"2026-02-21T01:11:29.365253779Z","closed_at":"2026-02-21T01:11:29.365206792Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3o8","depends_on_id":"bd-1sf","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-3o8","depends_on_id":"bd-p4x","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-3oh","title":"Unit test suite for backlinks, normalization parity, and metadata freshness logic","description":"Objective and scope:\n- Add focused unit tests that lock core algorithms and contracts for backlinks and freshness detection.\n- Scope includes extractor cases, key normalization parity, self-link filtering, traversal filters, and metadata token comparison logic.\n\nImplementation details:\n- Test location: #[cfg(test)] modules inline in relevant source files:\n  - Extractor tests: in src/backlinks.rs (or wherever the extractor lives) — see bd-3oh.1.\n  - Normalization/key/PageShellContext tests: in src/html.rs and src/serve.rs test modules — see bd-3oh.2.\n- NOTE: tracing-test crate is NOT in dev-dependencies. Do NOT add it. Log assertions in unit tests are limited to:\n  - Asserting the return value indicates an error/skip (e.g., empty Vec, None) rather than testing the log message text.\n  - If log assertions are required, document the approach (e.g., using a custom subscriber or accepting panic-free behavior as the bar).\n- Table-driven test structure: each test case is a tuple (input_markdown, source_path, serve_root, expected_outbound_refs).\n- Key normalization parity test: manually invoke url_key_from_rel_path() with synthetic paths (no filesystem needed) and assert output format. Then separately build backlinks index from TempDir fixture and assert runtime lookup keys match.\n- Self-link suppression test: source file a.md contains link to a.md; assert a.md does NOT appear in its own backlinks_index entry.\n- Non-UTF-8 test: pass raw invalid UTF-8 bytes to extractor function; assert it returns empty result without panic (log assertion not required without tracing-test).\n- Metadata token test: call build_page_shell() with a non-None file_mtime_secs; parse meta tag from returned HTML string using str::contains checks; assert correct u64 content.\n- Traversal filter test: create TempDir with .git/ subdirectory containing a markdown file with links; run traversal; assert .git-nested file was NOT indexed (verify by checking index map is empty for paths under .git/).\n\nDependencies:\n- All implementation tasks must be complete before this test task is worked.\n\nAcceptance criteria:\n- Unit coverage exists for all critical branches in backlinks/freshness core logic.\n- Tests run under 'cargo test' with no filesystem side effects beyond TempDir.\n- Tests are deterministic and do not rely on network timing.\n- No tracing-test dependency added.\n\nTest requirements (unit and e2e, with logging expectations):\n- Unit: this task is unit-test primary. Subtasks bd-3oh.1 and bd-3oh.2 own specific sub-areas.\n- E2E: none directly authored here; bd-26u covers e2e.\n- Logging: no in-process log capture. Verify correct behavior via return values and HTML output only.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-25T01:14:41.250893966Z","created_by":"exedev","updated_at":"2026-02-25T05:27:52.181429270Z","closed_at":"2026-02-25T05:27:52.181401052Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3oh","depends_on_id":"bd-1hd","type":"blocks","created_at":"2026-02-25T01:14:54.797050599Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3oh","depends_on_id":"bd-38z","type":"blocks","created_at":"2026-02-25T01:14:55.141389551Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3oh","depends_on_id":"bd-f8j","type":"blocks","created_at":"2026-02-25T01:14:54.454926881Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3oh","depends_on_id":"bd-r8y","type":"blocks","created_at":"2026-02-25T01:14:54.103050541Z","created_by":"exedev","metadata":"{}","thread_id":""}],"comments":[{"id":35,"issue_id":"bd-3oh","author":"Peter Schilling","text":"Regression strategy: unit tests should be table-driven and fixture-backed so future parser/routing refactors cannot silently break normalization or filtering guarantees.","created_at":"2026-02-25T01:15:13Z"}]}
{"id":"bd-3oh.1","title":"Unit subtask: extractor/link-filter/snippet fixture matrix","description":"Objective and scope:\n- Implement the extractor-centric unit matrix so parsing/filtering behavior is pinned.\n- Scope includes relative vs external links, fragment capture, snippet window shaping, non-UTF-8 skip behavior, outside-root link dropping, and first-H1 title extraction.\n\nImplementation details:\n- Tests live in #[cfg(test)] module of src/backlinks.rs.\n- No tracing-test. All assertions on return values only.\n- Paths in tests are synthetic PathBuf values (no filesystem I/O):\n  serve_root = PathBuf::from('/root'), source_path = PathBuf::from('/root/docs/a.md')\n- Link extraction fixture cases (assert_eq! with descriptive messages):\n  1. '[text](./other.md)' → outbound_refs[0].target_url_path = '/docs/other.md', no fragment.\n  2. '[text](./other.md#section)' → target_url_path = '/docs/other.md', target_fragment = Some('section').\n  3. '[text](../sibling/page.md)' → target_url_path = '/sibling/page.md'.\n  4. '[text](/absolute/path.md)' → target_url_path = '/absolute/path.md' (absolute-local from serve_root).\n  5. '[text](https://example.com)' → outbound_refs is empty (excluded).\n  6. '[text](http://...)' → excluded.\n  7. '[text](#heading)' → excluded.\n  8. '[text](mailto:foo@bar.com)' → excluded.\n  9. Multi-link doc with 2 local + 1 external → outbound_refs.len() == 2.\n  10. Link with surrounding text → snippet contains context; whitespace collapsed to single space.\n  11. Very long surrounding text (500+ chars on each side) → snippet.len() <= 200.\n  12. Empty &str input → DocExtractResult { title: None, outbound_refs: vec![] } (no panic).\n- Title extraction fixture cases:\n  13. '# My Title\\n\\ntext' → title = Some('My Title').\n  14. '## H2 Only\\n\\ntext' → title = None.\n  15. '[link](./a.md)\\n\\n# Late Title' → title = Some('Late Title') (single pass collects both).\n  16. '# First\\n\\n# Second' → title = Some('First') (first H1 only).\n  17. '# **Bold** *Title*' → title = Some('Bold Title') (inner text joined, no markdown syntax).\n  18. '' (empty string) → title = None, outbound_refs = [].\n- Outside-root drop case:\n  19. Source at /root/docs/a.md, serve_root = /root, link = '../../etc/passwd'. Resolved = /etc/passwd. strip_prefix(/root) fails. → outbound_refs is empty (silently dropped, no error).\n\nDependency links:\n- Subtask of bd-3oh; depends on extractor implementation (bd-f8j).\n\nAcceptance criteria:\n- All 19 listed test cases compile and pass deterministically.\n- No filesystem I/O in any test (all synthetic PathBuf values).\n- Case 19 confirms outside-root links are silently dropped.\n\nTest requirements:\n- Unit: primary deliverable. Run via cargo test --lib.\n- Logging: non-UTF-8 case replaced by empty-input case (case 12) since bd-1hd reads UTF-8 and skips on error before calling extractor.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-25T01:16:06.941628193Z","created_by":"exedev","updated_at":"2026-02-25T05:27:51.418640887Z","closed_at":"2026-02-25T05:27:51.418609745Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3oh.1","depends_on_id":"bd-3oh","type":"parent-child","created_at":"2026-02-25T01:16:06.941628193Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3oh.1","depends_on_id":"bd-f8j","type":"blocks","created_at":"2026-02-25T01:16:19.410762545Z","created_by":"exedev","metadata":"{}","thread_id":""}],"comments":[{"id":37,"issue_id":"bd-3oh.1","author":"Peter Schilling","text":"Subtask intent: keep fixture corpus compact but representative; prefer explicit expected tuples so failures explain exactly which link-shape regressed.","created_at":"2026-02-25T01:16:25Z"}]}
{"id":"bd-3oh.2","title":"Unit subtask: path-key parity, self-link suppression, metadata token compare","description":"Objective and scope:\n- Lock normalization, freshness, and PageShellContext contracts that are easy to regress during routing/template changes.\n- Scope includes canonical key parity, self-link filtering, metadata token embedding, and change notice div presence.\n\nImplementation details:\n- Tests live in #[cfg(test)] modules of src/serve.rs (for key/norm tests) and src/html.rs (for PageShellContext/HTML tests).\n- NOTE: tracing-test NOT in dev-dependencies; all assertions are on function return values and HTML string content only.\n- Key parity tests (pure, no filesystem; use synthetic paths):\n  1. url_key_from_rel_path('docs/readme.md') == '/docs/readme.md'.\n  2. url_key_from_rel_path('') == '/'.\n  3. url_key_from_rel_path('readme.md') == '/readme.md'.\n  4. norm_display round-trip: simulate percent_decode('/docs/read%20me.md') + normalize_path() → norm_display = 'docs/read me.md'; url_key_from_rel_path(norm_display) = '/docs/read me.md'. Assert this matches a key built from the same equivalent path string.\n  5. Fragment stripping: the freshness endpoint and backlinks lookup both strip fragments. If a request has path '/docs/page.md' (never contains fragment — axum/serve already separates path from query/fragment), key = '/docs/page.md'. Assert test exercises this path.\n- Self-link exclusion tests (use TempDir or synthetic index):\n  6. Build index where source_url_path = '/docs/a.md' links to target_url_path = '/docs/a.md' (self-link). Assert backlinks_index.get('/docs/a.md') is empty or excludes the self-referencing entry.\n  7. Source '/docs/a.md' links to '/docs/b.md' (different files). Assert backlinks_index['/docs/b.md'] contains one BacklinkRef with source_url_path = '/docs/a.md'.\n- PageShellContext and meta tag tests (call build_page_shell() directly):\n  8. ctx = PageShellContext { backlinks: &[], file_mtime_secs: Some(12345), page_url_path: Some('docs/test.md') }; HTML contains 'content=\"12345\"' and 'content=\"docs/test.md\"'.\n  9. ctx with file_mtime_secs: None → HTML does NOT contain 'mdmd-mtime' meta tag.\n  10. Any ctx (even with mtime=None) → HTML body contains 'id=\"mdmd-change-notice\"' and contains 'hidden'.\n- Source_display rendering tests:\n  11. BacklinkRef { source_display: 'My Title', source_url_path: '/a.md', snippet: 'ctx', target_fragment: None } → HTML contains '>My Title</a>' (exact link text).\n  12. BacklinkRef { source_display: 'docs/a.md' (path fallback), ... } → HTML contains '>docs/a.md</a>'.\n- HTML-escaping test:\n  13. BacklinkRef { source_display: '<script>xss</script>', snippet: '&amp;', ... } → HTML contains '&lt;script&gt;' and '&amp;amp;' (double-escaped snippet). Verify html_escape() was applied.\n\nDependency links:\n- Subtask of bd-3oh; depends on bd-3oh (parent), bd-r8y, bd-38z, and bd-1fc.\n\nAcceptance criteria:\n- All 13 listed tests compile and pass deterministically.\n- No filesystem I/O beyond synthetic PathBuf values.\n- No tracing-test dependency.\n\nTest requirements:\n- Unit: primary deliverable. Run via cargo test --lib.\n- Logging: no log assertions; test only return values and HTML string content.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-25T01:16:07.277571624Z","created_by":"exedev","updated_at":"2026-02-25T05:27:51.796142074Z","closed_at":"2026-02-25T05:27:51.796121277Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3oh.2","depends_on_id":"bd-1fc","type":"blocks","created_at":"2026-02-25T01:34:09.585844607Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3oh.2","depends_on_id":"bd-38z","type":"blocks","created_at":"2026-02-25T01:16:20.127631502Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3oh.2","depends_on_id":"bd-3oh","type":"parent-child","created_at":"2026-02-25T01:16:07.277571624Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3oh.2","depends_on_id":"bd-r8y","type":"blocks","created_at":"2026-02-25T01:16:19.759352620Z","created_by":"exedev","metadata":"{}","thread_id":""}],"comments":[{"id":38,"issue_id":"bd-3oh.2","author":"Peter Schilling","text":"Contract guard: this subtask is the safety net against subtle key drift between startup index and request path normalization.","created_at":"2026-02-25T01:16:26Z"}]}
{"id":"bd-3pj","title":"Backlinks panel + out-of-cwd serve safety + file freshness UX","description":"Objective and scope:\n- Deliver a Roam/Notion-style backlinks experience in mdmd serve, add file-change detection notice with reload action, and safely support serving entry paths outside cwd when explicitly requested.\n- Scope includes startup indexing, server state wiring, HTML/CSS updates, metadata polling flow, out-of-cwd warning/confirmation behavior, and removal/audit of redundant 'back to' assumptions.\n- Out of scope: multi-root serving, live backlinks re-index without restart, and widening traversal permissions outside selected serve_root.\n\nImplementation details:\n- Keep deterministic root derivation: entry directory if entry is dir; parent directory if entry is file.\n- Build backlinks once at startup from markdown files under serve_root; store index in shared AppState.\n- Keep containment protections; links outside serve_root remain blocked.\n- Add explicit startup warning when serve_root is outside cwd; interactive TTY requires y/yes, non-interactive auto-continues after warning.\n- Add file metadata token on rendered markdown pages and lightweight polling endpoint/behavior for changed-on-disk detection.\n\nDependency links:\n- Parent epic for child tasks below; epic remains open until all children close.\n\nAcceptance criteria:\n- Child dependency graph is acyclic and complete for backlinks, freshness notice, out-of-cwd safety prompt, and test coverage.\n- Behavior matches plan intent without needing docs/plans/backlinks-etc/plan.md during implementation.\n\nTest requirements (unit and e2e, with logging expectations):\n- Unit and integration/e2e requirements are delegated to child tasks and must collectively cover extraction, normalization parity, render behavior, polling update detection, and root-safety flows.\n- Logging expectations include startup scan summary counts and warning visibility for out-of-cwd serve roots.","acceptance_criteria":"1) Backlinks are indexed at startup for markdown content under the selected `serve_root` and rendered in-page with stable path normalization.\n2) A file-freshness notice flow detects on-disk changes and supports a user-triggered reload path without unsafe auto-overwrite behavior.\n3) Serving an entry path outside cwd is allowed only with explicit startup warning/confirmation behavior that matches TTY vs non-interactive expectations.\n4) Containment protections remain enforced so resolved navigation cannot escape the chosen `serve_root`.\n5) Child tasks, dependencies, and test coverage collectively validate backlinks UX, freshness UX, and out-of-cwd safety behavior.","notes":"Verification Steps:\n1. Implement the scoped changes and keep behavior aligned with this bead's objective/acceptance criteria.\n2. Run the unit and integration/e2e tests listed under Test requirements for this bead.\n3. Verify stdout/stderr logging expectations in the executed scenarios (default vs verbose, and any no-open/headless paths if applicable).\n4. Record the exact validation commands and outcomes in the implementation notes/PR summary for reproducibility.","status":"open","priority":1,"issue_type":"epic","created_at":"2026-02-25T01:13:21.290251927Z","created_by":"exedev","updated_at":"2026-02-25T21:03:40.153069063Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3pj","depends_on_id":"bd-17g","type":"blocks","created_at":"2026-02-25T01:14:49.071333817Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3pj","depends_on_id":"bd-1dt","type":"blocks","created_at":"2026-02-25T01:14:50.112675803Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3pj","depends_on_id":"bd-1fc","type":"blocks","created_at":"2026-02-25T01:14:49.423780768Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3pj","depends_on_id":"bd-1hd","type":"blocks","created_at":"2026-02-25T01:14:48.732035266Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3pj","depends_on_id":"bd-26u","type":"blocks","created_at":"2026-02-25T01:14:51.103851214Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3pj","depends_on_id":"bd-2ag","type":"blocks","created_at":"2026-02-25T01:14:50.457811798Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3pj","depends_on_id":"bd-38z","type":"blocks","created_at":"2026-02-25T01:14:49.771496951Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3pj","depends_on_id":"bd-3oh","type":"blocks","created_at":"2026-02-25T01:14:50.787584096Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3pj","depends_on_id":"bd-f8j","type":"blocks","created_at":"2026-02-25T01:14:48.380754559Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3pj","depends_on_id":"bd-r8y","type":"blocks","created_at":"2026-02-25T01:14:48.027554219Z","created_by":"exedev","metadata":"{}","thread_id":""}],"comments":[{"id":26,"issue_id":"bd-3pj","author":"Peter Schilling","text":"Planner decomposition note: this epic intentionally bundles three user-visible capabilities (backlinks, disk-change freshness notice, and out-of-cwd serving safety prompt) because they share serve-path routing and page-shell touchpoints. Keep the implementation split across child tasks to minimize regression risk and preserve reviewability.","created_at":"2026-02-25T01:15:10Z"}]}
{"id":"bd-3u5","title":"Build rich 404 page with nearest-parent recovery links","description":"Deliver a rich HTML 404 experience for unresolved non-security paths with clear recovery options.\n\nObjective and scope:\n- Replace plain unresolved-path responses with a state-aware HTML 404 renderer for expected misses.\n\nImplementation details:\n- Implement `rich_not_found_response(state: &Arc<AppState>, norm_display: &str) -> Response` that:\n  1) computes nearest existing parent directory under canonical root,\n  2) renders requested path context,\n  3) includes quick links to `state.entry_url_path`, root `/`, and nearest-parent index,\n  4) optionally includes nearest-parent directory listing via the shared directory-listing primitive from bd-3ci.\n- Implement `nearest_existing_parent(state: &Arc<AppState>, norm_display: &str) -> PathBuf` as a deterministic, root-bounded helper.\n- Preserve HTTP `404` status with `Content-Type: text/html; charset=utf-8`.\n- Replace only unresolved non-security `not_found_response()` call sites. Security-denial branches (traversal/null/invalid-encoding/outside-root) must remain terse and non-disclosing.\n- Reuse shared listing/sort/filter/encoding helpers from bd-3ci to avoid policy drift.\n\nDependency links:\n- Depends on bd-3ci and bd-2uj.\n- Blocks bd-3h2, bd-3fa, bd-16x.\n\n## Acceptance Criteria\n- Unresolved non-security paths return HTML 404 (`status=404`, `text/html`) showing requested path, nearest existing parent link, entry-doc link (`entry_url_path`), and root index link.\n- Security denials never use rich 404 rendering and continue returning terse non-disclosing responses.\n- `nearest_existing_parent()` is deterministic, bounded to canonical root, and robust across normalization edge cases.\n- Unit tests comprehensively cover nearest-parent selection: missing leaf, multi-level misses, root fallback, and encoded segment edge cases.\n- Integration tests verify rich-404 link correctness and that following nearest-parent recovery links succeeds when expected.\n- E2E script coverage is present in `tests/e2e_serve_navigation.sh` (`rich-404-recovery` + `logging-signatures` sections) with detailed request/response and log capture.\n- Expected 404 flows log at `INFO`/`DEBUG` with requested-path and nearest-parent fields; no `ERROR` logging for expected misses.\n\n## Verification Steps\n- Run unit tests for nearest_existing_parent edge cases (root fallback, multilevel miss, encoded segments).\n- Run integration tests that request missing paths and follow nearest-parent recovery links.\n- Run e2e rich-404-recovery checks and confirm expected misses log at INFO/DEBUG with requested-path + nearest-parent fields and no ERROR.","acceptance_criteria":"1) Unresolved non-security paths return HTML 404 (status 404, Content-Type text/html) showing requested path, nearest existing parent link, entry document link (entry_url_path), and root index link. 2) Security denials (traversal/null/invalid-encoding/outside-root) continue returning terse non-disclosing responses and never use rich 404 rendering. 3) nearest_existing_parent() is deterministic, root-bounded, and shared safely with listing helpers from bd-3ci. 4) Unit tests comprehensively cover nearest-parent behavior: missing leaf, multi-level miss, root fallback, normalization edge cases, and encoded segment handling. 5) Integration tests validate rich-404 link correctness and recoverability from the nearest parent index. 6) E2E script coverage is added/extended in tests/e2e_serve_navigation.sh for broken-link recovery paths with detailed request/response and log capture. 7) Expected 404 flows log at INFO/DEBUG with requested-path and nearest-parent fields; no ERROR logging for expected misses.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-24T22:57:02.586157854Z","created_by":"exedev","updated_at":"2026-02-24T23:58:23.676833545Z","closed_at":"2026-02-24T23:58:23.676783189Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3u5","depends_on_id":"bd-2uj","type":"blocks","created_at":"2026-02-24T22:57:15.407862905Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3u5","depends_on_id":"bd-3ci","type":"blocks","created_at":"2026-02-24T22:57:15.699297723Z","created_by":"exedev","metadata":"{}","thread_id":""}],"comments":[{"id":5,"issue_id":"bd-3u5","author":"Peter Schilling","text":"404 UX should optimize recovery speed: always provide context (what was requested) and nearby valid links. Reuse listing utilities where possible so sorting/filtering policy stays consistent between index and 404 pages.","created_at":"2026-02-24T22:57:35Z"},{"id":15,"issue_id":"bd-3u5","author":"Peter Schilling","text":"Implementation note: the current not_found_response() (serve.rs:371-378) returns text/plain 'Not Found'. The rich 404 handler needs access to AppState to get entry_url_path and canonical_root (for nearest-parent resolution). Replace the not_found_response() call in the handler's None branch with a rich_not_found_response(norm_display, &state) that: (1) walks up from the requested path until it finds an existing directory under serve_root, (2) builds breadcrumb and quick links using percent_encode_segment, (3) optionally lists the nearest parent directory using the same listing primitive as the directory index renderer. Unit tests needed for nearest_existing_parent() helper: test cases for missing leaf in existing parent, all ancestors missing (falls back to root), and root-level miss.","created_at":"2026-02-24T23:01:13Z"}]}
{"id":"bd-4yc","title":"serve3 gate A epic: mdmd serve SSR delivery","description":"Objective and Scope:\nDeliver Gate A of mdmd serve as a production-ready SSR markdown web server with deterministic behavior for CLI contract, routing safety, rendering parity baseline, heading-first UX, tailscale-aware startup URLs, and HTTP performance semantics.\n\nImplementation Details:\nCoordinate child slices bd-4yc.1 through bd-4yc.8 as the canonical dependency graph. Keep implementation SSR-first in Rust, preserve existing mdmd file-view behavior, and maintain explicit observability and tests for each behavior contract.\n\nDependency Links:\nRoot epic for all serve3 Gate A tasks and subtasks. Child dependency ordering is expressed via parent-child and blocks edges.\n\nAcceptance Criteria:\nAll child beads are closed; acceptance criteria in docs/plans/serve3/plan.md are met; startup/runtime behavior matches locked Gate A decisions.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nRun full unit and e2e matrix from bd-4yc.8. Validate logs include startup host policy rationale, bind/port selection, resolved root+entry, URL pair, resolver decision path, render/cache/compression decisions, and tailscale probe outcome.\n\nBackground / Rationale / Constraints / Intent:\nThis epic exists so future maintainers can execute Gate A without reopening planning context. Scope is intentionally tight to serve3 requirements and excludes watch mode, sanitize mode, and server-side Mermaid rasterization.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-02-23T21:35:28.887208058Z","created_by":"exedev","updated_at":"2026-02-23T23:49:48.182905036Z","closed_at":"2026-02-23T23:49:48.182884298Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-4yc.1","title":"serve3 slice 1: CLI + bootstrap contract","description":"Objective and Scope:\nImplement mdmd serve command/bootstrap contract while preserving backward-compatible mdmd file invocation behavior.\n\nImplementation Details:\nOwns CLI/runtime bootstrap and startup lifecycle: declared options, default port 3333 behavior, bounded AddrInUse increment policy, graceful Ctrl-C/SIGTERM shutdown, and deterministic startup summary outputs.\n\nDependency Links:\nParent: bd-4yc. Blocks bd-4yc.2 (routing) and bd-4yc.7 (tailscale URL policy). Child chain: bd-4yc.1.1 -> bd-4yc.1.2 -> bd-4yc.1.3.\n\nAcceptance Criteria:\nCLI contract is stable and documented by tests; bind retry behavior is bounded and reasoned; startup output contains contract fields consumed by validation tasks.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit: flag parsing/defaults, invalid input handling, retry cap behavior, startup formatter.\nE2E: occupied-port retries, shutdown on signal, startup output contract checks.\nLogging: bind retry reason classes, final bind target, and shutdown trigger classification.\n\nBackground / Rationale / Constraints / Intent:\nThis slice establishes operator-facing startup behavior for every downstream slice. Keep it deterministic so later routing/render/perf tasks can rely on stable startup semantics.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-23T21:35:29.005896034Z","created_by":"exedev","updated_at":"2026-02-23T23:49:47.964233982Z","closed_at":"2026-02-23T23:49:47.964202975Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.1","depends_on_id":"bd-4yc","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.1.1","title":"serve3 subtask: CLI arg surface + backward compatibility","description":"Objective and Scope:\nImplement parser and command wiring for mdmd serve path while preserving mdmd file invocation behavior.\n\nImplementation Details:\nAdd and validate options --port, --host, --root, --open, --no-tailscale, and --mermaid-mode; ensure legacy invocation path remains unchanged.\n\nDependency Links:\nParent task is bd-4yc.1.\n\nAcceptance Criteria:\nAll options parse and flow into runtime config; legacy command behavior is unchanged.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit tests for argument parsing and defaults; e2e smoke tests for legacy and new invocation forms; startup logs include resolved config summary.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-23T21:35:30.089833383Z","created_by":"exedev","updated_at":"2026-02-23T23:49:47.723339646Z","closed_at":"2026-02-23T23:49:47.723305005Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.1.1","depends_on_id":"bd-4yc.1","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.1.2","title":"serve3 subtask: bounded port probe + graceful shutdown","description":"Objective and Scope:\nImplement bind retry loop and controlled shutdown lifecycle.\n\nImplementation Details:\nStart at requested or default port and increment only on AddrInUse with bounded attempts; handle Ctrl-C and SIGTERM graceful drain.\n\nDependency Links:\nParent task is bd-4yc.1; blocked by bd-4yc.1.1.\n\nAcceptance Criteria:\nRetry logic matches policy and stops on non-AddrInUse errors; shutdown exits cleanly.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit tests for retry decision matrix; e2e with pre-bound ports and signal termination; logs record each retry and shutdown trigger.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-23T21:35:30.231963312Z","created_by":"exedev","updated_at":"2026-02-23T23:49:58.648576199Z","closed_at":"2026-02-23T23:49:58.648546690Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.1.2","depends_on_id":"bd-4yc.1","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.1.2","depends_on_id":"bd-4yc.1.1","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.1.3","title":"serve3 subtask: startup summary output + --open launch semantics","description":"Objective and Scope:\nFinalize operator-facing bootstrap UX by making startup output deterministic and implementing --open behavior that launches the resolved primary URL without changing server semantics.\n\nImplementation Details:\n- Emit startup output as a stable, parseable block with these required fields: bind host, bound port, resolved root path, resolved entry path, primary URL, localhost fallback URL, and effective mermaid mode.\n- When --open is set, invoke platform opener exactly once after successful bind/start and target the same primary URL printed to stdout.\n- If opener command fails, log a warning and continue serving; this must never crash or block startup completion.\n- Keep output wording stable enough for snapshot tests and automation scripts.\n\nDependency Links:\nParent: bd-4yc.1.\nBlocked by: bd-4yc.1.2 (port/bind lifecycle established first).\nBlocks: validation startup-output matrix work under bd-4yc.8.\n\nAcceptance Criteria:\n- Startup output always includes root and entry and both URLs.\n- --open launches the selected primary URL after server startup.\n- Opener failure degrades to warning-only behavior.\n- No regression to non-serve CLI flows.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\n- Unit: output formatter snapshot tests for deterministic field order and labels.\n- Unit: open-launch decision matrix for --open true/false and opener failure path.\n- E2E: run serve with --open under mocked opener and assert invoked URL equals printed primary URL.\n- Logging: assert startup summary lines and opener success/failure log entries include reason codes.\n\nBackground / Rationale / Constraints / Intent:\nThe serve command is frequently consumed both by humans and scripts; stable startup output prevents tooling drift and speeds debugging. --open is convenience only, so failures must be non-fatal.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T21:39:04.978952301Z","created_by":"exedev","updated_at":"2026-02-23T23:49:59.156901117Z","closed_at":"2026-02-23T23:49:59.156881397Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.1.3","depends_on_id":"bd-4yc.1","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.1.3","depends_on_id":"bd-4yc.1.2","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.2","title":"serve3 slice 2: root-safe routing + resolver","description":"Objective and Scope:\nImplement root-safe routing and deterministic path resolution for markdown + static content under configured root.\n\nImplementation Details:\nServe / and /*path with explicit precedence: exact path -> .md fallback -> README.md -> index.md. Enforce canonical under-root checks to prevent traversal and symlink escapes. Support markdown raw output via ?raw=1 and clear HTTP error contract.\n\nDependency Links:\nParent: bd-4yc. Blocked by bd-4yc.1. Blocks bd-4yc.3 and bd-4yc.6. Child chain: bd-4yc.2.1 -> bd-4yc.2.2 -> bd-4yc.2.3.\n\nAcceptance Criteria:\nOnly in-root files are served; resolver precedence is deterministic; markdown raw mode works; missing paths emit explicit 404 behavior.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit: precedence matrix, traversal rejection, symlink breakout rejection.\nE2E: nested fixtures, MIME checks, raw mode, and 404 path coverage.\nLogging: normalized request path, resolution rule selected, and rejection/error reason class.\n\nBackground / Rationale / Constraints / Intent:\nRouting safety is a security and correctness boundary. Downstream rendering/performance features assume resolver outputs are canonical and deterministic.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-23T21:35:29.136116625Z","created_by":"exedev","updated_at":"2026-02-23T23:49:58.898751482Z","closed_at":"2026-02-23T23:49:58.898731246Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.2","depends_on_id":"bd-4yc","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.2","depends_on_id":"bd-4yc.1","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.2.1","title":"serve3 subtask: path resolver precedence + markdown/raw responses","description":"Objective and Scope:\nImplement deterministic path resolution and markdown/raw response branching.\n\nImplementation Details:\nResolution order exact, .md, README.md, index.md; query raw=1 returns markdown source with text/markdown content type.\n\nDependency Links:\nParent task is bd-4yc.2; blocked by bd-4yc.1.\n\nAcceptance Criteria:\nResolver chooses expected file across fixture permutations; raw mode bypasses HTML wrapper.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit tests for precedence order; e2e route matrix including nested paths and raw output; debug logs include chosen resolution branch.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-23T21:35:30.384821169Z","created_by":"exedev","updated_at":"2026-02-23T23:49:58.416160975Z","closed_at":"2026-02-23T23:49:58.416131562Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.2.1","depends_on_id":"bd-4yc.1","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.2.1","depends_on_id":"bd-4yc.2","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.2.2","title":"serve3 subtask: traversal/symlink escape protections + static MIME","description":"Objective and Scope:\nEnforce root confinement and correct static file serving behavior.\n\nImplementation Details:\nCanonicalize paths and reject root escapes, traversal, and symlink breakout; serve static assets with MIME detection; explicit 404 for misses.\n\nDependency Links:\nParent task is bd-4yc.2; blocked by bd-4yc.2.1.\n\nAcceptance Criteria:\nNo request can escape configured root; static files return correct content type; missing files return 404.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit tests for root confinement edge cases; e2e symlink traversal attempts and static MIME checks; logs include rejection reason class.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-23T21:35:30.532425079Z","created_by":"exedev","updated_at":"2026-02-23T23:50:00.022511922Z","closed_at":"2026-02-23T23:50:00.022487015Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.2.2","depends_on_id":"bd-4yc.2","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.2.2","depends_on_id":"bd-4yc.2.1","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.2.3","title":"serve3 subtask: HTTP error contract + resolver observability","description":"Objective and Scope:\nDefine and implement the HTTP response contract and resolver observability for non-happy paths so routing behavior is predictable for users and tests.\n\nImplementation Details:\n- Normalize method handling for markdown/static routes: GET/HEAD supported, others return explicit status (e.g. 405) with stable error body semantics.\n- Standardize 404/403/405 response shape and content type policy.\n- Ensure resolver logging emits structured reason classes: exact_match, md_fallback, readme_fallback, index_fallback, not_found, traversal_reject, root_escape_reject, method_reject.\n- Maintain low overhead by keeping verbose resolver logs at debug level.\n\nDependency Links:\nParent: bd-4yc.2.\nBlocked by: bd-4yc.2.2 (path safety and MIME behavior in place first).\nBlocks: verification tasks that assert stable HTTP/error and resolver logs.\n\nAcceptance Criteria:\n- Unsupported methods and unresolved paths return deterministic status codes and response formats.\n- Resolver reason classes are emitted consistently for each request path.\n- HEAD behavior matches GET headers without response body.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\n- Unit: status mapping table tests for route + method combinations.\n- Unit: resolver reason enum coverage and serialization formatting.\n- E2E: fixture requests validate 404/405 and HEAD behavior across markdown/static routes.\n- Logging: assert debug log lines include normalized request path and resolver reason class.\n\nBackground / Rationale / Constraints / Intent:\nOperational debugging depends on deterministic failure behavior. Explicit reason classes avoid ambiguous logs and reduce triage time when link resolution or path safety checks fail.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T21:39:14.786539408Z","created_by":"exedev","updated_at":"2026-02-23T23:50:00.736935190Z","closed_at":"2026-02-23T23:50:00.736914246Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.2.3","depends_on_id":"bd-4yc.2","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.2.3","depends_on_id":"bd-4yc.2.2","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.3","title":"serve3 slice 3: SSR markdown pipeline (comrak + syntect)","description":"Objective and Scope:\nDeliver SSR markdown rendering baseline in Rust with practical GitHub-flavored behavior and stable local-link semantics.\n\nImplementation Details:\nUse comrak with explicit GFM extensions, apply syntect server-side fenced-code highlighting, and rewrite local markdown links for nested serve routes while preserving external links/fragments. Maintain fixture corpus for parity guardrails.\n\nDependency Links:\nParent: bd-4yc. Blocked by bd-4yc.2. Blocks bd-4yc.4, bd-4yc.5, and bd-4yc.6. Child chain: bd-4yc.3.1 -> {bd-4yc.3.2, bd-4yc.3.3} -> bd-4yc.3.4.\n\nAcceptance Criteria:\nSSR output supports required GFM baseline; code blocks are highlighted with deterministic fallback; local markdown links resolve across directory depth.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit: renderer options, highlight fallback paths, rewrite edge cases.\nE2E: GFM fixture corpus including tables/task lists/fenced code/links.\nLogging: renderer mode, highlight fallback reason, and rewrite decision classes.\n\nBackground / Rationale / Constraints / Intent:\nThis is the core user-visible behavior. Keep parsing/rendering mostly server-side for predictable output and performance.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-23T21:35:29.258879339Z","created_by":"exedev","updated_at":"2026-02-23T23:50:00.265714914Z","closed_at":"2026-02-23T23:50:00.265693953Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.3","depends_on_id":"bd-4yc","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.3","depends_on_id":"bd-4yc.2","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.3.1","title":"serve3 subtask: comrak GFM options + SSR template integration","description":"Objective and Scope:\nProduce SSR HTML with explicit GFM-compatible parser and renderer options.\n\nImplementation Details:\nUse comrak config for tables, task lists, strikethrough, autolinks, and fenced code; integrate renderer output into serve HTML template shell.\n\nDependency Links:\nParent task is bd-4yc.3; blocked by bd-4yc.2.\n\nAcceptance Criteria:\nFixture markdown renders expected structural HTML for baseline GFM features.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit tests for renderer option toggles; e2e golden tests for representative fixtures; logs record renderer profile at startup.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-23T21:35:30.695258105Z","created_by":"exedev","updated_at":"2026-02-23T23:49:59.788822522Z","closed_at":"2026-02-23T23:49:59.788802815Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.3.1","depends_on_id":"bd-4yc.2","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.3.1","depends_on_id":"bd-4yc.3","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.3.2","title":"serve3 subtask: syntect fenced-code highlighting + language fallback","description":"Objective and Scope:\nApply server-side syntax highlighting for fenced code blocks.\n\nImplementation Details:\nIntegrate syntect highlighting into SSR pipeline with graceful fallback when language is unknown.\n\nDependency Links:\nParent task is bd-4yc.3; blocked by bd-4yc.3.1.\n\nAcceptance Criteria:\nCode blocks receive deterministic highlighted HTML where grammar exists; unknown grammars remain readable plain output.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit tests for language lookup and fallback paths; e2e fixtures verify highlighted output; logs include unknown-language fallback counts.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T21:35:30.853438772Z","created_by":"exedev","updated_at":"2026-02-23T23:50:01.908803438Z","closed_at":"2026-02-23T23:50:01.908778721Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.3.2","depends_on_id":"bd-4yc.3","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.3.2","depends_on_id":"bd-4yc.3.1","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.3.3","title":"serve3 subtask: local markdown link rewriting","description":"Objective and Scope:\nRewrite internal markdown links into serve routes across nested directories.\n\nImplementation Details:\nRewrite relative links targeting local markdown while preserving external URLs, mailto links, fragments, and non-markdown asset links.\n\nDependency Links:\nParent task is bd-4yc.3; blocked by bd-4yc.3.1.\n\nAcceptance Criteria:\nInter-file links resolve correctly via HTTP routes; non-local links are unchanged.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit tests for relative normalization and anchor handling; e2e click-through tests across fixture tree; debug logs may include rewrite count per page.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T21:35:31.012106133Z","created_by":"exedev","updated_at":"2026-02-23T23:50:01.683506650Z","closed_at":"2026-02-23T23:50:01.683486517Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.3.3","depends_on_id":"bd-4yc.3","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.3.3","depends_on_id":"bd-4yc.3.1","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.3.4","title":"serve3 subtask: SSR parity fixture corpus for GFM baseline","description":"Objective and Scope:\nLock down baseline GitHub-flavored markdown parity using fixture-driven SSR tests so rendering changes remain intentional and reviewable.\n\nImplementation Details:\n- Add canonical fixture corpus covering tables, task lists, fenced code, autolinks, strikethrough, nested lists, blockquotes, and mixed inline formatting.\n- Verify SSR output includes expected structural HTML markers for each fixture and stays stable across parser upgrades.\n- Keep assertions focused on semantic structure (tags/classes/ids), not brittle whitespace.\n- Document fixture intent and expected behavior inside test files for maintainability.\n\nDependency Links:\nParent: bd-4yc.3.\nBlocked by: bd-4yc.3.2 and bd-4yc.3.3 (highlighting + link rewrite finalized first).\nBlocks: validation matrix completeness in bd-4yc.8.1 and bd-4yc.8.2.\n\nAcceptance Criteria:\n- Fixture corpus exists and is wired into automated tests.\n- SSR semantic output for GFM baseline features is asserted and passing.\n- Renderer regressions produce actionable diffs.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\n- Unit: parser/render option tests map each fixture feature to expected output markers.\n- E2E: serve fixture tree and validate rendered HTML contains expected structures.\n- Logging: optional debug logs include fixture name and render profile used during test runs.\n\nBackground / Rationale / Constraints / Intent:\n“Support everything GitHub does” is broad; fixture-backed semantic checks establish a practical, maintainable baseline that can be expanded without destabilizing Gate A.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T21:39:23.116382262Z","created_by":"exedev","updated_at":"2026-02-23T23:50:03.309058989Z","closed_at":"2026-02-23T23:50:03.309037558Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.3.4","depends_on_id":"bd-4yc.3","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.3.4","depends_on_id":"bd-4yc.3.2","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.3.4","depends_on_id":"bd-4yc.3.3","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.4","title":"serve3 slice 3b: mermaid assets + mode control","description":"Objective and Scope:\nProvide Mermaid support in serve mode with offline-first asset delivery and deterministic mode gating.\n\nImplementation Details:\nBundle Mermaid runtime in mdmd assets, expose it via /__mdmd/assets/*, and gate runtime injection using --mermaid-mode client|off (default client).\n\nDependency Links:\nParent: bd-4yc. Blocked by bd-4yc.3. Child chain: bd-4yc.4.1 -> bd-4yc.4.2. Validation dependency consumers: bd-4yc.8 and bd-4yc.8.2.\n\nAcceptance Criteria:\nClient mode renders Mermaid without CDN/network dependency; off mode suppresses runtime injection and execution.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit: mode parsing/template branch tests.\nE2E: offline asset fetch + enabled/disabled diagram behavior.\nLogging: startup field for effective Mermaid mode.\n\nBackground / Rationale / Constraints / Intent:\nGate A requires Mermaid compatibility while keeping server architecture SSR-first. Client-side Mermaid execution is a deliberate compromise; server-side Mermaid rendering is out of scope for this phase.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T21:35:29.386858973Z","created_by":"exedev","updated_at":"2026-02-23T23:50:02.592743076Z","closed_at":"2026-02-23T23:50:02.592723402Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.4","depends_on_id":"bd-4yc","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.4","depends_on_id":"bd-4yc.3","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.4.1","title":"serve3 subtask: bundled mermaid asset route","description":"Objective and Scope:\nShip and serve mermaid runtime from built-in assets endpoint.\n\nImplementation Details:\nExpose __mdmd assets route for embedded assets and ensure no CDN dependency.\n\nDependency Links:\nParent task is bd-4yc.4; blocked by bd-4yc.3.\n\nAcceptance Criteria:\nMermaid runtime is available from local assets route in offline environment.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit tests for asset path routing; e2e fetches asset endpoint without network; startup logs include asset mount path.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T21:35:31.181830949Z","created_by":"exedev","updated_at":"2026-02-23T23:50:01.453758111Z","closed_at":"2026-02-23T23:50:01.453739114Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.4.1","depends_on_id":"bd-4yc.3","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.4.1","depends_on_id":"bd-4yc.4","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.4.2","title":"serve3 subtask: mermaid mode client/off behavior","description":"Objective and Scope:\nImplement deterministic mermaid mode behavior in rendered pages.\n\nImplementation Details:\nDefault client mode injects runtime bootstrap; off mode omits scripts and avoids runtime execution.\n\nDependency Links:\nParent task is bd-4yc.4; blocked by bd-4yc.4.1.\n\nAcceptance Criteria:\nMode switch reliably controls script injection and runtime behavior.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit tests for mode parsing and template branch; e2e verifies diagram render versus disabled state; logs show effective mermaid mode.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T21:35:31.353549998Z","created_by":"exedev","updated_at":"2026-02-23T23:50:03.959219719Z","closed_at":"2026-02-23T23:50:03.959199826Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.4.2","depends_on_id":"bd-4yc.4","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.4.2","depends_on_id":"bd-4yc.4.1","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.5","title":"serve3 slice 4: heading-first navigation UX","description":"Objective and Scope:\nImplement heading-first reading/navigation UX with persistent TOC and stable heading identity.\n\nImplementation Details:\nExtract heading tree during SSR, generate deterministic GitHub-like IDs with collision suffixing, render persistent TOC/sidebar + file-path chrome, and apply minimal client enhancements for active-heading highlight and smooth TOC scroll.\n\nDependency Links:\nParent: bd-4yc. Blocked by bd-4yc.3. Child chain: bd-4yc.5.1 -> bd-4yc.5.2 -> bd-4yc.5.3. Consumed by validation tasks bd-4yc.8, bd-4yc.8.1, bd-4yc.8.2.\n\nAcceptance Criteria:\nTOC is always present for markdown pages; duplicate headings map to stable unique anchors; active heading highlight tracks viewport position.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit: slug generation/collision behavior and heading tree structure.\nE2E: TOC visibility, highlight transitions, smooth scrolling.\nLogging: heading count and collision count for rendered pages.\n\nBackground / Rationale / Constraints / Intent:\nThe heading system is a first-class requirement for long-form docs navigation. Keep JS minimal and deterministic so SSR remains dominant.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T21:35:29.515881229Z","created_by":"exedev","updated_at":"2026-02-23T23:50:02.356120491Z","closed_at":"2026-02-23T23:50:02.356099566Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.5","depends_on_id":"bd-4yc","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.5","depends_on_id":"bd-4yc.3","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.5.1","title":"serve3 subtask: heading extraction + deterministic slug collisions","description":"Objective and Scope:\nGenerate stable heading IDs and hierarchical TOC data during SSR.\n\nImplementation Details:\nImplement GitHub-like slug normalization and collision suffixing while preserving heading order and depth.\n\nDependency Links:\nParent task is bd-4yc.5; blocked by bd-4yc.3.\n\nAcceptance Criteria:\nDuplicate headings produce stable unique IDs across runs and content order.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit tests for slug normalization and collision cases; e2e snapshot validates TOC ID consistency; debug logs include collision metrics.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T21:35:31.520795592Z","created_by":"exedev","updated_at":"2026-02-23T23:50:01.212670278Z","closed_at":"2026-02-23T23:50:01.212643780Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.5.1","depends_on_id":"bd-4yc.3","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.5.1","depends_on_id":"bd-4yc.5","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.5.2","title":"serve3 subtask: persistent TOC + file path chrome","description":"Objective and Scope:\nRender always-visible heading TOC and display current file path in page header chrome.\n\nImplementation Details:\nInject TOC sidebar into page template with responsive layout behavior and current file indicator.\n\nDependency Links:\nParent task is bd-4yc.5; blocked by bd-4yc.5.1.\n\nAcceptance Criteria:\nTOC appears for markdown pages and file path is visible in desktop and mobile layouts.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nBrowser e2e checks for TOC and file path visibility at multiple viewport sizes; logs may include rendered heading count.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T21:35:31.701401898Z","created_by":"exedev","updated_at":"2026-02-23T23:50:03.735251032Z","closed_at":"2026-02-23T23:50:03.735231243Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.5.2","depends_on_id":"bd-4yc.5","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.5.2","depends_on_id":"bd-4yc.5.1","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.5.3","title":"serve3 subtask: active heading highlight + smooth TOC scrolling","description":"Objective and Scope:\nAdd minimal client enhancements for navigation usability.\n\nImplementation Details:\nUse IntersectionObserver for active heading highlight and smooth scrolling behavior for TOC anchor navigation.\n\nDependency Links:\nParent task is bd-4yc.5; blocked by bd-4yc.5.2.\n\nAcceptance Criteria:\nActive TOC item tracks in-view heading and TOC clicks scroll smoothly to target anchors.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nBrowser e2e validates active-state transitions and smooth scrolling behavior; debug logs may emit script initialization success.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-23T21:35:31.874026576Z","created_by":"exedev","updated_at":"2026-02-23T23:50:04.424130597Z","closed_at":"2026-02-23T23:50:04.424105700Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.5.3","depends_on_id":"bd-4yc.5","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.5.3","depends_on_id":"bd-4yc.5.2","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.6","title":"serve3 slice 5: cache + revalidation + compression","description":"Objective and Scope:\nDeliver performance-oriented HTTP behavior via render caching, conditional revalidation, and compression with standards-correct interactions.\n\nImplementation Details:\nCache markdown render output using canonical path + (mtime,size), emit ETag and Last-Modified validators, handle 304 responses correctly, and apply compression middleware for text responses while preserving validator/cache correctness across encodings.\n\nDependency Links:\nParent: bd-4yc. Blocked by bd-4yc.2 and bd-4yc.3. Child chain: bd-4yc.6.1 -> bd-4yc.6.2 -> bd-4yc.6.3 -> bd-4yc.6.4.\n\nAcceptance Criteria:\nCache hit/miss/invalidation behavior is deterministic; conditional requests are correct; compression does not break validator semantics.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit: key derivation, validator precedence, response decision matrix.\nE2E: Accept-Encoding and conditional-header permutations with body/header assertions.\nLogging: per-request cache, revalidation, and compression decision fields.\n\nBackground / Rationale / Constraints / Intent:\nPerformance improvements are required but must remain diagnosable. Explicit matrix testing/logging prevents subtle regressions in cache and HTTP semantics.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T21:35:29.645543778Z","created_by":"exedev","updated_at":"2026-02-23T23:50:02.132420002Z","closed_at":"2026-02-23T23:50:02.132399660Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.6","depends_on_id":"bd-4yc","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.6","depends_on_id":"bd-4yc.2","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.6","depends_on_id":"bd-4yc.3","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.6.1","title":"serve3 subtask: render cache keyed by canonical path + (mtime,size)","description":"Objective and Scope:\nImplement cache entries that invalidate on source content changes.\n\nImplementation Details:\nCache rendered output by canonical path and file metadata tuple mtime plus size to avoid stale responses.\n\nDependency Links:\nParent task is bd-4yc.6; blocked by bd-4yc.3 and bd-4yc.2.\n\nAcceptance Criteria:\nUnchanged files hit cache; modified files invalidate and re-render deterministically.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit tests for key generation and invalidation; e2e repeated request timing and content refresh checks; logs include hit, miss, and invalidate events.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T21:35:32.041052665Z","created_by":"exedev","updated_at":"2026-02-23T23:50:00.975420636Z","closed_at":"2026-02-23T23:50:00.975401775Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.6.1","depends_on_id":"bd-4yc.2","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.6.1","depends_on_id":"bd-4yc.3","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.6.1","depends_on_id":"bd-4yc.6","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.6.2","title":"serve3 subtask: ETag/Last-Modified + conditional 304","description":"Objective and Scope:\nSupport HTTP revalidation semantics for markdown and text responses.\n\nImplementation Details:\nEmit validators and evaluate If-None-Match and If-Modified-Since to return 304 when appropriate.\n\nDependency Links:\nParent task is bd-4yc.6; blocked by bd-4yc.6.1.\n\nAcceptance Criteria:\nConditional requests return correct status and header behavior with empty body on 304.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit tests for validator precedence rules; e2e with curl header scenarios; logs capture revalidation decision and matched validator type.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T21:35:32.209581284Z","created_by":"exedev","updated_at":"2026-02-23T23:50:03.524555710Z","closed_at":"2026-02-23T23:50:03.524536058Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.6.2","depends_on_id":"bd-4yc.6","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.6.2","depends_on_id":"bd-4yc.6.1","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.6.3","title":"serve3 subtask: compression middleware tuning","description":"Objective and Scope:\nEnable compression for eligible responses without breaking cache and revalidation correctness.\n\nImplementation Details:\nConfigure compression middleware for text-like content and verify compatibility with validator headers.\n\nDependency Links:\nParent task is bd-4yc.6; blocked by bd-4yc.6.2.\n\nAcceptance Criteria:\nResponses compress when client advertises support and remain standards-compliant with existing headers.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nIntegration tests with Accept-Encoding variants; e2e checks Content-Encoding and body integrity; logs indicate compression choice at debug level.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-23T21:35:32.388254280Z","created_by":"exedev","updated_at":"2026-02-23T23:50:04.193858401Z","closed_at":"2026-02-23T23:50:04.193838881Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.6.3","depends_on_id":"bd-4yc.6","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.6.3","depends_on_id":"bd-4yc.6.2","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.6.4","title":"serve3 subtask: cache-validator-compression interaction matrix","description":"Objective and Scope:\nValidate the interaction boundaries between cache, validators, and compression so response correctness is preserved under real client negotiation patterns.\n\nImplementation Details:\n- Define behavior for ETag/Last-Modified with compressed and uncompressed responses.\n- Ensure 304 responses are emitted without response body and with correct validator semantics.\n- Verify compression does not invalidate cache-key assumptions or leak stale variants.\n- Add targeted tests for Accept-Encoding transitions and repeated conditional requests.\n\nDependency Links:\nParent: bd-4yc.6.\nBlocked by: bd-4yc.6.3 (compression middleware configured first).\nBlocks: final e2e and logging assertions under bd-4yc.8.2.\n\nAcceptance Criteria:\n- Conditional requests behave correctly regardless of compression negotiation.\n- Cache hits/misses remain deterministic across encoding variants.\n- 304 and compressed 200 responses satisfy HTTP correctness expectations.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\n- Unit: validator/compression decision matrix tests.\n- E2E: sequential requests toggling Accept-Encoding and conditional headers.\n- Logging: assert cache + revalidate + compression reason fields are present per markdown request.\n\nBackground / Rationale / Constraints / Intent:\nThese features are individually straightforward but fragile in combination; explicit matrix testing prevents subtle production bugs where caches and validators disagree across encodings.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-23T21:39:30.658122945Z","created_by":"exedev","updated_at":"2026-02-23T23:50:04.906593116Z","closed_at":"2026-02-23T23:50:04.906560987Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.6.4","depends_on_id":"bd-4yc.6","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.6.4","depends_on_id":"bd-4yc.6.3","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.7","title":"serve3 slice 6: tailscale host policy + startup URLs","description":"Objective and Scope:\nImplement tailscale-aware startup URL policy with safe probing, explicit override behavior, and deterministic output.\n\nImplementation Details:\nProbe tailscale via `tailscale status --json` with timeout, parse `.Self.DNSName` safely, apply default bind-host policy when --host is absent, always print localhost fallback URL, and enforce strict --no-tailscale probe suppression with rationale logging.\n\nDependency Links:\nParent: bd-4yc. Blocked by bd-4yc.1. Child chain: bd-4yc.7.1 -> bd-4yc.7.2 -> bd-4yc.7.3. Consumed by validation tasks bd-4yc.8, bd-4yc.8.1, bd-4yc.8.3.\n\nAcceptance Criteria:\nStartup URL policy is deterministic across tailscale present/absent/error/no-tailscale/host-override cases; probe path never hangs startup.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit: tailscale parse and host-policy matrix.\nE2E: mocked probe outputs and probe suppression checks.\nLogging: probe duration/outcome class, policy branch selected, and printed primary+fallback URLs.\n\nBackground / Rationale / Constraints / Intent:\nStartup output is an operator contract. This slice ensures URL selection is explainable and stable regardless of machine tailscale state.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T21:35:29.802371840Z","created_by":"exedev","updated_at":"2026-02-23T23:49:48.739254977Z","closed_at":"2026-02-23T23:49:48.739231967Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.7","depends_on_id":"bd-4yc","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.7","depends_on_id":"bd-4yc.1","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.7.1","title":"serve3 subtask: tailscale probe execution + DNSName parsing","description":"Objective and Scope:\nDetect tailscale hostname safely and quickly for URL selection.\n\nImplementation Details:\nExecute tailscale status JSON with timeout; parse Self DNSName and trim trailing dot; gracefully handle command absence, failure, timeout, and malformed JSON.\n\nDependency Links:\nParent task is bd-4yc.7; blocked by bd-4yc.1.\n\nAcceptance Criteria:\nProbe never blocks startup beyond timeout; valid DNSName is normalized for host output.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit tests for parser success, failure, and timeout cases; e2e with mocked command outputs; logs include probe duration and outcome category.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T21:35:32.592043269Z","created_by":"exedev","updated_at":"2026-02-23T23:49:48.454538823Z","closed_at":"2026-02-23T23:49:48.454508319Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.7.1","depends_on_id":"bd-4yc.1","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.7.1","depends_on_id":"bd-4yc.7","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.7.2","title":"serve3 subtask: bind-host defaults + URL print policy","description":"Objective and Scope:\nApply bind-host policy and deterministic startup URL printing.\n\nImplementation Details:\nDefault host selection follows tailscale presence unless host override is set; always print primary URL and localhost fallback; include resolved root and entry in startup output.\n\nDependency Links:\nParent task is bd-4yc.7; blocked by bd-4yc.7.1.\n\nAcceptance Criteria:\nStartup output consistently includes host, URL, root, and entry fields and honors explicit host override.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit tests for host policy matrix; e2e startup output snapshot tests; logs show final selected host reason.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T21:35:32.790374833Z","created_by":"exedev","updated_at":"2026-02-23T23:49:59.383362137Z","closed_at":"2026-02-23T23:49:59.383342274Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.7.2","depends_on_id":"bd-4yc.7","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.7.2","depends_on_id":"bd-4yc.7.1","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.7.3","title":"serve3 subtask: --no-tailscale probe suppression + URL rationale","description":"Objective and Scope:\nGuarantee deterministic behavior when tailscale probing is explicitly disabled and clarify startup rationale for host/url selection.\n\nImplementation Details:\n- Implement strict no-probe path when --no-tailscale is enabled.\n- Ensure bind-host defaults and startup URL selection follow policy without reading tailscale state in disabled mode.\n- Emit explicit startup rationale line indicating whether selection came from tailscale probe, explicit --host override, or --no-tailscale policy path.\n\nDependency Links:\nParent: bd-4yc.7.\nBlocked by: bd-4yc.7.2 (host policy implementation first).\nBlocks: validation tasks that assert URL rationale and probe suppression.\n\nAcceptance Criteria:\n- --no-tailscale fully suppresses probe execution.\n- Startup output and logs clearly indicate no-tailscale decision path.\n- URL printing remains primary + localhost fallback and consistent with host policy.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\n- Unit: decision-matrix tests verify probe suppression and host selection outputs.\n- E2E: mocked environment confirms tailscale binary is not invoked when flag set.\n- Logging: assert rationale field values for probe_used, probe_skipped_no_tailscale, and host_override.\n\nBackground / Rationale / Constraints / Intent:\nUsers may disable tailscale for privacy, startup speed, or predictable localhost-only behavior. The disabled path must be explicit and observable to avoid confusing URL output.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T21:39:37.774022432Z","created_by":"exedev","updated_at":"2026-02-23T23:50:00.499022411Z","closed_at":"2026-02-23T23:50:00.498997096Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.7.3","depends_on_id":"bd-4yc.7","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.7.3","depends_on_id":"bd-4yc.7.2","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.8","title":"serve3 validation: unit/e2e matrix + logging assertions","description":"Objective and Scope:\nCodify complete verification evidence for Gate A across unit and end-to-end levels, including required observability assertions.\n\nImplementation Details:\nDefine coverage matrix tasks for all invariants, fixture-based end-to-end suites for routing/rendering/UX/performance, and dedicated startup URL behavior matrix with tailscale/no-tailscale/override permutations.\n\nDependency Links:\nParent: bd-4yc. Blocked by bd-4yc.1 through bd-4yc.7. Child chain: bd-4yc.8.1 -> bd-4yc.8.2 -> bd-4yc.8.3.\n\nAcceptance Criteria:\nAll Gate A contracts are enforced by deterministic tests and logging assertions; suite is CI-ready and not dependent on host-local tailscale state.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit: contract-level invariant tests per slice.\nE2E: fixture matrix + startup matrix with mocked tailscale outputs.\nLogging: assert startup summary, resolver choices, renderer mode, cache decisions, and tailscale rationale fields.\n\nBackground / Rationale / Constraints / Intent:\nThis task prevents incomplete delivery by requiring objective evidence for every promised behavior in Gate A.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-23T21:35:29.947873520Z","created_by":"exedev","updated_at":"2026-02-23T23:50:03.098319110Z","closed_at":"2026-02-23T23:50:03.098298596Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.8","depends_on_id":"bd-4yc","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8","depends_on_id":"bd-4yc.1","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8","depends_on_id":"bd-4yc.2","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8","depends_on_id":"bd-4yc.3","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8","depends_on_id":"bd-4yc.4","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8","depends_on_id":"bd-4yc.5","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8","depends_on_id":"bd-4yc.6","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8","depends_on_id":"bd-4yc.7","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.8.1","title":"serve3 subtask: unit coverage matrix for all Gate A invariants","description":"Objective and Scope:\nImplement broad unit coverage for deterministic serve behavior and edge conditions.\n\nImplementation Details:\nAdd unit tests for CLI parsing, port retries, resolver precedence, escape rejection, renderer configuration, slug collisions, cache validators, and tailscale parsing policy.\n\nDependency Links:\nParent task is bd-4yc.8; blocked by bd-4yc.1, bd-4yc.2, bd-4yc.3, bd-4yc.5, bd-4yc.6, and bd-4yc.7.\n\nAcceptance Criteria:\nCritical invariants have dedicated unit tests with clear failure messages.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nRun unit targets and enforce pass; capture and assert key log fields where feasible via test logger harness.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-23T21:35:32.994972218Z","created_by":"exedev","updated_at":"2026-02-23T23:50:02.885223530Z","closed_at":"2026-02-23T23:50:02.885203714Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.8.1","depends_on_id":"bd-4yc.1","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8.1","depends_on_id":"bd-4yc.2","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8.1","depends_on_id":"bd-4yc.3","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8.1","depends_on_id":"bd-4yc.5","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8.1","depends_on_id":"bd-4yc.6","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8.1","depends_on_id":"bd-4yc.7","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8.1","depends_on_id":"bd-4yc.8","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.8.2","title":"serve3 subtask: e2e fixture matrix + logging assertions","description":"Objective and Scope:\nValidate end-to-end behavior with fixture trees and startup/runtime observability assertions.\n\nImplementation Details:\nAdd integration tests for routing, rendering, mermaid modes, TOC UX signals, 404/raw/static MIME behavior, revalidation/compression, and tailscale URL fallback.\n\nDependency Links:\nParent task is bd-4yc.8; blocked by bd-4yc.8.1, bd-4yc.4, bd-4yc.5, and bd-4yc.6.\n\nAcceptance Criteria:\nE2E suite passes and verifies key startup and request logs needed to debug production failures.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nRun integration targets with deterministic fixtures and assert logs for startup summary, resolver choice, render mode, cache status, and tailscale probe result.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-23T21:35:33.207046223Z","created_by":"exedev","updated_at":"2026-02-23T23:50:04.673287798Z","closed_at":"2026-02-23T23:50:04.673264648Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.8.2","depends_on_id":"bd-4yc.4","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8.2","depends_on_id":"bd-4yc.5","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8.2","depends_on_id":"bd-4yc.6","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8.2","depends_on_id":"bd-4yc.8","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8.2","depends_on_id":"bd-4yc.8.1","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.8.3","title":"serve3 subtask: startup URL behavior matrix e2e","description":"Objective and Scope:\nAdd an end-to-end startup matrix that validates URL and startup output behavior across local, tailscale, and override scenarios.\n\nImplementation Details:\n- Cover startup scenarios: tailscale DNS present, tailscale absent, tailscale timeout/error, --no-tailscale enabled, and explicit --host override.\n- For each scenario, assert printed primary URL, localhost fallback URL, resolved root/entry fields, and rationale log lines.\n- Reuse deterministic mocks/stubs for tailscale command responses to avoid flaky environment coupling.\n\nDependency Links:\nParent: bd-4yc.8.\nBlocked by: bd-4yc.8.2 and bd-4yc.7.3.\nBlocks: Gate A sign-off by proving startup contract stability.\n\nAcceptance Criteria:\n- Startup matrix exists and passes in CI.\n- URL output, rationale logs, and root/entry fields are asserted in every startup mode.\n- Test harness is deterministic and independent of actual machine tailscale state.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\n- Unit: startup formatting/parsing helpers used by assertions.\n- E2E: scenario matrix with mocked tailscale command and host override combinations.\n- Logging: assert probe result class, selection rationale, and emitted URL pair for each run.\n\nBackground / Rationale / Constraints / Intent:\nStartup output is the operator contract for discovering the server endpoint. A dedicated matrix prevents regressions that otherwise escape basic render/routing tests.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-23T21:39:44.675427181Z","created_by":"exedev","updated_at":"2026-02-23T23:50:05.139523060Z","closed_at":"2026-02-23T23:50:05.139503575Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.8.3","depends_on_id":"bd-4yc.1.3","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8.3","depends_on_id":"bd-4yc.7.3","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8.3","depends_on_id":"bd-4yc.8","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8.3","depends_on_id":"bd-4yc.8.2","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-8z2","title":"[Subtask] Enforce deterministic local/tailscale URL output ordering","description":"Optional tailscale availability must not create nondeterministic or noisy user output. The tailscale block in run_serve currently emits two labeled lines per host; the new contract is one bare entry URL line (no index line).\n\nObjective and scope:\n- Ensure deterministic URL ordering and conditional tailscale URL inclusion.\n- Remove the tailscale 'index:' URL line from output entirely.\n- Remove 'url:' prefix from tailscale URL line.\n\nImplementation details:\nCurrent tailscale block (~lines 1478-1481 in serve.rs):\n    if let Some(ref host) = tailscale_host {\n        println!(\"url:   http://{host}:{bound_port}{}\", state.entry_url_path);\n        println!(\"index: http://{host}:{bound_port}/\");\n    }\n\nNew tailscale block (bare URL, no index, no prefix):\n    if let Some(ref host) = tailscale_host {\n        println!(\"http://{host}:{bound_port}{}\", state.entry_url_path);\n    }\n\nOutput contract:\n- Line 1: always http://127.0.0.1:{port}{entry_url_path} (from bd-3k4)\n- Line 2: http://{tailscale_host}:{port}{entry_url_path} only when tailscale detected\n- No index lines, no label prefixes, no skip messages to stdout\n\nDependency links:\n- Parent: bd-guc.\n- Depends on URL-only printer subtask (bd-3k4) for the local URL line.\n\nAcceptance criteria:\n- Output is exactly one line (no tailscale) or two lines (with tailscale), always in local-first order.\n- No 'index:' tailscale URL line appears in any mode.\n- Tailscale skip/miss messages do not appear on stdout.\n\nTest requirements:\nUnit:\n- Tailscale present path: one tailscale URL line, no index line.\n- Tailscale absent path: zero extra lines.\n\nE2E/integration:\n- Tests conditionally accept second URL line based on detection.\n- Assert no lines contain 'index:' prefix.\n- Logging expectation: no [tailscale] skip logging to stderr unless verbose.","notes":"Verification Steps:\n1. Implement the scoped changes and keep behavior aligned with this bead's objective/acceptance criteria.\n2. Run the unit and integration/e2e tests listed under Test requirements for this bead.\n3. Verify stdout/stderr logging expectations in the executed scenarios (default vs verbose, and any no-open/headless paths if applicable).\n4. Record the exact validation commands and outcomes in the implementation notes/PR summary for reproducibility.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-25T16:25:13.025497115Z","created_by":"exedev","updated_at":"2026-02-25T17:28:41.592183927Z","closed_at":"2026-02-25T17:28:41.592136891Z","close_reason":"Implemented: core tailscale URL output already correct (one bare URL, no index line). Added unit tests tailscale_url_present_emits_one_bare_url_no_index and tailscale_url_absent_emits_no_lines in serve.rs. Updated test_serve_startup_stdout_format integration test to assert URL-only stdout contract (1-2 lines, bare http:// URLs, no label prefixes, no [tailscale] stderr in default mode).","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-8z2","depends_on_id":"bd-3k4","type":"blocks","created_at":"2026-02-25T16:25:27.418810526Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-ezg","title":"Serve5-06: Secure serve_root path resolution for markdown and assets","description":"## Objective\nEnforce canonical `serve_root` containment with robust local path resolution, symlink safety, URL-encoding safety, file size limits, and correct MIME types.\n\n## Implementation Details (7-step pipeline)\n1. **Decode**: percent-decode the request path FIRST (before any normalization).\n2. **Normalize**: strip `..` components via `Path` component iteration; reject requests still containing `..` after decode.\n3. **Construct**: join `serve_root` + normalized path to get a candidate absolute path.\n4. **Fallback resolution**: try candidate as exact path; if not found, try `candidate + \".md\"` when extensionless; if candidate is a directory, try `candidate/README.md` then `candidate/index.md`.\n5. **R1 – Canonicalize + re-check**: call `std::fs::canonicalize` on the resolved path (follows symlinks); re-verify the canonicalized path starts with canonicalized `serve_root`. Reject if outside root even via symlink.\n6. **R5 – File size guard**: stat the file before reading; if size exceeds 16 MB (configurable), return `413 Content Too Large` with log of path and size.\n7. **Dispatch**: if resolved file is `.md` (case-insensitive), render as HTML page; otherwise serve as static asset.\n\n## MIME type (R6)\nDerive `Content-Type` from extension via static lookup table:\n`.md`/`.html` → `text/html`, `.css` → `text/css`, `.js` → `text/javascript`,\n`.png` → `image/png`, `.jpg`/`.jpeg` → `image/jpeg`, `.svg` → `image/svg+xml`,\n`.gif` → `image/gif`, `.ico` → `image/x-icon`, `.woff2` → `font/woff2`,\n`.pdf` → `application/pdf`. Unknown → `application/octet-stream`.\nNever rely on browser MIME sniffing.\n\n## R2 – URL-encoded traversal\nUnit tests must cover: `%2e%2e`, `%2F`, `%2e%2e%2f` (directory traversal slash-encoded), mixed-case `%2E%2E`. All must return 404.\n\n## Headers\nSet `X-Content-Type-Options: nosniff` on all responses (including 404/413/asset).\n\n## Acceptance Criteria\n- No out-of-root file access via traversal, URL-encoding, or symlink.\n- All fallback resolution cases (extensionless, README.md, index.md) work correctly.\n- File size limit enforced at 16 MB; 413 returned for oversized files.\n- All responses include correct `Content-Type` and `X-Content-Type-Options: nosniff`.\n\n## Verification Steps\n- Unit: request `/../etc/passwd` → 404 (after decode+normalize).\n- Unit: request `/%2e%2e/etc/passwd` → 404.\n- Unit: request `/%2e%2e%2fetc%2fpasswd` → 404 (slash also encoded; must not bypass normalization).\n- Unit: request `/%2E%2E/` (mixed case) → 404.\n- Unit: in-tree symlink pointing to `/tmp/secret.txt` → 404 (canonicalize re-check).\n- Unit: extensionless request `GET /docs/guide` resolves to `docs/guide.md` when exists.\n- Unit: directory request `GET /docs/` resolves to `docs/README.md` then `docs/index.md`.\n- Unit: file > 16 MB → 413 before any content read.\n- Unit: `.png` extension → `Content-Type: image/png`.\n- Unit: `.svg` extension → `Content-Type: image/svg+xml`.\n- Unit: unknown `.xyz` extension → `Content-Type: application/octet-stream`.\n- Integration: traverse attempt `GET /../../etc/passwd` → 404.\n- Integration: in-root file `GET /image.png` → 200 with `Content-Type: image/png`.\n- Integration: all responses include `X-Content-Type-Options: nosniff`.\n- Log: `[resolve] path=<norm> branch=<exact|extensionless|readme|index|denied> reason=<detail>`.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-24T04:49:41.249879765Z","created_by":"exedev","updated_at":"2026-02-24T06:53:05.258721581Z","closed_at":"2026-02-24T06:53:05.258687810Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-ezg","depends_on_id":"bd-1mz","type":"blocks","created_at":"2026-02-24T04:49:44.277094805Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-ezg","depends_on_id":"bd-2f2","type":"parent-child","created_at":"2026-02-24T06:24:49.231960576Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-f8j","title":"Implement startup markdown outbound-link extractor with snippet capture","description":"Objective and scope:\n- Build a dedicated markdown-source extractor for outbound links AND document title used only by startup backlink indexing.\n- Scope includes local-link filtering, path resolution against source file, outside-root link dropping, fragment capture, snippet generation, and first-H1 title extraction.\n- Lives in src/backlinks.rs (created by bd-1hd).\n\nImplementation details:\n- Parse markdown using pulldown-cmark events (pulldown-cmark is already a Cargo dependency).\n- Use pulldown_cmark::Parser::new_ext() with ENABLE_TABLES|ENABLE_STRIKETHROUGH; then call .into_offset_iter() to get (Event, Range<usize>) pairs for byte offset tracking.\n- In a single pass, collect BOTH outbound link refs AND first H1 title text:\n  Title extraction:\n  - On Event::Start(Tag::Heading { level: HeadingLevel::H1, .. }): set in_h1 = true, clear title buffer.\n  - On Event::Text(text) while in_h1: append to title buffer.\n  - On Event::End(TagEnd::Heading(HeadingLevel::H1)) with in_h1: doc_title = Some(title_buffer.trim().to_owned()); in_h1 = false. Stop tracking after first H1.\n  Link extraction:\n  - On Event::Start(Tag::Link { dest_url, .. }): record Range.start as link_start; capture dest_url.\n  - On Event::End(TagEnd::Link): record Range.end as link_end for snippet.\n  - Filter links: skip if dest_url starts with 'http:', 'https:', 'mailto:', 'ftp:', or equals/starts with '#'. Retain all others.\n  - Fragment capture: split dest_url on first '#'. First part = path component; second part (if non-empty) = fragment.\n  - Path resolution (returns Option<PathBuf>):\n    a. If path component is empty (fragment-only link after split): skip entirely.\n    b. If path component starts with '/': resolved = serve_root.join(path_component.trim_start_matches('/'))\n    c. Otherwise (relative): resolved = source_parent.join(path_component), then normalize '..' and '.' by splitting on '/' and applying a stack-based clean (reusing normalize_path logic from serve.rs or equivalent).\n  - Outside-root drop: call resolved.strip_prefix(serve_root). If Err (target is outside serve_root): SILENTLY DROP this OutboundRef — do not log, do not include in output. Targets outside serve_root are not servable and must not appear in the backlinks index.\n  - Key computation: let rel = stripped.to_string_lossy().replace('\\', '/'); let target_url_path = url_key_from_rel_path(&rel).\n  - Snippet extraction: raw_src[link_start.saturating_sub(80)..link_end.saturating_add(80).min(src_len)]. Collapse runs of ASCII whitespace to single space. Trim to 200 chars max.\n  - Construct OutboundRef { target_url_path, target_fragment: Option<String>, snippet: String } and push.\n- Return DocExtractResult { title: Option<String>, outbound_refs: Vec<OutboundRef> }.\n- Self-links are returned in outbound_refs (filtered at inversion stage in bd-1hd).\n- Non-UTF-8 input: since bd-1hd reads files with fs::read_to_string() and skips on error, the extractor receives valid UTF-8 &str. No additional non-UTF-8 handling needed inside the extractor; the function signature takes &str.\n\nDependency links:\n- Depends on data-model/key contract (bd-r8y) for url_key_from_rel_path.\n- Blocks index-build (bd-1hd) and unit-test tasks (bd-3oh.1).\n\nAcceptance criteria:\n- Outbound refs include only links whose resolved targets are inside serve_root.\n- Links outside serve_root are silently dropped (no log entry).\n- Self-links are returned (filtered downstream by bd-1hd).\n- Title extraction returns first H1 plain text, None when absent.\n\nTest requirements (unit and e2e, with logging expectations):\n- Unit: see bd-3oh.1 for full 18-case fixture matrix. Add case 19: link pointing outside serve_root (e.g., source at /root/docs/a.md, serve_root = /root, link = '../../etc/passwd') → outbound_refs is empty (silently dropped).\n- E2E: validated through backlinks panel integration.\n- Logging: no log for outside-root drops. Read errors logged by bd-1hd's traversal, not by the extractor.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-25T01:14:39.006270328Z","created_by":"exedev","updated_at":"2026-02-25T04:51:10.752704413Z","closed_at":"2026-02-25T04:51:10.752656012Z","close_reason":"Implemented extract_outbound_links in src/backlinks.rs with pulldown-cmark single-pass extractor, H1 title capture, outside-root silent drop, and snippet generation. Updated OutboundRef to use target_url_path/target_fragment fields.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-f8j","depends_on_id":"bd-r8y","type":"blocks","created_at":"2026-02-25T01:14:51.429541690Z","created_by":"exedev","metadata":"{}","thread_id":""}],"comments":[{"id":28,"issue_id":"bd-f8j","author":"Peter Schilling","text":"Implementation constraint: extractor must operate on markdown source and remain independent from HTML rewrite path. This prevents accidental coupling and keeps startup indexing deterministic even if render-time rewrite behavior evolves later.","created_at":"2026-02-25T01:15:11Z"}]}
{"id":"bd-guc","title":"Enforce URL-only startup stdout contract for serve","description":"Background and rationale:\nThe product goal is a minimal startup UX that foregrounds exactly what users need: the entry URL(s). Existing labeled output is too noisy.\n\nObjective and scope:\n- Make default startup stdout contain only the local entry URL and optional tailscale entry URL.\n- Remove extra startup labels and index/root lines from default output contract.\n- Keep URL lines present in verbose mode too.\n\nImplementation details:\n- Update startup print path to emit URL lines only.\n- Ensure local URL is always printed on successful startup.\n- Emit tailscale URL only when detection succeeds; otherwise print nothing about tailscale in default mode.\n- Keep output ordering deterministic (local first, tailscale second if present).\n\nDependency links:\n- Depends on CLI/options plumbing and diagnostic gating tasks.\n- Blocks final integration test update task.\n\nAcceptance criteria:\n- Default stdout shows exactly one or two lines: local URL always, tailscale URL optional.\n- No startup label lines appear in default mode.\n- Verbose mode still includes URL lines in stdout.\n\nTest requirements:\nUnit:\n- If URL formatting helpers exist, add coverage for local and tailscale URL rendering.\n- If no helper exists, add focused tests around startup output builder logic.\n\nE2E/integration:\n- Startup stdout-format test expects URL-only output.\n- Environment without tailscale verifies only one URL line.\n- Logging expectation: no tailscale skip diagnostics on stderr unless verbose.","notes":"Verification Steps:\n1. Implement the scoped changes and keep behavior aligned with this bead's objective/acceptance criteria.\n2. Run the unit and integration/e2e tests listed under Test requirements for this bead.\n3. Verify stdout/stderr logging expectations in the executed scenarios (default vs verbose, and any no-open/headless paths if applicable).\n4. Record the exact validation commands and outcomes in the implementation notes/PR summary for reproducibility.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-25T16:24:12.173867949Z","created_by":"exedev","updated_at":"2026-02-25T17:48:20.515069893Z","closed_at":"2026-02-25T17:48:20.515023861Z","close_reason":"Added unit tests for startup URL output contract: local_url_line_is_bare_http_127_0_0_1, startup_url_block_local_first_tailscale_second_no_labels, startup_url_block_local_only_when_no_tailscale. Implementation was already correct from subtasks bd-3k4 and bd-8z2.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-guc","depends_on_id":"bd-1o6","type":"blocks","created_at":"2026-02-25T16:24:19.537948022Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-guc","depends_on_id":"bd-3k4","type":"blocks","created_at":"2026-02-25T16:25:26.603185043Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-guc","depends_on_id":"bd-8z2","type":"blocks","created_at":"2026-02-25T16:25:27.023351310Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-guc","depends_on_id":"bd-h6g","type":"blocks","created_at":"2026-02-25T16:24:19.148566177Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-h6g","title":"Serve CLI flags and option plumbing for no-open + verbose","description":"Background and rationale:\nDefault serve startup should expose clear control over browser opening and diagnostics. Flag plumbing is the contract boundary that enables all downstream behavior.\n\nObjective and scope:\n- Add serve CLI flags no-open and verbose.\n- Thread both booleans through the serve entrypoint and state needed by downstream logic.\n- Preserve all existing defaults except the explicitly planned startup UX behavior.\n\nImplementation details:\n- Update argument parser and help text for serve command.\n- Update run_serve signature and all call sites to include no_open and verbose.\n- Ensure flag precedence is explicit: no_open always disables open attempts.\n- Keep URL printing path independent from verbose diagnostic gating.\n\nDependency links:\n- Foundation task; no prerequisites.\n- Blocks logging gate, output-contract, and auto-open implementation tasks.\n\nAcceptance criteria:\n- Running serve accepts no-open and verbose flags without regressions.\n- Runtime state has access to no_open and verbose where needed.\n- Existing behavior outside startup output/logging/open features remains unchanged.\n\nTest requirements:\nUnit:\n- Parser tests validate flag parsing and defaults.\n- Any config/option struct tests verify values are propagated to serve entrypoint.\n\nE2E/integration:\n- Smoke serve invocation succeeds with: default, verbose, no-open, and combined flags.\n- Logging expectation: verbose-only diagnostics can be asserted in later tasks once gating lands.","notes":"Verification Steps:\n1. Implement the scoped changes and keep behavior aligned with this bead's objective/acceptance criteria.\n2. Run the unit and integration/e2e tests listed under Test requirements for this bead.\n3. Verify stdout/stderr logging expectations in the executed scenarios (default vs verbose, and any no-open/headless paths if applicable).\n4. Record the exact validation commands and outcomes in the implementation notes/PR summary for reproducibility.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-25T16:24:11.391673039Z","created_by":"exedev","updated_at":"2026-02-25T16:50:40.951216872Z","closed_at":"2026-02-25T16:50:40.951156604Z","close_reason":"Both subtasks bd-28j and bd-3fh are closed. All acceptance criteria met: serve accepts --no-open and --verbose flags, AppState.verbose is accessible in handlers, no_open is threaded through run_serve, code compiles cleanly.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-h6g","depends_on_id":"bd-28j","type":"blocks","created_at":"2026-02-25T16:25:23.706640253Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-h6g","depends_on_id":"bd-3fh","type":"blocks","created_at":"2026-02-25T16:25:24.148031201Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-i8p","title":"Implement headed-aware non-blocking browser auto-open","description":"Background and rationale:\nServe should reduce manual friction by opening a browser automatically when it is reasonable and safe, while respecting explicit opt-out and headless/SSH contexts.\n\nObjective and scope:\n- Implement non-blocking browser auto-open for local URL.\n- Respect no-open override unconditionally.\n- Support macOS and Linux headed detection requirements.\n\nImplementation details:\n- Add open-attempt decision flow using: not no_open, headed environment true, and local URL availability.\n- macOS detection: suppress open attempt when SSH_CONNECTION or SSH_TTY is present.\n- Linux detection: require DISPLAY or WAYLAND_DISPLAY and suppress in obvious CI/headless contexts.\n- Launch command by platform: open <url> on macOS, xdg-open <url> on Linux.\n- Spawn opener as fire-and-forget; failures never fail server startup and are only logged in verbose mode.\n\nDependency links:\n- Depends on CLI/options plumbing and diagnostic gating tasks.\n- Blocks integration test completion task.\n\nAcceptance criteria:\n- Local headed sessions on macOS/Linux attempt to open browser by default.\n- no-open prevents attempts in all environments.\n- SSH/headless/CI contexts do not attempt open.\n- Open failures do not affect serve startup success.\n\nTest requirements:\nUnit:\n- Platform/environment decision tests for open-attempt gating.\n- Command-construction tests for macOS and Linux launchers.\n- Failure-path test asserts only verbose mode emits failure diagnostics.\n\nE2E/integration:\n- no-open integration path verifies no open attempt side effects.\n- Headless env integration path verifies no attempt and clean startup.\n- Logging expectation: opener failure details are suppressed unless verbose.","notes":"Verification Steps:\n1. Implement the scoped changes and keep behavior aligned with this bead's objective/acceptance criteria.\n2. Run the unit and integration/e2e tests listed under Test requirements for this bead.\n3. Verify stdout/stderr logging expectations in the executed scenarios (default vs verbose, and any no-open/headless paths if applicable).\n4. Record the exact validation commands and outcomes in the implementation notes/PR summary for reproducibility.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-25T16:24:12.556602888Z","created_by":"exedev","updated_at":"2026-02-25T17:54:06.181300139Z","closed_at":"2026-02-25T17:54:06.181264715Z","close_reason":"All subtasks complete (bd-kpe, bd-o5a closed). Browser auto-open logic integrated in run_serve with headed-environment detection, MDMD_OPEN_CMD override seam, and verbose-gated failure logging. Added two missing integration tests: test_headed_env_verbose_logs_browser_open_failure and test_headed_env_no_verbose_suppresses_browser_failure_log to lock the verbose-gating behavior on opener failure.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-i8p","depends_on_id":"bd-1o6","type":"blocks","created_at":"2026-02-25T16:24:20.342688669Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-i8p","depends_on_id":"bd-h6g","type":"blocks","created_at":"2026-02-25T16:24:19.934550498Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-i8p","depends_on_id":"bd-kpe","type":"blocks","created_at":"2026-02-25T16:25:28.139540106Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-i8p","depends_on_id":"bd-o5a","type":"blocks","created_at":"2026-02-25T16:25:28.537518842Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-kcr","title":"serve2 slice 2: root-safe routing","description":"## Covered Sections\n- executable-decomposition\n- slice-2-root-safe-routing-and-path-resolution\n- validation-strategy\n- cross-slice-dependencies\n- gate-a-approval-checklist\n\n## Acceptance Criteria\n- Extensionless and nested markdown links resolve correctly.\n- Static assets load from root tree.\n- Root-escape/traversal attempts return `403`.\n- Missing in-root targets return `404`.\n\n## Verification Steps\n- Run routing integration tests on fixture trees covering exact, extensionless, and fallback (`README.md`, `index.md`) resolution order.\n- Run security tests with traversal payloads (`..`, encoded traversal) asserting `403`.\n- Run missing-target tests asserting `404` for unresolved in-root paths.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-23T06:57:33.904072868Z","created_by":"exedev","updated_at":"2026-02-24T00:11:17.909046231Z","closed_at":"2026-02-24T00:11:17.909026974Z","close_reason":"Cleaning up for fresh start","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-kcr","depends_on_id":"bd-28p","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-kpe","title":"[Subtask] Implement platform headed-environment detection","description":"Automatic browser launch must avoid headless/remote sessions and respect platform-specific session signals. Detection runs once at startup before the open attempt.\n\nObjective and scope:\n- Implement headed-environment detection for macOS and Linux.\n- Return false for any context where a browser open would be unwanted or fail silently.\n- Make detection unit-testable without requiring cross-OS test runners.\n\nImplementation details:\n- Introduce a pure helper that accepts explicit inputs (env snapshot + platform enum) and returns headed/not-headed.\n- Keep a thin wrapper that reads process env + cfg(target_os) and calls the pure helper.\n- Recommended shape:\n  - enum RuntimePlatform { MacOs, Linux, Other }\n  - struct EnvSnapshot { ssh_connection: bool, ssh_tty: bool, display: bool, wayland_display: bool, ci: bool, github_actions: bool }\n  - fn is_headed_for(platform: RuntimePlatform, env: &EnvSnapshot) -> bool\n  - fn is_headed_environment() -> bool // wrapper used by production code\n\nBehavior rules:\n- macOS: false if SSH_CONNECTION or SSH_TTY set; otherwise true.\n- Linux: require DISPLAY or WAYLAND_DISPLAY; additionally false if CI or GITHUB_ACTIONS or SSH vars are set.\n- Other platforms: false.\n\nDependency links:\n- Parent: bd-i8p.\n- Depends on option propagation (bd-3fh) and verbose helper (bd-1zw).\n\nAcceptance criteria:\n- SSH sessions (SSH_CONNECTION or SSH_TTY set) return false on both platforms.\n- Linux without DISPLAY/WAYLAND_DISPLAY returns false.\n- Linux with CI or GITHUB_ACTIONS returns false even if DISPLAY is set.\n- macOS without SSH signals returns true.\n- Wrapper and pure helper stay behaviorally aligned.\n\nTest requirements:\nUnit:\n- Exhaustive matrix tests for is_headed_for(...) using synthetic EnvSnapshot inputs (no mutable global env required).\n- Wrapper sanity tests for is_headed_environment() with controlled env overrides where feasible.\n\nE2E/integration:\n- Headless env (no DISPLAY, CI=1) confirms no open attempt in server startup.\n- Logging expectation: headed-detection decisions only appear in stderr with --verbose.","notes":"Verification Steps:\n1. Implement the scoped changes and keep behavior aligned with this bead's objective/acceptance criteria.\n2. Run the unit and integration/e2e tests listed under Test requirements for this bead.\n3. Verify stdout/stderr logging expectations in the executed scenarios (default vs verbose, and any no-open/headless paths if applicable).\n4. Record the exact validation commands and outcomes in the implementation notes/PR summary for reproducibility.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-25T16:25:13.393373518Z","created_by":"exedev","updated_at":"2026-02-25T17:15:43.684470991Z","closed_at":"2026-02-25T17:15:43.684432734Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-kpe","depends_on_id":"bd-1zw","type":"blocks","created_at":"2026-02-25T16:25:29.820027139Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-kpe","depends_on_id":"bd-3fh","type":"blocks","created_at":"2026-02-25T16:25:29.359626493Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-mzl","title":"Serve5-04: Comrak SSR renderer with heading extraction","description":"## Objective\nImplement serve-only markdown renderer using comrak with GFM features, heading extraction, and security-safe defaults.\n\n## Implementation Details\n- Enable comrak GFM extensions: tables, task lists, autolinks, strikethrough, fenced code blocks.\n- R3 mitigation: set `ComrakOptions::render.unsafe_ = false` (default). Raw HTML blocks in Markdown are stripped, not passed through. Add unit test asserting `<script>alert(1)</script>` does not appear in rendered HTML output.\n- R4 mitigation: implement anchor ID deduplication counter during heading extraction. The first occurrence of a heading text slug gets its bare slug (e.g. `my-heading`); subsequent occurrences get a numeric suffix (`my-heading-1`, `my-heading-2`). Counter is per-document. Add unit tests with repeated headings at same and different nesting levels.\n- Extract headings (level, text, anchor ID) from the AST before rendering to a `Vec<HeadingEntry>` for TOC construction.\n- Keep TUI parse/render path (`src/parse.rs`, `src/render.rs`) completely untouched.\n- Render into `src/html.rs` as a pure function: `fn render_markdown(input: &str, file_path: &Path, serve_root: &Path) -> (String, Vec<HeadingEntry>)`. The `file_path` and `serve_root` parameters are required by bd-1p6's relative link resolution during the same AST traversal pass.\n- Log rendered file path and extracted heading count at `info` level.\n- R10 mitigation: enable only required comrak feature flags (GFM, not experimental extensions); pin comrak to a specific version in Cargo.toml. After implementation, verify binary size delta vs. pre-comrak build is ≤500 KB using `cargo build --release` and `du -sh`.\n\n## Acceptance Criteria\n- HTML covers phase-1 markdown feature matrix: paragraphs, emphasis, strong, inline code, ATX headings, fenced code blocks, tables, task lists, strikethrough, blockquotes, ordered/unordered lists, autolinks, normal links.\n- `<script>` in input does not appear in rendered HTML output.\n- Duplicate headings produce unique, sequenced anchor IDs.\n- `Vec<HeadingEntry>` produced for TOC construction.\n- Binary size delta after adding comrak is ≤500 KB (R10).\n\n## Verification Steps\n- Unit: `hello world` paragraph → output contains `<p>`.\n- Unit: `*text*` → output contains `<em>`.\n- Unit: `**text**` → output contains `<strong>`.\n- Unit: `` `inline code` `` → output contains `<code>`.\n- Unit: `[text](https://example.com)` normal link → output contains `<a href=\"https://example.com\">`.\n- Unit: GFM table → `<table>` with `<th>` and `<td>`.\n- Unit: task list → `<input type=\"checkbox\">`.\n- Unit: strikethrough → `<del>`.\n- Unit: fenced code block with info string renders `<pre><code class=\"language-rust\">` (or equivalent language class) — validates language hint is preserved in HTML output.\n- Unit: autolinks: bare URL `https://example.com` in Markdown body → output contains `<a href=\"https://example.com\">` (GFM autolink extension active).\n- Unit: blockquotes: `> quoted text` → output contains `<blockquote>`.\n- Unit: ordered list `1. Item` → output contains `<ol>` and `<li>`.\n- Unit: unordered list `- Item` → output contains `<ul>` and `<li>`.\n- Unit: `<script>alert(1)</script>` in input → absent from HTML output.\n- Unit: headings `## Foo`, `## Foo`, `## Foo` → anchors `foo`, `foo-1`, `foo-2`.\n- Unit: headings `## Foo` then `### Foo` → anchors `foo`, `foo-1` (no collision sharing between levels).\n- Unit: anchor IDs are stable across two renders of the same document.\n- Post-build: `cargo build --release` binary size delta vs. baseline ≤500 KB (R10 check).\n- Log: `[render] path=<file> headings=<count>` at info level.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-24T04:48:59.020048968Z","created_by":"exedev","updated_at":"2026-02-24T06:44:17.759132963Z","closed_at":"2026-02-24T06:44:17.759100632Z","close_reason":"Implemented: src/html.rs with render_markdown, HeadingEntry, slug deduplication, GFM extensions, XSS mitigation (unsafe_=false); comrak=0.35.0 pinned in Cargo.toml with default-features=false; mod html added to main.rs; full unit test suite.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-mzl","depends_on_id":"bd-2f2","type":"parent-child","created_at":"2026-02-24T06:24:50.280686309Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-mzl","depends_on_id":"bd-p7i","type":"blocks","created_at":"2026-02-24T04:49:02.334218168Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-o5a","title":"[Subtask] Implement non-blocking browser opener with graceful failure","description":"Browser launch should improve UX without affecting server reliability. The opener runs fire-and-forget after startup output is printed, so it never delays the URL appearing on stdout.\n\nObjective and scope:\n- Implement non-blocking open command execution with robust failure handling.\n- Integrate with headed-environment detection and the no_open flag.\n- Provide a test seam for command selection/spawn behavior.\n\nImplementation details:\nOpen attempt decision at startup in run_serve (after stdout URL lines are printed):\n    if should_attempt_open(no_open, is_headed_environment()) {\n        let url = format!(\"http://127.0.0.1:{bound_port}{}\", state.entry_url_path);\n        match spawn_browser_open(default_open_command(), &url) {\n            Ok(_) => vlog!(verbose, \"[browser] opened {url}\"),\n            Err(e) => vlog!(verbose, \"[browser] open failed: {e}\"),\n        }\n    }\n\nExpected helpers:\n- fn should_attempt_open(no_open: bool, headed: bool) -> bool\n- fn default_open_command() -> &'static str  // macOS=open, Linux=xdg-open, other=\"\"\n- fn spawn_browser_open(cmd: &str, url: &str) -> io::Result<Child>\n\nImportant:\n- Print stdout URL lines BEFORE attempting browser open.\n- Do not wait on child process.\n- spawn failure must never abort startup.\n\nDependency links:\n- Parent: bd-i8p.\n- Depends on headed detection subtask (bd-kpe).\n\nAcceptance criteria:\n- Eligible environments trigger exactly one non-blocking open attempt.\n- --no-open prevents all open attempts in all environments.\n- Open failures (spawn error) never abort serve startup.\n- URL lines appear on stdout before open attempt.\n\nTest requirements:\nUnit:\n- should_attempt_open matrix tests.\n- default_open_command tests for platform mapping via testable helper/platform enum.\n- spawn failure branch tests: no verbose -> no browser diagnostic; verbose -> [browser] open failed.\n\nE2E/integration:\n- --no-open path: server starts, URL printed, no open side-effect logs.\n- Headless env (CI=1, no DISPLAY): server starts, no open attempted.\n- Verbose headed simulation path logs one browser attempt line.\n- Logging expectation: [browser] lines are only present with --verbose.","notes":"Verification Steps:\n1. Implement the scoped changes and keep behavior aligned with this bead's objective/acceptance criteria.\n2. Run the unit and integration/e2e tests listed under Test requirements for this bead.\n3. Verify stdout/stderr logging expectations in the executed scenarios (default vs verbose, and any no-open/headless paths if applicable).\n4. Record the exact validation commands and outcomes in the implementation notes/PR summary for reproducibility.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-25T16:25:13.790506760Z","created_by":"exedev","updated_at":"2026-02-25T17:34:36.701630259Z","closed_at":"2026-02-25T17:34:36.701581227Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-o5a","depends_on_id":"bd-kpe","type":"blocks","created_at":"2026-02-25T16:25:28.935205166Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-p4x","title":"Basic markdown rendering: styled text display in terminal viewport","description":"Render parsed markdown content in the ratatui terminal with basic styling: bold for headings (with size differentiation by level), italic for emphasis, colored/boxed code spans, indented block quotes, bullet/numbered lists, and horizontal rules. The content should fill the terminal viewport. No scrolling yet - just render what fits on screen.","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-02-21T00:28:51.101979956Z","created_by":"exedev","updated_at":"2026-02-21T00:52:39.583653330Z","closed_at":"2026-02-21T00:52:39.583611191Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-p4x","depends_on_id":"bd-1sf","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-p7i","title":"Serve5-01: CLI subcommands with legacy compatibility","description":"## Objective\nPreserve `mdmd <file>` TUI behavior while adding explicit `mdmd serve <file>` and `mdmd view <file>` subcommands.\n\n## Implementation Details\n- Refactor clap to support a `Subcommand` enum (`Serve { file, bind, port }`, `View { file }`) plus legacy positional compatibility. Use `#[command(flatten)]` or a manual `Args` compatibility shim; do not break existing `mdmd <file>` parsing.\n- For legacy path: if no subcommand matched, re-parse first positional arg as file path and dispatch to TUI.\n- `view` maps to existing TUI dispatch path; `serve` dispatches to the new web server path.\n- `--help` output describes all three invocation forms.\n- Startup logs indicate which mode was dispatched: `[serve]`, `[view]`, `[legacy]`.\n- R9 mitigation: the refactored clap must not break bare positional file arg parsing.\n- The `serve` subcommand must include both `--bind <ADDR>` (default `127.0.0.1`) and `--port <N>` (default `3333`) as separate flags. `--bind` is the interface address; `--port` is the starting port number passed to bd-1mz's bind retry loop. Integration tests in bd-39z use `--port <free_port>` with a randomly allocated free port to avoid conflicts.\n\n## Acceptance Criteria\n- `mdmd README.md` still launches TUI (no regression).\n- `mdmd view README.md` launches TUI identically.\n- `mdmd serve README.md` dispatches to web server path.\n- `mdmd serve --bind 0.0.0.0 --port 8080 README.md` binds to specified interface and port without error.\n- Help text accurately describes all three invocation forms.\n- Startup diagnostic log line indicates selected mode.\n\n## Verification Steps\n- Unit parse matrix covering: bare file, `view <file>`, `serve <file>`, `serve --bind 127.0.0.1 <file>`, `serve --port 8080 <file>`, `serve --bind 0.0.0.0 --port 3334 <file>`, missing file, `--help`.\n- Integration: spawn binary with bare `README.md` arg, assert TUI mode dispatched (not serve).\n- Integration: spawn binary with `serve README.md`, assert serve mode dispatched.\n- Log line `[legacy]`/`[view]`/`[serve]` must appear in startup output.\n- Verify `--bind` and `--port` are each accepted without error by the clap parser and both values are propagated to server bootstrap (bd-1mz).","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-24T04:48:09.259299658Z","created_by":"exedev","updated_at":"2026-02-24T06:29:36.970815261Z","closed_at":"2026-02-24T06:29:36.970789477Z","close_reason":"Implemented CLI subcommands with legacy compatibility","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-p7i","depends_on_id":"bd-2f2","type":"parent-child","created_at":"2026-02-24T06:24:51.800902346Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-r8y","title":"Define backlink data model and canonical path-key contract","description":"Objective and scope:\n- Define stable types and keying rules for backlinks so index build and request lookup are guaranteed to align.\n- Scope includes payload schema, fragment handling, self-link exclusion, normalization invariants, source title display, and module placement.\n\nImplementation details:\n- Module: all types, the url_key_from_rel_path helper, and the extractor function live in src/backlinks.rs. Add 'mod backlinks;' to src/main.rs (line 6, after existing mod declarations). Use 'use crate::backlinks::BacklinkRef;' in serve.rs and html.rs as needed.\n- BacklinkRef struct:\n  pub struct BacklinkRef {\n    pub source_url_path: String,    // root-relative URL path with leading slash, e.g. '/docs/a.md'\n    pub source_display: String,     // first H1 title if available, else rel path without leading slash\n    pub snippet: String,            // ~80 chars before/after link, whitespace-collapsed, max 200 chars\n    pub target_fragment: Option<String>, // fragment without '#', for display and href construction\n  }\n- Index type: HashMap<String, Vec<BacklinkRef>> where keys are root-relative URL paths with leading slash (e.g., '/docs/readme.md').\n- Canonical key helper (pub in backlinks.rs, used by both build and lookup):\n  pub fn url_key_from_rel_path(rel: &str) -> String {\n    format!('/{rel}')\n  }\n  Called at index build time as url_key_from_rel_path(&stripped.to_string_lossy().replace('\\\\', '/'))\n  Called at request lookup time as url_key_from_rel_path(norm_display) where norm_display has no leading slash.\n- IMPORTANT: norm_display in serve_handler (serve.rs:982) is a root-relative string WITHOUT leading slash. Call url_key_from_rel_path(norm_display) → '/docs/readme.md'.\n- Fragment handling: store in BacklinkRef.target_fragment; exclude from key identity.\n- Self-link filtering: during inversion in bd-1hd, skip when source_url_path == target_url_path.\n- source_display population: use DocExtractResult.title (Option<String>). If Some(t), source_display = t. If None, source_display = source root-relative path without leading slash (e.g., 'docs/a.md').\n- Unicode separators: always normalize to '/' in URL keys regardless of OS path separator.\n\nDependency links:\n- Foundation task; all downstream extractor, server wiring, and test tasks depend on this contract.\n\nAcceptance criteria:\n- BacklinkRef, url_key_from_rel_path, and related types are defined in src/backlinks.rs.\n- mod backlinks; is in src/main.rs.\n- All downstream tasks import types from crate::backlinks.\n- Key derivation is a single canonical function used by both build and lookup.\n\nTest requirements:\n- Unit: test url_key_from_rel_path('docs/readme.md') == '/docs/readme.md', empty string → '/', 'readme.md' → '/readme.md'. Test BacklinkRef struct construction (fields accessible). See bd-3oh.2 for full contract test matrix.\n- E2E: covered indirectly through downstream panel rendering.\n- Logging: non-UTF-8 file skipping is logged by traversal (bd-1hd), not by types.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-25T01:14:38.681190202Z","created_by":"exedev","updated_at":"2026-02-25T01:52:43.568535137Z","closed_at":"2026-02-25T01:52:43.568509763Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":27,"issue_id":"bd-r8y","author":"Peter Schilling","text":"Maintainer rationale: path-key drift is the highest-risk failure mode (index built under one normalization, lookup under another). Treat this issue as the contract authority and require downstream tasks to reference or reuse the same helper/logic path.","created_at":"2026-02-25T01:15:10Z"}]}
{"id":"bd-t6w","title":"Validate existing resolve_candidate + rewrite_local_links integration","description":"Validate integration of existing local-link rewriting and candidate resolution under the new routing semantics. Do not re-implement `rewrite_local_links()` or `resolve_candidate()`.\n\nImplementation details:\n- Add/adjust tests asserting fallback order remains stable:\n  1) exact path,\n  2) extensionless + `.md`,\n  3) `dir/README.md`,\n  4) `dir/index.md`.\n- Verify markdown-generated links are root-relative hrefs (leading `/`) and remain reachable through HTTP.\n- Use temp-fixture-based scenarios (not repository `playground/` fixtures) to validate CWD-rooted serving behavior.\n- Include explicit CWD-root regression checks where entry is nested under a subdirectory and rewritten links preserve expected rooted prefixes.\n- Ensure `/` routing changes do not alter resolver/rewrite semantics for non-root markdown navigation.\n\nDependency links:\n- Depends on bd-uso.\n- Blocks broad integration suite completion (bd-3h2).\n\n## Acceptance Criteria\n- Existing `resolve_candidate()` fallback order is validated end-to-end without reimplementation: exact, `.md`, `README.md`, `index.md`.\n- Existing `rewrite_local_links()` behavior is preserved for CWD-rooted serving, including nested and parent-relative links that must rewrite to correct root-relative targets.\n- Unit tests pin helper-level normalization/rewrite assumptions that could regress with CWD-root serving.\n- Integration tests verify rewritten targets are reachable (`200`) and resolver branch selection remains stable.\n- E2E script coverage is present in `tests/e2e_serve_navigation.sh` (`link-rewrite-flow` + `logging-signatures`) with detailed request/response and resolver-log capture.\n- Debug logs capture resolver branch decisions and rewritten-target requests with no unexpected `WARN`/`ERROR` on valid navigation.\n\n## Verification Steps\n- Run unit tests for normalization/rewrite assumptions used by resolve_candidate/rewrite_local_links integration.\n- Run integration tests validating fallback order (exact, .md, README.md, index.md) and rewritten-link reachability (HTTP 200).\n- Run e2e link-rewrite-flow checks under RUST_LOG=debug and confirm resolver branch logs with no unexpected WARN/ERROR on valid navigation.","acceptance_criteria":"1) Existing resolve_candidate() fallback order is validated end-to-end without reimplementation: exact, extensionless + .md, dir/README.md, dir/index.md. 2) Existing rewrite_local_links() behavior is preserved for CWD-rooted serving, including nested and parent-relative links that must rewrite to correct root-relative /playground/... targets. 3) Unit tests pin helper-level normalization and URL rewrite assumptions that could regress with serve_root=CWD. 4) Integration tests verify rewritten link targets are directly reachable (HTTP 200) and that fallback branch selection stays stable. 5) E2E script coverage is added/extended in tests/e2e_serve_navigation.sh for link-rewrite and fallback-order paths with detailed per-step logging. 6) Debug logs capture resolver branch decisions and rewritten-target requests, with no unexpected WARN/ERROR on valid navigation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-24T22:57:02.881975794Z","created_by":"exedev","updated_at":"2026-02-25T00:06:59.022101415Z","closed_at":"2026-02-25T00:06:59.022065098Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-t6w","depends_on_id":"bd-uso","type":"blocks","created_at":"2026-02-24T22:57:15.991556854Z","created_by":"exedev","metadata":"{}","thread_id":""}],"comments":[{"id":6,"issue_id":"bd-t6w","author":"Peter Schilling","text":"This task is a guardrail against accidental rewrite/refactor churn. Treat  and  as established behavior and validate integration through tests rather than replacing implementations.","created_at":"2026-02-24T22:57:35Z"},{"id":12,"issue_id":"bd-t6w","author":"Peter Schilling","text":"Clarification: preserve existing functions rewrite_local_links() and resolve_candidate(); add integration tests instead of rewriting them.","created_at":"2026-02-24T22:57:49Z"},{"id":16,"issue_id":"bd-t6w","author":"Peter Schilling","text":"CWD-based serve_root impact: after bd-2uj changes serve_root from entry_file.parent() to current_dir(), verify that rewrite_local_links() still produces correct root-relative hrefs. Specifically: serving playground/README.md from cwd=/workspace/mdmd-dev means serve_root=/workspace/mdmd-dev and entry_file=/workspace/mdmd-dev/playground/README.md. A relative link like '../code.md' in playground/README.md resolves to /workspace/mdmd-dev/code.md and strips to /code.md. Test this case explicitly: render playground/README.md with serve_root=CWD and assert links to subdir/nested.md produce href='/playground/subdir/nested.md'. Also test that extensionless links in playground/links.md render as /playground/... hrefs after serve_root change. These tests will fail if serve_root is still entry_file.parent(), making them a regression guard for the CWD change.","created_at":"2026-02-24T23:01:21Z"}]}
{"id":"bd-tzk","title":"Code block syntax highlighting with syntect","description":"Add syntax highlighting to fenced code blocks using the syntect crate. Detect the language from the code fence info string (e.g., ```rust, ```python) and apply appropriate syntax coloring. Fall back to plain monospace rendering for unrecognized languages or fences without a language specifier.","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-02-21T00:28:53.768940253Z","created_by":"exedev","updated_at":"2026-02-21T01:46:12.854069214Z","closed_at":"2026-02-21T01:46:12.854021443Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-tzk","depends_on_id":"bd-p4x","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-u9i","title":"[Subtask] Gate tailscale/bind/startup diagnostics behind verbose","description":"Startup informational stderr noise must be cleaned up while stdout format work happens in bd-3k4/bd-8z2. This task only governs diagnostics emitted on stderr.\n\nObjective and scope:\n- Gate tailscale detection eprintln! calls behind verbose.\n- Gate server startup and bind diagnostic eprintln! calls behind verbose.\n- Leave error eprintln! calls (Error: ..., WARNING: ...) unconditional.\n\nImplementation details:\nApply vlog! macro (from bd-1zw) to the following specific informational call sites in serve.rs:\n- ~line 65: eprintln!(\"[tailscale] skipped reason=subprocess-error: {e}\") -> vlog!(verbose, ...)\n- ~line 73: eprintln!(\"[tailscale] skipped reason={reason}\") -> vlog!(verbose, ...)\n- ~line 205: eprintln!(\"[bind] trying port={}\", port) -> vlog!(verbose, ...)\n- ~line 210: eprintln!(\"[bind] success port={}\", port) -> vlog!(verbose, ...)\n- ~line 215: eprintln!(\"[bind] EADDRINUSE, trying {}\", next) -> vlog!(verbose, ...)\n- ~line 1456: eprintln!(\"[serve] listening on ...\") -> vlog!(verbose, ...)\n- ~line 1457-1461: eprintln!(\"[serve] serve_root=...\") -> vlog!(verbose, ...)\n- ~line 1488: eprintln!(\"[shutdown] complete\") -> vlog!(verbose, ...)\n\nNotes:\n- Stdout label removal remains in bd-3k4/bd-8z2 and must not be reintroduced on stderr.\n- Handler-level diagnostics ([request], [cache], [resolve], etc.) are covered in bd-1zw.\n\nDependency links:\n- Parent: bd-1o6.\n- Depends on shared verbose helper subtask (bd-1zw).\n\nAcceptance criteria:\n- Non-verbose default startup emits nothing informational to stderr.\n- --verbose startup shows [tailscale] skip reason and [serve] listening diagnostics.\n- Error paths (Error:, WARNING:) remain unconditional.\n\nTest requirements:\nUnit:\n- Branch coverage for tailscale diagnostic paths with verbose=false and verbose=true.\n\nE2E/integration:\n- Default mode: stderr contains no [tailscale], [bind], or [serve] informational lines.\n- --verbose mode: all three categories appear on stderr.\n- Logging expectation: capture and persist stderr excerpts for both modes to aid diff-based debugging.","notes":"Verification Steps:\n1. Implement the scoped changes and keep behavior aligned with this bead's objective/acceptance criteria.\n2. Run the unit and integration/e2e tests listed under Test requirements for this bead.\n3. Verify stdout/stderr logging expectations in the executed scenarios (default vs verbose, and any no-open/headless paths if applicable).\n4. Record the exact validation commands and outcomes in the implementation notes/PR summary for reproducibility.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-25T16:25:12.274029489Z","created_by":"exedev","updated_at":"2026-02-25T17:19:57.785650074Z","closed_at":"2026-02-25T17:19:57.785610318Z","close_reason":"All vlog! gating already in place from bd-1zw; added tailscale_dns_name_verbose_false/true_does_not_panic unit tests for branch coverage","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-u9i","depends_on_id":"bd-1zw","type":"blocks","created_at":"2026-02-25T16:25:25.784270808Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-uso","title":"Route '/' to root directory index with assets precedence","description":"Change routing semantics so GET / always renders the root directory index. Maintain embedded assets precedence (/assets/mdmd.css, /assets/mdmd.js) before file/doc resolution.\n\nImplementation details:\n- The change is in serve_handler() in serve.rs. The current early-exit for normalized empty path (lines 598-602 after bd-2uj changes):\n    let candidate = if normalized == PathBuf::new() {\n        state.entry_file.clone()  // ← REPLACE this entire branch\n    } else { ... };\n  This branch must be REPLACED (not just removed) with a direct call to render_directory_index_response for serve_root, bypassing resolve_candidate entirely:\n    if normalized == PathBuf::new() {\n        return render_directory_index_response(&state, &state.canonical_root, \"/\").await;\n    }\n  Rationale: if left as a fall-through, resolve_candidate(serve_root) would find serve_root/README.md and serve it instead of the index — contradicting the plan.\n- The old candidate construction for the empty-path case (serve entry file) is fully replaced; the else branch serve_root.join(&normalized) remains for all non-root paths.\n- Keep request path normalization and containment checks unchanged.\n- Ensure route dispatch order: embedded assets first → GET / early-exit → normalize/decode → resolve_candidate → markdown/static/dir-index/rich-404.\n- .current_dir(&fixture.root) has already been applied to ServerHandle::new in tests/serve_integration.rs (prerequisite done).\n- Update or remove all integration tests that asserted GET / returns entry markdown content (see Breaking Test Inventory comment).\n\n## Acceptance Criteria\n- Handler keeps `/assets/mdmd.css` and `/assets/mdmd.js` precedence, then short-circuits `GET /` to root directory index rendering without passing through `resolve_candidate()`.\n- `GET /` shows directory index even when root has `README.md`; non-root routing behavior and traversal protections are unchanged.\n- Regression tests migrated from bare `/` to pathful entry URL and include explicit index assertions for `/`.\n- Unit tests verify root-branch selection helper/path logic where applicable.\n- E2E scriptable run is documented and green with detailed logs: `RUST_LOG=debug cargo test --test serve_integration test_serve_root_index -- --nocapture`.\n- Success-path log output contains branch info and no unexpected `WARN`/`ERROR` entries.\n\n## Verification Steps\n- Run: RUST_LOG=debug cargo test --test serve_integration test_serve_root_index -- --nocapture.\n- Assert '/assets/mdmd.css' and '/assets/mdmd.js' still return 200 with expected content types.\n- Assert GET '/' renders root directory index markers and no unexpected WARN/ERROR in successful flow logs.","acceptance_criteria":"1) Route order is enforced: embedded assets first, then explicit GET / root-index early-exit, then normalized-path candidate resolution. 2) GET / always renders root directory index even when <serve_root>/README.md exists; non-root request behavior and traversal guards remain unchanged. 3) Integration tests in tests/serve_integration.rs migrate entry-content assertions from / to the pathful entry URL and add explicit root-index assertions for /. 4) Unit tests cover root-branch selection logic and ensure empty normalized path cannot fall through to resolve_candidate(). 5) E2E script coverage is added/extended in tests/e2e_serve_navigation.sh with a dedicated root-index case, section markers, and verbose request/response logging. 6) Debug logs include branch selection context for root-index rendering; successful root-index scenarios emit no unexpected WARN/ERROR.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-24T22:57:01.995315624Z","created_by":"exedev","updated_at":"2026-02-24T23:41:04.371419574Z","closed_at":"2026-02-24T23:41:04.371345022Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-uso","depends_on_id":"bd-2uj","type":"blocks","created_at":"2026-02-24T22:57:14.829531565Z","created_by":"exedev","metadata":"{}","thread_id":""}],"comments":[{"id":3,"issue_id":"bd-uso","author":"Peter Schilling","text":"Rationale: root-first browsing aligns with filesystem mental model and avoids special-casing entry content at . Keep embedded assets checked before candidate resolution to prevent accidental regression of CSS/JS delivery.","created_at":"2026-02-24T22:57:34Z"},{"id":11,"issue_id":"bd-uso","author":"Peter Schilling","text":"Clarification: root path slash behavior is intentional; GET slash must render root index, not entry markdown.","created_at":"2026-02-24T22:57:49Z"},{"id":14,"issue_id":"bd-uso","author":"Peter Schilling","text":"Coordination note: the serve_root=CWD change is initiated in bd-2uj's startup work but bd-uso owns the handler behavior. Verify that after serve_root=CWD: (1) normalized empty path (GET /) correctly calls the directory-index renderer for canonical_root, not state.entry_file; (2) the existing handler branch 'if normalized == PathBuf::new() { state.entry_file.clone() }' (serve.rs line 544-548) is removed and replaced with the directory-index call. Test updates REQUIRED: the integration test suite and any unit tests that assert GET / returns entry markdown body must be updated to expect root directory index HTML content instead. Add a new assertion: GET / response contains root directory listing markers (e.g. the serve_root directory name in a breadcrumb or the listing body).","created_at":"2026-02-24T23:00:32Z"},{"id":19,"issue_id":"bd-uso","author":"Peter Schilling","text":"CRITICAL LOGIC ERROR in description: the statement 'resolve_candidate(serve_root) returns None (serve_root is a directory with no README.md at root, or delegates to the directory index)' is WRONG. In the real test fixture and in any repo with a README.md at the project root, resolve_candidate(serve_root) WILL find and return that README.md as the 'readme' branch. The server would then serve README.md for GET /, contradicting the plan Decision #1 ('GET / will render the serve_root directory index'). CORRECT IMPLEMENTATION: the normalized==PathBuf::new() early branch must NOT be removed and left to fall through. Instead it must be REPLACED with a direct call to the directory-index renderer for serve_root, bypassing resolve_candidate entirely. Example:\n  if normalized == PathBuf::new() {\n      return render_directory_index_response(&state, &state.canonical_root, \"/\").await;\n  }\nThis ensures GET / always shows a browsable listing even when README.md exists at the project root. The pathful entry URL (printed at startup) is the correct way to reach the entry document.","created_at":"2026-02-24T23:10:01Z"},{"id":20,"issue_id":"bd-uso","author":"Peter Schilling","text":"CRITICAL TEST INFRASTRUCTURE GAP: ServerHandle::new in tests/serve_integration.rs spawns the server binary WITHOUT .current_dir(&fixture.root). After the serve_root=CWD change (already implemented in bd-2uj), the spawned server process CWD is the cargo test runner directory (/home/exedev/workspace/mdmd-dev). All fixture entry paths are under /tmp/... and will fail the 'entry_file.starts_with(canonical_root)' check in run_serve(), causing the server to exit immediately. ALL 30+ integration tests will crash at startup. Fix: add .current_dir(&fixture.root) to the Command::new(bin_path()) spawn in ServerHandle::new (tests/serve_integration.rs line ~124). This is a prerequisite for any integration test to pass. This fix belongs in bd-uso since it owns test updates for the GET / routing change.","created_at":"2026-02-24T23:10:08Z"},{"id":21,"issue_id":"bd-uso","author":"Peter Schilling","text":"BREAKING TEST INVENTORY: the following 7 tests fetch GET / expecting entry markdown content and MUST be updated to use the entry file's path instead (e.g. /README.md since fixture.entry is fixture.root/README.md):\n1. test_serve_basic_html (line 366) - asserts text/html TOC\n2. test_serve_toc_present (line 376) - asserts TOC nav sidebar\n3. test_serve_raw_mode (line 390) - fetches /?raw=1 expecting # Home source; must become /README.md?raw=1\n4. test_serve_table_rendered (line 406) - asserts <table> in body\n5. test_serve_task_list_rendered (line 419) - asserts checkbox\n6. test_serve_mermaid_placeholder (line 434) - asserts class=mermaid\n7. test_serve_mermaid_cdn_script (line 448) - asserts CDN script URL\nAlso update test_serve_startup_stdout_format (line 735): the startup banner now emits 'url:   http://..../README.md' (pathful) AND 'index: http://.../' (root). The test currently checks only for a line starting with 'url:   http://' which still matches. Add an assertion for the 'index: http://' line too, so the two-URL format is verified.\nTests that will still pass without changes: test_serve_nosniff_header (line 561), test_serve_compression_gzip (line 680), test_serve_compression_br (line 693) - all fetch GET / but don't assert entry content.","created_at":"2026-02-24T23:10:19Z"},{"id":24,"issue_id":"bd-uso","author":"Peter Schilling","text":"STATUS UPDATE: .current_dir(&fixture.root) has already been applied to ServerHandle::new in tests/serve_integration.rs (working copy). This prerequisite is done — integration tests will correctly set the server CWD to the fixture root. The remaining work for bd-uso is: (1) replace the early-exit candidate branch in serve_handler(), (2) update the 7 breaking integration tests listed in Breaking Test Inventory.","created_at":"2026-02-24T23:14:27Z"}]}
{"id":"bd-x0l","title":"Help/shortcuts dialog: ? to show filterable keyboard shortcuts","description":"Implement a help modal triggered by '?' that displays all keyboard shortcuts in a clean, organized list. The dialog should be filterable - typing text filters the list to show only matching shortcuts. Shortcuts should be grouped by category (Navigation, Search, View, etc.) with clear formatting.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-02-21T00:28:53.169308593Z","created_by":"exedev","updated_at":"2026-02-21T01:39:30.434893650Z","closed_at":"2026-02-21T01:39:30.434851429Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-x0l","depends_on_id":"bd-1by","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
