{"id":"bd-16x","title":"Document new serve semantics and index/404 policies","description":"Document behavior and operational expectations for the new serving model. Ensure maintainers and users understand root/index behavior, pathful startup URLs, and omission rules.\n\nImplementation details:\n- Update the mdmd serve help text in src/main.rs to reflect implemented semantics:\n  - startup output includes primary pathful URL (for example http://127.0.0.1:3333/playground/README.md) and root index URL (http://127.0.0.1:3333/).\n  - GET / renders root directory index, not entry document.\n  - directory index policies: dotfiles excluded, out-of-root symlinks omitted.\n  - broken links render rich recovery 404 with nearest-parent links/listing.\n- Add maintainer-facing doc at docs/serve-semantics.md (preferred over AGENTS edits) summarizing:\n  - CWD-based serve_root model,\n  - routing order and branch outcomes,\n  - listing/404 policies,\n  - canonical test and e2e commands.\n- Add a short release-verification runbook section that references the exact integration/e2e commands and expected log markers.\n\nFiles to update:\n- src/main.rs help/after_help text.\n- docs/serve-semantics.md (new or updated) as the canonical behavior contract.\n\nDependency links:\n- Depends on completed implementation/testing tasks.\n- Closes once docs align exactly with tested behavior/output labels.\n\n## Verification Steps\n- Run docs-linked commands (unit, integration, and tests/e2e_serve_navigation.sh under RUST_LOG=debug).\n- Verify help text and docs output labels match implementation exactly (pathful entry URL line, root index URL line, branch-log keys).\n- Confirm docs/serve-semantics.md is the canonical reference and command snippets execute as written.","acceptance_criteria":"1) CLI/help/docs describe final serve semantics accurately: pathful startup entry URL + root index URL, GET / as root index, and rich 404 recovery behavior. 2) Documentation explicitly records directory-index omission policies (dotfiles excluded, out-of-root symlinks omitted) and CWD-based serve_root behavior. 3) docs/serve-semantics.md is the canonical maintainer reference; AGENTS.md is not required for this feature documentation. 4) Docs link to canonical automated checks: unit tests, integration tests, and tests/e2e_serve_navigation.sh under RUST_LOG=debug. 5) Command snippets and expected log/output labels match implementation exactly (including both startup URL lines and branch-log keys). 6) Verification pass confirms docs-linked commands execute and produce sectioned, detailed logs.","status":"open","priority":2,"issue_type":"docs","created_at":"2026-02-24T22:57:03.486909206Z","created_by":"exedev","updated_at":"2026-02-24T23:26:09.790520385Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-16x","depends_on_id":"bd-2uj","type":"blocks","created_at":"2026-02-24T22:57:18.413014953Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-16x","depends_on_id":"bd-3ci","type":"blocks","created_at":"2026-02-24T22:57:19.017097786Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-16x","depends_on_id":"bd-3h2","type":"blocks","created_at":"2026-02-24T22:57:19.620213543Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-16x","depends_on_id":"bd-3u5","type":"blocks","created_at":"2026-02-24T22:57:19.318709773Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-16x","depends_on_id":"bd-uso","type":"blocks","created_at":"2026-02-24T22:57:18.716838114Z","created_by":"exedev","metadata":"{}","thread_id":""}],"comments":[{"id":8,"issue_id":"bd-16x","author":"Peter Schilling","text":"Documentation should be treated as behavioral contract: root index semantics, startup URLs, and listing policies must match tests and runtime output exactly.","created_at":"2026-02-24T22:57:36Z"}]}
{"id":"bd-18i","title":"serve2 slice 3: SSR markdown pipeline","description":"## Covered Sections\n- executable-decomposition\n- slice-3-ssr-markdown-pipeline-gfm-link-rewrite-mermaid-mode\n- validation-strategy\n- cross-slice-dependencies\n- gate-a-approval-checklist\n\n## Acceptance Criteria\n- GFM fixtures render correctly.\n- Mermaid fences render as diagrams (`client`) or code (`off`).\n- Nested relative links resolve to correct rendered pages from configured root.\n- Markdown conversion occurs server-side; client JS is limited to Mermaid execution and TOC active-state behavior.\n\n## Verification Steps\n- Run fixture-based render tests for tables/task-lists/strikethrough and syntax highlighting output markers.\n- Run Mermaid mode integration tests asserting rendered diagram container in `client` mode and preserved code fence in `off` mode.\n- Run link-rewrite tests from nested directories asserting resolved served URLs and no root-escape rewrites.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-23T06:57:33.996857597Z","created_by":"exedev","updated_at":"2026-02-24T00:11:18.158404927Z","closed_at":"2026-02-24T00:11:18.158385471Z","close_reason":"Cleaning up for fresh start","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-18i","depends_on_id":"bd-kcr","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-19b","title":"Heading navigation: n/p to jump between headings","description":"Implement heading-to-heading navigation using n (next heading) and p (previous heading). When pressed, the viewport should jump so the target heading appears at the top of the screen (or near the top with a small margin). The status bar should indicate the current heading context. This directly mirrors delta's navigate feature but built into the TUI.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-21T00:28:51.683391877Z","created_by":"exedev","updated_at":"2026-02-21T00:59:21.446601573Z","closed_at":"2026-02-21T00:59:21.446560142Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-19b","depends_on_id":"bd-1by","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-19b","depends_on_id":"bd-1sf","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-1by","title":"Viewport scrolling: j/k/arrows/page-up/page-down/gg/G navigation","description":"Implement vertical scrolling through the rendered markdown content. The viewport should track a scroll offset and render only the visible portion. Support: j/Down (scroll down one line), k/Up (scroll up one line), Ctrl-d/Page-Down (half page down), Ctrl-u/Page-Up (half page up), g/Home (top of document), G/End (bottom of document). Show a scroll position indicator in the status bar.","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-02-21T00:28:51.402568381Z","created_by":"exedev","updated_at":"2026-02-21T00:55:38.501072239Z","closed_at":"2026-02-21T00:55:38.501024827Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1by","depends_on_id":"bd-p4x","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-1mz","title":"Serve5-02: Server bootstrap, bounded port retry, graceful shutdown","description":"## Objective\nImplement axum/tokio server startup, default port 3333, bounded retry (100 attempts on EADDRINUSE only), and Ctrl+C shutdown.\n\n## Implementation Details\n- Bind loop: on EADDRINUSE errors, increment port by 1 and retry up to 100 times; exit with clear error when max attempts exhausted.\n- R8 mitigation: distinguish EADDRINUSE from other OS errors. For any non-EADDRINUSE bind error (e.g. EACCES, ENODEV), fail immediately with the specific OS error message — do NOT retry.\n- Default bind address: 127.0.0.1 loopback. The `--bind` flag is defined in bd-p7i's CLI serve subcommand and its value is passed to the server bootstrap here.\n- `tokio::signal::ctrl_c()` shutdown path; all listener tasks exit cleanly on SIGINT.\n- Log each bind attempt (port tried, outcome), the final bound port, and shutdown completion.\n- App state shared via `Arc<AppState>` containing `serve_root`, `entry_file`, and config.\n\n## Acceptance Criteria\n- Server binds on 3333 when free; retries on EADDRINUSE up to 100 times.\n- Non-EADDRINUSE errors cause immediate failure with OS error detail (not retry).\n- Clean shutdown on SIGINT without panic; exit code 0.\n\n## Verification Steps\n- Unit: `bind_with_retry` returns correct port after N EADDRINUSE failures.\n- Unit: non-EADDRINUSE error produces immediate `Err`, never retries.\n- Unit: attempt counter stops at 100 and returns descriptive error.\n- Integration: occupy port 3333, assert server binds on 3334.\n- Integration: occupy ports 3333–3432 (all 100 candidate ports), assert server fails with clear error message — must not panic.\n- Log lines: `[bind] trying port=3333`, `[bind] EADDRINUSE, trying 3334`, `[bind] success port=3334`, `[shutdown] complete`.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-24T04:48:24.259145678Z","created_by":"exedev","updated_at":"2026-02-24T06:34:30.168802641Z","closed_at":"2026-02-24T06:34:30.168776783Z","close_reason":"Implemented server bootstrap with bounded port retry and graceful shutdown","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1mz","depends_on_id":"bd-2f2","type":"parent-child","created_at":"2026-02-24T06:24:51.280417520Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1mz","depends_on_id":"bd-p7i","type":"blocks","created_at":"2026-02-24T04:48:27.856845905Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-1o1","title":"Vim-like search: / to search with highlighted matches and n/N navigation","description":"Implement vim-style search. Pressing '/' enters search mode with a search bar at the bottom. As the user types, matches are highlighted in the document (incremental search). Press Enter to confirm the search. Then use Ctrl-n/Ctrl-p (since n/p are taken by heading nav) to jump between matches. Press Escape to cancel search. The match count and current match index should be shown in the status bar.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-21T00:28:52.266944042Z","created_by":"exedev","updated_at":"2026-02-21T01:27:30.674300091Z","closed_at":"2026-02-21T01:27:30.674242613Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1o1","depends_on_id":"bd-1by","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-1p6","title":"Serve5-07: Local markdown link rewriting for web navigation","description":"## Objective\nRewrite local markdown links in the AST before HTML rendering for correct web navigation; preserve external URLs.\n\n## Implementation Details\n- Perform link rewriting via comrak AST traversal (NOT post-render string replacement) to avoid spurious matches in code blocks, inline HTML, and titles.\n- This traversal is integrated into the same `render_markdown` pass as heading extraction (see bd-mzl render signature: `fn render_markdown(input: &str, file_path: &Path, serve_root: &Path) -> (String, Vec<HeadingEntry>)`).\n- Rewrite targets that are relative paths ending in `.md` or extensionless local paths:\n  - `.md` suffix: leave as-is (serve resolver handles `.md` paths directly).\n  - Extensionless relative path: leave as-is (resolver will try `.md` fallback).\n  - Absolute and external URLs (`http://`, `https://`, `//`, `mailto:`, `#`): never rewritten.\n- Convert relative paths to root-relative (absolute from `serve_root`) so links work regardless of which page is being served. For example, `other.md` from `docs/subdir/page.md` → `/docs/subdir/other.md` as a root-relative href.\n- Preserve query strings (`?`) and fragments (`#`) — append after rewritten base path.\n- Directory-relative links: resolve from current file's directory within `serve_root`. If a relative path would resolve to a location above `serve_root` (e.g. `../../outside.md` from a nested file), the resulting href must not escape `serve_root` — either clamp to root or pass as-is for the path resolver to reject with 404 at request time.\n- Log: count of links rewritten vs. skipped per document at `debug` level.\n\n## Acceptance Criteria\n- Internal doc links navigate correctly across nested file hierarchies.\n- External links are unchanged.\n- No unsafe escaping via rewritten links.\n- Fragments and query strings are preserved.\n- Links in fenced code blocks are NOT rewritten.\n- Relative traversal links that would escape `serve_root` do not produce URLs pointing outside the root.\n\n## Verification Steps\n- Unit: `[t](other.md)` from root-level file → root-relative href `/other.md`.\n- Unit: `[t](subdir/page.md)` from root-level file → root-relative href `/subdir/page.md` (validates subdirectory path construction).\n- Unit: `[t](../parent.md)` from `docs/subdir/page.md` → root-relative href `/docs/parent.md` (resolves relative to current file directory, stays within `serve_root`).\n- Unit: `[t](subdir/doc)` extensionless from root-level file → root-relative path `/subdir/doc` passed through (resolver will add `.md`).\n- Unit: `[t](https://example.com/page.md)` → href unchanged.\n- Unit: `[t](#section)` → href unchanged.\n- Unit: `[t](doc.md#section?query=1)` → fragment and query preserved in rewritten href.\n- Unit: `[t](../../outside.md)` from `docs/subdir/page.md` → resulting href does not reference content above `serve_root`; either clamped to root or passes as-is for 404 handling by the resolver.\n- Unit: link inside a fenced code block → NOT rewritten.\n- Integration: navigate `index.md` → `subdir/page.md` via link → page renders (200).\n- Log: `[rewrite] file=<path> rewritten=<N> skipped=<M>` at debug level.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-24T04:49:57.542029263Z","created_by":"exedev","updated_at":"2026-02-24T07:11:49.295005423Z","closed_at":"2026-02-24T07:11:49.294959706Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1p6","depends_on_id":"bd-2f2","type":"parent-child","created_at":"2026-02-24T06:24:48.712151688Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1p6","depends_on_id":"bd-ezg","type":"blocks","created_at":"2026-02-24T04:50:01.074991413Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-1p6","depends_on_id":"bd-mzl","type":"blocks","created_at":"2026-02-24T04:50:00.822466106Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-1sf","title":"Markdown parsing: AST extraction with heading tree and link collection","description":"Implement markdown file parsing using pulldown-cmark. Parse the file into a structured representation that includes: (1) a flat list of content blocks (paragraphs, code blocks, lists, etc.) with their line ranges, (2) a heading tree with heading level, text, and line position, (3) a collection of all links with their text, URL, and position. This module is pure logic with no TUI dependency, making it easily unit-testable.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-21T00:28:50.821214527Z","created_by":"exedev","updated_at":"2026-02-21T00:43:41.340688781Z","closed_at":"2026-02-21T00:41:01.258983258Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1sf","depends_on_id":"bd-2rl","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-22o","title":"Serve5-09: Cache validators and compression middleware","description":"## Objective\nAdd `ETag`/`Last-Modified` response headers and response compression to improve serve performance; handle conditional requests with 304 responses.\n\n## Implementation Details\n- **ETag**: compute as hex-encoded FNV-1a (fast; sufficient for cache validation — not a cryptographic use) of response body bytes; set as strong ETag `\"<hash>\"`. Document the chosen algorithm in a code comment so it can be changed consistently. SHA-256 is acceptable if FNV-1a is unavailable, but prefer the faster hash.\n- **Last-Modified**: derive from file `mtime` (`std::fs::metadata().modified()`); format as HTTP date string per RFC 7231.\n- **Conditional request handling**:\n  - `If-None-Match`: compare request ETag against response ETag; return `304 Not Modified` with no body when equal. Return `200` with full body when ETag does not match.\n  - `If-Modified-Since`: compare request date against `Last-Modified`; return `304 Not Modified` when file has not been modified since that date. Return `200` with full body when the file was modified after the request date.\n- **Compression**: use `tower-http` `CompressionLayer` with gzip and brotli enabled; apply to all text responses (HTML, CSS, JS, plain text).\n- **Static assets** (`/assets/mdmd.css`, `/assets/mdmd.js`): also include `ETag`/`Last-Modified` based on embedded content hash and build time.\n- Log: `[cache] path=<p> etag=<hash> status=<200|304>` and `[compression] encoding=<gzip|br|none>` per request.\n\n## Acceptance Criteria\n- All responses include `ETag` and `Last-Modified` headers.\n- `If-None-Match` with matching ETag returns 304; with non-matching ETag returns 200 with full body.\n- `If-Modified-Since` with date newer than file mtime returns 304; with date older than file mtime returns 200 with full body.\n- Gzip compression applied when `Accept-Encoding: gzip` is negotiated (`Content-Encoding: gzip` in response).\n- Brotli compression applied when `Accept-Encoding: br` is negotiated (`Content-Encoding: br` in response).\n\n## Verification Steps\n- Unit: same content bytes produce identical ETag; different bytes produce different ETag.\n- Unit: `Last-Modified` format string parses as a valid RFC 7231 HTTP date.\n- Integration: GET page → response includes `ETag` and `Last-Modified`.\n- Integration: GET with `If-None-Match: <etag>` → 304, empty body.\n- Integration: GET with `If-None-Match: <different-etag>` → 200, full response body (non-matching ETag must not return 304).\n- Integration: GET with `If-Modified-Since: <date newer than file mtime>` → 304, empty body (file not modified since that date).\n- Integration: GET with `If-Modified-Since: <date older than file mtime>` → 200, full response body (file was modified after the request date).\n- Integration: GET with `Accept-Encoding: gzip` → `Content-Encoding: gzip`.\n- Integration: GET with `Accept-Encoding: br` → `Content-Encoding: br`.\n- Log: `[cache] path=/ etag=abc123 status=304` when conditional match.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-24T04:50:31.778809519Z","created_by":"exedev","updated_at":"2026-02-24T07:17:42.923018330Z","closed_at":"2026-02-24T07:17:42.922971235Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-22o","depends_on_id":"bd-1mz","type":"blocks","created_at":"2026-02-24T04:50:36.049121287Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-22o","depends_on_id":"bd-2f2","type":"parent-child","created_at":"2026-02-24T06:24:52.879701056Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-22o","depends_on_id":"bd-ezg","type":"blocks","created_at":"2026-02-24T04:50:36.302756074Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-22o","depends_on_id":"bd-mzl","type":"blocks","created_at":"2026-02-24T04:50:36.563266115Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-24s","title":"CLI interface: clap argument handling, --help, error messages","description":"Wire up proper CLI argument handling using clap. The binary should accept a positional markdown file path argument, support --help, and provide graceful error messages for common issues (file not found, not a markdown file, permission denied). Add a --version flag. If no file is given, show usage information.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-21T00:28:53.467357871Z","created_by":"exedev","updated_at":"2026-02-21T01:29:33.081621419Z","closed_at":"2026-02-21T01:29:33.081576672Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-24s","depends_on_id":"bd-2rl","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-267","title":"Outline modal: hierarchical heading view with live document preview","description":"Implement an outline overlay (triggered by 'o') that displays all headings in a hierarchical list, similar to Zed's Cmd-Shift-O. Headings are indented by level and prefixed with '#' symbols to denote hierarchy. The current heading (based on scroll position) should be pre-selected when the modal opens. As the user moves up/down in the outline list, the document behind the modal should scroll to show that heading's section. Pressing Enter selects and closes the modal at that position. Pressing Escape closes without changing position.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-21T00:28:51.962901586Z","created_by":"exedev","updated_at":"2026-02-21T01:18:15.824741236Z","closed_at":"2026-02-21T01:18:15.824667721Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-267","depends_on_id":"bd-19b","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-28p","title":"serve2 slice 1: CLI + bootstrap","description":"## Covered Sections\n- mdmd-serve2-replay-plan-2026-02-23-revision-2\n- overview\n- workflow-diagram\n- dependencies-and-implementation-notes\n- executable-decomposition\n- slice-1-cli-surface-and-server-bootstrap\n- risks-and-mitigations\n- validation-strategy\n- test-infrastructure-bootstrap\n- per-slice-validation-commands\n- manual-smoke-checklist-before-gate-a-sign-off\n- regression-guard-for-tui-backward-compatibility\n- operational-checks\n- startup\n- runtime-error-handling\n- large-file-and-resource-limits\n- graceful-shutdown\n- open-questions-resolved\n- cross-slice-dependencies\n- revision-pass-round-1-incorporated\n- gate-a-approval-checklist\n\n## Acceptance Criteria\n- CLI flags parse and route to runtime config correctly: `--port`, `--host`, `--root`, `--open`, `--no-tailscale`, `--mermaid-mode <client|off>`.\n- First free port at or above requested/default is selected within retry cap; cap exhaustion exits with actionable error.\n- Non-`AddrInUse` bind failures exit immediately with actionable error text.\n- Ctrl-C/SIGTERM performs graceful shutdown without panic.\n- `mdmd <file>` and `mdmd view <file>` still launch TUI path unchanged.\n\n## Verification Steps\n- Run unit tests covering CLI argument parsing and dispatch (`serve` vs TUI commands).\n- Run integration test that binds an occupied port and confirms auto-increment behavior and retry-cap failure path.\n- Run integration test that starts server and sends SIGINT/SIGTERM, asserting clean shutdown exit.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-23T06:57:33.814115841Z","created_by":"exedev","updated_at":"2026-02-24T00:11:17.437942082Z","closed_at":"2026-02-24T00:11:17.437913041Z","close_reason":"Cleaning up for fresh start","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-2f2","title":"Serve5: Implement mdmd serve phase-1 web server","description":"Top-level epic for mdmd serve phase 1. Adds axum/tokio web server to mdmd that serves Markdown as HTML with GFM rendering via comrak, sticky TOC, secure serve_root path resolution, Mermaid client hydration, cache validators, compression, and Tailscale-aware startup URLs. Preserves existing TUI (mdmd <file>) behavior. See docs/plans/serve5/plan.md for full spec.\n\n## Success Criteria\n- `mdmd <file>` continues to launch existing TUI behavior (no regression).\n- `mdmd serve README.md` starts server, prints localhost URL, and serves HTML.\n- Port 3333 occupied: server retries with incrementing ports; stops after 100 attempts with clear error.\n- Non-EADDRINUSE bind errors cause immediate failure with OS error detail (not retry).\n- Startup output always includes localhost URL; includes Tailscale URL when available.\n- Rendered HTML includes phase-1 feature matrix (tables, task lists, strikethrough, Mermaid placeholders, etc.).\n- TOC is persistently visible; active heading updates while scrolling.\n- Local Markdown links resolve only within serve_root; traversal attempts are denied (R1, R2).\n- URL-encoded traversal (%2e%2e) attempts are denied.\n- Symlink-based escape from serve_root is denied via post-canonicalize re-check.\n- Static asset requests resolve only within serve_root; traversal attempts are denied.\n- Files exceeding 16 MB return 413.\n- All responses include X-Content-Type-Options: nosniff and correct Content-Type (including 404/413).\n- HTTP responses support ETag/Last-Modified cache validation and gzip/brotli compression.\n- Server shuts down cleanly on Ctrl+C; exit code 0.\n- `cargo test`, `cargo clippy -- -D warnings`, and `cargo fmt --check` all pass.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-02-24T04:47:50.131042943Z","created_by":"exedev","updated_at":"2026-02-24T22:19:39.155285100Z","closed_at":"2026-02-24T22:19:39.155216156Z","close_reason":"All children completed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-2fs","title":"Link following: Enter to open linked markdown documents with back navigation","description":"When a link is focused (via Tab navigation from bd-3o8), pressing Enter on a link to a local .md file should open that file in mdmd, replacing the current document. Implement a navigation stack so the user can press Backspace or a back key to return to the previous document at the same scroll position. External URLs should be opened in the system browser.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-02-21T00:28:52.871364150Z","created_by":"exedev","updated_at":"2026-02-21T01:35:57.258977503Z","closed_at":"2026-02-21T01:35:57.258928168Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2fs","depends_on_id":"bd-3o8","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-2l9","title":"Serve5-10: Unit test coverage for serve internals","description":"## Objective\nProvide comprehensive deterministic unit test coverage for all serve internals, covering all R1–R10 risk mitigations.\n\n## Implementation Details\nTests live in `#[cfg(test)]` modules within each source file (`src/serve.rs`, `src/html.rs`, `src/web_assets.rs`).\nEach test must include a descriptive name explaining the exact scenario under test.\nAll tests must log scenario-specific failure context (via `println!` in test body or assertion messages).\n\n## Cargo.toml dependency audit (R10)\nBefore implementing any bead, verify Cargo.toml includes (with pinned versions):\n- `axum` (server framework, bd-1mz)\n- `tokio` with `full` features (async runtime, bd-1mz)\n- `comrak` with only needed features: `\"default\"` is fine; do NOT enable experimental extensions (bd-mzl)\n- `tower-http` with `compression-gzip`, `compression-br` (bd-22o)\n- `serde_json` (tailscale parsing, bd-3kq)\n- Dev-only: `reqwest` blocking client (bd-39z integration tests)\n- Optional: `fnv` crate for FNV-1a ETag, or use inline implementation (bd-22o)\nVerify binary size delta after comrak: `cargo build --release` before and after; delta must be ≤500 KB.\n\n## Port retry tests (R8)\n- `test_bind_retry_eaddrinuse_success`: N ports occupied, next free → success.\n- `test_bind_retry_max_failure`: 100 ports all EADDRINUSE → descriptive error.\n- `test_bind_no_retry_eacces`: EACCES error → immediate failure, attempt count = 1.\n\n## Tailscale parsing tests (R7)\n- `test_tailscale_valid_dns_name`: `\"hostname.ts.net.\"` → trimmed URL.\n- `test_tailscale_trailing_dot_only`: `\".\"` → no tailscale URL.\n- `test_tailscale_empty_dns_name`: `\"\"` → no tailscale URL.\n- `test_tailscale_missing_self_key`: JSON `{}` → no tailscale URL.\n- `test_tailscale_malformed_json`: `\"not json\"` → no tailscale URL, no panic.\n- `test_tailscale_subprocess_error`: command not found → no tailscale URL, no panic.\n\n## Path safety tests (R1, R2)\n- `test_path_traversal_dotdot`: `/../etc/passwd` → denied.\n- `test_path_traversal_url_encoded_dotdot`: `/%2e%2e/etc/passwd` → denied.\n- `test_path_traversal_slash_encoded`: `/%2e%2e%2fetc%2fpasswd` → denied (slash also URL-encoded).\n- `test_path_traversal_double_encoded`: `/%252e%252e/` → denied.\n- `test_path_traversal_mixed_case_encoding`: `/%2E%2E/` → denied.\n- `test_path_symlink_escape`: in-tree symlink → `/tmp/` → denied (canonicalize re-check).\n- `test_path_in_root_exact`: valid in-root path → resolved.\n\n## Path fallback tests\n- `test_path_extensionless_md_fallback`: `GET /guide` → resolves `guide.md`.\n- `test_path_directory_readme`: `GET /docs/` → resolves `docs/README.md`.\n- `test_path_directory_index`: `GET /docs/` (no README.md) → resolves `docs/index.md`.\n\n## File size limit tests (R5)\n- `test_file_size_limit_exceeded`: file > 16 MB → 413 result.\n- `test_file_size_limit_at_boundary`: file = 16 MB exactly → allowed.\n\n## MIME type tests (R6)\n- `test_mime_png`, `test_mime_svg`, `test_mime_jpg`, `test_mime_gif`, `test_mime_ico`.\n- `test_mime_css`, `test_mime_js`, `test_mime_woff2`, `test_mime_pdf`.\n- `test_mime_unknown_extension`: `.xyz` → `application/octet-stream`.\n\n## Security header tests (R6 - nosniff on all response types)\n- `test_nosniff_on_200`: successful response includes `X-Content-Type-Options: nosniff`.\n- `test_nosniff_on_404`: path-not-found response includes `X-Content-Type-Options: nosniff`.\n- `test_nosniff_on_413`: oversized-file response includes `X-Content-Type-Options: nosniff`.\n\n## HTML injection tests (R3)\n- `test_script_tag_stripped`: `<script>` in Markdown → not in HTML output.\n- `test_style_tag_stripped`: `<style>` in Markdown → not in HTML output.\n\n## Renderer feature tests (phase-1 feature matrix)\n- `test_render_paragraph`: plain text paragraph → output contains `<p>`.\n- `test_render_emphasis`: `*text*` → output contains `<em>`.\n- `test_render_strong`: `**text**` → output contains `<strong>`.\n- `test_render_inline_code`: `` `code` `` → output contains `<code>`.\n- `test_render_normal_link`: `[text](https://example.com)` → output contains `<a href=\"https://example.com\">`.\n- `test_render_fenced_code_language_class`: fenced block with info string `rust` → output contains `class=\"language-rust\"` (or equivalent); validates language hint preserved.\n- `test_render_autolinks`: bare URL `https://example.com` in Markdown body → output contains `<a href=\"https://example.com\">` (GFM autolink extension active).\n- `test_render_blockquote`: `> quoted text` → output contains `<blockquote>`.\n- `test_render_ordered_list`: `1. Item` → output contains `<ol>` and `<li>`.\n- `test_render_unordered_list`: `- Item` → output contains `<ul>` and `<li>`.\n\n## Anchor deduplication tests (R4)\n- `test_anchor_dedup_same_level`: three `## Foo` → `foo`, `foo-1`, `foo-2`.\n- `test_anchor_dedup_mixed_levels`: `## Foo` then `### Foo` → `foo`, `foo-1` (no collision sharing).\n- `test_anchor_no_collision_different_text`: `## Foo` then `## Bar` → `foo`, `bar`.\n\n## Link rewriting tests\n- `test_link_rewrite_relative_md`: `[t](other.md)` → href becomes root-relative `/other.md`.\n- `test_link_rewrite_subdirectory_md`: `[t](subdir/page.md)` from root-level file → root-relative href `/subdir/page.md` (validates subdirectory path construction).\n- `test_link_rewrite_nested_relative`: `[t](../doc.md)` → resolved correctly relative to current file directory; result is root-relative within serve_root.\n- `test_link_rewrite_external_unchanged`: `https://example.com/page.md` → unchanged.\n- `test_link_rewrite_fragment_only`: `#section` → unchanged.\n- `test_link_rewrite_fragment_preserved`: `doc.md#section` → fragment preserved.\n- `test_link_in_code_block_not_rewritten`: link in fenced code block → unchanged.\n- `test_link_rewrite_above_root_does_not_escape`: `[t](../../outside.md)` from `docs/subdir/page.md` → resulting href does not reference content above serve_root.\n\n## ETag tests (bd-22o)\n- `test_etag_deterministic`: same bytes → same ETag.\n- `test_etag_differs_on_change`: different bytes → different ETag.\n\n## Acceptance Criteria\n- All unit tests pass in CI (`cargo test`).\n- No test passes vacuously; each has meaningful assertions.\n- All scenario names are descriptive enough to diagnose failure without reading the test body.\n- Cargo.toml dependency audit completed; binary size delta ≤500 KB.\n\n## Verification Steps\n- Run `cargo test`; all listed test functions must exist and pass.\n- `cargo test 2>&1 | grep -E 'test .* ok|FAILED'` must show all listed tests passing.\n- Verify `cargo build --release` binary size delta ≤500 KB vs. pre-comrak baseline (R10).","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-24T04:51:17.855359180Z","created_by":"exedev","updated_at":"2026-02-24T22:11:47.814296452Z","closed_at":"2026-02-24T22:11:47.814247486Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2l9","depends_on_id":"bd-1mz","type":"blocks","created_at":"2026-02-24T04:51:23.276769482Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-2l9","depends_on_id":"bd-1p6","type":"blocks","created_at":"2026-02-24T04:51:24.286440326Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-2l9","depends_on_id":"bd-22o","type":"blocks","created_at":"2026-02-24T05:41:12.832675975Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-2l9","depends_on_id":"bd-2f2","type":"parent-child","created_at":"2026-02-24T06:24:48.204860877Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-2l9","depends_on_id":"bd-3kq","type":"blocks","created_at":"2026-02-24T04:51:23.544556465Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-2l9","depends_on_id":"bd-ezg","type":"blocks","created_at":"2026-02-24T04:51:24.035401190Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-2l9","depends_on_id":"bd-mzl","type":"blocks","created_at":"2026-02-24T04:51:23.786420830Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-2n4","title":"Serve5-05: HTML shell, sticky TOC UI, assets, and raw mode","description":"## Objective\nBuild page shell with persistent sticky TOC, active heading highlight via IntersectionObserver, embedded static assets, and ?raw=1 raw mode.\n\n## Implementation Details\n- HTML shell template in src/html.rs: full <!DOCTYPE html> with <head> (charset, viewport, CSS link) and <body> (header, TOC sidebar, content area).\n- Header displays: mdmd serve branding and current file path relative to serve_root.\n- TOC sidebar: sticky, left-aligned, generated from Vec<HeadingEntry>; links use #anchor-id fragments.\n- Active heading: mdmd.js uses IntersectionObserver with rootMargin: '0px 0px -80% 0px' to detect topmost visible heading; applies .active CSS class to corresponding TOC link.\n- Mermaid init entrypoint in mdmd.js: call mermaid.initialize({ startOnLoad: true }) after DOM ready. Note: the Mermaid CDN script tag is added by bd-2se; this bead only creates the JS init call stub.\n- Serve /assets/mdmd.css and /assets/mdmd.js from include_str! embedded constants in src/web_assets.rs.\n- ?raw=1 query param: return Markdown source as text/plain; charset=utf-8, bypassing HTML rendering.\n- CSS: responsive two-column layout (TOC + content), GitHub-inspired code/table styles, sticky TOC via position:sticky.\n- Request log includes mode=rendered or mode=raw per request.\n\n## Acceptance Criteria\n- TOC visible; active section updates while scrolling (IntersectionObserver).\n- ?raw=1 returns Markdown source with Content-Type: text/plain.\n- /assets/mdmd.css and /assets/mdmd.js serve with correct MIME types.\n- Header includes current file path context.\n- Rendered HTML shell contains a <script> tag that loads /assets/mdmd.js.\n\n## Verification Steps\n- Integration: GET / returns HTML with <nav> containing TOC links.\n- Integration: GET /?raw=1 returns Content-Type: text/plain and Markdown source.\n- Integration: GET /assets/mdmd.css returns Content-Type: text/css.\n- Integration: GET /assets/mdmd.js returns Content-Type: text/javascript and non-empty body.\n- Integration: rendered HTML page contains a <script> tag referencing /assets/mdmd.js (asset link must be present; Mermaid CDN <script> presence is verified in bd-2se, not here).\n- Log: [request] path=/ mode=rendered and [request] path=/ mode=raw per request type.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-24T04:49:17.745129387Z","created_by":"exedev","updated_at":"2026-02-24T06:59:58.790675533Z","closed_at":"2026-02-24T06:59:58.790653986Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2n4","depends_on_id":"bd-2f2","type":"parent-child","created_at":"2026-02-24T06:24:49.768696785Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-2n4","depends_on_id":"bd-mzl","type":"blocks","created_at":"2026-02-24T04:49:20.920224293Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-2rl","title":"Project scaffolding: Cargo project with ratatui/crossterm TUI skeleton","description":"Initialize the Rust project with Cargo.toml including dependencies: ratatui, crossterm, pulldown-cmark, clap. Create a minimal main.rs that initializes the terminal with crossterm, enters raw mode, sets up the ratatui event loop, renders an empty screen, and exits cleanly on 'q'. This is the foundation all other features build on.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-02-21T00:28:50.541913395Z","created_by":"exedev","updated_at":"2026-02-21T00:34:03.113219904Z","closed_at":"2026-02-21T00:34:03.113164879Z","close_reason":"Scaffolded Cargo project with ratatui/crossterm TUI skeleton","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-2se","title":"Serve5-08: Mermaid placeholder SSR and client hydration","description":"## Objective\nSupport Mermaid in phase 1 with SSR placeholders and client hydration only; no Node/headless-browser dependency.\n\n## Implementation Details\n- During comrak AST traversal, detect fenced code blocks with language='mermaid' (case-insensitive).\n- Replace mermaid fences with <pre class=\"mermaid\">...</pre> where content is HTML-escaped diagram source (do not inject raw Mermaid source without escaping).\n- Non-mermaid fenced code blocks are rendered via standard comrak code block output (unchanged).\n- In mdmd.js, initialize Mermaid client-side: load Mermaid from CDN (specific pinned version, e.g., https://cdn.jsdelivr.net/npm/mermaid@10.x.y/dist/mermaid.min.js) and call mermaid.initialize({ startOnLoad: true, theme: 'default' }).\n- Mermaid CDN script tag included in HTML shell unconditionally (small overhead, avoids conditional complexity).\n- Document the pinned CDN version in a code comment in web_assets.rs or html.rs, including the rationale for the chosen version.\n\n## Acceptance Criteria\n- Mermaid fences render <pre class=\"mermaid\"> placeholder with escaped diagram source.\n- Non-Mermaid fences unchanged by the Mermaid detection pass.\n- Client-side hydration initializes without console errors on a page with a Mermaid diagram.\n- Mermaid CDN <script> tag uses a specific pinned version (must NOT use @latest or an unresolvable range); the pinned version is documented in a code comment.\n\n## Verification Steps\n- Unit: fenced block language 'mermaid' → output contains <pre class=\"mermaid\">.\n- Unit: diagram source containing <> → HTML-escaped (&lt;&gt;) in output.\n- Unit: fenced block language 'rust' → code block, NOT mermaid placeholder.\n- Unit: fenced block language 'MERMAID' (uppercase) → also detected as mermaid.\n- Integration: GET page with mermaid diagram → HTML response contains class=\"mermaid\".\n- Integration: Mermaid CDN <script> tag present in HTML shell and URL contains a pinned semver (e.g., matches regex `mermaid@\\d+\\.\\d+`).\n- Browser e2e (optional manual): mermaid renders as SVG, no console errors.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-24T04:50:13.746249600Z","created_by":"exedev","updated_at":"2026-02-24T22:09:43.434335629Z","closed_at":"2026-02-24T22:09:43.434310034Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2se","depends_on_id":"bd-2f2","type":"parent-child","created_at":"2026-02-24T06:24:53.407176980Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-2se","depends_on_id":"bd-2n4","type":"blocks","created_at":"2026-02-24T04:50:17.431484725Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-2se","depends_on_id":"bd-mzl","type":"blocks","created_at":"2026-02-24T04:50:17.191235932Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-2uj","title":"Compute and expose entry_url_path; print pathful startup URLs","description":"Objective and scope:\n- Add `entry_url_path` to server state and compute it once at startup from resolved entry file.\n- Update startup output so the primary URL includes the document path and also prints a root index URL.\n\nImplementation details:\n- Extend `AppState` with `entry_url_path: String`.\n- After resolving the entry file under canonical root, derive URL path by:\n  1) stripping canonical root prefix,\n  2) converting separators to `/`,\n  3) percent-encoding each path segment,\n  4) prepending `/`.\n- Preserve startup rejection for entry paths outside `serve_root`.\n- If user passed a directory, keep existing directory-to-entry fallback, then compute URL from resolved file.\n- Startup output should clearly print both:\n  - primary entry URL (pathful)\n  - root index URL (`/`)\n\nDependency links:\n- Depends on epic only.\n- Blocks routing and docs tasks that consume startup URL semantics.\n\nAcceptance criteria:\n- `AppState` exposes stable `entry_url_path` for handlers/templates.\n- Startup log/output always includes both URLs with correct host/port and percent-encoding.\n- Paths with spaces/unicode produce valid encoded URLs.\n\nTest requirements (unit and e2e, with logging expectations):\n- Unit: test entry URL path derivation, including nested paths, spaces, unicode, and directory-entry resolution.\n- E2E: run `mdmd serve playground/README.md`; verify startup text includes both URLs and primary URL contains `/playground/README.md`.\n- Logging: verify startup output includes deterministic labels for both URLs and no warning/error logs during successful startup.\n\n## Verification Steps\n- Run unit tests for entry URL derivation including nested paths, spaces, unicode, and directory-entry resolution.\n- Run mdmd serve playground/README.md and verify startup output prints both primary pathful URL and root index URL with deterministic labels.\n- Run startup path under RUST_LOG=debug and confirm successful startup emits no unexpected WARN/ERROR.","acceptance_criteria":"1) AppState exposes stable entry_url_path for handlers/templates. 2) Startup log/output always includes both primary pathful entry URL and root index URL with correct host/port and percent-encoding. 3) Paths with spaces/unicode produce valid encoded URLs and entry-outside-root remains rejected at startup.","notes":"percent_encode_segment helper spec: encode each byte that is not an unreserved URI character (ALPHA/DIGIT/-._~) as %XX uppercase hex. Test vectors: 'hello' -> 'hello', 'my file' -> 'my%20file', 'path/seg' should NOT be called on full paths (only per-segment). entry_url_path for 'playground/README.md' with CWD='/workspace' -> '/playground/README.md'. entry_url_path for 'docs/my notes/guide.md' -> '/docs/my%20notes/guide.md'. Entry outside CWD: fail at startup with clear error message including both paths.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-24T22:57:01.706609912Z","created_by":"exedev","updated_at":"2026-02-24T23:26:26.225472419Z","closed_at":"2026-02-24T23:08:22.906959042Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":2,"issue_id":"bd-2uj","author":"Peter Schilling","text":"Intent: make startup navigation deterministic by computing a canonical, encoded path once and reusing it. Constraint: do not loosen outside-root rejection; directory input should still resolve using existing fallback rules before URL derivation.","created_at":"2026-02-24T22:57:34Z"},{"id":13,"issue_id":"bd-2uj","author":"Peter Schilling","text":"CRITICAL implementation gap: serve_root must change from entry_file.parent() to std::env::current_dir(). In run_serve(), the current code computes serve_root = entry_file.parent() (line 721-724 of serve.rs). The plan requires serve_root = canonical CWD so that navigation to sibling/parent directories from a nested entry file works correctly. Concretely: change run_serve() to: (1) let serve_root = std::env::current_dir().unwrap_or_else(|_| PathBuf::from(\".\"));  (2) let canonical_root = std::fs::canonicalize(&serve_root).unwrap_or_else(|_| serve_root.clone()); (3) validate that canonical entry_file starts_with canonical_root, else fail with a clear error. Without this change, serving playground/README.md would make serve_root=playground/ and requests for /playground/ would escape the root. Also add a percent_encode_segment(s: &str) -> String helper that percent-encodes a single URL path segment (spaces, unicode, reserved chars) for building entry_url_path and directory index hrefs. Unit tests must cover: entry_url_path derivation for nested paths, paths with spaces/unicode, directory-entry resolution before URL derivation, and the case where entry is outside CWD (must fail at startup with clear error).","created_at":"2026-02-24T23:00:25Z"},{"id":23,"issue_id":"bd-2uj","author":"Peter Schilling","text":"IMPLEMENTATION STATUS: as of the current working copy, bd-2uj is fully implemented. The following changes are present in src/serve.rs: (1) AppState.entry_url_path: String field added; (2) pub fn percent_encode_segment(s: &str) -> String implemented with unit tests (encode_unreserved_chars_pass_through, encode_space_as_percent20, encode_multibyte_unicode, encode_reserved_url_chars); (3) pub fn derive_entry_url_path(entry_file, canonical_root) -> Result<String, String> implemented with unit tests (url_path_simple_nested, url_path_top_level_file, url_path_entry_equals_root, url_path_deeply_nested, url_path_with_spaces, url_path_with_unicode_segment, url_path_outside_root_is_err); (4) run_serve() uses std::env::current_dir() as serve_root; (5) startup prints 'url:   http://127.0.0.1:{port}{entry_url_path}' and 'index: http://127.0.0.1:{port}/'. All unit tests pass. The test_serve_startup_stdout_format integration test still looks for 'url:   http://' which still matches — but bd-uso/bd-3h2 must also add an assertion for the 'index:' line.","created_at":"2026-02-24T23:11:13Z"}]}
{"id":"bd-30z","title":"Serve5-12: Startup and page-context UX polish","description":"## Objective\nFinalize startup/page context details: print serve_root, entry file, and URL(s) in stable format; display current file path in page header.\n\n## Implementation Details\n- Startup output (written to stdout, stable format):\n    mdmd serve\n    root:  /absolute/path/to/serve_root\n    entry: /absolute/path/to/entry.md\n    url:   http://127.0.0.1:3333\n    url:   http://hostname.ts.net:3333   (only when tailscale available)\n- Each line uses consistent 'key:   value' format with aligned colons.\n- Page header HTML: <header><span class=\"serve-root\">{serve_root}</span> / <span class=\"current-file\">{relative_file_path}</span></header>\n- relative_file_path is current request's resolved file path relative to serve_root.\n- All startup output must be assertable by integration tests via stdout line matching.\n\n## Acceptance Criteria\n- Startup stdout begins with 'mdmd serve' as the literal first line.\n- Startup stdout contains root:, entry:, and at least one url: line in stable format.\n- Page header shows current file relative path.\n- Output consistent regardless of Tailscale availability (localhost URL always present).\n\n## Verification Steps\n- Integration: assert startup stdout first line is exactly 'mdmd serve'.\n- Integration: capture startup stdout, assert lines match expected format with regex.\n- Integration: assert 'root:  /abs/path' line present.\n- Integration: assert 'entry: /abs/path' line present.\n- Integration: assert 'url:   http://127.0.0.1:<port>' line present.\n- Integration: render page, assert <header> contains relative file path.\n- Log: startup diagnostics remain structured for bind/path troubleshooting.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-24T04:50:50.850092495Z","created_by":"exedev","updated_at":"2026-02-24T22:09:17.716946509Z","closed_at":"2026-02-24T22:09:17.716905563Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-30z","depends_on_id":"bd-1mz","type":"blocks","created_at":"2026-02-24T04:50:54.791684786Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-30z","depends_on_id":"bd-2f2","type":"parent-child","created_at":"2026-02-24T06:24:52.338536034Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-30z","depends_on_id":"bd-2n4","type":"blocks","created_at":"2026-02-24T04:50:55.055540943Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-30z","depends_on_id":"bd-3kq","type":"blocks","created_at":"2026-02-24T05:48:00.099260830Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-324","title":"serve2 slice 5: cache + revalidation + compression","description":"## Covered Sections\n- executable-decomposition\n- slice-5-cache-revalidation-and-compression\n- validation-strategy\n- cross-slice-dependencies\n\n## Acceptance Criteria\n- Unchanged requests avoid unnecessary rerender.\n- Revalidation headers are present and `304` works correctly.\n- Compression is applied when client supports it.\n- Concurrent requests do not race or corrupt cache state.\n\n## Verification Steps\n- Run cache unit tests asserting key invalidation on file identity changes and reuse when unchanged.\n- Run HTTP integration tests for `ETag`/`Last-Modified` and conditional `If-None-Match`/`If-Modified-Since` returning `304`.\n- Run compression negotiation tests with `Accept-Encoding: gzip` asserting compressed text responses.\n- Run concurrency stress test with parallel requests to same document asserting deterministic responses.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T06:57:34.192977685Z","created_by":"exedev","updated_at":"2026-02-24T00:11:18.383144730Z","closed_at":"2026-02-24T00:11:18.383125757Z","close_reason":"Cleaning up for fresh start","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-324","depends_on_id":"bd-18i","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-39a","title":"serve2 slice 6: tailscale + bind host policy","description":"## Covered Sections\n- executable-decomposition\n- slice-6-tailscale-discovery-bind-host-policy-and-startup-url-selection\n- dependencies-and-implementation-notes\n- validation-strategy\n- cross-slice-dependencies\n- gate-a-approval-checklist\n\n## Acceptance Criteria\n- Bind host follows the 3-case policy in the plan.\n- Tailscale DNS URL is primary when available.\n- Localhost URL is always printed.\n- Missing/broken/hanging tailscale command never blocks startup.\n\n## Verification Steps\n- Run unit tests for host-selection decision table (explicit host, tailscale present, tailscale absent).\n- Run subprocess timeout/error-path tests with mocked `tailscale status --json` outputs (valid, invalid, timeout).\n- Run startup output tests asserting deterministic URL ordering and localhost inclusion.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T06:57:34.298549250Z","created_by":"exedev","updated_at":"2026-02-24T00:11:17.660230894Z","closed_at":"2026-02-24T00:11:17.660205768Z","close_reason":"Cleaning up for fresh start","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-39a","depends_on_id":"bd-28p","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-39h","title":"Terminal resize handling and responsive layout","description":"Ensure the application handles terminal resize events gracefully. When the terminal is resized, the content should reflow, scroll position should be maintained (or adjusted to stay reasonable), and all modals should re-center. Also handle very small terminal sizes gracefully (show a 'terminal too small' message if below minimum size).","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-21T00:28:54.074687071Z","created_by":"exedev","updated_at":"2026-02-21T01:42:43.778412177Z","closed_at":"2026-02-21T01:42:43.778367121Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-39h","depends_on_id":"bd-1by","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-39h","depends_on_id":"bd-267","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-39z","title":"Serve5-11: Integration and e2e test suite for mdmd serve","description":"## Objective\nComprehensive end-to-end coverage for serve behavior, security, rendering, navigation, cache semantics, MIME correctness, and legacy CLI compatibility.\n\n## Implementation Details\n- Tests live in tests/serve_integration.rs using reqwest (blocking) as HTTP client and std::process::Command to spawn mdmd binary.\n- Each test spawns server on random available port, performs HTTP requests, asserts on status/headers/body.\n- Fixtures: temp dir with test Markdown files (table, task list, mermaid block, relative links, oversized stub, symlink pointing outside root) created before each test; cleaned up after.\n- Detailed logging: each test prints `[TEST] scenario=<name> port=<port>` before requests. Failed assertions include full response body and headers.\n- Port selection: use `TcpListener::bind(\"127.0.0.1:0\")` to get free port before spawning binary with `--port <free_port>` and `--bind 127.0.0.1` to restrict to loopback.\n- Use `std::thread::sleep` with a reasonable startup wait (or retry loop with timeout) before making requests.\n\n## Coverage map (each is a separate #[test])\n- `test_serve_basic_html`: GET / → 200, HTML, Content-Type: text/html.\n- `test_serve_toc_present`: HTML response contains `<nav>` with TOC links.\n- `test_serve_raw_mode`: GET `/?raw=1` → Content-Type: text/plain, Markdown source.\n- `test_serve_table_rendered`: HTML contains `<table>` for GFM table fixture.\n- `test_serve_task_list_rendered`: HTML contains `<input type=\"checkbox\">`.\n- `test_serve_mermaid_placeholder`: HTML contains `class=\"mermaid\"` for mermaid fixture.\n- `test_serve_mermaid_cdn_script`: HTML contains Mermaid CDN `<script>` tag with pinned semver URL.\n- `test_serve_local_md_link_resolves`: GET link target → 200.\n- `test_serve_traversal_denied`: GET `/../etc/passwd` → 404.\n- `test_serve_url_encoded_traversal_denied`: GET `/%2e%2e/etc/passwd` → 404.\n- `test_serve_symlink_escape_denied`: symlink in root → outside path → 404.\n- `test_serve_extensionless_resolves`: GET `/guide` → 200 (resolves guide.md).\n- `test_serve_directory_readme_resolves`: GET `/subdir/` → 200 (resolves subdir/README.md).\n- `test_serve_directory_index_resolves`: GET `/subdir/` when README.md absent but index.md present → 200 (resolves subdir/index.md).\n- `test_serve_static_asset_image`: GET `/image.png` → 200, Content-Type: image/png.\n- `test_serve_nosniff_header`: X-Content-Type-Options: nosniff present on 200, 404, AND 413 responses (all three must be checked in this test or split into sub-assertions).\n- `test_serve_etag_present`: response includes `ETag` header.\n- `test_serve_304_on_etag_match`: GET with `If-None-Match: <etag>` → 304, empty body.\n- `test_serve_200_on_etag_mismatch`: GET with `If-None-Match: <wrong-etag>` → 200, full response body (non-matching ETag must NOT suppress full response).\n- `test_serve_304_on_modified_since`: GET with `If-Modified-Since: <date newer than file mtime>` → 304, empty body.\n- `test_serve_200_on_modified_since_older`: GET with `If-Modified-Since: <date older than file mtime>` → 200, full response body (file was modified after the request date, so must not return 304).\n- `test_serve_compression_gzip`: GET with `Accept-Encoding: gzip` → `Content-Encoding: gzip`.\n- `test_serve_compression_br`: GET with `Accept-Encoding: br` → `Content-Encoding: br`.\n- `test_serve_file_too_large`: oversized file (> 16 MB) → 413.\n- `test_serve_script_stripped`: page with `<script>` in Markdown → not in HTML response body.\n- `test_serve_startup_stdout_format`: capture stdout, assert: first line is 'mdmd serve', then 'root:', 'entry:', and 'url:' lines present in that order.\n- `test_serve_assets_css`: GET `/assets/mdmd.css` → 200, Content-Type: text/css.\n- `test_serve_assets_js`: GET `/assets/mdmd.js` → 200, Content-Type: text/javascript.\n- `test_legacy_cli_tui_path`: spawn `mdmd <file>` (no subcommand) → TUI mode dispatched, not serve. May require a non-interactive assertion (check process behavior, not terminal output).\n- `test_serve_graceful_shutdown`: send SIGINT to server process → exits with code 0.\n\n## Acceptance Criteria\n- All integration/e2e test functions pass with `cargo test --test serve_integration`.\n- Traversal and symlink denial tests confirm no file content leaked outside root.\n- Legacy CLI test confirms TUI path not regressed.\n- Pre-Merge Operational Checklist items covered by corresponding test functions.\n- Both conditional request cases tested: matching (304) and non-matching (200).\n- Both compression encodings tested independently: gzip and brotli.\n- nosniff header verified on 200, 404, and 413 response types.\n\n## Verification Steps\n- `cargo test --test serve_integration 2>&1`; all listed test names appear as ok.\n- Failed tests print `[TEST] scenario=<name>` plus full response context for diagnosis.\n- Run checklist: `cargo build --release`, `cargo clippy -- -D warnings`, `cargo fmt --check`, `cargo test`.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-24T04:51:47.387327453Z","created_by":"exedev","updated_at":"2026-02-24T22:19:38.359421935Z","closed_at":"2026-02-24T22:19:38.359387757Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-39z","depends_on_id":"bd-1mz","type":"blocks","created_at":"2026-02-24T04:51:53.763333091Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-39z","depends_on_id":"bd-1p6","type":"blocks","created_at":"2026-02-24T04:51:54.863487637Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-39z","depends_on_id":"bd-22o","type":"blocks","created_at":"2026-02-24T04:51:55.428642701Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-39z","depends_on_id":"bd-2f2","type":"parent-child","created_at":"2026-02-24T06:24:47.672297126Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-39z","depends_on_id":"bd-2n4","type":"blocks","created_at":"2026-02-24T04:51:54.326229413Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-39z","depends_on_id":"bd-2se","type":"blocks","created_at":"2026-02-24T04:51:55.140164297Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-39z","depends_on_id":"bd-30z","type":"blocks","created_at":"2026-02-24T04:51:55.721524335Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-39z","depends_on_id":"bd-3kq","type":"blocks","created_at":"2026-02-24T04:51:54.054948577Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-39z","depends_on_id":"bd-ezg","type":"blocks","created_at":"2026-02-24T04:51:54.585946730Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-3ci","title":"Implement directory index renderer policy (sort/filter/symlink/breadcrumbs)","description":"Implement directory index rendering for navigable folder requests that have no markdown fallback, plus the special GET / root early-exit.\n\nObjective and scope:\n- Add fn render_directory_index_response(state: &Arc<AppState>, dir_path: &Path, url_prefix: &str) -> Response that renders an HTML directory listing.\n- This function is used in TWO places in the handler:\n  (A) GET / early-exit (before resolve_candidate): always render directory index for serve_root.\n  (B) After resolve_candidate returns None: if metadata shows candidate is_dir, render directory index.\n\nImplementation details:\n- Handler structure (see also bd-uso for the GET / early-exit):\n    // (A) Root early-exit — always show directory index for serve_root.\n    if normalized == PathBuf::new() {\n        return render_directory_index_response(&state, &state.canonical_root, \"/\").await;\n    }\n    // (B) General pipeline.\n    let candidate = state.serve_root.join(&normalized);\n    match resolve_candidate(&candidate).await {\n        Some(resolved) => { /* serve file as before */ }\n        None => {\n            if let Ok(meta) = tokio::fs::metadata(&candidate).await {\n                if meta.is_dir() {\n                    return render_directory_index_response(&state, &candidate, &norm_display).await;\n                }\n            }\n            return rich_not_found_response(&state, &norm_display).await;\n        }\n    }\n- Sorting policy: directories first, then files; each group case-insensitive alphabetical.\n- Hidden entries policy: exclude entries whose name begins with '.'.\n- Symlink policy: include only if tokio::fs::canonicalize(entry) starts_with canonical_root; omit otherwise.\n- Breadcrumbs: build from url_prefix split by '/', each segment links back to its path. Root segment links to /.\n- Href encoding: encode each path segment with percent_encode_segment() individually, not the full path.\n- For directory paths that DO have README.md or index.md, resolve_candidate returns that file — directory index is NOT rendered for those paths (this is for path (B); path (A) always renders root index regardless).\n- Reuse the listing logic as a shared helper so bd-3u5 can call the same sort/filter/encode code.\n\nDependency links:\n- Depends on bd-uso (handler restructuring) and bd-2uj (percent_encode_segment).\n- Blocks bd-3u5, bd-3h2, bd-16x.\n\n## Acceptance Criteria\n- Shared directory-listing renderer is used for both root index and directory-path index responses, with deterministic ordering and per-segment URL encoding.\n- Listing policy is enforced: directories-first alpha sort, files alpha sort, dotfiles omitted, out-of-root symlinks omitted.\n- Breadcrumb links are correct for nested paths and root breadcrumb always points to `/`.\n- Unit tests cover listing-sort/filter/symlink decisions plus href segment encoding edge cases (spaces/unicode/reserved chars).\n- E2E scriptable checks validate root and nested directory index behavior with debug logging: `RUST_LOG=debug cargo test --test serve_integration test_serve_directory_index_policies -- --nocapture`.\n- Logs include index-render branch context (`path`, `entries`) and emit no unexpected `WARN`/`ERROR` on valid requests.\n\n## Verification Steps\n- Run unit tests covering sort/filter/symlink/breadcrumb/encoding policy helpers.\n- Run: RUST_LOG=debug cargo test --test serve_integration test_serve_directory_index_policies -- --nocapture.\n- Confirm rendered HTML shows deterministic ordering and logs include directory-index path + entry-count context without unexpected WARN/ERROR.","acceptance_criteria":"1) A shared directory-listing renderer is used by both GET / root early-exit and non-root directory index responses after unresolved candidate checks. 2) Listing policy is deterministic: directories first, then files; case-insensitive alpha sort within each group; dotfiles omitted; out-of-root symlinks omitted; in-root symlinks retained. 3) Breadcrumbs are correct for nested paths and root always links to /. 4) Hrefs are built by per-segment percent encoding (not whole-path encoding), including spaces, unicode, and reserved-character segments. 5) Unit tests comprehensively cover sort/filter/symlink/breadcrumb/encoding behaviors, including edge cases. 6) Integration tests validate root and nested index pages and confirm policy markers in rendered HTML. 7) E2E script coverage is added/extended in tests/e2e_serve_navigation.sh with directory-index scenarios and detailed step/log output. 8) Logs include directory-index branch context (requested path and entry count) and no unexpected WARN/ERROR on valid index requests.","notes":"Directory listing HTML structure: breadcrumb nav showing path segments as links (root -> dir1 -> dir2); entries list with icons or text markers for dirs vs files; each entry href is /path/to/dir/entry-name (percent-encoded); trailing slash on directory hrefs for clean navigation. Reuse the listing function in bd-3u5 (nearest-parent listing) to avoid duplicate sort/filter logic. Rust readdir: use tokio::fs::read_dir() and collect entries before sorting. Handle read_dir error gracefully by returning 500 or falling through to 404 rather than panicking.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-24T22:57:02.282636927Z","created_by":"exedev","updated_at":"2026-02-24T23:49:59.075456031Z","closed_at":"2026-02-24T23:49:59.075415112Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3ci","depends_on_id":"bd-2uj","type":"blocks","created_at":"2026-02-24T23:04:10.079782228Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3ci","depends_on_id":"bd-uso","type":"blocks","created_at":"2026-02-24T22:57:15.122871685Z","created_by":"exedev","metadata":"{}","thread_id":""}],"comments":[{"id":4,"issue_id":"bd-3ci","author":"Peter Schilling","text":"Policy note: directory listings are a product surface, not just debugging output. Enforce stable ordering/filtering to keep tests deterministic and UX predictable; omit out-of-root symlink targets to maintain boundary guarantees.","created_at":"2026-02-24T22:57:35Z"},{"id":22,"issue_id":"bd-3ci","author":"Peter Schilling","text":"Handler pipeline correction for GET /: the plan's workflow diagram shows GET / as a SEPARATE early branch that always renders the root directory index, distinct from the general GET /<path> pipeline. This means the implementation MUST NOT let GET / fall through to resolve_candidate (which would find serve_root/README.md and serve it instead of the index). The handler structure must be:\n\n  // Early-exit for root: always show root directory index.\n  if normalized == PathBuf::new() {\n      return render_directory_index_response(&state, &state.canonical_root, \"/\").await;\n  }\n  // General pipeline for all other paths:\n  let candidate = state.serve_root.join(&normalized);\n  match resolve_candidate(&candidate).await {\n      Some(resolved) => { /* serve file */ }\n      None => {\n          // Check if candidate is a directory → render index.\n          if let Ok(meta) = tokio::fs::metadata(&candidate).await {\n              if meta.is_dir() {\n                  return render_directory_index_response(&state, &candidate, &norm_display).await;\n              }\n          }\n          // Not a directory → rich 404.\n          return rich_not_found_response(&state, &norm_display).await;\n      }\n  }\n\nThe render_directory_index_response() function is shared by both the root-early-exit and the general is_dir branch.","created_at":"2026-02-24T23:10:34Z"}]}
{"id":"bd-3fa","title":"Add focused logging instrumentation for serve resolution branches","description":"Objective and scope:\n- Add explicit logging/observability expectations around path resolution and navigation outcomes to support debugging.\n- Keep instrumentation minimal, structured, and local-tool oriented.\n\nImplementation details:\n- Emit startup log with canonical serve root + pathful entry URL in one structured line, for example: [serve] serve_root=<...> entry_url_path=<...>.\n- Emit one structured request-outcome line per successful/expected branch:\n  - markdown served,\n  - static asset served,\n  - directory index rendered (include entries=<count>),\n  - rich 404 rendered (include nearest_parent=<...>).\n- Preserve existing resolver branch logging ([resolve] ...) and avoid duplicate noisy lines.\n- Keep expected-miss behavior non-error: rich 404 is INFO/DEBUG, not ERROR.\n- Keep traversal/invalid-input denials terse and log only minimal diagnostic context.\n\nDependency links:\n- Depends on routing/index/404 implementation tasks.\n- Supports integration and e2e logging assertions.\n\nTest requirements (unit and e2e, with logging expectations):\n- Unit: validate any helper that builds normalized/encoded fields used in structured logs.\n- Integration: capture stderr in tests/serve_integration.rs and assert required structured log keys per branch.\n- E2E scripts: extend tests/e2e_serve_navigation.sh with a dedicated logging-signatures section that runs targeted requests under RUST_LOG=debug, writes logs to an artifact file, and asserts required signatures with rg.\n\n## Verification Steps\n- Run targeted integration tests while capturing stderr and assert startup and branch-outcome log signatures exist.\n- Run tests/e2e_serve_navigation.sh logging-signatures section to validate required keys with rg.\n- Confirm expected 404 paths log at INFO/DEBUG and genuine failures are the only WARN/ERROR events.","acceptance_criteria":"1) Startup logs include serve_root and entry_url_path in a stable, parseable structured format. 2) Request-resolution logs emit one final branch-outcome line for markdown/static/directory-index/rich-404 with normalized path context. 3) Directory-index logs include entry-count metadata and rich-404 logs include nearest-parent metadata. 4) Expected 404 handling logs at INFO/DEBUG (not ERROR); WARN/ERROR are reserved for genuine failures. 5) Unit tests cover helper logic used to build structured log metadata where such helpers exist. 6) Integration tests assert presence of required branch log signatures by capturing server stderr. 7) tests/e2e_serve_navigation.sh contains a logging-signatures step that validates required log lines via rg and prints artifact locations for debugging.","status":"closed","priority":2,"issue_type":"chore","created_at":"2026-02-24T22:57:03.777721989Z","created_by":"exedev","updated_at":"2026-02-25T00:01:20.093506497Z","closed_at":"2026-02-25T00:01:20.093454975Z","close_reason":"Added all four structured log lines per spec","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3fa","depends_on_id":"bd-2uj","type":"blocks","created_at":"2026-02-24T23:04:10.369332895Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3fa","depends_on_id":"bd-3ci","type":"blocks","created_at":"2026-02-24T22:57:16.582041835Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3fa","depends_on_id":"bd-3u5","type":"blocks","created_at":"2026-02-24T22:57:16.883548631Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3fa","depends_on_id":"bd-uso","type":"blocks","created_at":"2026-02-24T22:57:16.275767501Z","created_by":"exedev","metadata":"{}","thread_id":""}],"comments":[{"id":9,"issue_id":"bd-3fa","author":"Peter Schilling","text":"Logging is for diagnosis of path resolution decisions. Capture branch outcome and relevant normalized path context at info/debug levels; expected 404 flows are not errors.","created_at":"2026-02-24T22:57:36Z"},{"id":18,"issue_id":"bd-3fa","author":"Peter Schilling","text":"Logging integration notes: with the new handler pipeline (markdown -> static asset -> directory index -> rich 404), add structured log lines for each branch outcome. Recommended format for new branches: '[request] path={norm_display} mode=directory_index entries={count}' and '[request] path={norm_display} mode=rich_404 nearest_parent={parent_path}'. Startup logs should emit: '[serve] serve_root={canonical_root} entry_url_path={entry_url_path}' so operators can confirm CWD-based root is correct. The existing '[resolve] path=... branch=...' format is preserved for existing branches. Integration tests in bd-3h2 should capture stderr and assert these log lines are present on successful and 404 paths.","created_at":"2026-02-24T23:01:37Z"}]}
{"id":"bd-3h2","title":"Expand integration test matrix for serve navigation flows","description":"Build a comprehensive integration/e2e test matrix for the new serve UX behavior. This bead is the cross-feature acceptance gate from root navigation through broken-link recovery.\n\nImplementation details:\n- Keep the existing real-binary subprocess pattern in `tests/serve_integration.rs` (`Command::new(bin_path())` + reqwest client). Do not switch to `axum` TestClient/`tower::ServiceExt`.\n- Server subprocesses must run with `.current_dir(&fixture.root)` so CWD-root semantics are exercised against temp fixtures.\n- Extend integration tests to cover:\n  - `GET /` returns root directory index HTML (not entry markdown).\n  - Root index links to the entry document; following link returns rendered markdown HTML (`200`, `text/html`).\n  - Relative markdown links resolve to root-relative hrefs and remain reachable.\n  - Directory index policies: breadcrumbs, dirs-before-files ordering, dotfiles excluded, out-of-root symlinks omitted.\n  - Rich 404 page: `404`, HTML content type, requested path shown, nearest-parent recovery link, entry link, root link.\n  - Embedded assets `/assets/mdmd.css` and `/assets/mdmd.js` remain routable/content-typed correctly.\n- Continue using tempdir `Fixture`/`FixtureOptions`; add options for dotfiles/symlinks/nested structures instead of introducing alternate fixture systems.\n- Keep all integration coverage in `tests/serve_integration.rs`.\n\nDependency links:\n- Depends on bd-uso, bd-3u5, bd-3ci, bd-3fa, bd-t6w.\n- Blocks docs/polish closeout.\n\n## Acceptance Criteria\n- Integration suite validates full navigation flow: startup URL lines, root index at `/`, entry navigation, rewritten relative links, directory index policy behaviors, embedded assets, and rich 404 recovery.\n- Fixture strategy stays tempdir-based using `Fixture`/`FixtureOptions` and includes explicit options for dotfiles, symlinks, nested dirs, and link cases.\n- A maintained e2e script exists at `tests/e2e_serve_navigation.sh` with explicit sections: `root-index-flow`, `directory-index-policy`, `link-rewrite-flow`, `rich-404-recovery`, `logging-signatures`.\n- E2E script runs targeted integration tests under `RUST_LOG=debug` with `--nocapture`, writes deterministic log artifacts, and exits non-zero on any assertion failure.\n- Script output includes per-request assertions that report URL, expected status/content marker, and observed result for fast diagnosis.\n- Happy-path scenarios emit no unexpected `WARN`/`ERROR`; expected 404 scenarios include structured recovery context in logs.\n\n## Verification Steps\n- Run: RUST_LOG=debug cargo test --test serve_integration -- --nocapture and verify the expanded matrix passes.\n- Run: bash tests/e2e_serve_navigation.sh and verify required sections (root-index-flow, directory-index-policy, link-rewrite-flow, rich-404-recovery, logging-signatures).\n- Confirm script artifacts are deterministic and include per-step URL/status/content-marker assertions.","acceptance_criteria":"1) Integration suite in tests/serve_integration.rs validates full navigation flow: startup URL lines, root index at /, entry navigation, rewritten relative links, directory index policy behaviors, embedded assets, and rich 404 recovery. 2) Fixture strategy stays tempdir-based using Fixture/FixtureOptions and includes dedicated options for dotfiles, symlinks, nested dirs, and link scenarios. 3) E2E coverage is script-driven and maintained in tests/e2e_serve_navigation.sh with at least these sections: root-index-flow, directory-index-policy, link-rewrite-flow, rich-404-recovery, and logging-signatures. 4) Script runs targeted integration tests under RUST_LOG=debug with --nocapture, exits non-zero on any failed assertion, and writes logs to deterministic artifact paths. 5) Script output includes clear section markers plus per-step request/response assertions that identify failing URL, expected status/content markers, and observed result. 6) Integration + e2e coverage together exercises both happy-path and broken-link-path behavior end-to-end, including recovery links. 7) Happy-path scenarios emit no unexpected WARN/ERROR; expected 404 scenarios include structured recovery context in logs.","status":"open","priority":1,"issue_type":"task","created_at":"2026-02-24T22:57:03.184262094Z","created_by":"exedev","updated_at":"2026-02-24T23:26:08.256736036Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3h2","depends_on_id":"bd-3ci","type":"blocks","created_at":"2026-02-24T22:57:17.184494920Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3h2","depends_on_id":"bd-3fa","type":"blocks","created_at":"2026-02-24T22:57:18.105352783Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3h2","depends_on_id":"bd-3u5","type":"blocks","created_at":"2026-02-24T22:57:17.488760988Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3h2","depends_on_id":"bd-t6w","type":"blocks","created_at":"2026-02-24T22:57:17.793528298Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3h2","depends_on_id":"bd-uso","type":"blocks","created_at":"2026-02-24T23:23:33.179248447Z","created_by":"exedev","metadata":"{}","thread_id":""}],"comments":[{"id":7,"issue_id":"bd-3h2","author":"Peter Schilling","text":"Integration matrix is the release-quality gate for this feature set. Prefer fixture-driven tests that model real navigation hops rather than isolated response checks.","created_at":"2026-02-24T22:57:36Z"},{"id":17,"issue_id":"bd-3h2","author":"Peter Schilling","text":"Fixture inventory: playground/ already contains stable test fixtures. Use these for integration tests: playground/README.md (entry doc with relative links to other files), playground/links.md (link-rich file), playground/subdir/nested.md (nested markdown with relative links back to parent), playground/subdir/sibling.md. Test scenario matrix for integration suite: (1) GET / returns HTML listing containing 'playground' dir entry; (2) GET /playground/README.md returns rendered HTML; (3) GET /playground/ returns dir index listing links.md, README.md, subdir/, etc.; (4) GET /playground/subdir/ returns dir index with nested.md, sibling.md; (5) GET /playground/subdir/nested.md returns rendered HTML; (6) GET /playground/.hidden (if it exists) returns 404 or is excluded from index; (7) GET /nonexistent/path/file.md returns 404 rich page with /playground/ as nearest parent (or /); (8) /assets/mdmd.css and /assets/mdmd.js return expected content-type. All tests use the actual binary or axum TestClient for real HTTP semantics.","created_at":"2026-02-24T23:01:30Z"},{"id":25,"issue_id":"bd-3h2","author":"Peter Schilling","text":"CLARIFICATION on fixture strategy: the comment above mentioning 'playground/ already contains stable test fixtures — use these for integration tests' is INCORRECT for the integration test suite. Integration tests in tests/serve_integration.rs use temp-dir Fixture instances (via tempfile::tempdir()), NOT the playground/ directory. playground/ files are for manual local testing only (e.g. cargo run serve playground/README.md). The integration tests must create their own controlled fixtures via Fixture::new(opts) and extend FixtureOptions as needed. The playground/ fixture inventory comment describes manual scenarios only, not automated test scenarios. The automated test scenarios are described in the implementation details section of this bead.","created_at":"2026-02-24T23:15:23Z"}]}
{"id":"bd-3jp","title":"serve2 slice 4: heading-first navigation","description":"## Covered Sections\n- executable-decomposition\n- slice-4-heading-first-navigation-ux\n- validation-strategy\n- cross-slice-dependencies\n\n## Acceptance Criteria\n- TOC links map 1:1 to heading IDs.\n- Active section is visually highlighted while scrolling.\n- Duplicate heading text yields stable unique IDs.\n\n## Verification Steps\n- Run slug-generation unit tests for duplicate and punctuation-heavy headings.\n- Run DOM-level tests (or snapshot assertions) verifying TOC anchor/heading ID parity.\n- Run browser integration check asserting active-state class changes while scrolling fixture content.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T06:57:34.095403578Z","created_by":"exedev","updated_at":"2026-02-24T00:11:18.605946485Z","closed_at":"2026-02-24T00:11:18.605921729Z","close_reason":"Cleaning up for fresh start","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3jp","depends_on_id":"bd-18i","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-3kq","title":"Serve5-03: Tailscale-aware startup URL output","description":"## Objective\nAlways print localhost URL on startup; conditionally print Tailscale URL from `.Self.DNSName`.\n\n## Implementation Details\n- Spawn `tailscale status --json` as subprocess; capture stdout.\n- R7 mitigation: parse JSON via `serde_json` using `?`/`Result` propagation only — zero `unwrap()`/`expect()` on tailscale parsing paths. Any parse failure, empty output, or subprocess error is silently treated as 'no Tailscale available'; log at `debug` level with skip reason.\n- Trim trailing `.` from DNSName before printing.\n- Only print Tailscale URL when DNSName is non-empty after trimming.\n- Startup output always includes: `url:   http://127.0.0.1:{port}`\n- When Tailscale available: also print: `url:   http://{tailscale_dns}:{port}`\n\n## Acceptance Criteria\n- Startup never panics or fails due to tailscale errors.\n- URL output policy is deterministic: always localhost, optionally tailscale.\n- All tailscale parse paths use `?`/`Result`; no `unwrap`.\n\n## Verification Steps\n- Unit: valid JSON with DNSName `\"hostname.ts.net.\"` → trimmed URL `http://hostname.ts.net:{port}`.\n- Unit: trailing dot only `\".\"` → treated as empty, no tailscale URL.\n- Unit: empty JSON `{}` or missing `Self` → no tailscale URL, no panic.\n- Unit: malformed JSON → no tailscale URL, no panic.\n- Unit: subprocess failure (command not found) → no tailscale URL, no panic.\n- Integration: start server with environment stub returning valid Tailscale JSON; assert tailscale URL appears in startup output.\n- Integration: start server with environment stub returning invalid JSON; assert only localhost URL appears (no tailscale URL, no crash).\n- Log: `[tailscale] skipped reason=<detail>` at debug level when unavailable.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-24T04:48:41.578140572Z","created_by":"exedev","updated_at":"2026-02-24T07:04:57.643176128Z","closed_at":"2026-02-24T07:04:57.643138391Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3kq","depends_on_id":"bd-1mz","type":"blocks","created_at":"2026-02-24T04:48:44.924382127Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3kq","depends_on_id":"bd-2f2","type":"parent-child","created_at":"2026-02-24T06:24:50.770923572Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-3mx","title":"Relative-link serve UX overhaul","description":"Objective and scope:\n- Deliver the relative-link serving UX overhaul for `mdmd serve <path>` so local doc browsing behaves like filesystem navigation.\n- Scope includes startup URL behavior, path-aware routing, directory index rendering, rich broken-link pages, and full validation coverage.\n- Out of scope: adding a `--root` flag or changing the broader containment/security model beyond current local-tool checks.\n\nImplementation details:\n- Use `serve_root = cwd` and keep containment checks as the base trust boundary.\n- Ensure `entry_url_path` is computed once at startup from canonical entry path relative to canonical root.\n- Keep existing `resolve_candidate()` and `rewrite_local_links()` implementations; focus on integrating behavior with routing and UX.\n- Coordinate child tasks for routing order, index policy, 404 experience, tests, and docs.\n\nDependency links:\n- Parent epic; children are blocked by this issue for structure/traceability.\n\nAcceptance criteria:\n- All child tasks are completed and dependency graph is acyclic.\n- End-to-end flow works: startup prints pathful entry URL + root URL, `/` shows root index, relative links resolve, broken links show rich recovery page.\n- Final behavior matches plan intent without needing to consult `docs/plans/relative-links/plan.md`.\n\nTest requirements (unit and e2e, with logging expectations):\n- Unit: child tasks must include focused unit tests for helper/path logic.\n- E2E/integration: child tasks must include route-level behavior validation from startup URL through navigation.\n- Logging: successful-path tests should observe no `WARN/ERROR`; broken-link scenarios should emit structured request context at `INFO` or `DEBUG` with requested path.\n\n## Success Criteria\n- Child tasks close with no dependency cycles and collectively deliver the planned UX behavior: pathful startup URL, root index at `/`, working relative navigation, directory index policies, and rich 404 recovery.\n- Unit-test coverage exists for path derivation/listing/nearest-parent logic and guards against regressions in fallback or encoding behavior.\n- E2E coverage includes reproducible script-based execution with detailed debug logging for happy path and broken-link path.\n- Release verification runbook includes explicit commands (`cargo test`, targeted integration tests, and e2e script invocations) and expected log signatures.\n\n## Verification Steps\n- Verify all child beads are closed and dependency graph remains acyclic (br dep cycles).\n- Run full verification suite (cargo test, targeted serve integration tests, and tests/e2e_serve_navigation.sh) and confirm expected behavior signatures.\n- Validate release runbook commands and log markers are complete enough for reproducible maintainer validation.","acceptance_criteria":"1) All child tasks complete with an acyclic dependency graph and no scope loss versus the approved relative-link serve UX plan. 2) Delivered behavior is end-to-end consistent: pathful startup entry URL + root index URL, GET / root index, correct relative-link navigation, directory index policy enforcement, and rich 404 recovery UX. 3) Comprehensive automated coverage exists across unit tests, integration tests, and at least one maintained e2e script (tests/e2e_serve_navigation.sh) with detailed logging. 4) Logging expectations are validated: branch-level resolution context is present; happy-path runs avoid unexpected WARN/ERROR; expected 404 flows log structured recovery context at INFO/DEBUG. 5) Release verification runbook includes explicit commands and expected log signatures so maintainers can reproduce behavior without consulting plan docs.","status":"open","priority":1,"issue_type":"epic","created_at":"2026-02-24T22:57:01.431220176Z","created_by":"exedev","updated_at":"2026-02-24T23:25:44.967388119Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3mx","depends_on_id":"bd-16x","type":"blocks","created_at":"2026-02-24T22:57:21.690694419Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3mx","depends_on_id":"bd-2uj","type":"blocks","created_at":"2026-02-24T22:57:19.918097507Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3mx","depends_on_id":"bd-3ci","type":"blocks","created_at":"2026-02-24T22:57:20.520529966Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3mx","depends_on_id":"bd-3fa","type":"blocks","created_at":"2026-02-24T22:57:21.998189257Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3mx","depends_on_id":"bd-3h2","type":"blocks","created_at":"2026-02-24T22:57:21.401707339Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3mx","depends_on_id":"bd-3u5","type":"blocks","created_at":"2026-02-24T22:57:20.816603430Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3mx","depends_on_id":"bd-t6w","type":"blocks","created_at":"2026-02-24T22:57:21.106867297Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3mx","depends_on_id":"bd-uso","type":"blocks","created_at":"2026-02-24T22:57:20.217151538Z","created_by":"exedev","metadata":"{}","thread_id":""}],"comments":[{"id":1,"issue_id":"bd-3mx","author":"Peter Schilling","text":"Maintainer context: this epic is intentionally integration-focused and preserves existing resolver/rewrite internals. The key behavior shift is UX routing ( as root index) and startup URL presentation. Keep scope constrained to local-tool use and existing containment checks.","created_at":"2026-02-24T22:57:34Z"},{"id":10,"issue_id":"bd-3mx","author":"Peter Schilling","text":"Dependency authority: the explicit graph (via br dep) is canonical. Epic depends on all child tasks so work can start with ready leaf tasks and epic closes last.","created_at":"2026-02-24T22:57:49Z"}]}
{"id":"bd-3o8","title":"Link detection, highlighting, and Tab navigation between links","description":"Visually highlight markdown links in the rendered document with a distinct style (underline + color). Implement Tab/Shift-Tab to cycle between links. When a link is focused, show the URL in the status bar. This creates the accessibility-inspired link navigation described in the spec.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-02-21T00:28:52.559065613Z","created_by":"exedev","updated_at":"2026-02-21T01:11:29.365253779Z","closed_at":"2026-02-21T01:11:29.365206792Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3o8","depends_on_id":"bd-1sf","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-3o8","depends_on_id":"bd-p4x","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-3u5","title":"Build rich 404 page with nearest-parent recovery links","description":"Deliver a rich HTML 404 experience for unresolved non-security paths with clear recovery options.\n\nObjective and scope:\n- Replace plain unresolved-path responses with a state-aware HTML 404 renderer for expected misses.\n\nImplementation details:\n- Implement `rich_not_found_response(state: &Arc<AppState>, norm_display: &str) -> Response` that:\n  1) computes nearest existing parent directory under canonical root,\n  2) renders requested path context,\n  3) includes quick links to `state.entry_url_path`, root `/`, and nearest-parent index,\n  4) optionally includes nearest-parent directory listing via the shared directory-listing primitive from bd-3ci.\n- Implement `nearest_existing_parent(state: &Arc<AppState>, norm_display: &str) -> PathBuf` as a deterministic, root-bounded helper.\n- Preserve HTTP `404` status with `Content-Type: text/html; charset=utf-8`.\n- Replace only unresolved non-security `not_found_response()` call sites. Security-denial branches (traversal/null/invalid-encoding/outside-root) must remain terse and non-disclosing.\n- Reuse shared listing/sort/filter/encoding helpers from bd-3ci to avoid policy drift.\n\nDependency links:\n- Depends on bd-3ci and bd-2uj.\n- Blocks bd-3h2, bd-3fa, bd-16x.\n\n## Acceptance Criteria\n- Unresolved non-security paths return HTML 404 (`status=404`, `text/html`) showing requested path, nearest existing parent link, entry-doc link (`entry_url_path`), and root index link.\n- Security denials never use rich 404 rendering and continue returning terse non-disclosing responses.\n- `nearest_existing_parent()` is deterministic, bounded to canonical root, and robust across normalization edge cases.\n- Unit tests comprehensively cover nearest-parent selection: missing leaf, multi-level misses, root fallback, and encoded segment edge cases.\n- Integration tests verify rich-404 link correctness and that following nearest-parent recovery links succeeds when expected.\n- E2E script coverage is present in `tests/e2e_serve_navigation.sh` (`rich-404-recovery` + `logging-signatures` sections) with detailed request/response and log capture.\n- Expected 404 flows log at `INFO`/`DEBUG` with requested-path and nearest-parent fields; no `ERROR` logging for expected misses.\n\n## Verification Steps\n- Run unit tests for nearest_existing_parent edge cases (root fallback, multilevel miss, encoded segments).\n- Run integration tests that request missing paths and follow nearest-parent recovery links.\n- Run e2e rich-404-recovery checks and confirm expected misses log at INFO/DEBUG with requested-path + nearest-parent fields and no ERROR.","acceptance_criteria":"1) Unresolved non-security paths return HTML 404 (status 404, Content-Type text/html) showing requested path, nearest existing parent link, entry document link (entry_url_path), and root index link. 2) Security denials (traversal/null/invalid-encoding/outside-root) continue returning terse non-disclosing responses and never use rich 404 rendering. 3) nearest_existing_parent() is deterministic, root-bounded, and shared safely with listing helpers from bd-3ci. 4) Unit tests comprehensively cover nearest-parent behavior: missing leaf, multi-level miss, root fallback, normalization edge cases, and encoded segment handling. 5) Integration tests validate rich-404 link correctness and recoverability from the nearest parent index. 6) E2E script coverage is added/extended in tests/e2e_serve_navigation.sh for broken-link recovery paths with detailed request/response and log capture. 7) Expected 404 flows log at INFO/DEBUG with requested-path and nearest-parent fields; no ERROR logging for expected misses.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-24T22:57:02.586157854Z","created_by":"exedev","updated_at":"2026-02-24T23:58:23.676833545Z","closed_at":"2026-02-24T23:58:23.676783189Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3u5","depends_on_id":"bd-2uj","type":"blocks","created_at":"2026-02-24T22:57:15.407862905Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-3u5","depends_on_id":"bd-3ci","type":"blocks","created_at":"2026-02-24T22:57:15.699297723Z","created_by":"exedev","metadata":"{}","thread_id":""}],"comments":[{"id":5,"issue_id":"bd-3u5","author":"Peter Schilling","text":"404 UX should optimize recovery speed: always provide context (what was requested) and nearby valid links. Reuse listing utilities where possible so sorting/filtering policy stays consistent between index and 404 pages.","created_at":"2026-02-24T22:57:35Z"},{"id":15,"issue_id":"bd-3u5","author":"Peter Schilling","text":"Implementation note: the current not_found_response() (serve.rs:371-378) returns text/plain 'Not Found'. The rich 404 handler needs access to AppState to get entry_url_path and canonical_root (for nearest-parent resolution). Replace the not_found_response() call in the handler's None branch with a rich_not_found_response(norm_display, &state) that: (1) walks up from the requested path until it finds an existing directory under serve_root, (2) builds breadcrumb and quick links using percent_encode_segment, (3) optionally lists the nearest parent directory using the same listing primitive as the directory index renderer. Unit tests needed for nearest_existing_parent() helper: test cases for missing leaf in existing parent, all ancestors missing (falls back to root), and root-level miss.","created_at":"2026-02-24T23:01:13Z"}]}
{"id":"bd-4yc","title":"serve3 gate A epic: mdmd serve SSR delivery","description":"Objective and Scope:\nDeliver Gate A of mdmd serve as a production-ready SSR markdown web server with deterministic behavior for CLI contract, routing safety, rendering parity baseline, heading-first UX, tailscale-aware startup URLs, and HTTP performance semantics.\n\nImplementation Details:\nCoordinate child slices bd-4yc.1 through bd-4yc.8 as the canonical dependency graph. Keep implementation SSR-first in Rust, preserve existing mdmd file-view behavior, and maintain explicit observability and tests for each behavior contract.\n\nDependency Links:\nRoot epic for all serve3 Gate A tasks and subtasks. Child dependency ordering is expressed via parent-child and blocks edges.\n\nAcceptance Criteria:\nAll child beads are closed; acceptance criteria in docs/plans/serve3/plan.md are met; startup/runtime behavior matches locked Gate A decisions.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nRun full unit and e2e matrix from bd-4yc.8. Validate logs include startup host policy rationale, bind/port selection, resolved root+entry, URL pair, resolver decision path, render/cache/compression decisions, and tailscale probe outcome.\n\nBackground / Rationale / Constraints / Intent:\nThis epic exists so future maintainers can execute Gate A without reopening planning context. Scope is intentionally tight to serve3 requirements and excludes watch mode, sanitize mode, and server-side Mermaid rasterization.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-02-23T21:35:28.887208058Z","created_by":"exedev","updated_at":"2026-02-23T23:49:48.182905036Z","closed_at":"2026-02-23T23:49:48.182884298Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-4yc.1","title":"serve3 slice 1: CLI + bootstrap contract","description":"Objective and Scope:\nImplement mdmd serve command/bootstrap contract while preserving backward-compatible mdmd file invocation behavior.\n\nImplementation Details:\nOwns CLI/runtime bootstrap and startup lifecycle: declared options, default port 3333 behavior, bounded AddrInUse increment policy, graceful Ctrl-C/SIGTERM shutdown, and deterministic startup summary outputs.\n\nDependency Links:\nParent: bd-4yc. Blocks bd-4yc.2 (routing) and bd-4yc.7 (tailscale URL policy). Child chain: bd-4yc.1.1 -> bd-4yc.1.2 -> bd-4yc.1.3.\n\nAcceptance Criteria:\nCLI contract is stable and documented by tests; bind retry behavior is bounded and reasoned; startup output contains contract fields consumed by validation tasks.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit: flag parsing/defaults, invalid input handling, retry cap behavior, startup formatter.\nE2E: occupied-port retries, shutdown on signal, startup output contract checks.\nLogging: bind retry reason classes, final bind target, and shutdown trigger classification.\n\nBackground / Rationale / Constraints / Intent:\nThis slice establishes operator-facing startup behavior for every downstream slice. Keep it deterministic so later routing/render/perf tasks can rely on stable startup semantics.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-23T21:35:29.005896034Z","created_by":"exedev","updated_at":"2026-02-23T23:49:47.964233982Z","closed_at":"2026-02-23T23:49:47.964202975Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.1","depends_on_id":"bd-4yc","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.1.1","title":"serve3 subtask: CLI arg surface + backward compatibility","description":"Objective and Scope:\nImplement parser and command wiring for mdmd serve path while preserving mdmd file invocation behavior.\n\nImplementation Details:\nAdd and validate options --port, --host, --root, --open, --no-tailscale, and --mermaid-mode; ensure legacy invocation path remains unchanged.\n\nDependency Links:\nParent task is bd-4yc.1.\n\nAcceptance Criteria:\nAll options parse and flow into runtime config; legacy command behavior is unchanged.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit tests for argument parsing and defaults; e2e smoke tests for legacy and new invocation forms; startup logs include resolved config summary.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-23T21:35:30.089833383Z","created_by":"exedev","updated_at":"2026-02-23T23:49:47.723339646Z","closed_at":"2026-02-23T23:49:47.723305005Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.1.1","depends_on_id":"bd-4yc.1","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.1.2","title":"serve3 subtask: bounded port probe + graceful shutdown","description":"Objective and Scope:\nImplement bind retry loop and controlled shutdown lifecycle.\n\nImplementation Details:\nStart at requested or default port and increment only on AddrInUse with bounded attempts; handle Ctrl-C and SIGTERM graceful drain.\n\nDependency Links:\nParent task is bd-4yc.1; blocked by bd-4yc.1.1.\n\nAcceptance Criteria:\nRetry logic matches policy and stops on non-AddrInUse errors; shutdown exits cleanly.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit tests for retry decision matrix; e2e with pre-bound ports and signal termination; logs record each retry and shutdown trigger.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-23T21:35:30.231963312Z","created_by":"exedev","updated_at":"2026-02-23T23:49:58.648576199Z","closed_at":"2026-02-23T23:49:58.648546690Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.1.2","depends_on_id":"bd-4yc.1","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.1.2","depends_on_id":"bd-4yc.1.1","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.1.3","title":"serve3 subtask: startup summary output + --open launch semantics","description":"Objective and Scope:\nFinalize operator-facing bootstrap UX by making startup output deterministic and implementing --open behavior that launches the resolved primary URL without changing server semantics.\n\nImplementation Details:\n- Emit startup output as a stable, parseable block with these required fields: bind host, bound port, resolved root path, resolved entry path, primary URL, localhost fallback URL, and effective mermaid mode.\n- When --open is set, invoke platform opener exactly once after successful bind/start and target the same primary URL printed to stdout.\n- If opener command fails, log a warning and continue serving; this must never crash or block startup completion.\n- Keep output wording stable enough for snapshot tests and automation scripts.\n\nDependency Links:\nParent: bd-4yc.1.\nBlocked by: bd-4yc.1.2 (port/bind lifecycle established first).\nBlocks: validation startup-output matrix work under bd-4yc.8.\n\nAcceptance Criteria:\n- Startup output always includes root and entry and both URLs.\n- --open launches the selected primary URL after server startup.\n- Opener failure degrades to warning-only behavior.\n- No regression to non-serve CLI flows.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\n- Unit: output formatter snapshot tests for deterministic field order and labels.\n- Unit: open-launch decision matrix for --open true/false and opener failure path.\n- E2E: run serve with --open under mocked opener and assert invoked URL equals printed primary URL.\n- Logging: assert startup summary lines and opener success/failure log entries include reason codes.\n\nBackground / Rationale / Constraints / Intent:\nThe serve command is frequently consumed both by humans and scripts; stable startup output prevents tooling drift and speeds debugging. --open is convenience only, so failures must be non-fatal.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T21:39:04.978952301Z","created_by":"exedev","updated_at":"2026-02-23T23:49:59.156901117Z","closed_at":"2026-02-23T23:49:59.156881397Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.1.3","depends_on_id":"bd-4yc.1","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.1.3","depends_on_id":"bd-4yc.1.2","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.2","title":"serve3 slice 2: root-safe routing + resolver","description":"Objective and Scope:\nImplement root-safe routing and deterministic path resolution for markdown + static content under configured root.\n\nImplementation Details:\nServe / and /*path with explicit precedence: exact path -> .md fallback -> README.md -> index.md. Enforce canonical under-root checks to prevent traversal and symlink escapes. Support markdown raw output via ?raw=1 and clear HTTP error contract.\n\nDependency Links:\nParent: bd-4yc. Blocked by bd-4yc.1. Blocks bd-4yc.3 and bd-4yc.6. Child chain: bd-4yc.2.1 -> bd-4yc.2.2 -> bd-4yc.2.3.\n\nAcceptance Criteria:\nOnly in-root files are served; resolver precedence is deterministic; markdown raw mode works; missing paths emit explicit 404 behavior.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit: precedence matrix, traversal rejection, symlink breakout rejection.\nE2E: nested fixtures, MIME checks, raw mode, and 404 path coverage.\nLogging: normalized request path, resolution rule selected, and rejection/error reason class.\n\nBackground / Rationale / Constraints / Intent:\nRouting safety is a security and correctness boundary. Downstream rendering/performance features assume resolver outputs are canonical and deterministic.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-23T21:35:29.136116625Z","created_by":"exedev","updated_at":"2026-02-23T23:49:58.898751482Z","closed_at":"2026-02-23T23:49:58.898731246Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.2","depends_on_id":"bd-4yc","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.2","depends_on_id":"bd-4yc.1","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.2.1","title":"serve3 subtask: path resolver precedence + markdown/raw responses","description":"Objective and Scope:\nImplement deterministic path resolution and markdown/raw response branching.\n\nImplementation Details:\nResolution order exact, .md, README.md, index.md; query raw=1 returns markdown source with text/markdown content type.\n\nDependency Links:\nParent task is bd-4yc.2; blocked by bd-4yc.1.\n\nAcceptance Criteria:\nResolver chooses expected file across fixture permutations; raw mode bypasses HTML wrapper.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit tests for precedence order; e2e route matrix including nested paths and raw output; debug logs include chosen resolution branch.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-23T21:35:30.384821169Z","created_by":"exedev","updated_at":"2026-02-23T23:49:58.416160975Z","closed_at":"2026-02-23T23:49:58.416131562Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.2.1","depends_on_id":"bd-4yc.1","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.2.1","depends_on_id":"bd-4yc.2","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.2.2","title":"serve3 subtask: traversal/symlink escape protections + static MIME","description":"Objective and Scope:\nEnforce root confinement and correct static file serving behavior.\n\nImplementation Details:\nCanonicalize paths and reject root escapes, traversal, and symlink breakout; serve static assets with MIME detection; explicit 404 for misses.\n\nDependency Links:\nParent task is bd-4yc.2; blocked by bd-4yc.2.1.\n\nAcceptance Criteria:\nNo request can escape configured root; static files return correct content type; missing files return 404.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit tests for root confinement edge cases; e2e symlink traversal attempts and static MIME checks; logs include rejection reason class.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-23T21:35:30.532425079Z","created_by":"exedev","updated_at":"2026-02-23T23:50:00.022511922Z","closed_at":"2026-02-23T23:50:00.022487015Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.2.2","depends_on_id":"bd-4yc.2","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.2.2","depends_on_id":"bd-4yc.2.1","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.2.3","title":"serve3 subtask: HTTP error contract + resolver observability","description":"Objective and Scope:\nDefine and implement the HTTP response contract and resolver observability for non-happy paths so routing behavior is predictable for users and tests.\n\nImplementation Details:\n- Normalize method handling for markdown/static routes: GET/HEAD supported, others return explicit status (e.g. 405) with stable error body semantics.\n- Standardize 404/403/405 response shape and content type policy.\n- Ensure resolver logging emits structured reason classes: exact_match, md_fallback, readme_fallback, index_fallback, not_found, traversal_reject, root_escape_reject, method_reject.\n- Maintain low overhead by keeping verbose resolver logs at debug level.\n\nDependency Links:\nParent: bd-4yc.2.\nBlocked by: bd-4yc.2.2 (path safety and MIME behavior in place first).\nBlocks: verification tasks that assert stable HTTP/error and resolver logs.\n\nAcceptance Criteria:\n- Unsupported methods and unresolved paths return deterministic status codes and response formats.\n- Resolver reason classes are emitted consistently for each request path.\n- HEAD behavior matches GET headers without response body.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\n- Unit: status mapping table tests for route + method combinations.\n- Unit: resolver reason enum coverage and serialization formatting.\n- E2E: fixture requests validate 404/405 and HEAD behavior across markdown/static routes.\n- Logging: assert debug log lines include normalized request path and resolver reason class.\n\nBackground / Rationale / Constraints / Intent:\nOperational debugging depends on deterministic failure behavior. Explicit reason classes avoid ambiguous logs and reduce triage time when link resolution or path safety checks fail.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T21:39:14.786539408Z","created_by":"exedev","updated_at":"2026-02-23T23:50:00.736935190Z","closed_at":"2026-02-23T23:50:00.736914246Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.2.3","depends_on_id":"bd-4yc.2","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.2.3","depends_on_id":"bd-4yc.2.2","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.3","title":"serve3 slice 3: SSR markdown pipeline (comrak + syntect)","description":"Objective and Scope:\nDeliver SSR markdown rendering baseline in Rust with practical GitHub-flavored behavior and stable local-link semantics.\n\nImplementation Details:\nUse comrak with explicit GFM extensions, apply syntect server-side fenced-code highlighting, and rewrite local markdown links for nested serve routes while preserving external links/fragments. Maintain fixture corpus for parity guardrails.\n\nDependency Links:\nParent: bd-4yc. Blocked by bd-4yc.2. Blocks bd-4yc.4, bd-4yc.5, and bd-4yc.6. Child chain: bd-4yc.3.1 -> {bd-4yc.3.2, bd-4yc.3.3} -> bd-4yc.3.4.\n\nAcceptance Criteria:\nSSR output supports required GFM baseline; code blocks are highlighted with deterministic fallback; local markdown links resolve across directory depth.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit: renderer options, highlight fallback paths, rewrite edge cases.\nE2E: GFM fixture corpus including tables/task lists/fenced code/links.\nLogging: renderer mode, highlight fallback reason, and rewrite decision classes.\n\nBackground / Rationale / Constraints / Intent:\nThis is the core user-visible behavior. Keep parsing/rendering mostly server-side for predictable output and performance.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-23T21:35:29.258879339Z","created_by":"exedev","updated_at":"2026-02-23T23:50:00.265714914Z","closed_at":"2026-02-23T23:50:00.265693953Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.3","depends_on_id":"bd-4yc","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.3","depends_on_id":"bd-4yc.2","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.3.1","title":"serve3 subtask: comrak GFM options + SSR template integration","description":"Objective and Scope:\nProduce SSR HTML with explicit GFM-compatible parser and renderer options.\n\nImplementation Details:\nUse comrak config for tables, task lists, strikethrough, autolinks, and fenced code; integrate renderer output into serve HTML template shell.\n\nDependency Links:\nParent task is bd-4yc.3; blocked by bd-4yc.2.\n\nAcceptance Criteria:\nFixture markdown renders expected structural HTML for baseline GFM features.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit tests for renderer option toggles; e2e golden tests for representative fixtures; logs record renderer profile at startup.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-23T21:35:30.695258105Z","created_by":"exedev","updated_at":"2026-02-23T23:49:59.788822522Z","closed_at":"2026-02-23T23:49:59.788802815Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.3.1","depends_on_id":"bd-4yc.2","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.3.1","depends_on_id":"bd-4yc.3","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.3.2","title":"serve3 subtask: syntect fenced-code highlighting + language fallback","description":"Objective and Scope:\nApply server-side syntax highlighting for fenced code blocks.\n\nImplementation Details:\nIntegrate syntect highlighting into SSR pipeline with graceful fallback when language is unknown.\n\nDependency Links:\nParent task is bd-4yc.3; blocked by bd-4yc.3.1.\n\nAcceptance Criteria:\nCode blocks receive deterministic highlighted HTML where grammar exists; unknown grammars remain readable plain output.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit tests for language lookup and fallback paths; e2e fixtures verify highlighted output; logs include unknown-language fallback counts.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T21:35:30.853438772Z","created_by":"exedev","updated_at":"2026-02-23T23:50:01.908803438Z","closed_at":"2026-02-23T23:50:01.908778721Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.3.2","depends_on_id":"bd-4yc.3","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.3.2","depends_on_id":"bd-4yc.3.1","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.3.3","title":"serve3 subtask: local markdown link rewriting","description":"Objective and Scope:\nRewrite internal markdown links into serve routes across nested directories.\n\nImplementation Details:\nRewrite relative links targeting local markdown while preserving external URLs, mailto links, fragments, and non-markdown asset links.\n\nDependency Links:\nParent task is bd-4yc.3; blocked by bd-4yc.3.1.\n\nAcceptance Criteria:\nInter-file links resolve correctly via HTTP routes; non-local links are unchanged.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit tests for relative normalization and anchor handling; e2e click-through tests across fixture tree; debug logs may include rewrite count per page.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T21:35:31.012106133Z","created_by":"exedev","updated_at":"2026-02-23T23:50:01.683506650Z","closed_at":"2026-02-23T23:50:01.683486517Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.3.3","depends_on_id":"bd-4yc.3","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.3.3","depends_on_id":"bd-4yc.3.1","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.3.4","title":"serve3 subtask: SSR parity fixture corpus for GFM baseline","description":"Objective and Scope:\nLock down baseline GitHub-flavored markdown parity using fixture-driven SSR tests so rendering changes remain intentional and reviewable.\n\nImplementation Details:\n- Add canonical fixture corpus covering tables, task lists, fenced code, autolinks, strikethrough, nested lists, blockquotes, and mixed inline formatting.\n- Verify SSR output includes expected structural HTML markers for each fixture and stays stable across parser upgrades.\n- Keep assertions focused on semantic structure (tags/classes/ids), not brittle whitespace.\n- Document fixture intent and expected behavior inside test files for maintainability.\n\nDependency Links:\nParent: bd-4yc.3.\nBlocked by: bd-4yc.3.2 and bd-4yc.3.3 (highlighting + link rewrite finalized first).\nBlocks: validation matrix completeness in bd-4yc.8.1 and bd-4yc.8.2.\n\nAcceptance Criteria:\n- Fixture corpus exists and is wired into automated tests.\n- SSR semantic output for GFM baseline features is asserted and passing.\n- Renderer regressions produce actionable diffs.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\n- Unit: parser/render option tests map each fixture feature to expected output markers.\n- E2E: serve fixture tree and validate rendered HTML contains expected structures.\n- Logging: optional debug logs include fixture name and render profile used during test runs.\n\nBackground / Rationale / Constraints / Intent:\n“Support everything GitHub does” is broad; fixture-backed semantic checks establish a practical, maintainable baseline that can be expanded without destabilizing Gate A.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T21:39:23.116382262Z","created_by":"exedev","updated_at":"2026-02-23T23:50:03.309058989Z","closed_at":"2026-02-23T23:50:03.309037558Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.3.4","depends_on_id":"bd-4yc.3","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.3.4","depends_on_id":"bd-4yc.3.2","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.3.4","depends_on_id":"bd-4yc.3.3","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.4","title":"serve3 slice 3b: mermaid assets + mode control","description":"Objective and Scope:\nProvide Mermaid support in serve mode with offline-first asset delivery and deterministic mode gating.\n\nImplementation Details:\nBundle Mermaid runtime in mdmd assets, expose it via /__mdmd/assets/*, and gate runtime injection using --mermaid-mode client|off (default client).\n\nDependency Links:\nParent: bd-4yc. Blocked by bd-4yc.3. Child chain: bd-4yc.4.1 -> bd-4yc.4.2. Validation dependency consumers: bd-4yc.8 and bd-4yc.8.2.\n\nAcceptance Criteria:\nClient mode renders Mermaid without CDN/network dependency; off mode suppresses runtime injection and execution.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit: mode parsing/template branch tests.\nE2E: offline asset fetch + enabled/disabled diagram behavior.\nLogging: startup field for effective Mermaid mode.\n\nBackground / Rationale / Constraints / Intent:\nGate A requires Mermaid compatibility while keeping server architecture SSR-first. Client-side Mermaid execution is a deliberate compromise; server-side Mermaid rendering is out of scope for this phase.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T21:35:29.386858973Z","created_by":"exedev","updated_at":"2026-02-23T23:50:02.592743076Z","closed_at":"2026-02-23T23:50:02.592723402Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.4","depends_on_id":"bd-4yc","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.4","depends_on_id":"bd-4yc.3","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.4.1","title":"serve3 subtask: bundled mermaid asset route","description":"Objective and Scope:\nShip and serve mermaid runtime from built-in assets endpoint.\n\nImplementation Details:\nExpose __mdmd assets route for embedded assets and ensure no CDN dependency.\n\nDependency Links:\nParent task is bd-4yc.4; blocked by bd-4yc.3.\n\nAcceptance Criteria:\nMermaid runtime is available from local assets route in offline environment.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit tests for asset path routing; e2e fetches asset endpoint without network; startup logs include asset mount path.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T21:35:31.181830949Z","created_by":"exedev","updated_at":"2026-02-23T23:50:01.453758111Z","closed_at":"2026-02-23T23:50:01.453739114Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.4.1","depends_on_id":"bd-4yc.3","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.4.1","depends_on_id":"bd-4yc.4","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.4.2","title":"serve3 subtask: mermaid mode client/off behavior","description":"Objective and Scope:\nImplement deterministic mermaid mode behavior in rendered pages.\n\nImplementation Details:\nDefault client mode injects runtime bootstrap; off mode omits scripts and avoids runtime execution.\n\nDependency Links:\nParent task is bd-4yc.4; blocked by bd-4yc.4.1.\n\nAcceptance Criteria:\nMode switch reliably controls script injection and runtime behavior.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit tests for mode parsing and template branch; e2e verifies diagram render versus disabled state; logs show effective mermaid mode.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T21:35:31.353549998Z","created_by":"exedev","updated_at":"2026-02-23T23:50:03.959219719Z","closed_at":"2026-02-23T23:50:03.959199826Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.4.2","depends_on_id":"bd-4yc.4","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.4.2","depends_on_id":"bd-4yc.4.1","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.5","title":"serve3 slice 4: heading-first navigation UX","description":"Objective and Scope:\nImplement heading-first reading/navigation UX with persistent TOC and stable heading identity.\n\nImplementation Details:\nExtract heading tree during SSR, generate deterministic GitHub-like IDs with collision suffixing, render persistent TOC/sidebar + file-path chrome, and apply minimal client enhancements for active-heading highlight and smooth TOC scroll.\n\nDependency Links:\nParent: bd-4yc. Blocked by bd-4yc.3. Child chain: bd-4yc.5.1 -> bd-4yc.5.2 -> bd-4yc.5.3. Consumed by validation tasks bd-4yc.8, bd-4yc.8.1, bd-4yc.8.2.\n\nAcceptance Criteria:\nTOC is always present for markdown pages; duplicate headings map to stable unique anchors; active heading highlight tracks viewport position.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit: slug generation/collision behavior and heading tree structure.\nE2E: TOC visibility, highlight transitions, smooth scrolling.\nLogging: heading count and collision count for rendered pages.\n\nBackground / Rationale / Constraints / Intent:\nThe heading system is a first-class requirement for long-form docs navigation. Keep JS minimal and deterministic so SSR remains dominant.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T21:35:29.515881229Z","created_by":"exedev","updated_at":"2026-02-23T23:50:02.356120491Z","closed_at":"2026-02-23T23:50:02.356099566Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.5","depends_on_id":"bd-4yc","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.5","depends_on_id":"bd-4yc.3","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.5.1","title":"serve3 subtask: heading extraction + deterministic slug collisions","description":"Objective and Scope:\nGenerate stable heading IDs and hierarchical TOC data during SSR.\n\nImplementation Details:\nImplement GitHub-like slug normalization and collision suffixing while preserving heading order and depth.\n\nDependency Links:\nParent task is bd-4yc.5; blocked by bd-4yc.3.\n\nAcceptance Criteria:\nDuplicate headings produce stable unique IDs across runs and content order.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit tests for slug normalization and collision cases; e2e snapshot validates TOC ID consistency; debug logs include collision metrics.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T21:35:31.520795592Z","created_by":"exedev","updated_at":"2026-02-23T23:50:01.212670278Z","closed_at":"2026-02-23T23:50:01.212643780Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.5.1","depends_on_id":"bd-4yc.3","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.5.1","depends_on_id":"bd-4yc.5","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.5.2","title":"serve3 subtask: persistent TOC + file path chrome","description":"Objective and Scope:\nRender always-visible heading TOC and display current file path in page header chrome.\n\nImplementation Details:\nInject TOC sidebar into page template with responsive layout behavior and current file indicator.\n\nDependency Links:\nParent task is bd-4yc.5; blocked by bd-4yc.5.1.\n\nAcceptance Criteria:\nTOC appears for markdown pages and file path is visible in desktop and mobile layouts.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nBrowser e2e checks for TOC and file path visibility at multiple viewport sizes; logs may include rendered heading count.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T21:35:31.701401898Z","created_by":"exedev","updated_at":"2026-02-23T23:50:03.735251032Z","closed_at":"2026-02-23T23:50:03.735231243Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.5.2","depends_on_id":"bd-4yc.5","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.5.2","depends_on_id":"bd-4yc.5.1","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.5.3","title":"serve3 subtask: active heading highlight + smooth TOC scrolling","description":"Objective and Scope:\nAdd minimal client enhancements for navigation usability.\n\nImplementation Details:\nUse IntersectionObserver for active heading highlight and smooth scrolling behavior for TOC anchor navigation.\n\nDependency Links:\nParent task is bd-4yc.5; blocked by bd-4yc.5.2.\n\nAcceptance Criteria:\nActive TOC item tracks in-view heading and TOC clicks scroll smoothly to target anchors.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nBrowser e2e validates active-state transitions and smooth scrolling behavior; debug logs may emit script initialization success.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-23T21:35:31.874026576Z","created_by":"exedev","updated_at":"2026-02-23T23:50:04.424130597Z","closed_at":"2026-02-23T23:50:04.424105700Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.5.3","depends_on_id":"bd-4yc.5","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.5.3","depends_on_id":"bd-4yc.5.2","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.6","title":"serve3 slice 5: cache + revalidation + compression","description":"Objective and Scope:\nDeliver performance-oriented HTTP behavior via render caching, conditional revalidation, and compression with standards-correct interactions.\n\nImplementation Details:\nCache markdown render output using canonical path + (mtime,size), emit ETag and Last-Modified validators, handle 304 responses correctly, and apply compression middleware for text responses while preserving validator/cache correctness across encodings.\n\nDependency Links:\nParent: bd-4yc. Blocked by bd-4yc.2 and bd-4yc.3. Child chain: bd-4yc.6.1 -> bd-4yc.6.2 -> bd-4yc.6.3 -> bd-4yc.6.4.\n\nAcceptance Criteria:\nCache hit/miss/invalidation behavior is deterministic; conditional requests are correct; compression does not break validator semantics.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit: key derivation, validator precedence, response decision matrix.\nE2E: Accept-Encoding and conditional-header permutations with body/header assertions.\nLogging: per-request cache, revalidation, and compression decision fields.\n\nBackground / Rationale / Constraints / Intent:\nPerformance improvements are required but must remain diagnosable. Explicit matrix testing/logging prevents subtle regressions in cache and HTTP semantics.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T21:35:29.645543778Z","created_by":"exedev","updated_at":"2026-02-23T23:50:02.132420002Z","closed_at":"2026-02-23T23:50:02.132399660Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.6","depends_on_id":"bd-4yc","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.6","depends_on_id":"bd-4yc.2","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.6","depends_on_id":"bd-4yc.3","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.6.1","title":"serve3 subtask: render cache keyed by canonical path + (mtime,size)","description":"Objective and Scope:\nImplement cache entries that invalidate on source content changes.\n\nImplementation Details:\nCache rendered output by canonical path and file metadata tuple mtime plus size to avoid stale responses.\n\nDependency Links:\nParent task is bd-4yc.6; blocked by bd-4yc.3 and bd-4yc.2.\n\nAcceptance Criteria:\nUnchanged files hit cache; modified files invalidate and re-render deterministically.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit tests for key generation and invalidation; e2e repeated request timing and content refresh checks; logs include hit, miss, and invalidate events.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T21:35:32.041052665Z","created_by":"exedev","updated_at":"2026-02-23T23:50:00.975420636Z","closed_at":"2026-02-23T23:50:00.975401775Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.6.1","depends_on_id":"bd-4yc.2","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.6.1","depends_on_id":"bd-4yc.3","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.6.1","depends_on_id":"bd-4yc.6","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.6.2","title":"serve3 subtask: ETag/Last-Modified + conditional 304","description":"Objective and Scope:\nSupport HTTP revalidation semantics for markdown and text responses.\n\nImplementation Details:\nEmit validators and evaluate If-None-Match and If-Modified-Since to return 304 when appropriate.\n\nDependency Links:\nParent task is bd-4yc.6; blocked by bd-4yc.6.1.\n\nAcceptance Criteria:\nConditional requests return correct status and header behavior with empty body on 304.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit tests for validator precedence rules; e2e with curl header scenarios; logs capture revalidation decision and matched validator type.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T21:35:32.209581284Z","created_by":"exedev","updated_at":"2026-02-23T23:50:03.524555710Z","closed_at":"2026-02-23T23:50:03.524536058Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.6.2","depends_on_id":"bd-4yc.6","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.6.2","depends_on_id":"bd-4yc.6.1","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.6.3","title":"serve3 subtask: compression middleware tuning","description":"Objective and Scope:\nEnable compression for eligible responses without breaking cache and revalidation correctness.\n\nImplementation Details:\nConfigure compression middleware for text-like content and verify compatibility with validator headers.\n\nDependency Links:\nParent task is bd-4yc.6; blocked by bd-4yc.6.2.\n\nAcceptance Criteria:\nResponses compress when client advertises support and remain standards-compliant with existing headers.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nIntegration tests with Accept-Encoding variants; e2e checks Content-Encoding and body integrity; logs indicate compression choice at debug level.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-23T21:35:32.388254280Z","created_by":"exedev","updated_at":"2026-02-23T23:50:04.193858401Z","closed_at":"2026-02-23T23:50:04.193838881Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.6.3","depends_on_id":"bd-4yc.6","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.6.3","depends_on_id":"bd-4yc.6.2","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.6.4","title":"serve3 subtask: cache-validator-compression interaction matrix","description":"Objective and Scope:\nValidate the interaction boundaries between cache, validators, and compression so response correctness is preserved under real client negotiation patterns.\n\nImplementation Details:\n- Define behavior for ETag/Last-Modified with compressed and uncompressed responses.\n- Ensure 304 responses are emitted without response body and with correct validator semantics.\n- Verify compression does not invalidate cache-key assumptions or leak stale variants.\n- Add targeted tests for Accept-Encoding transitions and repeated conditional requests.\n\nDependency Links:\nParent: bd-4yc.6.\nBlocked by: bd-4yc.6.3 (compression middleware configured first).\nBlocks: final e2e and logging assertions under bd-4yc.8.2.\n\nAcceptance Criteria:\n- Conditional requests behave correctly regardless of compression negotiation.\n- Cache hits/misses remain deterministic across encoding variants.\n- 304 and compressed 200 responses satisfy HTTP correctness expectations.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\n- Unit: validator/compression decision matrix tests.\n- E2E: sequential requests toggling Accept-Encoding and conditional headers.\n- Logging: assert cache + revalidate + compression reason fields are present per markdown request.\n\nBackground / Rationale / Constraints / Intent:\nThese features are individually straightforward but fragile in combination; explicit matrix testing prevents subtle production bugs where caches and validators disagree across encodings.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-02-23T21:39:30.658122945Z","created_by":"exedev","updated_at":"2026-02-23T23:50:04.906593116Z","closed_at":"2026-02-23T23:50:04.906560987Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.6.4","depends_on_id":"bd-4yc.6","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.6.4","depends_on_id":"bd-4yc.6.3","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.7","title":"serve3 slice 6: tailscale host policy + startup URLs","description":"Objective and Scope:\nImplement tailscale-aware startup URL policy with safe probing, explicit override behavior, and deterministic output.\n\nImplementation Details:\nProbe tailscale via `tailscale status --json` with timeout, parse `.Self.DNSName` safely, apply default bind-host policy when --host is absent, always print localhost fallback URL, and enforce strict --no-tailscale probe suppression with rationale logging.\n\nDependency Links:\nParent: bd-4yc. Blocked by bd-4yc.1. Child chain: bd-4yc.7.1 -> bd-4yc.7.2 -> bd-4yc.7.3. Consumed by validation tasks bd-4yc.8, bd-4yc.8.1, bd-4yc.8.3.\n\nAcceptance Criteria:\nStartup URL policy is deterministic across tailscale present/absent/error/no-tailscale/host-override cases; probe path never hangs startup.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit: tailscale parse and host-policy matrix.\nE2E: mocked probe outputs and probe suppression checks.\nLogging: probe duration/outcome class, policy branch selected, and printed primary+fallback URLs.\n\nBackground / Rationale / Constraints / Intent:\nStartup output is an operator contract. This slice ensures URL selection is explainable and stable regardless of machine tailscale state.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T21:35:29.802371840Z","created_by":"exedev","updated_at":"2026-02-23T23:49:48.739254977Z","closed_at":"2026-02-23T23:49:48.739231967Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.7","depends_on_id":"bd-4yc","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.7","depends_on_id":"bd-4yc.1","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.7.1","title":"serve3 subtask: tailscale probe execution + DNSName parsing","description":"Objective and Scope:\nDetect tailscale hostname safely and quickly for URL selection.\n\nImplementation Details:\nExecute tailscale status JSON with timeout; parse Self DNSName and trim trailing dot; gracefully handle command absence, failure, timeout, and malformed JSON.\n\nDependency Links:\nParent task is bd-4yc.7; blocked by bd-4yc.1.\n\nAcceptance Criteria:\nProbe never blocks startup beyond timeout; valid DNSName is normalized for host output.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit tests for parser success, failure, and timeout cases; e2e with mocked command outputs; logs include probe duration and outcome category.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T21:35:32.592043269Z","created_by":"exedev","updated_at":"2026-02-23T23:49:48.454538823Z","closed_at":"2026-02-23T23:49:48.454508319Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.7.1","depends_on_id":"bd-4yc.1","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.7.1","depends_on_id":"bd-4yc.7","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.7.2","title":"serve3 subtask: bind-host defaults + URL print policy","description":"Objective and Scope:\nApply bind-host policy and deterministic startup URL printing.\n\nImplementation Details:\nDefault host selection follows tailscale presence unless host override is set; always print primary URL and localhost fallback; include resolved root and entry in startup output.\n\nDependency Links:\nParent task is bd-4yc.7; blocked by bd-4yc.7.1.\n\nAcceptance Criteria:\nStartup output consistently includes host, URL, root, and entry fields and honors explicit host override.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit tests for host policy matrix; e2e startup output snapshot tests; logs show final selected host reason.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T21:35:32.790374833Z","created_by":"exedev","updated_at":"2026-02-23T23:49:59.383362137Z","closed_at":"2026-02-23T23:49:59.383342274Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.7.2","depends_on_id":"bd-4yc.7","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.7.2","depends_on_id":"bd-4yc.7.1","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.7.3","title":"serve3 subtask: --no-tailscale probe suppression + URL rationale","description":"Objective and Scope:\nGuarantee deterministic behavior when tailscale probing is explicitly disabled and clarify startup rationale for host/url selection.\n\nImplementation Details:\n- Implement strict no-probe path when --no-tailscale is enabled.\n- Ensure bind-host defaults and startup URL selection follow policy without reading tailscale state in disabled mode.\n- Emit explicit startup rationale line indicating whether selection came from tailscale probe, explicit --host override, or --no-tailscale policy path.\n\nDependency Links:\nParent: bd-4yc.7.\nBlocked by: bd-4yc.7.2 (host policy implementation first).\nBlocks: validation tasks that assert URL rationale and probe suppression.\n\nAcceptance Criteria:\n- --no-tailscale fully suppresses probe execution.\n- Startup output and logs clearly indicate no-tailscale decision path.\n- URL printing remains primary + localhost fallback and consistent with host policy.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\n- Unit: decision-matrix tests verify probe suppression and host selection outputs.\n- E2E: mocked environment confirms tailscale binary is not invoked when flag set.\n- Logging: assert rationale field values for probe_used, probe_skipped_no_tailscale, and host_override.\n\nBackground / Rationale / Constraints / Intent:\nUsers may disable tailscale for privacy, startup speed, or predictable localhost-only behavior. The disabled path must be explicit and observable to avoid confusing URL output.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-23T21:39:37.774022432Z","created_by":"exedev","updated_at":"2026-02-23T23:50:00.499022411Z","closed_at":"2026-02-23T23:50:00.498997096Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.7.3","depends_on_id":"bd-4yc.7","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.7.3","depends_on_id":"bd-4yc.7.2","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.8","title":"serve3 validation: unit/e2e matrix + logging assertions","description":"Objective and Scope:\nCodify complete verification evidence for Gate A across unit and end-to-end levels, including required observability assertions.\n\nImplementation Details:\nDefine coverage matrix tasks for all invariants, fixture-based end-to-end suites for routing/rendering/UX/performance, and dedicated startup URL behavior matrix with tailscale/no-tailscale/override permutations.\n\nDependency Links:\nParent: bd-4yc. Blocked by bd-4yc.1 through bd-4yc.7. Child chain: bd-4yc.8.1 -> bd-4yc.8.2 -> bd-4yc.8.3.\n\nAcceptance Criteria:\nAll Gate A contracts are enforced by deterministic tests and logging assertions; suite is CI-ready and not dependent on host-local tailscale state.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nUnit: contract-level invariant tests per slice.\nE2E: fixture matrix + startup matrix with mocked tailscale outputs.\nLogging: assert startup summary, resolver choices, renderer mode, cache decisions, and tailscale rationale fields.\n\nBackground / Rationale / Constraints / Intent:\nThis task prevents incomplete delivery by requiring objective evidence for every promised behavior in Gate A.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-23T21:35:29.947873520Z","created_by":"exedev","updated_at":"2026-02-23T23:50:03.098319110Z","closed_at":"2026-02-23T23:50:03.098298596Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.8","depends_on_id":"bd-4yc","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8","depends_on_id":"bd-4yc.1","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8","depends_on_id":"bd-4yc.2","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8","depends_on_id":"bd-4yc.3","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8","depends_on_id":"bd-4yc.4","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8","depends_on_id":"bd-4yc.5","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8","depends_on_id":"bd-4yc.6","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8","depends_on_id":"bd-4yc.7","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.8.1","title":"serve3 subtask: unit coverage matrix for all Gate A invariants","description":"Objective and Scope:\nImplement broad unit coverage for deterministic serve behavior and edge conditions.\n\nImplementation Details:\nAdd unit tests for CLI parsing, port retries, resolver precedence, escape rejection, renderer configuration, slug collisions, cache validators, and tailscale parsing policy.\n\nDependency Links:\nParent task is bd-4yc.8; blocked by bd-4yc.1, bd-4yc.2, bd-4yc.3, bd-4yc.5, bd-4yc.6, and bd-4yc.7.\n\nAcceptance Criteria:\nCritical invariants have dedicated unit tests with clear failure messages.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nRun unit targets and enforce pass; capture and assert key log fields where feasible via test logger harness.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-23T21:35:32.994972218Z","created_by":"exedev","updated_at":"2026-02-23T23:50:02.885223530Z","closed_at":"2026-02-23T23:50:02.885203714Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.8.1","depends_on_id":"bd-4yc.1","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8.1","depends_on_id":"bd-4yc.2","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8.1","depends_on_id":"bd-4yc.3","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8.1","depends_on_id":"bd-4yc.5","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8.1","depends_on_id":"bd-4yc.6","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8.1","depends_on_id":"bd-4yc.7","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8.1","depends_on_id":"bd-4yc.8","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.8.2","title":"serve3 subtask: e2e fixture matrix + logging assertions","description":"Objective and Scope:\nValidate end-to-end behavior with fixture trees and startup/runtime observability assertions.\n\nImplementation Details:\nAdd integration tests for routing, rendering, mermaid modes, TOC UX signals, 404/raw/static MIME behavior, revalidation/compression, and tailscale URL fallback.\n\nDependency Links:\nParent task is bd-4yc.8; blocked by bd-4yc.8.1, bd-4yc.4, bd-4yc.5, and bd-4yc.6.\n\nAcceptance Criteria:\nE2E suite passes and verifies key startup and request logs needed to debug production failures.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\nRun integration targets with deterministic fixtures and assert logs for startup summary, resolver choice, render mode, cache status, and tailscale probe result.\\n\\nBackground / Rationale / Constraints / Intent:\\nThis bead is self-contained for future maintainers and should be implementable without reopening plan docs. Keep scope tight, preserve existing mdmd behavior outside serve3 Gate A, and prefer deterministic logs/tests so regressions are diagnosable.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-23T21:35:33.207046223Z","created_by":"exedev","updated_at":"2026-02-23T23:50:04.673287798Z","closed_at":"2026-02-23T23:50:04.673264648Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.8.2","depends_on_id":"bd-4yc.4","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8.2","depends_on_id":"bd-4yc.5","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8.2","depends_on_id":"bd-4yc.6","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8.2","depends_on_id":"bd-4yc.8","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8.2","depends_on_id":"bd-4yc.8.1","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4yc.8.3","title":"serve3 subtask: startup URL behavior matrix e2e","description":"Objective and Scope:\nAdd an end-to-end startup matrix that validates URL and startup output behavior across local, tailscale, and override scenarios.\n\nImplementation Details:\n- Cover startup scenarios: tailscale DNS present, tailscale absent, tailscale timeout/error, --no-tailscale enabled, and explicit --host override.\n- For each scenario, assert printed primary URL, localhost fallback URL, resolved root/entry fields, and rationale log lines.\n- Reuse deterministic mocks/stubs for tailscale command responses to avoid flaky environment coupling.\n\nDependency Links:\nParent: bd-4yc.8.\nBlocked by: bd-4yc.8.2 and bd-4yc.7.3.\nBlocks: Gate A sign-off by proving startup contract stability.\n\nAcceptance Criteria:\n- Startup matrix exists and passes in CI.\n- URL output, rationale logs, and root/entry fields are asserted in every startup mode.\n- Test harness is deterministic and independent of actual machine tailscale state.\n\nVerification Steps (unit and e2e requirements, with logging expectations):\n- Unit: startup formatting/parsing helpers used by assertions.\n- E2E: scenario matrix with mocked tailscale command and host override combinations.\n- Logging: assert probe result class, selection rationale, and emitted URL pair for each run.\n\nBackground / Rationale / Constraints / Intent:\nStartup output is the operator contract for discovering the server endpoint. A dedicated matrix prevents regressions that otherwise escape basic render/routing tests.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-23T21:39:44.675427181Z","created_by":"exedev","updated_at":"2026-02-23T23:50:05.139523060Z","closed_at":"2026-02-23T23:50:05.139503575Z","close_reason":"Cleaning up failed planner run","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-4yc.8.3","depends_on_id":"bd-4yc.1.3","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8.3","depends_on_id":"bd-4yc.7.3","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8.3","depends_on_id":"bd-4yc.8","type":"parent-child","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-4yc.8.3","depends_on_id":"bd-4yc.8.2","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-ezg","title":"Serve5-06: Secure serve_root path resolution for markdown and assets","description":"## Objective\nEnforce canonical `serve_root` containment with robust local path resolution, symlink safety, URL-encoding safety, file size limits, and correct MIME types.\n\n## Implementation Details (7-step pipeline)\n1. **Decode**: percent-decode the request path FIRST (before any normalization).\n2. **Normalize**: strip `..` components via `Path` component iteration; reject requests still containing `..` after decode.\n3. **Construct**: join `serve_root` + normalized path to get a candidate absolute path.\n4. **Fallback resolution**: try candidate as exact path; if not found, try `candidate + \".md\"` when extensionless; if candidate is a directory, try `candidate/README.md` then `candidate/index.md`.\n5. **R1 – Canonicalize + re-check**: call `std::fs::canonicalize` on the resolved path (follows symlinks); re-verify the canonicalized path starts with canonicalized `serve_root`. Reject if outside root even via symlink.\n6. **R5 – File size guard**: stat the file before reading; if size exceeds 16 MB (configurable), return `413 Content Too Large` with log of path and size.\n7. **Dispatch**: if resolved file is `.md` (case-insensitive), render as HTML page; otherwise serve as static asset.\n\n## MIME type (R6)\nDerive `Content-Type` from extension via static lookup table:\n`.md`/`.html` → `text/html`, `.css` → `text/css`, `.js` → `text/javascript`,\n`.png` → `image/png`, `.jpg`/`.jpeg` → `image/jpeg`, `.svg` → `image/svg+xml`,\n`.gif` → `image/gif`, `.ico` → `image/x-icon`, `.woff2` → `font/woff2`,\n`.pdf` → `application/pdf`. Unknown → `application/octet-stream`.\nNever rely on browser MIME sniffing.\n\n## R2 – URL-encoded traversal\nUnit tests must cover: `%2e%2e`, `%2F`, `%2e%2e%2f` (directory traversal slash-encoded), mixed-case `%2E%2E`. All must return 404.\n\n## Headers\nSet `X-Content-Type-Options: nosniff` on all responses (including 404/413/asset).\n\n## Acceptance Criteria\n- No out-of-root file access via traversal, URL-encoding, or symlink.\n- All fallback resolution cases (extensionless, README.md, index.md) work correctly.\n- File size limit enforced at 16 MB; 413 returned for oversized files.\n- All responses include correct `Content-Type` and `X-Content-Type-Options: nosniff`.\n\n## Verification Steps\n- Unit: request `/../etc/passwd` → 404 (after decode+normalize).\n- Unit: request `/%2e%2e/etc/passwd` → 404.\n- Unit: request `/%2e%2e%2fetc%2fpasswd` → 404 (slash also encoded; must not bypass normalization).\n- Unit: request `/%2E%2E/` (mixed case) → 404.\n- Unit: in-tree symlink pointing to `/tmp/secret.txt` → 404 (canonicalize re-check).\n- Unit: extensionless request `GET /docs/guide` resolves to `docs/guide.md` when exists.\n- Unit: directory request `GET /docs/` resolves to `docs/README.md` then `docs/index.md`.\n- Unit: file > 16 MB → 413 before any content read.\n- Unit: `.png` extension → `Content-Type: image/png`.\n- Unit: `.svg` extension → `Content-Type: image/svg+xml`.\n- Unit: unknown `.xyz` extension → `Content-Type: application/octet-stream`.\n- Integration: traverse attempt `GET /../../etc/passwd` → 404.\n- Integration: in-root file `GET /image.png` → 200 with `Content-Type: image/png`.\n- Integration: all responses include `X-Content-Type-Options: nosniff`.\n- Log: `[resolve] path=<norm> branch=<exact|extensionless|readme|index|denied> reason=<detail>`.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-24T04:49:41.249879765Z","created_by":"exedev","updated_at":"2026-02-24T06:53:05.258721581Z","closed_at":"2026-02-24T06:53:05.258687810Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-ezg","depends_on_id":"bd-1mz","type":"blocks","created_at":"2026-02-24T04:49:44.277094805Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-ezg","depends_on_id":"bd-2f2","type":"parent-child","created_at":"2026-02-24T06:24:49.231960576Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-kcr","title":"serve2 slice 2: root-safe routing","description":"## Covered Sections\n- executable-decomposition\n- slice-2-root-safe-routing-and-path-resolution\n- validation-strategy\n- cross-slice-dependencies\n- gate-a-approval-checklist\n\n## Acceptance Criteria\n- Extensionless and nested markdown links resolve correctly.\n- Static assets load from root tree.\n- Root-escape/traversal attempts return `403`.\n- Missing in-root targets return `404`.\n\n## Verification Steps\n- Run routing integration tests on fixture trees covering exact, extensionless, and fallback (`README.md`, `index.md`) resolution order.\n- Run security tests with traversal payloads (`..`, encoded traversal) asserting `403`.\n- Run missing-target tests asserting `404` for unresolved in-root paths.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-23T06:57:33.904072868Z","created_by":"exedev","updated_at":"2026-02-24T00:11:17.909046231Z","closed_at":"2026-02-24T00:11:17.909026974Z","close_reason":"Cleaning up for fresh start","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-kcr","depends_on_id":"bd-28p","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-mzl","title":"Serve5-04: Comrak SSR renderer with heading extraction","description":"## Objective\nImplement serve-only markdown renderer using comrak with GFM features, heading extraction, and security-safe defaults.\n\n## Implementation Details\n- Enable comrak GFM extensions: tables, task lists, autolinks, strikethrough, fenced code blocks.\n- R3 mitigation: set `ComrakOptions::render.unsafe_ = false` (default). Raw HTML blocks in Markdown are stripped, not passed through. Add unit test asserting `<script>alert(1)</script>` does not appear in rendered HTML output.\n- R4 mitigation: implement anchor ID deduplication counter during heading extraction. The first occurrence of a heading text slug gets its bare slug (e.g. `my-heading`); subsequent occurrences get a numeric suffix (`my-heading-1`, `my-heading-2`). Counter is per-document. Add unit tests with repeated headings at same and different nesting levels.\n- Extract headings (level, text, anchor ID) from the AST before rendering to a `Vec<HeadingEntry>` for TOC construction.\n- Keep TUI parse/render path (`src/parse.rs`, `src/render.rs`) completely untouched.\n- Render into `src/html.rs` as a pure function: `fn render_markdown(input: &str, file_path: &Path, serve_root: &Path) -> (String, Vec<HeadingEntry>)`. The `file_path` and `serve_root` parameters are required by bd-1p6's relative link resolution during the same AST traversal pass.\n- Log rendered file path and extracted heading count at `info` level.\n- R10 mitigation: enable only required comrak feature flags (GFM, not experimental extensions); pin comrak to a specific version in Cargo.toml. After implementation, verify binary size delta vs. pre-comrak build is ≤500 KB using `cargo build --release` and `du -sh`.\n\n## Acceptance Criteria\n- HTML covers phase-1 markdown feature matrix: paragraphs, emphasis, strong, inline code, ATX headings, fenced code blocks, tables, task lists, strikethrough, blockquotes, ordered/unordered lists, autolinks, normal links.\n- `<script>` in input does not appear in rendered HTML output.\n- Duplicate headings produce unique, sequenced anchor IDs.\n- `Vec<HeadingEntry>` produced for TOC construction.\n- Binary size delta after adding comrak is ≤500 KB (R10).\n\n## Verification Steps\n- Unit: `hello world` paragraph → output contains `<p>`.\n- Unit: `*text*` → output contains `<em>`.\n- Unit: `**text**` → output contains `<strong>`.\n- Unit: `` `inline code` `` → output contains `<code>`.\n- Unit: `[text](https://example.com)` normal link → output contains `<a href=\"https://example.com\">`.\n- Unit: GFM table → `<table>` with `<th>` and `<td>`.\n- Unit: task list → `<input type=\"checkbox\">`.\n- Unit: strikethrough → `<del>`.\n- Unit: fenced code block with info string renders `<pre><code class=\"language-rust\">` (or equivalent language class) — validates language hint is preserved in HTML output.\n- Unit: autolinks: bare URL `https://example.com` in Markdown body → output contains `<a href=\"https://example.com\">` (GFM autolink extension active).\n- Unit: blockquotes: `> quoted text` → output contains `<blockquote>`.\n- Unit: ordered list `1. Item` → output contains `<ol>` and `<li>`.\n- Unit: unordered list `- Item` → output contains `<ul>` and `<li>`.\n- Unit: `<script>alert(1)</script>` in input → absent from HTML output.\n- Unit: headings `## Foo`, `## Foo`, `## Foo` → anchors `foo`, `foo-1`, `foo-2`.\n- Unit: headings `## Foo` then `### Foo` → anchors `foo`, `foo-1` (no collision sharing between levels).\n- Unit: anchor IDs are stable across two renders of the same document.\n- Post-build: `cargo build --release` binary size delta vs. baseline ≤500 KB (R10 check).\n- Log: `[render] path=<file> headings=<count>` at info level.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-24T04:48:59.020048968Z","created_by":"exedev","updated_at":"2026-02-24T06:44:17.759132963Z","closed_at":"2026-02-24T06:44:17.759100632Z","close_reason":"Implemented: src/html.rs with render_markdown, HeadingEntry, slug deduplication, GFM extensions, XSS mitigation (unsafe_=false); comrak=0.35.0 pinned in Cargo.toml with default-features=false; mod html added to main.rs; full unit test suite.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-mzl","depends_on_id":"bd-2f2","type":"parent-child","created_at":"2026-02-24T06:24:50.280686309Z","created_by":"exedev","metadata":"{}","thread_id":""},{"issue_id":"bd-mzl","depends_on_id":"bd-p7i","type":"blocks","created_at":"2026-02-24T04:49:02.334218168Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-p4x","title":"Basic markdown rendering: styled text display in terminal viewport","description":"Render parsed markdown content in the ratatui terminal with basic styling: bold for headings (with size differentiation by level), italic for emphasis, colored/boxed code spans, indented block quotes, bullet/numbered lists, and horizontal rules. The content should fill the terminal viewport. No scrolling yet - just render what fits on screen.","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-02-21T00:28:51.101979956Z","created_by":"exedev","updated_at":"2026-02-21T00:52:39.583653330Z","closed_at":"2026-02-21T00:52:39.583611191Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-p4x","depends_on_id":"bd-1sf","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-p7i","title":"Serve5-01: CLI subcommands with legacy compatibility","description":"## Objective\nPreserve `mdmd <file>` TUI behavior while adding explicit `mdmd serve <file>` and `mdmd view <file>` subcommands.\n\n## Implementation Details\n- Refactor clap to support a `Subcommand` enum (`Serve { file, bind, port }`, `View { file }`) plus legacy positional compatibility. Use `#[command(flatten)]` or a manual `Args` compatibility shim; do not break existing `mdmd <file>` parsing.\n- For legacy path: if no subcommand matched, re-parse first positional arg as file path and dispatch to TUI.\n- `view` maps to existing TUI dispatch path; `serve` dispatches to the new web server path.\n- `--help` output describes all three invocation forms.\n- Startup logs indicate which mode was dispatched: `[serve]`, `[view]`, `[legacy]`.\n- R9 mitigation: the refactored clap must not break bare positional file arg parsing.\n- The `serve` subcommand must include both `--bind <ADDR>` (default `127.0.0.1`) and `--port <N>` (default `3333`) as separate flags. `--bind` is the interface address; `--port` is the starting port number passed to bd-1mz's bind retry loop. Integration tests in bd-39z use `--port <free_port>` with a randomly allocated free port to avoid conflicts.\n\n## Acceptance Criteria\n- `mdmd README.md` still launches TUI (no regression).\n- `mdmd view README.md` launches TUI identically.\n- `mdmd serve README.md` dispatches to web server path.\n- `mdmd serve --bind 0.0.0.0 --port 8080 README.md` binds to specified interface and port without error.\n- Help text accurately describes all three invocation forms.\n- Startup diagnostic log line indicates selected mode.\n\n## Verification Steps\n- Unit parse matrix covering: bare file, `view <file>`, `serve <file>`, `serve --bind 127.0.0.1 <file>`, `serve --port 8080 <file>`, `serve --bind 0.0.0.0 --port 3334 <file>`, missing file, `--help`.\n- Integration: spawn binary with bare `README.md` arg, assert TUI mode dispatched (not serve).\n- Integration: spawn binary with `serve README.md`, assert serve mode dispatched.\n- Log line `[legacy]`/`[view]`/`[serve]` must appear in startup output.\n- Verify `--bind` and `--port` are each accepted without error by the clap parser and both values are propagated to server bootstrap (bd-1mz).","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-24T04:48:09.259299658Z","created_by":"exedev","updated_at":"2026-02-24T06:29:36.970815261Z","closed_at":"2026-02-24T06:29:36.970789477Z","close_reason":"Implemented CLI subcommands with legacy compatibility","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-p7i","depends_on_id":"bd-2f2","type":"parent-child","created_at":"2026-02-24T06:24:51.800902346Z","created_by":"exedev","metadata":"{}","thread_id":""}]}
{"id":"bd-t6w","title":"Validate existing resolve_candidate + rewrite_local_links integration","description":"Validate integration of existing local-link rewriting and candidate resolution under the new routing semantics. Do not re-implement `rewrite_local_links()` or `resolve_candidate()`.\n\nImplementation details:\n- Add/adjust tests asserting fallback order remains stable:\n  1) exact path,\n  2) extensionless + `.md`,\n  3) `dir/README.md`,\n  4) `dir/index.md`.\n- Verify markdown-generated links are root-relative hrefs (leading `/`) and remain reachable through HTTP.\n- Use temp-fixture-based scenarios (not repository `playground/` fixtures) to validate CWD-rooted serving behavior.\n- Include explicit CWD-root regression checks where entry is nested under a subdirectory and rewritten links preserve expected rooted prefixes.\n- Ensure `/` routing changes do not alter resolver/rewrite semantics for non-root markdown navigation.\n\nDependency links:\n- Depends on bd-uso.\n- Blocks broad integration suite completion (bd-3h2).\n\n## Acceptance Criteria\n- Existing `resolve_candidate()` fallback order is validated end-to-end without reimplementation: exact, `.md`, `README.md`, `index.md`.\n- Existing `rewrite_local_links()` behavior is preserved for CWD-rooted serving, including nested and parent-relative links that must rewrite to correct root-relative targets.\n- Unit tests pin helper-level normalization/rewrite assumptions that could regress with CWD-root serving.\n- Integration tests verify rewritten targets are reachable (`200`) and resolver branch selection remains stable.\n- E2E script coverage is present in `tests/e2e_serve_navigation.sh` (`link-rewrite-flow` + `logging-signatures`) with detailed request/response and resolver-log capture.\n- Debug logs capture resolver branch decisions and rewritten-target requests with no unexpected `WARN`/`ERROR` on valid navigation.\n\n## Verification Steps\n- Run unit tests for normalization/rewrite assumptions used by resolve_candidate/rewrite_local_links integration.\n- Run integration tests validating fallback order (exact, .md, README.md, index.md) and rewritten-link reachability (HTTP 200).\n- Run e2e link-rewrite-flow checks under RUST_LOG=debug and confirm resolver branch logs with no unexpected WARN/ERROR on valid navigation.","acceptance_criteria":"1) Existing resolve_candidate() fallback order is validated end-to-end without reimplementation: exact, extensionless + .md, dir/README.md, dir/index.md. 2) Existing rewrite_local_links() behavior is preserved for CWD-rooted serving, including nested and parent-relative links that must rewrite to correct root-relative /playground/... targets. 3) Unit tests pin helper-level normalization and URL rewrite assumptions that could regress with serve_root=CWD. 4) Integration tests verify rewritten link targets are directly reachable (HTTP 200) and that fallback branch selection stays stable. 5) E2E script coverage is added/extended in tests/e2e_serve_navigation.sh for link-rewrite and fallback-order paths with detailed per-step logging. 6) Debug logs capture resolver branch decisions and rewritten-target requests, with no unexpected WARN/ERROR on valid navigation.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-24T22:57:02.881975794Z","created_by":"exedev","updated_at":"2026-02-25T00:06:59.022101415Z","closed_at":"2026-02-25T00:06:59.022065098Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-t6w","depends_on_id":"bd-uso","type":"blocks","created_at":"2026-02-24T22:57:15.991556854Z","created_by":"exedev","metadata":"{}","thread_id":""}],"comments":[{"id":6,"issue_id":"bd-t6w","author":"Peter Schilling","text":"This task is a guardrail against accidental rewrite/refactor churn. Treat  and  as established behavior and validate integration through tests rather than replacing implementations.","created_at":"2026-02-24T22:57:35Z"},{"id":12,"issue_id":"bd-t6w","author":"Peter Schilling","text":"Clarification: preserve existing functions rewrite_local_links() and resolve_candidate(); add integration tests instead of rewriting them.","created_at":"2026-02-24T22:57:49Z"},{"id":16,"issue_id":"bd-t6w","author":"Peter Schilling","text":"CWD-based serve_root impact: after bd-2uj changes serve_root from entry_file.parent() to current_dir(), verify that rewrite_local_links() still produces correct root-relative hrefs. Specifically: serving playground/README.md from cwd=/workspace/mdmd-dev means serve_root=/workspace/mdmd-dev and entry_file=/workspace/mdmd-dev/playground/README.md. A relative link like '../code.md' in playground/README.md resolves to /workspace/mdmd-dev/code.md and strips to /code.md. Test this case explicitly: render playground/README.md with serve_root=CWD and assert links to subdir/nested.md produce href='/playground/subdir/nested.md'. Also test that extensionless links in playground/links.md render as /playground/... hrefs after serve_root change. These tests will fail if serve_root is still entry_file.parent(), making them a regression guard for the CWD change.","created_at":"2026-02-24T23:01:21Z"}]}
{"id":"bd-tzk","title":"Code block syntax highlighting with syntect","description":"Add syntax highlighting to fenced code blocks using the syntect crate. Detect the language from the code fence info string (e.g., ```rust, ```python) and apply appropriate syntax coloring. Fall back to plain monospace rendering for unrecognized languages or fences without a language specifier.","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-02-21T00:28:53.768940253Z","created_by":"exedev","updated_at":"2026-02-21T01:46:12.854069214Z","closed_at":"2026-02-21T01:46:12.854021443Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-tzk","depends_on_id":"bd-p4x","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-uso","title":"Route '/' to root directory index with assets precedence","description":"Change routing semantics so GET / always renders the root directory index. Maintain embedded assets precedence (/assets/mdmd.css, /assets/mdmd.js) before file/doc resolution.\n\nImplementation details:\n- The change is in serve_handler() in serve.rs. The current early-exit for normalized empty path (lines 598-602 after bd-2uj changes):\n    let candidate = if normalized == PathBuf::new() {\n        state.entry_file.clone()  // ← REPLACE this entire branch\n    } else { ... };\n  This branch must be REPLACED (not just removed) with a direct call to render_directory_index_response for serve_root, bypassing resolve_candidate entirely:\n    if normalized == PathBuf::new() {\n        return render_directory_index_response(&state, &state.canonical_root, \"/\").await;\n    }\n  Rationale: if left as a fall-through, resolve_candidate(serve_root) would find serve_root/README.md and serve it instead of the index — contradicting the plan.\n- The old candidate construction for the empty-path case (serve entry file) is fully replaced; the else branch serve_root.join(&normalized) remains for all non-root paths.\n- Keep request path normalization and containment checks unchanged.\n- Ensure route dispatch order: embedded assets first → GET / early-exit → normalize/decode → resolve_candidate → markdown/static/dir-index/rich-404.\n- .current_dir(&fixture.root) has already been applied to ServerHandle::new in tests/serve_integration.rs (prerequisite done).\n- Update or remove all integration tests that asserted GET / returns entry markdown content (see Breaking Test Inventory comment).\n\n## Acceptance Criteria\n- Handler keeps `/assets/mdmd.css` and `/assets/mdmd.js` precedence, then short-circuits `GET /` to root directory index rendering without passing through `resolve_candidate()`.\n- `GET /` shows directory index even when root has `README.md`; non-root routing behavior and traversal protections are unchanged.\n- Regression tests migrated from bare `/` to pathful entry URL and include explicit index assertions for `/`.\n- Unit tests verify root-branch selection helper/path logic where applicable.\n- E2E scriptable run is documented and green with detailed logs: `RUST_LOG=debug cargo test --test serve_integration test_serve_root_index -- --nocapture`.\n- Success-path log output contains branch info and no unexpected `WARN`/`ERROR` entries.\n\n## Verification Steps\n- Run: RUST_LOG=debug cargo test --test serve_integration test_serve_root_index -- --nocapture.\n- Assert '/assets/mdmd.css' and '/assets/mdmd.js' still return 200 with expected content types.\n- Assert GET '/' renders root directory index markers and no unexpected WARN/ERROR in successful flow logs.","acceptance_criteria":"1) Route order is enforced: embedded assets first, then explicit GET / root-index early-exit, then normalized-path candidate resolution. 2) GET / always renders root directory index even when <serve_root>/README.md exists; non-root request behavior and traversal guards remain unchanged. 3) Integration tests in tests/serve_integration.rs migrate entry-content assertions from / to the pathful entry URL and add explicit root-index assertions for /. 4) Unit tests cover root-branch selection logic and ensure empty normalized path cannot fall through to resolve_candidate(). 5) E2E script coverage is added/extended in tests/e2e_serve_navigation.sh with a dedicated root-index case, section markers, and verbose request/response logging. 6) Debug logs include branch selection context for root-index rendering; successful root-index scenarios emit no unexpected WARN/ERROR.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-24T22:57:01.995315624Z","created_by":"exedev","updated_at":"2026-02-24T23:41:04.371419574Z","closed_at":"2026-02-24T23:41:04.371345022Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-uso","depends_on_id":"bd-2uj","type":"blocks","created_at":"2026-02-24T22:57:14.829531565Z","created_by":"exedev","metadata":"{}","thread_id":""}],"comments":[{"id":3,"issue_id":"bd-uso","author":"Peter Schilling","text":"Rationale: root-first browsing aligns with filesystem mental model and avoids special-casing entry content at . Keep embedded assets checked before candidate resolution to prevent accidental regression of CSS/JS delivery.","created_at":"2026-02-24T22:57:34Z"},{"id":11,"issue_id":"bd-uso","author":"Peter Schilling","text":"Clarification: root path slash behavior is intentional; GET slash must render root index, not entry markdown.","created_at":"2026-02-24T22:57:49Z"},{"id":14,"issue_id":"bd-uso","author":"Peter Schilling","text":"Coordination note: the serve_root=CWD change is initiated in bd-2uj's startup work but bd-uso owns the handler behavior. Verify that after serve_root=CWD: (1) normalized empty path (GET /) correctly calls the directory-index renderer for canonical_root, not state.entry_file; (2) the existing handler branch 'if normalized == PathBuf::new() { state.entry_file.clone() }' (serve.rs line 544-548) is removed and replaced with the directory-index call. Test updates REQUIRED: the integration test suite and any unit tests that assert GET / returns entry markdown body must be updated to expect root directory index HTML content instead. Add a new assertion: GET / response contains root directory listing markers (e.g. the serve_root directory name in a breadcrumb or the listing body).","created_at":"2026-02-24T23:00:32Z"},{"id":19,"issue_id":"bd-uso","author":"Peter Schilling","text":"CRITICAL LOGIC ERROR in description: the statement 'resolve_candidate(serve_root) returns None (serve_root is a directory with no README.md at root, or delegates to the directory index)' is WRONG. In the real test fixture and in any repo with a README.md at the project root, resolve_candidate(serve_root) WILL find and return that README.md as the 'readme' branch. The server would then serve README.md for GET /, contradicting the plan Decision #1 ('GET / will render the serve_root directory index'). CORRECT IMPLEMENTATION: the normalized==PathBuf::new() early branch must NOT be removed and left to fall through. Instead it must be REPLACED with a direct call to the directory-index renderer for serve_root, bypassing resolve_candidate entirely. Example:\n  if normalized == PathBuf::new() {\n      return render_directory_index_response(&state, &state.canonical_root, \"/\").await;\n  }\nThis ensures GET / always shows a browsable listing even when README.md exists at the project root. The pathful entry URL (printed at startup) is the correct way to reach the entry document.","created_at":"2026-02-24T23:10:01Z"},{"id":20,"issue_id":"bd-uso","author":"Peter Schilling","text":"CRITICAL TEST INFRASTRUCTURE GAP: ServerHandle::new in tests/serve_integration.rs spawns the server binary WITHOUT .current_dir(&fixture.root). After the serve_root=CWD change (already implemented in bd-2uj), the spawned server process CWD is the cargo test runner directory (/home/exedev/workspace/mdmd-dev). All fixture entry paths are under /tmp/... and will fail the 'entry_file.starts_with(canonical_root)' check in run_serve(), causing the server to exit immediately. ALL 30+ integration tests will crash at startup. Fix: add .current_dir(&fixture.root) to the Command::new(bin_path()) spawn in ServerHandle::new (tests/serve_integration.rs line ~124). This is a prerequisite for any integration test to pass. This fix belongs in bd-uso since it owns test updates for the GET / routing change.","created_at":"2026-02-24T23:10:08Z"},{"id":21,"issue_id":"bd-uso","author":"Peter Schilling","text":"BREAKING TEST INVENTORY: the following 7 tests fetch GET / expecting entry markdown content and MUST be updated to use the entry file's path instead (e.g. /README.md since fixture.entry is fixture.root/README.md):\n1. test_serve_basic_html (line 366) - asserts text/html TOC\n2. test_serve_toc_present (line 376) - asserts TOC nav sidebar\n3. test_serve_raw_mode (line 390) - fetches /?raw=1 expecting # Home source; must become /README.md?raw=1\n4. test_serve_table_rendered (line 406) - asserts <table> in body\n5. test_serve_task_list_rendered (line 419) - asserts checkbox\n6. test_serve_mermaid_placeholder (line 434) - asserts class=mermaid\n7. test_serve_mermaid_cdn_script (line 448) - asserts CDN script URL\nAlso update test_serve_startup_stdout_format (line 735): the startup banner now emits 'url:   http://..../README.md' (pathful) AND 'index: http://.../' (root). The test currently checks only for a line starting with 'url:   http://' which still matches. Add an assertion for the 'index: http://' line too, so the two-URL format is verified.\nTests that will still pass without changes: test_serve_nosniff_header (line 561), test_serve_compression_gzip (line 680), test_serve_compression_br (line 693) - all fetch GET / but don't assert entry content.","created_at":"2026-02-24T23:10:19Z"},{"id":24,"issue_id":"bd-uso","author":"Peter Schilling","text":"STATUS UPDATE: .current_dir(&fixture.root) has already been applied to ServerHandle::new in tests/serve_integration.rs (working copy). This prerequisite is done — integration tests will correctly set the server CWD to the fixture root. The remaining work for bd-uso is: (1) replace the early-exit candidate branch in serve_handler(), (2) update the 7 breaking integration tests listed in Breaking Test Inventory.","created_at":"2026-02-24T23:14:27Z"}]}
{"id":"bd-x0l","title":"Help/shortcuts dialog: ? to show filterable keyboard shortcuts","description":"Implement a help modal triggered by '?' that displays all keyboard shortcuts in a clean, organized list. The dialog should be filterable - typing text filters the list to show only matching shortcuts. Shortcuts should be grouped by category (Navigation, Search, View, etc.) with clear formatting.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-02-21T00:28:53.169308593Z","created_by":"exedev","updated_at":"2026-02-21T01:39:30.434893650Z","closed_at":"2026-02-21T01:39:30.434851429Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-x0l","depends_on_id":"bd-1by","type":"blocks","created_at":"2026-02-24T04:37:02Z","created_by":"import","metadata":"{}","thread_id":""}]}
